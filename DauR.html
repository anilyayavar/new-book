<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>R for Audit Analytics</title>

    <meta name="author" content="Anil Goyal" />
  
   <meta name="description" content="<p>This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse.</p>" />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="R for Audit Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="<a href="https://anilyayavar.github.io/new-book/" class="uri">https://anilyayavar.github.io/new-book/</a>" />
  <meta property="og:image" content="<a href="https://anilyayavar.github.io/new-book/" class="uri">https://anilyayavar.github.io/new-book/</a>/images/cover.jpg" />
  <meta property="og:description" content="<p>This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse.</p>" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R for Audit Analytics" />
  
  <meta name="twitter:description" content="<p>This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse.</p>" />
  <meta name="twitter:image" content="<a href="https://anilyayavar.github.io/new-book/" class="uri">https://anilyayavar.github.io/new-book/</a>/images/cover.jpg" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.8.0/transition.js"></script>
    <script src="libs/bs3compat-0.8.0/tabs.js"></script>
    <script src="libs/bs3compat-0.8.0/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
    <style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
      <link rel="stylesheet" href="style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<!--bookdown:title:start-->
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Audit Analytics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="welcome-to-r-for-audit-analytics" class="section level1 unnumbered">
<h1 class="unnumbered">Welcome to R for Audit Analytics</h1>
<p><a href="https://hits.seeyoufarm.com"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fanilyayavar.github.io%2Fnew-book%2F&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=hits&amp;edge_flat=false" alt="Hits" /></a></p>
<p><a href="https://anilyayavar.github.io/new-book/index.html"><img src="images/cover.jpg" alt="Hard-Cover to be released soon" class="cover" width="705" height="1125"/></a></p>
<p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
<p><a property="dct:title" rel="cc:attributionURL" href="https://anilyayavar.github.io/new-book/">R for Audit Analytics</a> by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://www.linkedin.com/in/anil-kumar-goyal/">Anil Goyal</a> is licensed under <a href="https://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC 4.0<img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"/><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"/><img src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1" style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"/></a></p>
</p>
<p>The author works for Government of India. The opinions expressed in this book are personal to the author and are not to be construed as that of Government of India, or of author in his official capacity. All data-sets and examples used in the book are either sample data-sets available with R and allied packages or available online (or other sources) as open data-sets or created by author himself to demonstrate the case under discussion. None of the data-sets and examples used in this book pertain to any entity ever handled by the author in his official capacity and do not breach the official secrecy in any manner.</p>
<hr />
<p>This is website for book <strong>R for Audit Analytics</strong> hosted for absolutely free for use by all. This is the work by <a href="https://www.linkedin.com/in/anil-kumar-goyal/">Anil Goyal</a>. Suggestions, errors, etc. may be communicated to author over his email <a href="mailto:anilyayavar@gmail.com" class="email">anilyayavar@gmail.com</a> or through the <a href="https://github.com/anilyayavar/new-book">github version</a> of this book.</p>
</div>
<div id="preface" class="section level1 unnumbered">
<h1 class="unnumbered">Preface</h1>
<blockquote>
<p>“R is the Swiss Army knife of data science. It’s a versatile and powerful tool that can handle nearly any data-related task, from data cleaning and preparation to statistical modeling and machine learning. And because it’s open-source, there’s a vast ecosystem of packages and tools available to extend its capabilities even further.” - Norman Matloff, professor of computer science at the University of California, Davis.</p>
</blockquote>
<p>Welcome to my book on R language, designed specifically for auditors who are interested in learning data analytics using open source resources. In today’s digital age, data is abundant and ubiquitous, and its importance cannot be overstated. As a result, auditors must be equipped with the necessary skills to leverage this data and draw insights from it. This book is a result of my love for R and my passion for data analytics. In this book, I have tried to present R programming concepts and case studies that are useful in audit analysis as well as forensic audit and fraud investigation.</p>
<p>This book is written based on my notes on R while I was learning the language myself. I have included sufficient figures and examples to make the concepts easy to understand for readers. Most of the figures have been created by me except a few, for which due credit has been given.</p>
<p>R is an open-source programming language that has been gaining popularity in recent years due to its versatility and flexibility in data analysis. My journey with R began during COVID-19 lock-down, and I was introduced to R for data analysis by one of my colleagues. Since then, R has become an essential tool in my toolbox for data analysis.</p>
<p>In this book, I have tried to make the concepts of R programming and data analytics as accessible as possible for auditors who may have little or zero knowledge of programming. The first part of the book covers R programming concepts which are absolutely necessary to work in R. Second part onward covers data wrangling/transformation techniques as well as different techniques useful in forensic audit and fraud investigation.</p>
<p>I hope that this book will be a useful resource for auditors who want to learn data analytics using open source resources like R. I invite readers to share their suggestions and comments on the book to help me improve it further.</p>
<p>Happy reading and happy learning!</p>
<div id="acknowledgments" class="section level2 unnumbered">
<h2 class="unnumbered">Acknowledgments</h2>
<p>Writing this book has been a journey filled with learning, challenges, and invaluable support from those around me. First and foremost, I extend my deepest gratitude to my wife, <strong>Reena</strong>, whose unwavering encouragement and belief in my abilities persuaded me to embark on this endeavour. Her steadfast support has been the cornerstone of my motivation throughout this process.</p>
<p>I am also profoundly grateful to my esteemed colleagues, whose expertise, insights, and feedback have greatly enriched the content of this book. Their willingness to share their knowledge, provide suggestions, and meticulously point out errors and mistakes have been instrumental in refining the quality and accuracy of the material presented herein.</p>
<p>Furthermore, I extend my thanks to all those who have contributed to this project in various capacities, whether through discussions, reviews, or moral support. Your contributions have been invaluable and have undoubtedly played a significant role in shaping this book.</p>
<p>Lastly, I would like to express my appreciation to the readers who will engage with this book. It is my sincere hope that the knowledge imparted within these pages proves valuable and contributes to the advancement of auditing practices utilizing the R language.</p>
<p>Thank you, from the depths of my heart, for being a part of this journey.</p>
</div>
<div id="r-not-just-a-letter" class="section level2 unnumbered">
<h2 class="unnumbered">R, not just a letter</h2>
<p>R programming language is the extended version of the S programming language. John Chambers, the creator of the S programming language in 1976 at Bell laboratories. In 1988, the official version of the S language came into existence with the name S-PLUS. The R language is almost the unchanged version of S-PLUS.</p>
<p>In 1991, R was created by <strong>Ross Ihaka</strong> and <strong>Robert Gentleman</strong> in the Department of Statistics at the University of Auckland. Ross’s and Robert’s experience developing R is documented in a 1996 paper in the Journal of Computational and Graphical Statistics.<span class="citation"><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></span> In 1997 the R Core Group was formed, containing some people associated with S and S-PLUS. Currently, the core group controls the source code for R and is solely able to check in changes to the main R source tree. Finally, in 2000 R version 1.0.0 was released to the public. </p>
<div class="figure" style="text-align: center">
<img src="images/history.png" alt="A Brief History of R" width="90%" />
<p class="caption">
(#fig:history)A Brief History of R
</p>
</div>
</div>
<div id="why-r" class="section level2 unnumbered">
<h2 class="unnumbered">Why R?</h2>
<p>R programming language is an open-source programming language for statistical computation. It supports n number of statistical analysis techniques, machine learning models, and graphical visualization for data analysis. It serves the purpose of the free software environment for statistical computation and graphics. R is easy to understand and implement. The packages are available to create an effective R program, data models, and graphical charts. For research and analytics purposes, it is a popular language among statisticians and data scientists.</p>
<div class="figure" style="text-align: center">
<img src="images/whyR.png" alt="Why R" width="90%" />
<p class="caption">
(#fig:whyr)Why R
</p>
</div>
<p>I always admire <strong>Hadley Wickham</strong>’s contributions to the development of R programming concepts, that has made data analysis more accessible and efficient. The tidyverse, a collection of R packages developed by Wickham, has transformed the way data analysts and data scientists work with data. The tidyverse promotes a consistent and coherent way of working with data, making it easier to write code that is easier to read, understand, and maintain. Wickham’s contributions to R have become the foundation of many data analysis tools in other programming languages, including Python and Julia. I hope that this book will inspire readers to explore the vast potential of R and the contributions made by Wickham in data analytics.</p>
<p>One of the advantages of using free/open source tools like R is that they can be easily customized and extended to suit the specific needs of the user. Additionally, free/open source tools are often updated more frequently than licensed tools, ensuring that users have access to the latest features and bug fixes. Using licensed data analytics tools like Caseware IDEA, Tableau, Power BI and others can be expensive, and their licensing fees can be a significant burden on smaller organizations or individuals. By using open source tools like R, users can significantly reduce their costs while still having access to powerful data analytics capabilities.</p>
<p>Another strength of R is its extensive library of packages, which includes many tools for statistical analysis and data visualization.</p>
</div>
</div>
<div id="about-author" class="section level1 unnumbered">
<h1 class="unnumbered">About author</h1>
<p>Anil Goyal is a data analytics enthusiast who has been working in the Indian Audit and Accounts Department since 1998. Anil has a passion for learning and applying programming languages/other tools such as R and Tableau to solve data-related challenges.</p>
<p>Anil is a self-taught expert in R, and has been involved in a variety of data analytics projects and audits.</p>
<p>Anil holds a post-graduate degree in Mathematics from the University of Rajasthan, Jaipur, which he received in 1998. This book is his first book. He continues to expand his skill set and knowledge in this field. Anil also loves to solve problems raised by various users on <a href="https://stackoverflow.com/users/2884859/anilgoyal">StackOverflow.com</a> mainly related to R language.</p>
<p>When not working with data, Anil enjoys pursuing his personal interests, which include <a href="https://www.flickr.com/search/?user_id=121352773%40N04&amp;view_all=1&amp;text=birds">photographying birds</a>, <a href="https://www.flickr.com/search/?user_id=121352773%40N04&amp;view_all=1&amp;text=landscape">nature</a>; reading and watching movies, etc..</p>
<!--chapter:end:index.Rmd-->
</div>
<div id="gearing-up" class="section level1 unnumbered">
<h1 class="unnumbered">Gearing up</h1>
<div id="download-and-installation" class="section level2" number="0.1">
<h2><span class="header-section-number">0.1</span> Download and installation</h2>
<p>The R programming language for local computer can be downloaded from web portal of <strong>The Comprehensive R Archive Network</strong>, in short mostly referred to as <strong>CRAN</strong>, which is a network of ftp and web servers around the world that store identical, up-to-date, versions of code and documentation for R. The portal address is <a href="https://cran.r-project.org/">https://cran.r-project.org/</a> -</p>
<div class="figure" style="text-align: center">
<img src="images/CRAN.png" alt="CRAN Portal" width="60%" />
<p class="caption">
(#fig:cranportal)CRAN Portal
</p>
</div>
<p>Download the specific (as per the operating system) file from the port and install it following the instructions. The R programming interface looks like-</p>
<div class="figure" style="text-align: center">
<img src="images/workspace.png" alt="R Workspace" width="70%" />
<p class="caption">
(#fig:workspace)R Workspace
</p>
</div>
</div>
<div id="writing-your-first-code" class="section level2" number="0.2">
<h2><span class="header-section-number">0.2</span> Writing your first code</h2>
<p>Writing code in R is pretty easy. Just type the command in front of <code>&gt;</code>, as shown in figure @ref(fig:workspace) prompt and press <code>Enter(Return)</code> key. R will display the results in next line.</p>
<div class="figure" style="text-align: center">
<img src="images/first_code.png" alt="Left - Writing first Code in R; Right - Indenting code not necessary but recommended" width="49%" height="49%" /><img src="images/indent.png" alt="Left - Writing first Code in R; Right - Indenting code not necessary but recommended" width="49%" height="49%" />
<p class="caption">
(#fig:first)Left - Writing first Code in R; Right - Indenting code not necessary but recommended
</p>
</div>
</div>
<div id="things-to-remember" class="section level2" number="0.3">
<h2><span class="header-section-number">0.3</span> Things to remember</h2>
<ol style="list-style-type: decimal">
<li>R is case sensitive. This will have to be remembered while writing/storing/calling functions or other objects. So <code>Anil</code>, <code>ANIL</code>, <code>anil</code> all are different objects in R.</li>
<li>White spaces between different pieces of codes don’t matter. See figure-@ref(fig:first) above. Both <code>3+4</code> and <code>3 + 4</code> will evaluate same. However, for better readability it is always better to use spaces.</li>
<li>Parenthesis <code>()</code> are generally used to change the natural order of precedence. Moreover, these are also used in passing arguments to functions, which will be discussed in detail in chapter-@ref(func) and onward.</li>
<li>Multi-line code(s) aren’t required to be indented in R. In R, indents have no meaning. However, following best practices to write a code that is understandable by readers, proper indentation is suggested. See figure-@ref(fig:first) (right) above.</li>
<li>If an incomplete code is written in the first line of the code (useful when a single line is not sufficient to write complete code), R will automatically prompt as displaying <code>+</code> at the beginning of line, instead of a <code>&gt;</code>. See figure-@ref(fig:first) (right) above.</li>
<li>Indices in R always start from 1 (and not from 0). This has been discussed in detail in chapter-@ref(subset).</li>
<li>Code that start with hash symbol <code>#</code> does not execute. Even in a line if <code>#</code> appears in between the line, the code from that place does not get executed. See the following example. Comments may be used in codes for either of the purposes -
<ul>
<li>Code Readability</li>
<li>Explanation of code</li>
<li>Inclusion of metadata, other references, etc.</li>
<li>Prevent execution of certain line of code</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># 1 + 3 (this won&#39;t be executed)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">3</span> <span class="co"># +5</span></span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<blockquote>
<p>Tip: to clear the workspace, just click <code>ctrl</code> + <code>l</code>.</p>
</blockquote>
<p>Normally R code files have an extension <code>.R</code> but other R files may have other extensions, such as project files <code>.Rproj</code>, markdown files <code>.Rmd</code>, and many more.</p>
<p>All of the programming/code writing may be done in R. But you may have noticed that code once executed cannot be edited. The code has to written again (Tip: To get previous executed command just use scroll up key on keyboard). Thus, in order to use many other smart features, we will write our code as R scripts i.e. in <code>.R</code> files, using most popular IDE for R which is <code>R Studio</code>.</p>
<blockquote>
<p>Rstudio IDE is so popular among those using R, that many people cannot distinguish between R and its IDE. Even Stack Overflow which is a popular forum to seek online help explicitly asks users not to tag ‘R studio’ in general R code problems<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
</blockquote>
</div>
<div id="r-studio-ide" class="section level2" number="0.4">
<h2><span class="header-section-number">0.4</span> R studio IDE</h2>
<p>RStudio is free and open source IDE (Integrated Development Environment) for R, which is available for Windows, Mac OS and LINUX. It can be downloaded from its portal <a href="https://posit.co/download/rstudio-desktop/">https://posit.co/download/rstudio-desktop/</a>. For our most of the data analytics needs, we require Rstudio desktop version, which is available for free to download and installation.</p>
<p>It includes a console, syntax-highlighting editor that supports direct code execution, and a variety of robust tools for plotting, viewing history, debugging and managing your work-space. After downloading and installing it the local machine, a work-space/UI similar to that shown in following figure, is opened.</p>
<div class="figure" style="text-align: center">
<img src="images/rstudio.png" alt="R Studio interface" width="90%" />
<p class="caption">
(#fig:rstud)R Studio interface
</p>
</div>
<p>There are four panels</p>
<ul>
<li>Top-left:
<ul>
<li><strong>Scripts and Files:</strong> The script files which we will be working on, will be opened and displayed here. To open a new script, you just need to click the new script button <img src="images/new_script.png" /> which is just below the <em>file menu.</em>; or using keyboard shortcut <code>ctrl + shift + n</code></li>
</ul></li>
<li>Bottom-left:
<ul>
<li><strong>R console:</strong> is where the R commands can be written and see the output. Even the commands run on script will show the output in this panel.</li>
</ul></li>
</ul>
<p><img src="images/console.png" id="id" class="class" width="447" height="157" />
+ <strong>Terminal:</strong> Here we can access our system shell.
- Top-right:
+ <strong>Environment:</strong> To see the objects saved in current environment. This panel is also used to import data in current environment.
+ <strong>History</strong> To view the history of commands run, in the current session
+ <strong>Connections:</strong> Used to connect/import with external database/data
- Bottom-right:
+ <strong>Files</strong> having tree of folders, to see the file structure of current working directory
+ <strong>Plots</strong> graph window, if the output of R command is a plot/graph, it will be generated here.</p>
<p><img src="images/plotspane.png" id="id" class="class" width="771" height="293" />
+ <strong>Packages</strong>, to download and load the external packages using mouse click
+ <strong>Help</strong>, window to get help on desired functions. Even the help sought through r command will be displayed in this window.</p>
<p><img src="images/helppane.png" id="id" class="class" width="774" height="282" />
+ <strong>Viewer:</strong> can be used to view local web content.</p>
<p><img src="images/viewerpane.png" id="id" class="class" width="752" height="272" /></p>
<p>Readers may note that to execute the code from a .R file is slightly different than to execute it from <code>console</code> where pressing <code>Enter/Return</code> key just executes it and gives us result in the next line. To run the script from the <code>Scripts and Files</code> pane (Top-left) we can do either of the following -</p>
<ul>
<li>Select the code and press <code>ctrl/command + Enter/Return</code> keys.</li>
<li>If the cursor is anywhere between the code or even anywhere in the line(s) having the code/code-block, we can press <code>ctrl/command + Enter/Return</code> keys.</li>
<li>Or alternatively, we can make use of <code>Run</code> button <img src="images/run.png" /> given in top-right side of <code>Files and Scripts</code> pane.</li>
</ul>
<p><img src="images/rstudiopanes.png" id="id" class="class" width="770" height="575" /></p>
<blockquote>
<p>To get a quick overview (and for later-on references) readers may refer to the <a href="https://rstudio.github.io/cheatsheets/rstudio-ide.pdf">Rstudio cheatsheet</a> available from <a href="https://posit.co/resources/cheatsheets/">Posit Cheatsheets page</a>, wherein many other cheatsheets are also available.</p>
</blockquote>
</div>
<div id="packages-and-libraries-and-conflicts" class="section level2" number="0.5">
<h2><span class="header-section-number">0.5</span> Packages and libraries and conflicts</h2>
<p>As already stated, one of the strength of R is that numerous user-written packages (or <em>libraries</em>) are available on <strong>Comprehensive R Archive Network</strong> i.e. <a href="https://cran.r-project.org/">CRAN</a>. Package installation is perhaps easiest of the jobs in R.</p>
<p>The command is fairly simple -</p>
<pre><code>install.packages(&quot;library_name&quot;)</code></pre>
<p>which downloads the given package name (to be given in quotes and is case-sensitive), compiles it and then load it into the specified/default directory. This will however, not load into the memory/R current session. The libraries/packages are to be downloaded only once in a computer/system but need to be loaded in each and every new session of R, using the command- </p>
<pre><code>library(library_name)</code></pre>
<p>Quotes here, are optional but package name is still case sensitive. So to install and load <code>tidyverse</code> we need to run first command once (which will download the package into your local computer) but second command (to load it in the current R session) at every new session.</p>
<pre><code>install.packages(&#39;tidyverse&#39;)</code></pre>
<p>Rstudio pane <code>Packages</code> may also be used, as shown in the following image (taken from cheatsheet).</p>
<p><img src="images/pack.png" id="id" class="class" width="507" height="327" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.4     ✔ readr     2.1.5
## ✔ forcats   1.0.0     ✔ stringr   1.5.1
## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
## ✔ purrr     1.0.2     
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
<p>Also notice the output of library command above. Besides loading successfully, nine packages which we will discuss in section @ref(TIDYVE), it has given a message about conflicts.</p>
<p>So what are these conflicts? Actually when a function having exactly same name resides in multiple package a conflict arises, and R by default prefers the conflicted functions loaded in last. Here, package <code>stats</code> which is part of base R also consists of a function <code>filter</code> which has been overridden by package <code>dplyr</code> loaded as part of <code>tidyverse</code>. Thus, after loading <code>dplyr</code>, this function <code>filter</code> has been masked from <code>stats</code>.</p>
<p>In case we want to use <code>filter</code> from masked <code>stats</code> we may either</p>
<ul>
<li>call it using double colon operator (Refer section @ref(doublec)), i.e. using <code>stats::filter()</code>; or</li>
<li>make use of another package <code>conflicted</code> which is again part of tidyverse as follows-</li>
</ul>
<pre><code>library(conflicted)
conflict_prefer(&quot;filter&quot;, &quot;stats&quot;)</code></pre>
<blockquote>
<p>Usage of package <code>conflicted</code> is advised with a bit caution, as loading this package causes to restrict usage of conflicted function altogether i.e. without giving explicit preference.</p>
</blockquote>
<div id="doublec" class="section level3" number="0.5.1">
<h3><span class="header-section-number">0.5.1</span> Double Colon operator <code>::</code></h3>
<p>In R, we can use double colon operator i.e. <code>::</code> to access functions that are defined as part of the internal functions that a package uses. These may be used in at least two cases-</p>
<ol style="list-style-type: decimal">
<li>To call a function say <code>filter</code> from package <code>dplyr</code> we may use <code>dplyr::filter()</code> without actually loading it.<br />
</li>
<li>In cases of conflicts as discussed in preceding section, e.g. <code>stats::filter()</code>.</li>
</ol>
</div>
</div>
<div id="help" class="section level2" number="0.6">
<h2><span class="header-section-number">0.6</span> Getting Help within R</h2>
<p>Once R is installed, there is a comprehensive built-in help system. We can use any of the following commands-</p>
<pre><code>help.start()   # general help
help(foo)      # help about function `foo`
?foo           # same as above
apropos(&quot;foo&quot;) # show all functions containing word `foo`
example(foo)   # show an example of function `foo`</code></pre>
<p>Alternatively, features under the Help menu or help pane, can also be used.</p>
</div>
<div id="TIDYVE" class="section level2" number="0.7">
<h2><span class="header-section-number">0.7</span> tidyverse</h2>
<p>The <a href="https://www.tidyverse.org/">tidyverse</a> is a <em>package of packages</em> that work in harmony because they share common data representations and ‘API’ design. This package is designed to make all these easy to install and load multiple ‘tidyverse’ packages in a single step.</p>
<p>Though <code>tidyverse</code> is a collection 20+ packages (in fact 80+ packages will be installed including depended packages) which are all installed by <code>install.packages("tidyverse")</code> command, yet <code>library(tidyverse)</code> load <a href="https://www.tidyverse.org/packages/">nine</a> of them. Others (like <code>readxl</code>) will have to loaded explicitly.</p>
<ol style="list-style-type: decimal">
<li><a href="https://ggplot2.tidyverse.org/"><strong>ggplot2</strong></a> is a system for decoratively creating graphics, based on <a href="https://link.springer.com/book/10.1007/0-387-28695-0"><em>The Grammar of Graphics</em></a>.</li>
<li><a href="https://dplyr.tidyverse.org/"><strong>dplyr</strong></a> provides a grammar of data manipulation, providing a consistent set of verbs that solve the most common data manipulation challenges.</li>
<li><a href="https://tidyr.tidyverse.org/"><strong>tidyr</strong></a> provides a set of functions useful for data transformation.</li>
<li><a href="https://readr.tidyverse.org/"><strong>readr</strong></a> is used to read and write rectangular/tabular data formats.</li>
<li><a href="https://purrr.tidyverse.org/"><strong>purrr</strong></a> is functional programming (FP) toolkit for working with functions and vectors.</li>
<li><a href="https://tibble.tidyverse.org/"><strong>tibble</strong></a> provides functionalities related to displaying data frames.</li>
<li><a href="https://stringr.tidyverse.org/"><strong>stringr</strong></a> provides set of functions designed to work with strings. It is built on top of another package <a href="https://cran.r-project.org/package=stringi">stringi</a>.</li>
<li><a href="https://forcats.tidyverse.org/"><strong>forcats</strong></a> provides a suite of useful tools that solve common problems with factors.</li>
<li><a href="https://lubridate.tidyverse.org/"><strong>lubridate</strong></a> makes it easier to do the things R does with date-times.</li>
</ol>
<p>With latest version of Tidyverse, while loading it <a href="https://lubridate.tidyverse.org/"><strong>lubridate</strong></a> also loads with default.</p>
<div class="figure" style="text-align: center">
<img src="images/tidyverse.png" alt="tidyverse" width="70%" />
<p class="caption">
(#fig:tidyverse)tidyverse
</p>
</div>
<p>There are several other <code>tidyverse</code> packages which we will be working with-</p>
<ul>
<li><code>hms</code></li>
<li><code>readxl</code></li>
<li><code>glue</code></li>
</ul>
<!--chapter:end:00-Zero.Rmd-->
</div>
</div>
<div id="part-i-basic-r-programming-concepts" class="section level1 unnumbered">
<h1 class="unnumbered">Part-I: Basic R Programming Concepts</h1>
</div>
<div id="r-programming-language" class="section level1" number="1">
<h1><span class="header-section-number">1</span> R Programming Language</h1>
<div id="calculator" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Use R as a calculator</h2>
<p>To start learning R, just start entering equations directly at the command prompt <code>&gt;</code> and press enter. So, <code>3+4</code> will give you result <code>7</code>. Common mathematical operators are listed in table @ref(tab:table3).</p>
<table>
<caption>(#tab:table3) Common Mathematical Operators in R</caption>
<colgroup>
<col width="16%" />
<col width="33%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Operator/ function</th>
<th align="left">Meaning</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>+</code></td>
<td align="left">Addition</td>
<td align="left"><code>4 + 5</code> is <code>9</code></td>
</tr>
<tr class="even">
<td align="center"><code>-</code></td>
<td align="left">Substraction</td>
<td align="left"><code>4 - 5</code> is <code>-1</code></td>
</tr>
<tr class="odd">
<td align="center"><code>*</code></td>
<td align="left">Multiplication</td>
<td align="left"><code>4 * 5</code> is <code>20</code></td>
</tr>
<tr class="even">
<td align="center"><code>/</code></td>
<td align="left">Division</td>
<td align="left"><code>4/5</code> is <code>0.8</code></td>
</tr>
<tr class="odd">
<td align="center"><code>^</code></td>
<td align="left">Exponent</td>
<td align="left"><code>2^4</code> is <code>16</code></td>
</tr>
<tr class="even">
<td align="center"><code>%%</code></td>
<td align="left">Modulus (Remainder from division)</td>
<td align="left"><code>15 %% 12</code> is <code>3</code></td>
</tr>
<tr class="odd">
<td align="center"><code>%/%</code></td>
<td align="left">Integer Division</td>
<td align="left"><code>15 %/% 12</code> is <code>1</code></td>
</tr>
</tbody>
</table>
<p>Strings or Characters have to be enclosed in single <code>'</code> or double<code>"</code> quotes (more on strings in section @ref(string)). So a few examples of calculations that can be performed in R could be-</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="dv">4</span> <span class="sc">+</span> <span class="dv">3</span> <span class="sc">^</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="dv">8</span> <span class="sc">*</span> (<span class="dv">9</span> <span class="sc">+</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 104</code></pre>
<blockquote>
<p>Note that R follows common mathematical order of precedence while evalauting expressions. That may be changed using simple parenthesis i.e. <code>()</code>. Also note that other brackets/braces i.e. curly braces <code>{}</code> and <code>[]</code> have been assigned different meaning, so to change nested order of operations only <code>()</code> may be used.</p>
</blockquote>
</div>
<div id="object-assignment" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Object Assignment</h2>
<p>R is an object-oriented language.<span class="citation"><a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></span> This means that <em>objects</em> are created and stored in R environment so that they can be used later.</p>
<p>So what is an object? An object can be something as simple as a number (value) that can be assigned to a variable. Think of it like this; Suppose we have greet each user by his/her name prefixing <em>hello</em> to his/her name. Now user’s name may be saved in our work environment for later use. Thus, once the user name is saved in a variable then can be retrieved later on, by calling the variable name instead of asking the user name again and again. An object can be also be a data-set or complex model output or some function. Thus, an object created in R can hold multiple values.</p>
<p>The other important thing about objects is that objects are created in R, using the assignment operator <code>&lt;-</code>. Use of equals sign <code>=</code> to set something as an object is not recommended thought it will work properly in some cases. For now we will stick with the assignment operator, and interpret it as the left side is the object name that is storing the object information specified on the right side. <em>If <code>-&gt;</code> right hand side assignment is used, needless to say things mentioned above will interchange.</em></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># user name</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>user_name <span class="ot">&lt;-</span> <span class="st">&#39;Anil Goyal&#39;</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># when the above variable is called</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>user_name</span></code></pre></div>
<pre><code>## [1] &quot;Anil Goyal&quot;</code></pre>
<blockquote>
<p><strong>Case sensitive nature:</strong> Names of variables even all objects in R are case sensitive, and thus <code>user</code>, <code>USER</code> and <code>useR</code>; all are different variables.</p>
</blockquote>
</div>
<div id="atomic-data-types-in-r" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Atomic data types in R</h2>
<p>We have seen that objects in R can be created to store some values/data. Even these objects can contain other objects as well. So a question arises, what is the most atomic/basic data type in R. By atomic we mean that the object cannot be split any further. Thus, the atomic objects created in R can be thought of variables holding one single value. E.g. user’s name, user’s age, etc. Now atomic objects created in R can be of six types-</p>
<ul>
<li>logical (or Boolean i.e. TRUE FALSE etc.)</li>
<li>integer (having non-decimal numeric values like 0, 1, etc.)</li>
<li>double ( or floating decimal type i.e. having numeric values in decimal i.e. 1.0 or 5.25, etc.)</li>
<li>character (or string data type having some alphanumeric value)</li>
<li>complex (numbers having both real and imaginary parts e.g. 1+1i)</li>
<li>raw (not discussed here)</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/datatypes.png" alt="Data types in R" width="429" height="60%" />
<p class="caption">
(#fig:datatypes)Data types in R
</p>
</div>
<p>Let us discuss all of these.</p>
<blockquote>
<p>Note: We will use a pre-built function <code>typeof()</code> to check the type of given value/variable. However, functions as such will be discussed later-on.</p>
</blockquote>
<div id="logical" class="section level3" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Logical</h3>
<p>In R logical values are stored as either <code>TRUE</code> or <code>FALSE</code> (all in caps)</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="cn">TRUE</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>my_val <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="fu">typeof</span>(my_val)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<p><strong><code>NA</code></strong>: There is one special type of logical value i.e. <code>NA</code> (short for <em>Not Available</em>). This is used for missing data.</p>
<blockquote>
<p>Remember missing data is not an empty string. The difference between the two is explained in section @ref(string).</p>
</blockquote>
</div>
<div id="integer" class="section level3" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Integer</h3>
<p>Numeric values can either be integer (i.e. without a floating point decimal) or with a floating decimal value (called <code>double</code> in r). Now integers in R are differentiated by a suffix <code>L</code>. E.g.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>my_val1 <span class="ot">&lt;-</span> <span class="dv">2</span><span class="dt">L</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">typeof</span>(my_val1)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
</div>
<div id="double" class="section level3" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Double</h3>
<p>Numeric values with decimals are stored in objects of type <code>double</code>. It should be kept in mind that if storing an integer value directly to a variable, suffix <code>L</code> must be used otherwise the object will be stored as <code>double</code> type as shown in above example.</p>
<p>In double type, exponential formats or hexadecimal formats to store these numerals may also be used.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>my_val2 <span class="ot">&lt;-</span> <span class="fl">2.5</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>my_val3 <span class="ot">&lt;-</span> <span class="fl">1.23e4</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>my_val4 <span class="ot">&lt;-</span> <span class="dv">0xcafe</span> <span class="co"># hexadecimal format (prefixed by 0x)</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="fu">typeof</span>(my_val2)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">typeof</span>(my_val3)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">typeof</span>(my_val4)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<blockquote>
<p>Note: Suffix <code>L</code> may also be used with numerals in hexadecimal (e.g. <code>0xcafeL</code>) or exponential formats (e.g. <code>1.23e4L</code>), which will coerce these numerals in <code>integer</code> format.</p>
</blockquote>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="dv">0xcafe</span><span class="dt">L</span>)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p>Thus, both <code>integer</code> and <code>double</code> data types may be understood in R as having sub-types of <code>numeric</code> data. There are three other types of special numerals (specifically doubles) <code>Inf</code>, <code>-Inf</code> and <code>NaN</code>. The first two are infinity (positive and negative) and the last one denotes an indefinite number (<code>NaN</code> short for <em>Not a Number</em>).</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="dv">0</span></span></code></pre></div>
<pre><code>## [1] Inf</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="sc">-</span><span class="dv">45</span><span class="sc">/</span><span class="dv">0</span></span></code></pre></div>
<pre><code>## [1] -Inf</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="dv">0</span><span class="sc">/</span><span class="dv">0</span></span></code></pre></div>
<pre><code>## [1] NaN</code></pre>
</div>
<div id="string" class="section level3" number="1.3.4">
<h3><span class="header-section-number">1.3.4</span> Character</h3>
<p>Strings are stored in R as a character type. Strings should either be surrounded by single quotes <code>''</code> or double quotes <code>""</code><a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>my_val5 <span class="ot">&lt;-</span> <span class="st">&#39;Anil Goyal&#39;</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>my_val6 <span class="ot">&lt;-</span> <span class="st">&quot;Anil Goyal&quot;</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>my_val7 <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span> <span class="co"># empty string</span></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>my_missing_val <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co"># missing value</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a><span class="fu">typeof</span>(my_val5)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="fu">typeof</span>(my_val6)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="fu">typeof</span>(my_val7)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="fu">typeof</span>(my_missing_val)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<blockquote>
<p><a href="%5BNotes:%5D(Notes:)%7B.uri%7D" class="uri">[Notes:\\](Notes:){.uri}</a> 1. Though <code>NA</code> is basically of type logical yet it will be used to store missing values in any other data type also as shown in subsequent chapter(s). 2. Special characters are escaped with <code>\</code>; Type <code>?Quotes</code> in console and check documentation for full details. 3. A simple use of <code>\</code> escape character may be to use <code>"</code> or <code>'</code> within these quotes. Check Example-3 below.</p>
</blockquote>
<p>Example-1: Usage of double and single quote interchangeably.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a>my_val8 <span class="ot">&lt;-</span> <span class="st">&quot;R&#39;s book&quot;</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>my_val8</span></code></pre></div>
<pre><code>## [1] &quot;R&#39;s book&quot;</code></pre>
<p>Example-2: Usage of escape character.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;This is first line.</span><span class="sc">\n</span><span class="st">This is new line&quot;</span>)</span></code></pre></div>
<pre><code>## This is first line.
## This is new line</code></pre>
<p>Example-3: Usage of escape character to store single/double quotes as string themselves.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\&#39;</span><span class="st"> is single quote and </span><span class="sc">\&quot;</span><span class="st"> is double quote&quot;</span>)</span></code></pre></div>
<pre><code>## &#39; is single quote and &quot; is double quote</code></pre>
<p><strong>Note:</strong> If absence of indices has been noticed in above code output, learn more about <code>cat</code> function <a href="#cat">here</a>.</p>
</div>
<div id="null" class="section level3" number="1.3.5">
<h3><span class="header-section-number">1.3.5</span> NULL</h3>
<p><code>NULL</code> (note: all caps) is a specific data type used to create an empty vector. Even this <code>NULL</code> can be used as a vector in itself.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<pre><code>## [1] &quot;NULL&quot;</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a>vec</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>vec</span></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
<div id="complex" class="section level3" number="1.3.6">
<h3><span class="header-section-number">1.3.6</span> Complex</h3>
<p>Complex numbers are made up of real and imaginary parts. As these will not be used in the data analysis tasks, it is not discussed in detail here.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a>my_complex_no <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">+</span><span class="dv">1</span><span class="dt">i</span></span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a><span class="fu">typeof</span>(my_complex_no)</span></code></pre></div>
<pre><code>## [1] &quot;complex&quot;</code></pre>
</div>
</div>
<div id="data-structuresobject-types-in-r" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Data structures/Object Types in R</h2>
<p>Objects in R can be either homogeneous or heterogeneous.</p>
<div class="figure" style="text-align: center">
<img src="images/homgeneous.jpg" alt="Objects/Data structures in R, can either be homogeneous (left) or heterogeneous (right)" width="49%" height="49%" /><img src="images/hetero.jpg" alt="Objects/Data structures in R, can either be homogeneous (left) or heterogeneous (right)" width="49%" height="49%" />
<p class="caption">
(#fig:datastr)Objects/Data structures in R, can either be homogeneous (left) or heterogeneous (right)
</p>
</div>
<div id="homogeneous-objects" class="section level3 unnumbered">
<h3 class="unnumbered">Homogeneous objects</h3>
</div>
<div id="vectors" class="section level3" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Vectors</h3>
<p>What is a vector? A vector is simply a collection of values/data of same type.</p>
<div class="figure" style="text-align: center">
<img src="images/vec_buck.jpg" alt="Vectors are homegeneous data structures in R" width="99%" />
<p class="caption">
(#fig:vecs)Vectors are homegeneous data structures in R
</p>
</div>
<div id="simple-vectors-unnamed-vectors" class="section level4" number="1.4.1.1">
<h4><span class="header-section-number">1.4.1.1</span> Simple vectors (Unnamed vectors)</h4>
<p>Though, <code>Vector</code> is the most atomic data type used in R, yet it can hold multiple values (of same type) simultaneously. In fact vector is a collection of multiple values of same type. So why vector is atomic when it can hold multiple values? You may have noticed a <code>[1]</code> printed at the start of line of output whenever a variable was called/printed. This <code>[1]</code> actually is the index of that element. Thus, in R instead of having <em>scalar(s)</em> as most atomic type, we have <em>vector(s)</em> containing only one element. Whenever a vector is called all the values stored in it are displayed with its index at the start of each new line only.</p>
<p>Even processing of multiple values simultaneously, stored in a vector, to produce a desired output, is one of the most powerful strengths of R. The three variables shown in the figure below, all are vectors.</p>
<div class="figure" style="text-align: center">
<img src="images/example_vecs.png" alt="Examples of Vectors" width="99%" />
<p class="caption">
(#fig:exvecs)Examples of Vectors
</p>
</div>
<p>How to create a vector? Vectors in R are created using either -</p>
<ul>
<li><code>c()</code> function which is shortest and most commonly used function in r. The elements are concatenated (and hence the shortcut <code>c</code> for this function) using a comma <code>,</code> ; <em>OR</em></li>
<li><code>vector()</code> produces vector of given <code>length</code> and <code>mode</code>.</li>
</ul>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>my_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>my_vector</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a>my_vector2 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">&#39;integer&#39;</span>, <span class="at">length =</span> <span class="dv">15</span>)</span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a>my_vector2</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</code></pre>
<p>Function <code>c()</code> can also be used to <strong>join two or more vectors</strong>.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a>vec1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a>vec2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>)</span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a>vec3 <span class="ot">&lt;-</span> <span class="fu">c</span>(vec1, vec2)</span>
<span id="cb66-4"><a href="#cb66-4" tabindex="-1"></a>vec3</span></code></pre></div>
<pre><code>## [1]  1  2 11 12</code></pre>
<div class="figure" style="text-align: center">
<img src="images/vector_concatenation.png" alt="Vector Concatenation" width="247" height="20%" />
<p class="caption">
(#fig:vecconcat)Vector Concatenation
</p>
</div>
</div>
<div id="useful-functions-to-create-new-vectors" class="section level4 unnumbered">
<h4 class="unnumbered">Useful Functions to create new vectors</h4>
<p>There are some more useful functions to create new vectors in R, which we should discuss here as we will be using these vectors in subsequent chapters.</p>
</div>
<div id="generate-integer-sequences-with-colon-operator" class="section level4 unnumbered">
<h4 class="unnumbered">Generate integer sequences with Colon Operator <code>:</code></h4>
<p>This function generates a sequence from the number preceding <code>:</code> to next specified number, in arithmetical difference of <code>1</code> or <code>-1</code> as the case may be. Notice that output vector type is of <code>integer</code>.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">25</span></span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="dv">25</span><span class="sc">:</span><span class="dv">30</span></span></code></pre></div>
<pre><code>## [1] 25 26 27 28 29 30</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span><span class="dv">1</span></span></code></pre></div>
<pre><code>##  [1] 10  9  8  7  6  5  4  3  2  1</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">250</span>)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<blockquote>
<p>Note: One of the common mistakes with colon operator is assuming its <strong>operator precedence</strong>. In R, colon operator has calculation precedence over any mathematical operator. Think of outputs you may get with these-</p>
</blockquote>
<pre><code>n &lt;- 5
1:n+1
1:n*2</code></pre>
</div>
<div id="generate-specific-sequences-with-function-seq" class="section level4 unnumbered">
<h4 class="unnumbered">Generate specific sequences with function <code>seq</code></h4>
<p>This function generates a sequence from a given number to another number, similar to <code>:</code>, but it gives us more control over the output desired. We can provide the difference specifically (<code>double</code> type also) in the <code>by</code> argument. Otherwise if <code>length.out</code> argument is provided it calculates the difference automatically.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<pre><code>##  [1] 1.0 1.3 1.6 1.9 2.2 2.5 2.8 3.1 3.4 3.7 4.0 4.3 4.6 4.9</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">11</span>)</span></code></pre></div>
<pre><code>##  [1] 1.0 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2.0</code></pre>
</div>
<div id="repeat-a-patternvector-with-function-rep" class="section level4 unnumbered">
<h4 class="unnumbered">Repeat a pattern/vector with function <code>rep</code></h4>
<p>As the name suggests <code>rep</code> is short for <em>repeat</em> and thus it repeat a given element, a given number of times.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a><span class="fu">rep</span>(<span class="st">&#39;repeat this&#39;</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;repeat this&quot; &quot;repeat this&quot; &quot;repeat this&quot; &quot;repeat this&quot; &quot;repeat this&quot;</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="co"># We can even repeat already created vectors</span></span>
<span id="cb83-2"><a href="#cb83-2" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb83-3"><a href="#cb83-3" tabindex="-1"></a><span class="fu">rep</span>(vec, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##  [1]  1 10  1 10  1 10  1 10  1 10</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a><span class="fu">rep</span>(vec, <span class="at">each =</span> <span class="dv">5</span>) <span class="co"># notice the difference in results</span></span></code></pre></div>
<pre><code>##  [1]  1  1  1  1  1 10 10 10 10 10</code></pre>
</div>
<div id="generate-english-alphabet-with-letters-letters" class="section level4 unnumbered">
<h4 class="unnumbered">Generate english alphabet with <code>LETTERS</code> / <code>letters</code></h4>
<p>These are two inbuilt vectors in R having all 26 alphabets in upper and lower cases respectively.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a>LETTERS</span></code></pre></div>
<pre><code>##  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot; &quot;K&quot; &quot;L&quot; &quot;M&quot; &quot;N&quot; &quot;O&quot; &quot;P&quot; &quot;Q&quot; &quot;R&quot; &quot;S&quot;
## [20] &quot;T&quot; &quot;U&quot; &quot;V&quot; &quot;W&quot; &quot;X&quot; &quot;Y&quot; &quot;Z&quot;</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" tabindex="-1"></a>letters</span></code></pre></div>
<pre><code>##  [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot; &quot;k&quot; &quot;l&quot; &quot;m&quot; &quot;n&quot; &quot;o&quot; &quot;p&quot; &quot;q&quot; &quot;r&quot; &quot;s&quot;
## [20] &quot;t&quot; &quot;u&quot; &quot;v&quot; &quot;w&quot; &quot;x&quot; &quot;y&quot; &quot;z&quot;</code></pre>
</div>
<div id="generate-gregorian-calendar-month-names-with-month.name-month.abb" class="section level4 unnumbered">
<h4 class="unnumbered">Generate gregorian calendar month names with <code>month.name</code> / <code>month.abb</code></h4>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a>month.name</span></code></pre></div>
<pre><code>##  [1] &quot;January&quot;   &quot;February&quot;  &quot;March&quot;     &quot;April&quot;     &quot;May&quot;       &quot;June&quot;     
##  [7] &quot;July&quot;      &quot;August&quot;    &quot;September&quot; &quot;October&quot;   &quot;November&quot;  &quot;December&quot;</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a>month.abb</span></code></pre></div>
<pre><code>##  [1] &quot;Jan&quot; &quot;Feb&quot; &quot;Mar&quot; &quot;Apr&quot; &quot;May&quot; &quot;Jun&quot; &quot;Jul&quot; &quot;Aug&quot; &quot;Sep&quot; &quot;Oct&quot; &quot;Nov&quot; &quot;Dec&quot;</code></pre>
</div>
<div id="named-vectors" class="section level4" number="1.4.1.2">
<h4><span class="header-section-number">1.4.1.2</span> Named Vectors</h4>
<p>Vectors in R, can be named also, i.e. where each of the element has a name. E.g.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">B =</span> <span class="dv">20</span>, <span class="at">C =</span> <span class="dv">15</span>)</span>
<span id="cb95-2"><a href="#cb95-2" tabindex="-1"></a>ages</span></code></pre></div>
<pre><code>##  A  B  C 
## 10 20 15</code></pre>
<div class="figure" style="text-align: center">
<img src="images/named_vector.png" alt="Vector elements can have names" width="60%" />
<p class="caption">
(#fig:namedvec)Vector elements can have names
</p>
</div>
<p><strong>Note</strong> here that while assigning names to each element, the names are not enclosed in quotes similar to variable assignment. Also notice that this time R has not printed the numeric indices/index of first element (on each new line). There are other ways to assign names to an existing vector. We can use <code>names()</code> function, which displays the names of all elements in that vector ( <em>and this time in quotes as these are displayed in a vector</em>).</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" tabindex="-1"></a><span class="fu">names</span>(ages)</span></code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;B&quot; &quot;C&quot;</code></pre>
<p>Using this function we can assign names to existing vector. See</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" tabindex="-1"></a>vec1</span></code></pre></div>
<pre><code>## [1] 1 2</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" tabindex="-1"></a><span class="fu">names</span>(vec1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;first_element&#39;</span>, <span class="st">&#39;second_element&#39;</span>)</span>
<span id="cb101-2"><a href="#cb101-2" tabindex="-1"></a>vec1</span></code></pre></div>
<pre><code>##  first_element second_element 
##              1              2</code></pre>
<p>Names may also be assigned using <code>setNames()</code> while creating the vector simultaneously.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" tabindex="-1"></a>new_vec <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>, LETTERS)</span>
<span id="cb103-2"><a href="#cb103-2" tabindex="-1"></a>new_vec</span></code></pre></div>
<pre><code>##  A  B  C  D  E  F  G  H  I  J  K  L  M  N  O  P  Q  R  S  T  U  V  W  X  Y  Z 
##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26</code></pre>
<p>Function <code>unname()</code> may be used to remove all names. Even all the names can be removed by assigning <code>NULL</code> to <code>names</code> of that vector. Also remember that <code>unname</code> does not modify vector in place. To have this change we will have to assigned unnamed vector to that vector again. Check this,</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a><span class="fu">unname</span>(new_vec)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
## [26] 26</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" tabindex="-1"></a>new_vec</span></code></pre></div>
<pre><code>##  A  B  C  D  E  F  G  H  I  J  K  L  M  N  O  P  Q  R  S  T  U  V  W  X  Y  Z 
##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" tabindex="-1"></a>new_vec <span class="ot">&lt;-</span> <span class="fu">unname</span>(new_vec)</span>
<span id="cb109-2"><a href="#cb109-2" tabindex="-1"></a>new_vec</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
## [26] 26</code></pre>
</div>
<div id="type-coercion" class="section level4 unnumbered">
<h4 class="unnumbered">Type coercion</h4>
<p>There are occasions when different classes of R objects get mixed together. Sometimes this happens by accident but it can also happen on purpose. Let us deal with each of these.</p>
<p>But prior to this let us learn how to check the type of a vector. Of course we can check the type of any vector using function <code>typeof()</code> but what if we want to check whether any vector is of a specific type. So there are <code>is.*()</code> functions to check this, and all these functions return either <code>TRUE</code> or <code>FALSE</code>.</p>
<ul>
<li><code>is.logical()</code></li>
<li><code>is.integer()</code></li>
<li><code>is.double()</code></li>
<li><code>is.character()</code></li>
<li><code>is.complex()</code></li>
</ul>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" tabindex="-1"></a><span class="fu">is.integer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a><span class="fu">is.logical</span>(LETTERS)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="implicit-coercion" class="section level4 unnumbered">
<h4 class="unnumbered">Implicit Coercion</h4>
<p>As already stated, vector is the most atomic data object in R. Even all the elements of a vector (having multiple elements) are vectors in themselves. We have also discussed that vectors are homogeneous in types. So what happens when we try to mix elements of different types in a vector.</p>
<p>In fact when we try to mix elements of different types in a vector, the resultant vector is coerced to the type which is most feasible. Since a numeral say <code>56</code> can easily be converted into a complex number (<code>56+0i</code>) or character (<code>"56"</code>), but alphabet say <code>A</code>, cannot be converted into a numeral, the atomic data types normally follow the order of precedence, tabulated in table @ref(tab:rank).</p>
<table>
<caption>(#tab:rank) Order of Precedence for Atomic Data Types</caption>
<thead>
<tr class="header">
<th align="center">Rank</th>
<th align="center">Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">Character</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">Complex</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">Double</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">Integer</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">Logical</td>
</tr>
</tbody>
</table>
<p>For e.g. in the following diagram, notice all individual elements in first vector. Out of the types of all elements therein, character type is having highest rank and thus resultant vector will be silently coerced to a character vector. Similarly, second and third vectors are coerced to <code>double</code> (second element) and <code>integer</code> (first element) respectively.</p>
<div class="figure" style="text-align: center">
<img src="images/implicit_coercion.png" alt="Implicit Coercion of Vectors" width="99%" />
<p class="caption">
(#fig:impcoer)Implicit Coercion of Vectors
</p>
</div>
<p>It is also important to note here that this implicit coercion is without any warning and is silently performed. This implicit coercion is also carried out when two (or more) vectors having different data types are concatenated together.</p>
<p>Example- <code>vec</code> is an existing vector of type <code>integer</code>. When we try to add an extra element say of <code>character</code> type, <code>vec</code> type is coerced to <code>character</code>.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb115-2"><a href="#cb115-2" tabindex="-1"></a><span class="fu">typeof</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">append</span>(vec, <span class="st">&#39;ABCD&#39;</span>)</span>
<span id="cb117-2"><a href="#cb117-2" tabindex="-1"></a><span class="fu">typeof</span>(vec)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>R also implicitly coerces vectors to appropriate type when we try to perform calculations on vectors of other types. Example</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" tabindex="-1"></a>(<span class="cn">TRUE</span> <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">TRUE</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="cn">FALSE</span> <span class="sc">+</span> <span class="dv">56</span>)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
</div>
<div id="explicit-coercion" class="section level4 unnumbered">
<h4 class="unnumbered">Explicit Coercion</h4>
<p>We can explicitly coerce by using an <code>as.*()</code> function, like <code>as.logical()</code>, <code>as.integer()</code>, <code>as.double()</code>, or <code>as.character()</code>. <strong>Failed coercion of strings generates a warning and a missing value:</strong></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" tabindex="-1"></a><span class="fu">as.double</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>## [1] 1 0</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" tabindex="-1"></a><span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="st">&#39;one&#39;</span>, <span class="dv">1</span><span class="dt">L</span>))</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>## [1]  1 NA  1</code></pre>
</div>
<div id="coercion-precedence" class="section level4" number="1.4.1.3">
<h4><span class="header-section-number">1.4.1.3</span> Coercion precedence</h4>
<p>Sometimes, inside R both coercion happen at same time. So which one to precede other? Actually, implicit coercion will precede explicit coercion always. Consider this example. However, without seeing the result try to guess the output.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" tabindex="-1"></a><span class="fu">as.logical</span>(<span class="fu">c</span>(<span class="st">&#39;TRUE&#39;</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] TRUE   NA</code></pre>
<p>Explanation: the vector <code>c('TRUE', 1)</code> coerces to <code>c('TRUE', '1')</code> due to implicit coercion first and thereafter explicit coercion forces second element <code>as.logical('1')</code> to <code>NA</code>. Though <code>as.logical(1)</code> would have resulted into <code>TRUE</code> but <code>as.logical("1")</code> would result into <code>NA</code>.</p>
</div>
<div id="checking-dimensions" class="section level4 unnumbered">
<h4 class="unnumbered">Checking dimensions</h4>
<p>Now a vector can have <code>n</code> number of vectors (recall that each element is a vector in itself) and at times we may need to check how many elements a given vector contains. Using function <code>length()</code>, we can check the number of elements.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" tabindex="-1"></a><span class="fu">length</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 100</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" tabindex="-1"></a><span class="fu">length</span>(LETTERS)</span></code></pre></div>
<pre><code>## [1] 26</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" tabindex="-1"></a><span class="fu">length</span>(<span class="st">&#39;LENGTH&#39;</span>) <span class="co"># If you thought its output should have been 6, check again.</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
</div>
<div id="matrix-matrices" class="section level3" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> Matrix (Matrices)</h3>
<p>Matrix (or plural matrices) is a two dimensional arrangement (similar to a matrix in linear algebra and hence its name) of elements of again same type as in vectors. E.g.</p>
<p><span class="math display">\[\begin{array}{ccc}
x_{11} &amp; x_{12} &amp; x_{13}\\
x_{21} &amp; x_{22} &amp; x_{23}
\end{array}\]</span></p>
<p>Thus, matrices are vectors with an attribute named <em>dimension</em>.</p>
<blockquote>
<p>The dimension attribute is itself an integer vector of length 2 (number of rows, number of columns).</p>
</blockquote>
<div id="create-a-new-matrix" class="section level4 unnumbered">
<h4 class="unnumbered">Create a new matrix</h4>
<p>A new matrix can be created using function <code>matrix()</code> where a vector is given which is to be converted into a matrix and either number of rows <code>nrow</code> or number of columns <code>ncol</code> may be given.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    4    7   10
## [2,]    2    5    8   11
## [3,]    3    6    9   12</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">ncol=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    5    9
## [2,]    2    6   10
## [3,]    3    7   11
## [4,]    4    8   12</code></pre>
<p>Another useful argument is <code>byrow</code> which by default is <code>FALSE</code>. So if it is explicitly changed, we get</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">ncol=</span><span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    4    5    6
## [3,]    7    8    9
## [4,]   10   11   12</code></pre>
<div class="figure" style="text-align: center">
<img src="images/byrow.png" alt="Arrangement of Matrix, if byrow argument is used" width="60%" />
<p class="caption">
(#fig:byrow)Arrangement of Matrix, if byrow argument is used
</p>
</div>
<p>Matrix can be of any type. But rules of explicit and implicit coercion (as explained in vectors) also apply here.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" tabindex="-1"></a><span class="fu">matrix</span>(LETTERS, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
## [1,] &quot;A&quot;  &quot;C&quot;  &quot;E&quot;  &quot;G&quot;  &quot;I&quot;  &quot;K&quot;  &quot;M&quot;  &quot;O&quot;  &quot;Q&quot;  &quot;S&quot;   &quot;U&quot;   &quot;W&quot;   &quot;Y&quot;  
## [2,] &quot;B&quot;  &quot;D&quot;  &quot;F&quot;  &quot;H&quot;  &quot;J&quot;  &quot;L&quot;  &quot;N&quot;  &quot;P&quot;  &quot;R&quot;  &quot;T&quot;   &quot;V&quot;   &quot;X&quot;   &quot;Z&quot;</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" tabindex="-1"></a><span class="fu">matrix</span>(<span class="fu">c</span>(LETTERS, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), <span class="at">nrow=</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,] &quot;A&quot;  &quot;F&quot;  &quot;K&quot;  &quot;P&quot;  &quot;U&quot;  &quot;Z&quot; 
## [2,] &quot;B&quot;  &quot;G&quot;  &quot;L&quot;  &quot;Q&quot;  &quot;V&quot;  &quot;1&quot; 
## [3,] &quot;C&quot;  &quot;H&quot;  &quot;M&quot;  &quot;R&quot;  &quot;W&quot;  &quot;2&quot; 
## [4,] &quot;D&quot;  &quot;I&quot;  &quot;N&quot;  &quot;S&quot;  &quot;X&quot;  &quot;3&quot; 
## [5,] &quot;E&quot;  &quot;J&quot;  &quot;O&quot;  &quot;T&quot;  &quot;Y&quot;  &quot;4&quot;</code></pre>
</div>
<div id="names-in-matrices" class="section level4 unnumbered">
<h4 class="unnumbered">Names in matrices</h4>
<p>Similar to vectors, rows or columns or both in matrices may have names. Check <code>?matrix()</code> for complete documentation.</p>
</div>
<div id="dimension" class="section level4 unnumbered">
<h4 class="unnumbered">Dimension</h4>
<p>To check dimension of a matrix we can use <code>dim()</code> (short for dimension) (similar to <code>length</code> in case of vectors) which will return a vector with two numbers (rows first, followed by columns).</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" tabindex="-1"></a>my_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(LETTERS, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), <span class="at">nrow=</span><span class="dv">5</span>)</span>
<span id="cb148-2"><a href="#cb148-2" tabindex="-1"></a><span class="fu">dim</span>(my_mat)</span></code></pre></div>
<pre><code>## [1] 5 6</code></pre>
<p>This gives us another method to create matrix from a vector. See</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" tabindex="-1"></a>my_mat2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb150-2"><a href="#cb150-2" tabindex="-1"></a><span class="fu">dim</span>(my_mat2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>)</span>
<span id="cb150-3"><a href="#cb150-3" tabindex="-1"></a>my_mat2</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    3    5    7    9
## [2,]    2    4    6    8   10</code></pre>
</div>
<div id="have-a-check-on-replication" class="section level4 unnumbered">
<h4 class="unnumbered">Have a check on replication</h4>
<p>What happens when product of given dimensions is less than or greater than given vector to be converted. It replicates but it is advised to check these properly as resultant vector may not be as desired. Check these cases, and notice when R gives result silently and when with a warning.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">nrow=</span><span class="dv">5</span>, <span class="at">ncol=</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Warning in matrix(1:10, nrow = 5, ncol = 5): data length differs from size of
## matrix: [10 != 5 x 5]</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    6    1    6    1
## [2,]    2    7    2    7    2
## [3,]    3    8    3    8    3
## [4,]    4    9    4    9    4
## [5,]    5   10    5   10    5</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Warning in matrix(1:1000, nrow = 2, ncol = 3): data length [1000] is not a
## sub-multiple or multiple of the number of columns [3]</code></pre>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6</code></pre>
</div>
<div id="combining-matrices" class="section level4 unnumbered">
<h4 class="unnumbered">Combining matrices</h4>
<p>Using <code>cbind()</code> or <code>rbind()</code> we can combine two matrices column-wise or row-wise respectively.</p>
<div class="figure" style="text-align: center">
<img src="images/cbind_vs_rbind.png" alt="Binding of Two or more matrices together" width="374" height="60%" />
<p class="caption">
(#fig:bind)Binding of Two or more matrices together
</p>
</div>
<p>See these two examples.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" tabindex="-1"></a>mat1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb158-2"><a href="#cb158-2" tabindex="-1"></a>mat2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb158-3"><a href="#cb158-3" tabindex="-1"></a><span class="fu">cbind</span>(mat1, mat2)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    3    5    7
## [2,]    2    4    6    8</code></pre>
<p>Example-2</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" tabindex="-1"></a><span class="fu">rbind</span>(mat1, mat2)</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    3
## [2,]    2    4
## [3,]    5    7
## [4,]    6    8</code></pre>
</div>
</div>
<div id="arrays" class="section level3" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> Arrays</h3>
<p>Till now we have seen that elements in one dimension are represented as vectors and in two dimension as matrices. So a question arises here, how many dimensions we can have. Actually we can have n number of dimensions in r, in object type <code>array</code>, but they’ll become increasingly difficult to comprehend and are not thus discussed here. Check these however for your understanding,</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" tabindex="-1"></a><span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>)) <span class="co"># a three dimensional array</span></span></code></pre></div>
<pre><code>## , , 1
## 
##      [,1] [,2]
## [1,]    1    4
## [2,]    2    5
## [3,]    3    6
## 
## , , 2
## 
##      [,1] [,2]
## [1,]    7   10
## [2,]    8   11
## [3,]    9   12
## 
## , , 3
## 
##      [,1] [,2]
## [1,]   13   16
## [2,]   14   17
## [3,]   15   18
## 
## , , 4
## 
##      [,1] [,2]
## [1,]   19   22
## [2,]   20   23
## [3,]   21   24</code></pre>
<p>Try creating 4 or 5 dimensional arrays in your console and see the results.</p>
<p>Further properties of vectors, matrices will be discussed in next chapter on sub-setting and indexing where we will learn how to retrieve specific elements of vector/matrices/etc. But till now we have created objects which have elements of same type. What if we want to have different types of elements/data retaining their types, together in a single variable? Answer is in next section, where we will discuss hetergeneous objects.</p>
</div>
<div id="heterogeneous-objects" class="section level3 unnumbered">
<h3 class="unnumbered">Heterogeneous objects</h3>
</div>
<div id="lists" class="section level3" number="1.4.4">
<h3><span class="header-section-number">1.4.4</span> Lists</h3>
<p>So lists are used when we want to combine elements of different types together. Function used to create a list is <code>list()</code>. Check this</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" tabindex="-1"></a><span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="st">&#39;My string&#39;</span>, <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 2
## 
## [[3]]
## [1] 3
## 
## [[4]]
## [1] &quot;My string&quot;
## 
## [[5]]
## [1] TRUE</code></pre>
<p>Pictorially this list can be depicted as</p>
<div class="figure" style="text-align: center">
<img src="images/list_ex.png" alt="A list in R is a heterogeneous object" width="99%" />
<p class="caption">
(#fig:exlist)A list in R is a heterogeneous object
</p>
</div>
<p>Interestingly list can contain vectors, matrices, arrays as individual elements. See</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" tabindex="-1"></a><span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, LETTERS, <span class="cn">TRUE</span>, my_mat2)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1 2 3
## 
## [[2]]
##  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot; &quot;K&quot; &quot;L&quot; &quot;M&quot; &quot;N&quot; &quot;O&quot; &quot;P&quot; &quot;Q&quot; &quot;R&quot; &quot;S&quot;
## [20] &quot;T&quot; &quot;U&quot; &quot;V&quot; &quot;W&quot; &quot;X&quot; &quot;Y&quot; &quot;Z&quot;
## 
## [[3]]
## [1] TRUE
## 
## [[4]]
##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    3    5    7    9
## [2,]    2    4    6    8   10</code></pre>
<div class="figure" style="text-align: center">
<img src="images/list_ex2.png" alt="A list in R, can contain vector, matrices, array or even lists" width="99%" />
<p class="caption">
(#fig:exlist2)A list in R, can contain vector, matrices, array or even lists
</p>
</div>
<p>Similar to vectors these elements can be named also.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" tabindex="-1"></a><span class="fu">list</span>(<span class="at">first_item =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">second_item =</span> my_mat2)</span></code></pre></div>
<pre><code>## $first_item
## [1] 1 2 3 4 5
## 
## $second_item
##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    3    5    7    9
## [2,]    2    4    6    8   10</code></pre>
<p>OR</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" tabindex="-1"></a>my_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">first=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">1</span>, <span class="at">B=</span><span class="dv">2</span>, <span class="at">C=</span><span class="dv">3</span>),<span class="at">second=</span>my_mat2)</span>
<span id="cb170-2"><a href="#cb170-2" tabindex="-1"></a>my_list</span></code></pre></div>
<pre><code>## $first
## A B C 
## 1 2 3 
## 
## $second
##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    3    5    7    9
## [2,]    2    4    6    8   10</code></pre>
<div class="figure" style="text-align: center">
<img src="images/named_list.png" alt="Similar to vector elements, the elements in list can be named also" width="99%" />
<p class="caption">
(#fig:namedlist)Similar to vector elements, the elements in list can be named also
</p>
</div>
<p>OR</p>
<p>More interestingly, lists can even contain another lists.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" tabindex="-1"></a>my_list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(my_list, <span class="at">new_item =</span> LETTERS)</span>
<span id="cb172-2"><a href="#cb172-2" tabindex="-1"></a>my_list2</span></code></pre></div>
<pre><code>## [[1]]
## [[1]]$first
## A B C 
## 1 2 3 
## 
## [[1]]$second
##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    3    5    7    9
## [2,]    2    4    6    8   10
## 
## 
## $new_item
##  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot; &quot;K&quot; &quot;L&quot; &quot;M&quot; &quot;N&quot; &quot;O&quot; &quot;P&quot; &quot;Q&quot; &quot;R&quot; &quot;S&quot;
## [20] &quot;T&quot; &quot;U&quot; &quot;V&quot; &quot;W&quot; &quot;X&quot; &quot;Y&quot; &quot;Z&quot;</code></pre>
<p>Number of items at first level can be checked using <code>length</code> as in vectors. Checking number of items in second level onward will be covered in subsequent chapter(s).</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" tabindex="-1"></a><span class="fu">length</span>(my_list)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" tabindex="-1"></a><span class="fu">length</span>(my_list2) <span class="co"># If you thought its output should have been 3, think again.</span></span></code></pre></div>
<pre><code>## [1] 2</code></pre>
</div>
<div id="data-frame" class="section level3" number="1.4.5">
<h3><span class="header-section-number">1.4.5</span> Data Frame</h3>
<p>Data frames are used to store tabular data (or rectangular) in R. They are an important type of object in R.</p>
<div class="figure" style="text-align: center">
<img src="images/dataframe.png" alt="An example data frame" width="99%" />
<p class="caption">
(#fig:dframe)An example data frame
</p>
</div>
<p>Data frames are represented as a special type of list where every element of the list has to have the same length. Each element of the list can be thought of as a column and the length of each element of the list is the number of rows.</p>
<div class="figure" style="text-align: center">
<img src="images/list_vs_df.png" alt="A data frame in R, is just a special kind of list" width="99%" />
<p class="caption">
(#fig:listvsdf)A data frame in R, is just a special kind of list
</p>
</div>
<p>Unlike matrices, data frames can store different classes of objects in each column. (Remember that matrices must have every element be the same class).</p>
<p>To create a data frame from scratch we will use function <code>data.frame()</code>. See</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">emp_name =</span> <span class="fu">c</span>(<span class="st">&#39;Thomas&#39;</span>, <span class="st">&#39;Andrew&#39;</span>, <span class="st">&#39;Jonathan&#39;</span>, <span class="st">&#39;Bob&#39;</span>, <span class="st">&#39;Charles&#39;</span>),</span>
<span id="cb178-2"><a href="#cb178-2" tabindex="-1"></a>                    <span class="at">department =</span> <span class="fu">c</span>(<span class="st">&#39;HR&#39;</span>, <span class="st">&#39;Accounts&#39;</span>, <span class="st">&#39;Accounts&#39;</span>, <span class="st">&#39;Execution&#39;</span>, <span class="st">&#39;Tech&#39;</span>),</span>
<span id="cb178-3"><a href="#cb178-3" tabindex="-1"></a>                    <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">43</span>, <span class="dv">39</span>, <span class="dv">42</span>, <span class="dv">25</span>),</span>
<span id="cb178-4"><a href="#cb178-4" tabindex="-1"></a>                    <span class="at">salary =</span> <span class="fu">c</span>(<span class="dv">20000</span>, <span class="dv">22000</span>, <span class="dv">21000</span>, <span class="dv">25000</span>, <span class="cn">NA</span>),</span>
<span id="cb178-5"><a href="#cb178-5" tabindex="-1"></a>                    <span class="at">whether_permanent =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">NA</span>, <span class="cn">NA</span>))</span>
<span id="cb178-6"><a href="#cb178-6" tabindex="-1"></a>my_df</span></code></pre></div>
<pre><code>##   emp_name department age salary whether_permanent
## 1   Thomas         HR  40  20000              TRUE
## 2   Andrew   Accounts  43  22000              TRUE
## 3 Jonathan   Accounts  39  21000             FALSE
## 4      Bob  Execution  42  25000                NA
## 5  Charles       Tech  25     NA                NA</code></pre>
<p><strong>Note</strong> that R, on its own, has allocated row names that are numbers to each of the row on its own.</p>
<p>Of course at most of the times we will have data frames ready for us to analyse and thus we will learn to import/read external data in r, in subsequent chapters. To check dimensions of a data frame use <code>dim</code> as in matrix.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" tabindex="-1"></a><span class="fu">dim</span>(my_df)</span></code></pre></div>
<pre><code>## [1] 5 5</code></pre>
<p>Thus, the object types in R, can be depicted as in adjoining figure.</p>
<div class="figure" style="text-align: center">
<img src="images/Objects.png" alt="Most important Data structures, in R" width="99%" />
<p class="caption">
(#fig:impdstr)Most important Data structures, in R
</p>
</div>
</div>
</div>
<div id="other-data-types" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Other Data types</h2>
<p>Of course, there are other data types in R of which three are particularly useful <code>factor</code>, <code>date</code> and <code>date-time</code>. These types are actually built over the base atomic types, <code>integer</code>, <code>double</code> and <code>double</code> respectively and that’s why these are being discussed separately. These types are built as <code>S3 objects</code> in R, and users may also define their own data types in <code>object oriented programming</code>. <strong>OOP</strong> being concept of core programming concepts and therefore are out of the scope here.</p>
<p>However, to understand the S3 objects better, we have to understand that atomic objects (for the sake of simplicity consider only vectors) can have attributes.</p>
<p><strong>Example</strong> One of the attributes that each vector has is <code>names</code>, which for unnamed vector is empty (NULL). Attributes of any object can be viewed/called from function <code>attributes()</code>.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" tabindex="-1"></a><span class="co"># Let us create a vector</span></span>
<span id="cb182-2"><a href="#cb182-2" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">26</span></span>
<span id="cb182-3"><a href="#cb182-3" tabindex="-1"></a><span class="co"># Convert this to a named vector using function setNames()</span></span>
<span id="cb182-4"><a href="#cb182-4" tabindex="-1"></a><span class="co"># This function takes first argument as vector</span></span>
<span id="cb182-5"><a href="#cb182-5" tabindex="-1"></a><span class="co"># Second argument should be a character vector of equal length.</span></span>
<span id="cb182-6"><a href="#cb182-6" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">setNames</span>(vec, LETTERS)</span>
<span id="cb182-7"><a href="#cb182-7" tabindex="-1"></a><span class="co"># let&#39;s check what are the attributes of `vec`</span></span>
<span id="cb182-8"><a href="#cb182-8" tabindex="-1"></a><span class="fu">attributes</span>(vec)</span></code></pre></div>
<pre><code>## $names
##  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot; &quot;K&quot; &quot;L&quot; &quot;M&quot; &quot;N&quot; &quot;O&quot; &quot;P&quot; &quot;Q&quot; &quot;R&quot; &quot;S&quot;
## [20] &quot;T&quot; &quot;U&quot; &quot;V&quot; &quot;W&quot; &quot;X&quot; &quot;Y&quot; &quot;Z&quot;</code></pre>
<p>Using <code>attr()</code> we may assign any new attribute to any R object/variable.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" tabindex="-1"></a><span class="co"># Let&#39;s also assign a new attribute say `x` having value &quot;New Attribute&quot; to `vec`</span></span>
<span id="cb184-2"><a href="#cb184-2" tabindex="-1"></a><span class="fu">attr</span>(vec, <span class="st">&quot;x&quot;</span>) <span class="ot">&lt;-</span> <span class="st">&quot;New Attribute&quot;</span></span>
<span id="cb184-3"><a href="#cb184-3" tabindex="-1"></a><span class="co"># Now let&#39;s check its attributes again</span></span>
<span id="cb184-4"><a href="#cb184-4" tabindex="-1"></a><span class="fu">attributes</span>(vec)</span></code></pre></div>
<pre><code>## $names
##  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot; &quot;K&quot; &quot;L&quot; &quot;M&quot; &quot;N&quot; &quot;O&quot; &quot;P&quot; &quot;Q&quot; &quot;R&quot; &quot;S&quot;
## [20] &quot;T&quot; &quot;U&quot; &quot;V&quot; &quot;W&quot; &quot;X&quot; &quot;Y&quot; &quot;Z&quot;
## 
## $x
## [1] &quot;New Attribute&quot;</code></pre>
<p>We can see, in above example, how a new attribute has been added to a vector. It should have been clear by now that apart from <code>names</code>, other <code>attributes</code> may also be assigned to a vector.</p>
<div id="fctrss" class="section level3" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> Factors</h3>
<p>A factor is a vector that can contain only predefined values. It is used to store categorical data. Factors are built on top of an integer vector with two attributes: a <em>class</em>, ‘factor’, which makes it behave differently from regular integer vectors, and <em>levels</em>, which defines the set of allowed values. To create factors we will use function <code>factor</code>.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" tabindex="-1"></a>fac <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;c&#39;</span>, <span class="st">&#39;a&#39;</span>))</span>
<span id="cb186-2"><a href="#cb186-2" tabindex="-1"></a>fac</span></code></pre></div>
<pre><code>## [1] a b c a
## Levels: a b c</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" tabindex="-1"></a><span class="fu">typeof</span>(fac) <span class="co"># notice its output</span></span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" tabindex="-1"></a><span class="fu">attributes</span>(fac)</span></code></pre></div>
<pre><code>## $levels
## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;
## 
## $class
## [1] &quot;factor&quot;</code></pre>
<p>So if <code>typeof</code> of a factor is returning integer, how will we check its type? We may use <code>class</code> or <code>is.factor</code> in this case.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" tabindex="-1"></a><span class="fu">class</span>(fac)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" tabindex="-1"></a><span class="fu">is.factor</span>(fac)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Now a factor can be ordered also. We may use its argument <code>ordered = TRUE</code> along with another argument <code>levels</code>.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" tabindex="-1"></a>my_degrees <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;PG&quot;</span>, <span class="st">&quot;PG&quot;</span>, <span class="st">&quot;Doctorate&quot;</span>, <span class="st">&quot;UG&quot;</span>, <span class="st">&quot;PG&quot;</span>)</span>
<span id="cb196-2"><a href="#cb196-2" tabindex="-1"></a>my_factor <span class="ot">&lt;-</span> <span class="fu">factor</span>(my_degrees, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;UG&#39;</span>, <span class="st">&#39;PG&#39;</span>, <span class="st">&#39;Doctorate&#39;</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb196-3"><a href="#cb196-3" tabindex="-1"></a>my_factor <span class="co"># notice output here</span></span></code></pre></div>
<pre><code>## [1] PG        PG        Doctorate UG        PG       
## Levels: UG &lt; PG &lt; Doctorate</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" tabindex="-1"></a><span class="fu">is.ordered</span>(my_factor)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Another argument <code>labels</code> can also be used to display the labels, which may be different from levels.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" tabindex="-1"></a>my_factor <span class="ot">&lt;-</span> <span class="fu">factor</span>(my_degrees, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;UG&#39;</span>, <span class="st">&#39;PG&#39;</span>, <span class="st">&#39;Doctorate&#39;</span>), </span>
<span id="cb200-2"><a href="#cb200-2" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Under-Graduate&quot;</span>, <span class="st">&quot;Post Graduate&quot;</span>, <span class="st">&quot;Ph.D&quot;</span>),</span>
<span id="cb200-3"><a href="#cb200-3" tabindex="-1"></a>                    <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb200-4"><a href="#cb200-4" tabindex="-1"></a>my_factor <span class="co"># notice output here</span></span></code></pre></div>
<pre><code>## [1] Post Graduate  Post Graduate  Ph.D           Under-Graduate Post Graduate 
## Levels: Under-Graduate &lt; Post Graduate &lt; Ph.D</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" tabindex="-1"></a><span class="fu">is.factor</span>(<span class="fu">c</span>(my_factor, <span class="st">&quot;UG&quot;</span>))</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Attribute <code>levels</code> can be used as a function to retrieve/modify these.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" tabindex="-1"></a><span class="fu">levels</span>(my_factor)</span></code></pre></div>
<pre><code>## [1] &quot;Under-Graduate&quot; &quot;Post Graduate&quot;  &quot;Ph.D&quot;</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" tabindex="-1"></a><span class="fu">levels</span>(my_factor) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Grad&quot;</span>, <span class="st">&quot;Masters&quot;</span>, <span class="st">&quot;Doctorate&quot;</span>)</span>
<span id="cb206-2"><a href="#cb206-2" tabindex="-1"></a>my_factor</span></code></pre></div>
<pre><code>## [1] Masters   Masters   Doctorate Grad      Masters  
## Levels: Grad &lt; Masters &lt; Doctorate</code></pre>
<p>Remember that while factors look like (and often behave like) character vectors, they are built on top of integers. Try to think of output of this <code>is.factor(c(my_factor, "UG"))</code> before running it in your console.</p>
<p>We will learn about these data types in detail in chapter @ref(factors).</p>
</div>
<div id="date" class="section level3" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> Date</h3>
<p>Date vectors are built on top of double vectors. They have class “Date” and no other attributes. A common way to create <code>date</code> vectors in R, is converting a character string to date using <code>as.Date()</code> (see case carefully),</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" tabindex="-1"></a>my_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1970-01-31&quot;</span>)</span>
<span id="cb208-2"><a href="#cb208-2" tabindex="-1"></a>my_date</span></code></pre></div>
<pre><code>## [1] &quot;1970-01-31&quot;</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" tabindex="-1"></a><span class="fu">attributes</span>(my_date)</span></code></pre></div>
<pre><code>## $class
## [1] &quot;Date&quot;</code></pre>
<p>Do check other arguments of as.Date by running <code>?as.Date()</code> in your console. To check whether a given variable is of type Date in r, there is no function like <code>is.Date</code> in base r, so we may use <code>inherits()</code> in this case.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" tabindex="-1"></a><span class="fu">inherits</span>(my_date, <span class="st">&#39;Date&#39;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="date-time-posixct" class="section level3" number="1.5.3">
<h3><span class="header-section-number">1.5.3</span> Date-time (<code>POSIXct</code>)</h3>
<p>Times are represented by the <code>POSIXct</code> or the <code>POSIXlt</code> class.</p>
<ul>
<li>POSIXct is just a very large integer under the hood. It use a useful class when you want to store times in something like a data frame.</li>
<li>POSIXlt is a list underneath and it stores a bunch of other useful information like the day of the week, day of the year, month, day of the month.</li>
</ul>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" tabindex="-1"></a>my_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb214-2"><a href="#cb214-2" tabindex="-1"></a>my_time</span></code></pre></div>
<pre><code>## [1] &quot;2024-11-29 09:57:08 IST&quot;</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" tabindex="-1"></a><span class="fu">class</span>(my_time)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" tabindex="-1"></a>my_time2 <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(my_time)</span>
<span id="cb218-2"><a href="#cb218-2" tabindex="-1"></a><span class="fu">class</span>(my_time2)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXlt&quot; &quot;POSIXt&quot;</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">unclass</span>(my_time2))</span></code></pre></div>
<pre><code>##  [1] &quot;sec&quot;    &quot;min&quot;    &quot;hour&quot;   &quot;mday&quot;   &quot;mon&quot;    &quot;year&quot;   &quot;wday&quot;   &quot;yday&quot;  
##  [9] &quot;isdst&quot;  &quot;zone&quot;   &quot;gmtoff&quot;</code></pre>
</div>
<div id="duration-difftime" class="section level3" number="1.5.4">
<h3><span class="header-section-number">1.5.4</span> Duration (<code>difftime</code>)</h3>
<p>Duration, which represent the amount of time between pairs of dates or date-times, are stored in <code>difftimes</code>. <code>Difftimes</code> are built on top of doubles, and have a units attribute that determines how the integer should be interpreted.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" tabindex="-1"></a>two_days <span class="ot">&lt;-</span> <span class="fu">as.difftime</span>(<span class="dv">2</span>, <span class="at">units =</span> <span class="st">&#39;days&#39;</span>)</span>
<span id="cb222-2"><a href="#cb222-2" tabindex="-1"></a>two_days</span></code></pre></div>
<pre><code>## Time difference of 2 days</code></pre>
<p>These over the top, data types will be discussed in more detail in chapter @ref(lubridate).</p>
<!--chapter:end:02-basics.Rmd-->
</div>
</div>
</div>
<div id="subset" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Subsetting R objects or accesing specific elements</h1>
<p>There are multiple methods for sub-setting R objects (vectors, matrices, data frames, lists, etc.) and each have its own uses and benefits. We will discuss each one of them. Three operators <code>[</code>, <code>[[</code> &amp; <code>$</code> will be used.</p>
<div id="subsetting-vectors" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Subsetting vectors</h2>
<p>Let us first start sub-setting vectors, which is as we have learned, atomic object in R. To subset the vectors we will use <code>[</code>.
For this we will use following <code>x</code> vector, which has 6 elements (names) each starting with alphabets A to F.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Andrew&#39;</span>, <span class="st">&#39;Bob&#39;</span>, <span class="st">&#39;Chris&#39;</span>, <span class="st">&#39;Danny&#39;</span>, <span class="st">&#39;Edmund&#39;</span>, <span class="st">&#39;Freddie&#39;</span>)</span></code></pre></div>
<p><img src="images/subset_vec.png" /></p>
<div id="subsetting-through-a-vector-of-positive-integers" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Subsetting through a vector of positive integers</h3>
<p>Sub-setting through positive integers will give us elements at those given position (indices). See this</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" tabindex="-1"></a><span class="co"># fourth element</span></span>
<span id="cb225-2"><a href="#cb225-2" tabindex="-1"></a>x[<span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Danny&quot;</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" tabindex="-1"></a><span class="co"># third to fifth element</span></span>
<span id="cb227-2"><a href="#cb227-2" tabindex="-1"></a>x[<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Chris&quot;  &quot;Danny&quot;  &quot;Edmund&quot;</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" tabindex="-1"></a><span class="co"># first and fifth element</span></span>
<span id="cb229-2"><a href="#cb229-2" tabindex="-1"></a>x[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot; &quot;Chris&quot;</code></pre>
<p><em>Note: Check what happens when the integer vector has repeated integers.</em></p>
</div>
<div id="subsetting-through-a-vector-of-negative-integers" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Subsetting through a vector of negative integers</h3>
<p>Sub-setting through negative integers will give us all elements <strong>except</strong> those at given indices. See</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" tabindex="-1"></a><span class="co"># all elements except that at fourth</span></span>
<span id="cb231-2"><a href="#cb231-2" tabindex="-1"></a>x[<span class="sc">-</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot;  &quot;Bob&quot;     &quot;Chris&quot;   &quot;Edmund&quot;  &quot;Freddie&quot;</code></pre>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" tabindex="-1"></a><span class="co"># all elements except third to fifth</span></span>
<span id="cb233-2"><a href="#cb233-2" tabindex="-1"></a>x[<span class="sc">-</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot;  &quot;Bob&quot;     &quot;Freddie&quot;</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" tabindex="-1"></a><span class="co"># all elements except first and fifth</span></span>
<span id="cb235-2"><a href="#cb235-2" tabindex="-1"></a>x[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;Bob&quot;     &quot;Chris&quot;   &quot;Danny&quot;   &quot;Freddie&quot;</code></pre>
<p><em>Note: Try mixing sub-setting with a vector having both positive and negative integers in your console and check what happens.</em></p>
</div>
<div id="subsetting-through-a-logical-vector" class="section level3" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Subsetting through a logical vector</h3>
<p>We can also subset a given vector through another vector having <code>logical</code> values i.e. <code>TRUE</code> and <code>FALSE</code>. As you can understand output/result will have elements at places having <code>TRUE</code> only.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" tabindex="-1"></a><span class="co"># First, third and fifth element only</span></span>
<span id="cb237-2"><a href="#cb237-2" tabindex="-1"></a>x[<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot; &quot;Chris&quot;  &quot;Danny&quot;</code></pre>
<p><strong>Recycling</strong> is an important concept while sub-setting though a logical vector. It recycles the given logical vector up to the length of vector to be subset. Thus, <code>x[TRUE]</code> will give us original <code>x</code> only.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" tabindex="-1"></a>x[<span class="cn">TRUE</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot;  &quot;Bob&quot;     &quot;Chris&quot;   &quot;Danny&quot;   &quot;Edmund&quot;  &quot;Freddie&quot;</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" tabindex="-1"></a>x[<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)] <span class="co"># will give elements at odd indices</span></span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot; &quot;Chris&quot;  &quot;Edmund&quot;</code></pre>
<p><em>Note: Try to subset a vector through a logical vector having missing values i.e. <code>NA</code> along with <code>TRUE</code> and/or <code>FALSE</code> in your console and check what happens.</em></p>
<p><strong>Sub-setting through logical vector is most important and used sub-setting method as we will see it subsequent chapter/sections when we will filter a vector on the basis of some conditions.</strong></p>
</div>
<div id="subsetting-through-a-character-vector" class="section level3" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Subsetting through a character vector</h3>
<p>This method is used when the given vector is named. We can pass desired names inside <code>[]</code> to get/filter those desired elements. See this example.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" tabindex="-1"></a><span class="co"># let us create a named vector `y`</span></span>
<span id="cb243-2"><a href="#cb243-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb243-3"><a href="#cb243-3" tabindex="-1"></a><span class="co"># display `y`</span></span>
<span id="cb243-4"><a href="#cb243-4" tabindex="-1"></a>y</span></code></pre></div>
<pre><code>## A B C D E F 
## 1 2 3 4 5 6</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" tabindex="-1"></a><span class="co"># subset elements named `A` and `C`</span></span>
<span id="cb245-2"><a href="#cb245-2" tabindex="-1"></a>y[<span class="fu">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;C&#39;</span>)]</span></code></pre></div>
<pre><code>## A C 
## 1 3</code></pre>
<p><em>Note that we have used quotes in above method of sub-setting.</em> We can use this method when we have names saved in another variable. See this</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;C&#39;</span>, <span class="st">&#39;E&#39;</span>)</span>
<span id="cb247-2"><a href="#cb247-2" tabindex="-1"></a><span class="co"># subset those elements from `y` which are named as per `var`</span></span>
<span id="cb247-3"><a href="#cb247-3" tabindex="-1"></a>y[var] <span class="co"># notice that since `var` is a variable, we have not used quotes.</span></span></code></pre></div>
<pre><code>## A C E 
## 1 3 5</code></pre>
<p><em>Note: Similar to positive integer indexing we will get repeated values if character vector has repeated names.</em></p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" tabindex="-1"></a>y[<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;A&quot;</span>)]</span></code></pre></div>
<pre><code>## A A C A 
## 1 1 3 1</code></pre>
<p><strong>Other two methods of indexing will not be used frequently but are important to know for debugging the code as sometimes your subset vector may be <code>NULL</code> or <code>zero</code></strong></p>
</div>
<div id="subsetting-through-nothing" class="section level3" number="2.1.5">
<h3><span class="header-section-number">2.1.5</span> Subsetting through nothing</h3>
<p>Indexing through nothing i.e. simply with <code>[]</code> will give us original vector.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" tabindex="-1"></a>x[]</span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot;  &quot;Bob&quot;     &quot;Chris&quot;   &quot;Danny&quot;   &quot;Edmund&quot;  &quot;Freddie&quot;</code></pre>
</div>
<div id="subsetting-through-zero" class="section level3" number="2.1.6">
<h3><span class="header-section-number">2.1.6</span> Subsetting through Zero</h3>
<p>Sub-setting through <code>NULL</code> or <code>0</code> will give us a zero length vector.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" tabindex="-1"></a>x[<span class="cn">NULL</span>]</span></code></pre></div>
<pre><code>## character(0)</code></pre>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" tabindex="-1"></a>y[<span class="dv">0</span>]</span></code></pre></div>
<pre><code>## named integer(0)</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" tabindex="-1"></a><span class="fu">is.null</span>(x[<span class="cn">NULL</span>])</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>It is important and interesting to note here that subsetting through NULL is not NULL and is a zero length vector instead.</p>
</div>
</div>
<div id="subsetting-matrices-and-arrays" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Subsetting Matrices and arrays</h2>
<p>We can subset higher dimensional structures (Matrix - 2 dimensional and arrays - dimension greater than 2) using (i) multiple vectors, (ii) single vector and (iii) matrix.</p>
<p>Let us first create a 5x5 matrix say <code>mat</code> with elements named <span class="math inline">\(A_{mn}\)</span> where <code>m</code> will denote row number and <code>n</code> will denote column number.</p>
<pre><code>##      [,1]  [,2]  [,3]  [,4]  [,5] 
## [1,] &quot;A11&quot; &quot;A12&quot; &quot;A13&quot; &quot;A14&quot; &quot;A15&quot;
## [2,] &quot;A21&quot; &quot;A22&quot; &quot;A23&quot; &quot;A24&quot; &quot;A25&quot;
## [3,] &quot;A31&quot; &quot;A32&quot; &quot;A33&quot; &quot;A34&quot; &quot;A35&quot;
## [4,] &quot;A41&quot; &quot;A42&quot; &quot;A43&quot; &quot;A44&quot; &quot;A45&quot;
## [5,] &quot;A51&quot; &quot;A52&quot; &quot;A53&quot; &quot;A54&quot; &quot;A55&quot;</code></pre>
<div id="indexing-through-multiple-vectors" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Indexing through Multiple vectors</h3>
<p>This is extension of all sub-setting methods explained for a vector. In objects with higher dimensionality we will have to provide one vector for each dimension. Blank values, as you may understood (ref - sub-setting through nothing explained above) will do nothing and return that dimension complete.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" tabindex="-1"></a><span class="co"># first and second row with third and fifth column</span></span>
<span id="cb260-2"><a href="#cb260-2" tabindex="-1"></a>mat[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>)]</span></code></pre></div>
<pre><code>##      [,1]  [,2] 
## [1,] &quot;A13&quot; &quot;A15&quot;
## [2,] &quot;A23&quot; &quot;A25&quot;</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" tabindex="-1"></a><span class="co"># third to fifth column, all rows</span></span>
<span id="cb262-2"><a href="#cb262-2" tabindex="-1"></a>mat[,<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3] 
## [1,] &quot;A13&quot; &quot;A14&quot; &quot;A15&quot;
## [2,] &quot;A23&quot; &quot;A24&quot; &quot;A25&quot;
## [3,] &quot;A33&quot; &quot;A34&quot; &quot;A35&quot;
## [4,] &quot;A43&quot; &quot;A44&quot; &quot;A45&quot;
## [5,] &quot;A53&quot; &quot;A54&quot; &quot;A55&quot;</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" tabindex="-1"></a><span class="co"># all columns except third</span></span>
<span id="cb264-2"><a href="#cb264-2" tabindex="-1"></a>mat[, <span class="sc">-</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3]  [,4] 
## [1,] &quot;A11&quot; &quot;A12&quot; &quot;A14&quot; &quot;A15&quot;
## [2,] &quot;A21&quot; &quot;A22&quot; &quot;A24&quot; &quot;A25&quot;
## [3,] &quot;A31&quot; &quot;A32&quot; &quot;A34&quot; &quot;A35&quot;
## [4,] &quot;A41&quot; &quot;A42&quot; &quot;A44&quot; &quot;A45&quot;
## [5,] &quot;A51&quot; &quot;A52&quot; &quot;A54&quot; &quot;A55&quot;</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" tabindex="-1"></a><span class="co"># Odd rows, all columns</span></span>
<span id="cb266-2"><a href="#cb266-2" tabindex="-1"></a>mat[<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),]</span></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3]  [,4]  [,5] 
## [1,] &quot;A11&quot; &quot;A12&quot; &quot;A13&quot; &quot;A14&quot; &quot;A15&quot;
## [2,] &quot;A31&quot; &quot;A32&quot; &quot;A33&quot; &quot;A34&quot; &quot;A35&quot;
## [3,] &quot;A51&quot; &quot;A52&quot; &quot;A53&quot; &quot;A54&quot; &quot;A55&quot;</code></pre>
<p>The idea can be extended to a named matrix also.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" tabindex="-1"></a><span class="co"># First create a named matrix</span></span>
<span id="cb268-2"><a href="#cb268-2" tabindex="-1"></a><span class="fu">rownames</span>(mat) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Row&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb268-3"><a href="#cb268-3" tabindex="-1"></a><span class="fu">colnames</span>(mat) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Col&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb268-4"><a href="#cb268-4" tabindex="-1"></a>mat</span></code></pre></div>
<pre><code>##      Col1  Col2  Col3  Col4  Col5 
## Row1 &quot;A11&quot; &quot;A12&quot; &quot;A13&quot; &quot;A14&quot; &quot;A15&quot;
## Row2 &quot;A21&quot; &quot;A22&quot; &quot;A23&quot; &quot;A24&quot; &quot;A25&quot;
## Row3 &quot;A31&quot; &quot;A32&quot; &quot;A33&quot; &quot;A34&quot; &quot;A35&quot;
## Row4 &quot;A41&quot; &quot;A42&quot; &quot;A43&quot; &quot;A44&quot; &quot;A45&quot;
## Row5 &quot;A51&quot; &quot;A52&quot; &quot;A53&quot; &quot;A54&quot; &quot;A55&quot;</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" tabindex="-1"></a><span class="co"># filter desired rows/columns</span></span>
<span id="cb270-2"><a href="#cb270-2" tabindex="-1"></a>mat[<span class="fu">c</span>(<span class="st">&quot;Row1&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;Col2&quot;</span>, <span class="st">&quot;Col3&quot;</span>)]</span></code></pre></div>
<pre><code>##  Col2  Col3 
## &quot;A12&quot; &quot;A13&quot;</code></pre>
<p>In the above example you must have noticed that indexing objects with higher dimensionality may return the objects with lower dimensionality. E.g. sub-setting a matrix may return a vector. <strong>We can control the dimensionality reduction through the argument <code>drop=FALSE</code> which is by default TRUE and may thus introduce bugs in the code.</strong></p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" tabindex="-1"></a>mat[<span class="fu">c</span>(<span class="st">&quot;Row1&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;Col2&quot;</span>, <span class="st">&quot;Col3&quot;</span>), drop<span class="ot">=</span><span class="cn">FALSE</span>]</span></code></pre></div>
<pre><code>##      Col2  Col3 
## Row1 &quot;A12&quot; &quot;A13&quot;</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" tabindex="-1"></a><span class="co">#check this</span></span>
<span id="cb274-2"><a href="#cb274-2" tabindex="-1"></a><span class="fu">dim</span>(mat[<span class="fu">c</span>(<span class="st">&quot;Row1&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;Col2&quot;</span>, <span class="st">&quot;Col3&quot;</span>), <span class="at">drop=</span><span class="cn">FALSE</span>])</span></code></pre></div>
<pre><code>## [1] 1 2</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" tabindex="-1"></a><span class="co">#versus this</span></span>
<span id="cb276-2"><a href="#cb276-2" tabindex="-1"></a><span class="fu">dim</span>(mat[<span class="fu">c</span>(<span class="st">&quot;Row1&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;Col2&quot;</span>, <span class="st">&quot;Col3&quot;</span>)])</span></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
<div id="subsetting-through-one-vector" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Subsetting through one vector</h3>
<p>By now it should be clear that objects with higher dimensionality like matrices, array are actually vectors at the core of r, displayed and acting like objects having more than one dimension. So sub-setting with single vector on these objects coerce the behavior of these objects as vectors only and give output exactly as shown in previous section.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" tabindex="-1"></a>mat[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">25</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;A11&quot; &quot;A52&quot; &quot;A53&quot; &quot;A55&quot;</code></pre>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" tabindex="-1"></a><span class="co"># OR</span></span>
<span id="cb280-2"><a href="#cb280-2" tabindex="-1"></a>mat[<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)]</span></code></pre></div>
<pre><code>##  [1] &quot;A11&quot; &quot;A31&quot; &quot;A51&quot; &quot;A22&quot; &quot;A42&quot; &quot;A13&quot; &quot;A33&quot; &quot;A53&quot; &quot;A24&quot; &quot;A44&quot; &quot;A15&quot; &quot;A35&quot;
## [13] &quot;A55&quot;</code></pre>
</div>
<div id="subsetting-through-a-matrix" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Subsetting through a matrix</h3>
<p>We can also subset objects with higher dimensionality with integer matrix (having number of columns equal to dimensions). In other words, to subset a matrix (2D) with the help of other matrix we will need a 2 column matrix where first column will indicate row number and second column will indicate column number. See</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" tabindex="-1"></a>selection_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>, <span class="co"># Element at Row 1 Col 1</span></span>
<span id="cb282-2"><a href="#cb282-2" tabindex="-1"></a>                             <span class="dv">2</span>,<span class="dv">2</span>, <span class="co"># Element at Row 2 Col 2</span></span>
<span id="cb282-3"><a href="#cb282-3" tabindex="-1"></a>                             <span class="dv">3</span>,<span class="dv">3</span>), <span class="co"># Element at Row 3 Col 3</span></span>
<span id="cb282-4"><a href="#cb282-4" tabindex="-1"></a>                           <span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb282-5"><a href="#cb282-5" tabindex="-1"></a>                           <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb282-6"><a href="#cb282-6" tabindex="-1"></a>mat[selection_matrix]</span></code></pre></div>
<pre><code>## [1] &quot;A11&quot; &quot;A22&quot; &quot;A33&quot;</code></pre>
</div>
</div>
<div id="subsetting-lists" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Subsetting lists</h2>
<p>List sub-setting can be done using either <code>[]</code>, <code>[[]]</code> or <code>$</code>. To understand the difference between these, let us consider these one by one. As done earlier let us consider a list of 4 elements - one vector, one matrix, one list and one data frame. For now let us consider that list is unnamed.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" tabindex="-1"></a>my_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb284-2"><a href="#cb284-2" tabindex="-1"></a>  <span class="dv">11</span><span class="sc">:</span><span class="dv">20</span>,                                                       <span class="co"># first element</span></span>
<span id="cb284-3"><a href="#cb284-3" tabindex="-1"></a>  <span class="fu">outer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x, y) <span class="fu">paste0</span>(<span class="st">&#39;B&#39;</span>, x, y)),     <span class="co"># second element</span></span>
<span id="cb284-4"><a href="#cb284-4" tabindex="-1"></a>  <span class="fu">list</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>], <span class="cn">TRUE</span>),                                    <span class="co"># third element  </span></span>
<span id="cb284-5"><a href="#cb284-5" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">col1 =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">col2 =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)                  <span class="co"># fourth element</span></span>
<span id="cb284-6"><a href="#cb284-6" tabindex="-1"></a>)</span>
<span id="cb284-7"><a href="#cb284-7" tabindex="-1"></a><span class="co"># display the list</span></span>
<span id="cb284-8"><a href="#cb284-8" tabindex="-1"></a>my_list</span></code></pre></div>
<pre><code>## [[1]]
##  [1] 11 12 13 14 15 16 17 18 19 20
## 
## [[2]]
##      [,1]  [,2]  [,3]  [,4] 
## [1,] &quot;B11&quot; &quot;B12&quot; &quot;B13&quot; &quot;B14&quot;
## [2,] &quot;B21&quot; &quot;B22&quot; &quot;B23&quot; &quot;B24&quot;
## [3,] &quot;B31&quot; &quot;B32&quot; &quot;B33&quot; &quot;B34&quot;
## [4,] &quot;B41&quot; &quot;B42&quot; &quot;B43&quot; &quot;B44&quot;
## 
## [[3]]
## [[3]][[1]]
## [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot;
## 
## [[3]][[2]]
## [1] TRUE
## 
## 
## [[4]]
##   col1 col2
## 1    a    5
## 2    b    6
## 3    c    7
## 4    d    8</code></pre>
<div id="subsetting-lists-with" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Subsetting lists with <code>[]</code></h3>
<p>Sub-setting lists with <code>[]</code> will always result a list containing desired element(s).</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" tabindex="-1"></a>my_list[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [[1]]
##      [,1]  [,2]  [,3]  [,4] 
## [1,] &quot;B11&quot; &quot;B12&quot; &quot;B13&quot; &quot;B14&quot;
## [2,] &quot;B21&quot; &quot;B22&quot; &quot;B23&quot; &quot;B24&quot;
## [3,] &quot;B31&quot; &quot;B32&quot; &quot;B33&quot; &quot;B34&quot;
## [4,] &quot;B41&quot; &quot;B42&quot; &quot;B43&quot; &quot;B44&quot;</code></pre>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" tabindex="-1"></a><span class="fu">class</span>(my_list[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<p>We can apply other ideas of vector sub-setting as explained earlier with this list sub-setting. The output will also be list containing one or more items.</p>
</div>
<div id="subsetting-lists-with-1" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Subsetting lists with <code>[[]]</code></h3>
<p>Sub-setting list with <code>[[]]</code> will return that specific item (as per index given) but the output will be of type of that specific item.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" tabindex="-1"></a>my_list[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3]  [,4] 
## [1,] &quot;B11&quot; &quot;B12&quot; &quot;B13&quot; &quot;B14&quot;
## [2,] &quot;B21&quot; &quot;B22&quot; &quot;B23&quot; &quot;B24&quot;
## [3,] &quot;B31&quot; &quot;B32&quot; &quot;B33&quot; &quot;B34&quot;
## [4,] &quot;B41&quot; &quot;B42&quot; &quot;B43&quot; &quot;B44&quot;</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" tabindex="-1"></a><span class="fu">class</span>(my_list[[<span class="dv">4</span>]])</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p><em>Notice the difference in outputs created with <code>my_list[2]</code> and <code>my_list[[2]]</code> in above 2 code blocks.</em></p>
<p><em>Needless to say, one cannot index/subset lists using multiple indices.</em> Check <code>my_list[[1:2]]</code> in your console as the results may not be as what you think.</p>
</div>
<div id="chaining-or-multiple-subsetting" class="section level3" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Chaining or multiple subsetting</h3>
<p>We can further subset/index a vector/variable in R using <strong>chaining</strong> i.e. by combining one or methods as we have discussed here.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" tabindex="-1"></a><span class="co"># third element of second element</span></span>
<span id="cb294-2"><a href="#cb294-2" tabindex="-1"></a>my_list[[<span class="dv">2</span>]][<span class="dv">3</span>] <span class="co"># recall that by default matrix is by column</span></span></code></pre></div>
<pre><code>## [1] &quot;B31&quot;</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb296-2"><a href="#cb296-2" tabindex="-1"></a>my_list[[<span class="dv">2</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3] 
## [1,] &quot;B12&quot; &quot;B13&quot; &quot;B14&quot;
## [2,] &quot;B22&quot; &quot;B23&quot; &quot;B24&quot;
## [3,] &quot;B32&quot; &quot;B33&quot; &quot;B34&quot;</code></pre>
</div>
<div id="subsetting-with" class="section level3" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Subsetting with <code>$</code></h3>
<p><code>$</code> is a shorthand operator: <code>x$y</code> is roughly equivalent to <code>x[["y"]]</code>. To check this let us assign our list some names.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" tabindex="-1"></a><span class="fu">names</span>(my_list) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;second&quot;</span>, <span class="st">&quot;third&quot;</span>, <span class="st">&quot;fourth&quot;</span>)</span>
<span id="cb298-2"><a href="#cb298-2" tabindex="-1"></a><span class="co"># Now see</span></span>
<span id="cb298-3"><a href="#cb298-3" tabindex="-1"></a>my_list<span class="sc">$</span>first</span></code></pre></div>
<pre><code>##  [1] 11 12 13 14 15 16 17 18 19 20</code></pre>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" tabindex="-1"></a>my_list<span class="sc">$</span>fourth<span class="sc">$</span>col2</span></code></pre></div>
<pre><code>## [1] 5 6 7 8</code></pre>
<p><em>Notice that rules for dimensionality reduction also applies with <code>$</code></em>.</p>
<p>Another difference between <code>[[</code> sub-setting versus <code>$</code> sub-setting is partial matching (<em>left to right only</em>), which is possible with <code>$</code> only and not with <code>[[</code>. See</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" tabindex="-1"></a>my_list<span class="sc">$</span>fir</span></code></pre></div>
<pre><code>##  [1] 11 12 13 14 15 16 17 18 19 20</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" tabindex="-1"></a>my_list[[<span class="st">&#39;fir&#39;</span>]]</span></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
</div>
<div id="data-frames" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Data frames</h2>
<p>As already explained data frames are basically lists with each element having equal length, rules for sub-setting lists all apply with data frames. One addition is that data frames can also be subset using rules for matrix sub-setting.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" tabindex="-1"></a>mtcars <span class="co"># it is a default data frame in r</span></span></code></pre></div>
<pre><code>##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" tabindex="-1"></a><span class="co"># list type sub-setting</span></span>
<span id="cb308-2"><a href="#cb308-2" tabindex="-1"></a>mtcars[[<span class="dv">2</span>]]  <span class="co"># second column </span></span></code></pre></div>
<pre><code>##  [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4</code></pre>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" tabindex="-1"></a><span class="co"># matrix type</span></span>
<span id="cb310-2"><a href="#cb310-2" tabindex="-1"></a>mtcars[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="co"># first four rows with second &amp; third columns</span></span></code></pre></div>
<pre><code>##                cyl disp
## Mazda RX4        6  160
## Mazda RX4 Wag    6  160
## Datsun 710       4  108
## Hornet 4 Drive   6  258</code></pre>
<p><strong>Remember</strong></p>
<ol style="list-style-type: decimal">
<li>If sub-setting data frames with single vector, data frame behave like lists, by default. If we have to get output as data.frame we will have use <code>drop= FALSE</code> argument.</li>
<li>If however, sub-setting data frame through two vectors, these behave like matrices.</li>
</ol>
<p>Examples</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" tabindex="-1"></a><span class="co">#Default</span></span>
<span id="cb312-2"><a href="#cb312-2" tabindex="-1"></a>mtcars[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [1] 6 6 4 6 8</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" tabindex="-1"></a><span class="co"># using drop argument</span></span>
<span id="cb314-2"><a href="#cb314-2" tabindex="-1"></a>mtcars[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">2</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span></code></pre></div>
<pre><code>##                   cyl
## Mazda RX4           6
## Mazda RX4 Wag       6
## Datsun 710          4
## Hornet 4 Drive      6
## Hornet Sportabout   8</code></pre>
</div>
<div id="subsetting-and-assignment" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Subsetting and assignment</h2>
<p>All the sub-setting that we have seen can be used for assignment as well.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" tabindex="-1"></a>my_list<span class="sc">$</span>first <span class="ot">&lt;-</span> mtcars[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb316-2"><a href="#cb316-2" tabindex="-1"></a>my_list</span></code></pre></div>
<pre><code>## $first
##                cyl disp
## Mazda RX4        6  160
## Mazda RX4 Wag    6  160
## Datsun 710       4  108
## Hornet 4 Drive   6  258
## 
## $second
##      [,1]  [,2]  [,3]  [,4] 
## [1,] &quot;B11&quot; &quot;B12&quot; &quot;B13&quot; &quot;B14&quot;
## [2,] &quot;B21&quot; &quot;B22&quot; &quot;B23&quot; &quot;B24&quot;
## [3,] &quot;B31&quot; &quot;B32&quot; &quot;B33&quot; &quot;B34&quot;
## [4,] &quot;B41&quot; &quot;B42&quot; &quot;B43&quot; &quot;B44&quot;
## 
## $third
## $third[[1]]
## [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot;
## 
## $third[[2]]
## [1] TRUE
## 
## 
## $fourth
##   col1 col2
## 1    a    5
## 2    b    6
## 3    c    7
## 4    d    8</code></pre>
<!--chapter:end:03-Subsets.Rmd-->
</div>
</div>
<div id="func" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Functions and operations in R</h1>
<p>What is a function? Mathematically, a function <span class="math inline">\(f\)</span> is a relationship which map an input <span class="math inline">\(x\)</span> to an specific output, which is denoted as <span class="math inline">\(f(x)\)</span>. There are only two conditions i.e. every input should have an output, and same input if passed into same function multiple times, it should produce same output each time. So if <span class="math inline">\(x=y\)</span> we should have <span class="math inline">\(f(x)=f(y)\)</span>.</p>
<div class="figure" style="text-align: center">
<img src="images/function.png" alt="Author's illustration of a function" width="99%" />
<p class="caption">
(#fig:unnamed-chunk-89)Author’s illustration of a function
</p>
</div>
<p>For example <code>squaring</code> if considered on numbers is a function. We denote this as <span class="math inline">\(f(x)=x^2\)</span>. Or, <code>square-root</code> on positive numbers is also a function.</p>
<p>Now there may be more than one input, let us assume three inputs <code>x</code>, <code>y</code> and <code>z</code> and our function’s job is to add three times <code>x</code>, two times <code>z</code> and one time <code>y</code> together. We will write this function as <span class="math inline">\(f(x,y,z) = 3x+y+2z\)</span>. Each programming language has some pre-defined functions. Here inputs are usually termed as <code>arguments</code>. Normally values to <code>arguments</code> should be passed by users, but many times there’s a default value for these arguments. So if the value of that argument is not supplier by the user/coder explicitly, that function uses that default value silently and produces a result.</p>
<p>R’s engine then calculates the output as per definition of that function and gives us the output. If that output is assigned to some variable R does not displays/prints anything but if function is performed only the output is displayed usually, with the exception that many times function is carried out silently and nothing is returned.</p>
<p>In this chapter we will learn about some of the pre-defined functions which shall be used in our data analysis operations. We can also define our own custom functions which we will learn in chapter @ref(cust).</p>
<p>As an example, <code>sum()</code> is a predefined function available in R, which produces sum of one or more vectors passed in the function as arguments.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">15</span><span class="sc">:</span><span class="dv">45</span>)</span></code></pre></div>
<pre><code>## [1] 985</code></pre>
<p>To check the arguments available for any pre-defined function, we can use another function <code>args()</code> which take a <em>function name</em> as an argument and returns all the available arguments to that function.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" tabindex="-1"></a><span class="fu">args</span>(sum)</span></code></pre></div>
<pre><code>## function (..., na.rm = FALSE) 
## NULL</code></pre>
<p>Here we see that there is an argument (which is anmed argument0 <code>na.rm</code> having a default value <code>FALSE</code>. Actually, this argument silently takes default value and produces results. But if <code>TRUE</code> is required as a value to this argument that need to be explicitly mentioned.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cn">NA</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 55</code></pre>
<p>To get the definition of any existing function, we may just type its name without parenthesis on console, and the definition will be returned as an output.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" tabindex="-1"></a>sum</span></code></pre></div>
<pre><code>## function (..., na.rm = FALSE)  .Primitive(&quot;sum&quot;)</code></pre>
<p>To get further help about any existing function, refer section @ref(help).</p>
<div id="cust" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Custom Functions</h2>
<p>One of R’s greatest strengths is the user’s ability to add functions. In fact, many of the functions in R are functions of existing functions. The structure of a function looks like this:</p>
<pre><code>myfunctionname &lt;- function(arg1, arg2, ... ){
  statements
  return(object)
}</code></pre>
<p><strong>Note:</strong> Objects in the function are local to the function. The object returned can be any data type, from scalar to list.</p>
<p>Let’s take a look at an example. We will create a function which will take 3 numbers, will give an output by adding thrice of first, second and twice of third.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" tabindex="-1"></a>my_fun1 <span class="ot">&lt;-</span> <span class="cf">function</span>(first,second,third){</span>
<span id="cb329-2"><a href="#cb329-2" tabindex="-1"></a>  first<span class="sc">*</span><span class="dv">3</span><span class="sc">+</span>second<span class="sc">+</span>third<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb329-3"><a href="#cb329-3" tabindex="-1"></a>}</span>
<span id="cb329-4"><a href="#cb329-4" tabindex="-1"></a><span class="co"># let&#39;s check whether it is working as desired</span></span>
<span id="cb329-5"><a href="#cb329-5" tabindex="-1"></a><span class="fu">my_fun1</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 30</code></pre>
<ul>
<li>If the arguments provided are not named, it will take all arguments in the order these are defined.</li>
<li>However, we can provide named arguments in any order. See this</li>
</ul>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" tabindex="-1"></a><span class="fu">my_fun1</span>(<span class="at">second=</span><span class="dv">3</span>, <span class="at">first=</span><span class="dv">1</span>, <span class="at">third=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 26</code></pre>
<ul>
<li>Partial matching of names are also allowed. Example</li>
</ul>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" tabindex="-1"></a><span class="fu">my_fun1</span>(<span class="at">sec=</span><span class="dv">3</span>,<span class="at">fir=</span><span class="dv">1</span>,<span class="at">thi=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 26</code></pre>
<ul>
<li>We can also provide default values to any argument. These default values are however, overridden when specific values are given. See this example.</li>
</ul>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" tabindex="-1"></a><span class="co"># let&#39;s create a new function which adds twice the second argument to first argument, which in turn by default is 10</span></span>
<span id="cb335-2"><a href="#cb335-2" tabindex="-1"></a>my_fun2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">first=</span><span class="dv">10</span>, second){</span>
<span id="cb335-3"><a href="#cb335-3" tabindex="-1"></a>  first<span class="sc">+</span>second<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb335-4"><a href="#cb335-4" tabindex="-1"></a>}</span>
<span id="cb335-5"><a href="#cb335-5" tabindex="-1"></a><span class="fu">my_fun2</span>(<span class="at">second =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 30</code></pre>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" tabindex="-1"></a><span class="fu">my_fun2</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 21</code></pre>
<ul>
<li>There may be functions which do not require any argument. See this example</li>
</ul>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" tabindex="-1"></a>my_fun3 <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb339-2"><a href="#cb339-2" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&#39;Hi&#39;</span>)</span>
<span id="cb339-3"><a href="#cb339-3" tabindex="-1"></a>}</span>
<span id="cb339-4"><a href="#cb339-4" tabindex="-1"></a><span class="fu">my_fun3</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Hi&quot;</code></pre>
<div id="special-argument-ellipsis-..." class="section level3 unnumbered">
<h3 class="unnumbered">Special argument ellipsis <code>...</code></h3>
<p>While searching for help of a function in r, you may have came across something like this <code>sum(..., na.rm = FALSE)</code>. The three dots <code>...</code> here are referred to as ellipsis. Basically it means that the function is designed to take any number of named or unnamed arguments.</p>
<p>Thus it means we can provide any number of arguments in place of <code>...</code>. Now the point to be noted here is that values to all agruments occurring after <code>...</code> must only be named. See this example-</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="cn">NA</span>, <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="cn">NA</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 5050</code></pre>
<p>Now we can even use these three dots in our own custom functions. Just unpack these before writing the actual statement for that function. See this simple example-</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1" tabindex="-1"></a>my_ellipsis_func <span class="ot">&lt;-</span> <span class="cf">function</span>(...){</span>
<span id="cb345-2"><a href="#cb345-2" tabindex="-1"></a>  l <span class="ot">&lt;-</span> <span class="fu">list</span>(...) <span class="co"># unpack ellipsis</span></span>
<span id="cb345-3"><a href="#cb345-3" tabindex="-1"></a>  <span class="fu">length</span>(l) <span class="co"># return length of l</span></span>
<span id="cb345-4"><a href="#cb345-4" tabindex="-1"></a>}</span>
<span id="cb345-5"><a href="#cb345-5" tabindex="-1"></a><span class="fu">my_ellipsis_func</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">20</span>, <span class="st">&#39;a string&#39;</span>) <span class="co"># we are passing three arguments</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<div id="environment-issues" class="section level3 unnumbered">
<h3 class="unnumbered">Environment issues</h3>
<ul>
<li>Any of the argument values are not saved/updated in global environment. See this example</li>
</ul>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb347-2"><a href="#cb347-2" tabindex="-1"></a>my_fun4 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb347-3"><a href="#cb347-3" tabindex="-1"></a>  x<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb347-4"><a href="#cb347-4" tabindex="-1"></a>}</span>
<span id="cb347-5"><a href="#cb347-5" tabindex="-1"></a><span class="fu">my_fun4</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<ul>
<li>Even if we create another variable inside the function, that variable is not available outside that function’s environment.</li>
</ul>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb351-2"><a href="#cb351-2" tabindex="-1"></a>my_fun5 <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb351-3"><a href="#cb351-3" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb351-4"><a href="#cb351-4" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb351-5"><a href="#cb351-5" tabindex="-1"></a>}</span>
<span id="cb351-6"><a href="#cb351-6" tabindex="-1"></a><span class="fu">my_fun5</span>()</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" tabindex="-1"></a>y</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<ul>
<li>If however, we want to create a variable (or update existing variable) inside the function intentionally, we may use <code>forced assignment</code> denoted as <code>&lt;&lt;-</code>. See this example</li>
</ul>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb355-2"><a href="#cb355-2" tabindex="-1"></a>my_fun5 <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb355-3"><a href="#cb355-3" tabindex="-1"></a>  y <span class="ot">&lt;&lt;-</span> <span class="dv">1</span></span>
<span id="cb355-4"><a href="#cb355-4" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb355-5"><a href="#cb355-5" tabindex="-1"></a>}</span>
<span id="cb355-6"><a href="#cb355-6" tabindex="-1"></a><span class="fu">my_fun5</span>()</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" tabindex="-1"></a>y</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<ul>
<li>As already stated, we can create object of any type using a custom function.</li>
</ul>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" tabindex="-1"></a>my_list_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb359-2"><a href="#cb359-2" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">sum=</span><span class="fu">sum</span>(x),</span>
<span id="cb359-3"><a href="#cb359-3" tabindex="-1"></a>       <span class="at">mean =</span> <span class="fu">mean</span>(x),</span>
<span id="cb359-4"><a href="#cb359-4" tabindex="-1"></a>       <span class="at">sd =</span> <span class="fu">sd</span>(x))</span>
<span id="cb359-5"><a href="#cb359-5" tabindex="-1"></a>}</span>
<span id="cb359-6"><a href="#cb359-6" tabindex="-1"></a><span class="fu">my_list_fun</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## $sum
## [1] 55
## 
## $mean
## [1] 5.5
## 
## $sd
## [1] 3.02765</code></pre>
</div>
</div>
</div>
<div id="existing-and-useful-functions-in-base-r" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Existing and useful functions in base R</h1>
<p>R has a lot of inbuilt/existing functions that are useful and therefore it is good to know about them. Let us discuss a few of these existing functions which are useful for data analytics and other allied jobs.</p>
<p>Firstly, let’s learn logical operators that will be useful to check various conditions. For those who doesn’t know what operators are, they may simply think of operators being special kind of functions having exactly two arguments.</p>
<div id="conditions-and-logical-operatorsoperands" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Conditions and logical operators/operands</h2>
<table>
<caption>(#tab:table2) Conditions and logical operators/operands</caption>
<colgroup>
<col width="16%" />
<col width="33%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Operator/ function</th>
<th align="left">Meaning</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>==</code></td>
<td align="left">Is RHS equal to LHS?</td>
<td align="left"><code>5 == 2</code> will return FALSE</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="left"></td>
<td align="left"><code>'Anil' == 'anil'</code> is FALSE</td>
</tr>
<tr class="odd">
<td align="center"><code>!=</code></td>
<td align="left">Is RHS not equal to LHS?</td>
<td align="left"><code>'ABCD' != 'abcd'</code> is TRUE</td>
</tr>
<tr class="even">
<td align="center"><code>&gt;=</code></td>
<td align="left">Is LHS greater than or equal to RHS?</td>
<td align="left"><code>5 &gt;= 2</code> will return TRUE</td>
</tr>
<tr class="odd">
<td align="center"><code>&lt;=</code></td>
<td align="left">Is LHS less than or equal to RHS?</td>
<td align="left"><code>15 &lt;= 2</code> will return FALSE</td>
</tr>
<tr class="even">
<td align="center"><code>&gt;</code></td>
<td align="left">Is LHS strictly greater than RHS?</td>
<td align="left"><code>2 &gt; 2</code> will return FALSE</td>
</tr>
<tr class="odd">
<td align="center"><code>&lt;</code></td>
<td align="left">Is LHS strictly less than RHS?</td>
<td align="left"><code>12 &lt; 12</code> will return FALSE</td>
</tr>
<tr class="even">
<td align="center"><code>is.na()</code></td>
<td align="left">Whether the argument passed is NA</td>
<td align="left"><code>is.na(NA)</code> is TRUE</td>
</tr>
<tr class="odd">
<td align="center"><code>is.null()</code></td>
<td align="left">Whether the argument passed is null</td>
<td align="left"><code>is.null(NA)</code> is FALSE</td>
</tr>
<tr class="even">
<td align="center"><code>|</code></td>
<td align="left">Logical OR</td>
<td align="left"><code>TRUE | FALSE</code> will return <code>TRUE</code></td>
</tr>
<tr class="odd">
<td align="center"><code>&amp;</code></td>
<td align="left">Logical AND</td>
<td align="left"><code>TRUE &amp; FALSE</code> will return <code>FALSE</code></td>
</tr>
<tr class="even">
<td align="center"><code>!</code></td>
<td align="left">Logical NOT</td>
<td align="left"><code>!TRUE</code> will return <code>FALSE</code></td>
</tr>
<tr class="odd">
<td align="center"><code>||</code></td>
<td align="left">Element wise Logical OR</td>
<td align="left">Examines only the first element of the operands resulting into a single length logical vector</td>
</tr>
<tr class="even">
<td align="center"><code>&amp;&amp;</code></td>
<td align="left">Element wise Logical AND</td>
<td align="left">Examines only the first element of the operands resulting into a single length logical vector</td>
</tr>
<tr class="odd">
<td align="center"><code>%in%</code></td>
<td align="left">LHS <strong>IN</strong> RHS</td>
<td align="left">Checks whether LHS elements are present in RHS vector</td>
</tr>
</tbody>
</table>
</div>
<div id="vectorisation-of-operations-and-functions" class="section level2 unnumbered">
<h2 class="unnumbered">Vectorisation of operations and functions</h2>
<p>All the above mentioned operators are <strong>vectorised</strong>. Except <code>||</code> and <code>&amp;&amp;</code> will return vector of same length as we are comparing. Check</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" tabindex="-1"></a>LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>] <span class="sc">==</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span><span class="dv">1</span> <span class="sc">&gt;=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span></code></pre></div>
<pre><code>##  [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1" tabindex="-1"></a><span class="co"># TRUE will act as 1 and FALSE as 0</span></span>
<span id="cb365-2"><a href="#cb365-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb365-3"><a href="#cb365-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb365-4"><a href="#cb365-4" tabindex="-1"></a>x <span class="sc">==</span> y</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1" tabindex="-1"></a><span class="co"># Examples of element wise operations</span></span>
<span id="cb367-2"><a href="#cb367-2" tabindex="-1"></a>x <span class="sc">&amp;</span> y</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE  TRUE</code></pre>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" tabindex="-1"></a>x <span class="sc">|</span> y</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" tabindex="-1"></a><span class="co"># character strings may be checked for alphabetic order</span></span>
<span id="cb371-2"><a href="#cb371-2" tabindex="-1"></a><span class="st">&#39;ABCD&#39;</span> <span class="sc">&gt;=</span> <span class="st">&#39;AACD&#39;</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="recycling" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Recycling</h2>
<p><strong>Recycling</strong> rules apply when two vectors are not of equal length. See these examples.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1" tabindex="-1"></a><span class="co"># Notice that results are displayed silently</span></span>
<span id="cb373-2"><a href="#cb373-2" tabindex="-1"></a>LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>] <span class="sc">==</span> <span class="st">&#39;A&#39;</span></span></code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1" tabindex="-1"></a><span class="co">#Notice that results are displayed with a warning</span></span>
<span id="cb375-2"><a href="#cb375-2" tabindex="-1"></a>LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] <span class="sc">==</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## Warning in LETTERS[1:5] == LETTERS[1:3]: longer object length is not a multiple
## of shorter object length</code></pre>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE FALSE</code></pre>
<p>The <strong>operator <code>%in%</code></strong> behaves slightly different from above. Each searches each element of LHS in RHS and gives result in a logical vector equal to length of LHS vector. See these examples carefully.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" tabindex="-1"></a><span class="st">&#39;A&#39;</span> <span class="sc">%in%</span> LETTERS</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1" tabindex="-1"></a>LETTERS <span class="sc">%in%</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<pre><code>##  [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [25] FALSE FALSE</code></pre>
</div>
<div id="handling-missing-values-na-in-these-operations" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Handling Missing values <code>NA</code> in these operations</h2>
<p>While checking for any condition to be <code>TRUE</code> or <code>FALSE</code> missing values <code>NA</code> and/or <code>NaN</code> should be handled carefully or a bug may be introduced. See these examples-</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" tabindex="-1"></a><span class="cn">FALSE</span> <span class="sc">!=</span> <span class="cn">NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">!=</span> <span class="cn">NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Thus, if any of the condition is evaluated on a vector, we can have <code>NA</code> in our output along with <code>TRUE</code> and <code>FALSE</code>. See this example</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">15</span>, <span class="cn">NA</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb386-2"><a href="#cb386-2" tabindex="-1"></a>x <span class="sc">&lt;=</span> <span class="dv">5</span></span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE    NA  TRUE  TRUE</code></pre>
<p>These missing values however behaves slightly different with logical operators <code>&amp;</code> <code>|</code>. See these examples.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" tabindex="-1"></a><span class="cn">TRUE</span> <span class="sc">|</span> <span class="cn">NA</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" tabindex="-1"></a><span class="cn">FALSE</span> <span class="sc">&amp;</span> <span class="cn">NA</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="use-of-above-logical-operators-for-subsetting" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Use of above logical operators for subsetting</h2>
<p>Since the logical operations on vectors gives a <code>logical</code> vector as output, these can be used for sub-setting as well. See these examples.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" tabindex="-1"></a>my_ages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">45</span>, <span class="dv">31</span>, <span class="dv">51</span>, <span class="dv">25</span>, <span class="dv">27</span>, <span class="dv">59</span>, <span class="dv">45</span>)</span>
<span id="cb392-2"><a href="#cb392-2" tabindex="-1"></a><span class="co"># filter ages greater than or equal to 30</span></span>
<span id="cb392-3"><a href="#cb392-3" tabindex="-1"></a>my_ages[my_ages <span class="sc">&gt;=</span> <span class="dv">30</span>]</span></code></pre></div>
<pre><code>## [1] 40 45 31 51 59 45</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" tabindex="-1"></a>my_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Andrew&quot;</span>, <span class="st">&quot;Bob&quot;</span>, <span class="st">&quot;Carl&quot;</span>, <span class="st">&quot;Daven&quot;</span>, <span class="st">&quot;Earl&quot;</span>)</span>
<span id="cb394-2"><a href="#cb394-2" tabindex="-1"></a><span class="co"># filter names which start with alphabet either A, B or C</span></span>
<span id="cb394-3"><a href="#cb394-3" tabindex="-1"></a>my_names[my_names <span class="sc">&lt;=</span> <span class="st">&quot;D&quot;</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot; &quot;Bob&quot;    &quot;Carl&quot;</code></pre>
</div>
<div id="conditions-with-ifelse" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Conditions with <code>ifelse</code></h2>
<p>Syntax <code>ifelse(test, yes, no)</code> will be used to return value (of same shape as <code>test</code>) which is filled with elements selected from either <code>yes</code> or <code>no</code> depending on whether the elements of <code>test</code> are <code>TRUE</code> or <code>FALSE</code>. See this example</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="cn">NA</span>, <span class="dv">16</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb396-2"><a href="#cb396-2" tabindex="-1"></a><span class="fu">ifelse</span>(x<span class="sc">&gt;</span><span class="dv">5</span>, <span class="st">&#39;Greater than 5&#39;</span>, <span class="st">&#39;Upto 5&#39;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;Upto 5&quot;         &quot;Upto 5&quot;         &quot;Upto 5&quot;         &quot;Upto 5&quot;        
##  [5] &quot;Upto 5&quot;         NA               &quot;Greater than 5&quot; &quot;Greater than 5&quot;
##  [9] &quot;Greater than 5&quot; &quot;Greater than 5&quot; &quot;Greater than 5&quot;</code></pre>
</div>
<div id="functions-all-and-any" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Functions <code>all()</code> and <code>any()</code></h2>
<p>These are shortcut functions to tell us whether <code>all</code> or <code>any</code> of the elements of given object are <code>TRUE</code>. See This example</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb398-2"><a href="#cb398-2" tabindex="-1"></a><span class="fu">all</span>(x <span class="sc">&gt;</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" tabindex="-1"></a><span class="fu">any</span>(x <span class="sc">&gt;</span> <span class="dv">20</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>All of the above mentioned operators (along with those listed in section @ref(calculator)) are <strong>vectorised</strong>. Check these examples.</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb402-2"><a href="#cb402-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb402-3"><a href="#cb402-3" tabindex="-1"></a></span>
<span id="cb402-4"><a href="#cb402-4" tabindex="-1"></a>x <span class="sc">+</span> y</span></code></pre></div>
<pre><code>## [1]  7  9 11 13 15</code></pre>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" tabindex="-1"></a>x <span class="sc">-</span> y</span></code></pre></div>
<pre><code>## [1] -5 -5 -5 -5 -5</code></pre>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" tabindex="-1"></a>x <span class="sc">*</span> y</span></code></pre></div>
<pre><code>## [1]  6 14 24 36 50</code></pre>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" tabindex="-1"></a>x <span class="sc">/</span> y</span></code></pre></div>
<pre><code>## [1] 0.1666667 0.2857143 0.3750000 0.4444444 0.5000000</code></pre>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" tabindex="-1"></a>x <span class="sc">^</span> y</span></code></pre></div>
<pre><code>## [1]       1     128    6561  262144 9765625</code></pre>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" tabindex="-1"></a><span class="co"># Caution: here RHS is not a vector</span></span>
<span id="cb412-2"><a href="#cb412-2" tabindex="-1"></a>y <span class="sc">%%</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 0 1 2 0 1</code></pre>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" tabindex="-1"></a>y <span class="sc">%/%</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 2 2 2 3 3</code></pre>
<p><strong>Recycling</strong> also applies on mathematical operators. See these examples and notice when R gives results silently and when with a warning.</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">+</span> <span class="dv">4</span></span></code></pre></div>
<pre><code>## [1] 14 15 16 17 18 19</code></pre>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1" tabindex="-1"></a><span class="dv">100</span><span class="sc">:</span><span class="dv">110</span> <span class="sc">-</span> <span class="dv">50</span></span></code></pre></div>
<pre><code>##  [1] 50 51 52 53 54 55 56 57 58 59 60</code></pre>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1" tabindex="-1"></a><span class="co"># when length of one vector is multiple of length of smaller vector</span></span>
<span id="cb420-2"><a href="#cb420-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">9</span>)</span>
<span id="cb420-3"><a href="#cb420-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>)</span>
<span id="cb420-4"><a href="#cb420-4" tabindex="-1"></a>x <span class="sc">+</span> y</span></code></pre></div>
<pre><code>## [1] 12 10 14 17</code></pre>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="#cb422-1" tabindex="-1"></a><span class="co"># when length of one vector is not multiple of length of smaller vector</span></span>
<span id="cb422-2"><a href="#cb422-2" tabindex="-1"></a>x <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Warning in x + c(1, 2, 3): longer object length is not a multiple of shorter
## object length</code></pre>
<pre><code>## [1]  6  4 10 10</code></pre>
<p>All the above-mentioned operators/functions may also be used on matrices, arrays of larger dimension, since we have already seen that matrices/arrays are actually vectors at the core.</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1" tabindex="-1"></a>mat1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>()</span></code></pre></div>
</div>
<div id="common-arithmetical-functions" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> Common arithmetical Functions</h2>
<table>
<caption>(#tab:table4) Common Arithmetical Functions</caption>
<colgroup>
<col width="15%" />
<col width="24%" />
<col width="25%" />
<col width="34%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Function</th>
<th align="left">Meaning</th>
<th align="left">Input</th>
<th align="left">Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>sum()</code></td>
<td align="left">Adds all elements</td>
<td align="left">One or more Vector, matrix, array</td>
<td align="left">Vector having 1 element only</td>
</tr>
<tr class="even">
<td align="center"><code>prod()</code></td>
<td align="left">Returns product of all elements</td>
<td align="left">One or more Vector, matrix, array</td>
<td align="left">Vector having 1 element only</td>
</tr>
<tr class="odd">
<td align="center"><code>mean()</code></td>
<td align="left">Returns the arithmetic mean</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector having 1 element only</td>
</tr>
<tr class="even">
<td align="center"><code>max()</code></td>
<td align="left">Returns maximum value</td>
<td align="left">One or more Vector, matrix, array</td>
<td align="left">Vector having 1 element only</td>
</tr>
<tr class="odd">
<td align="center"><code>min()</code></td>
<td align="left">Returns minimum value</td>
<td align="left">One or more Vector, matrix, array</td>
<td align="left">Vector having 1 element only</td>
</tr>
<tr class="even">
<td align="center"><code>ceiling()</code></td>
<td align="left">Returns integer(s) not less than given values</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector, matrix, array having same <code>dim</code></td>
</tr>
<tr class="odd">
<td align="center"><code>floor()</code></td>
<td align="left">Returns largest integers not greater than given values</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector, matrix, array having same <code>dim</code></td>
</tr>
<tr class="even">
<td align="center"><code>trunc()</code></td>
<td align="left">returns integers formed by truncating the values towards 0</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector, matrix, array having same <code>dim</code></td>
</tr>
<tr class="odd">
<td align="center"><code>round(x, digits = 0)</code></td>
<td align="left">Rounds the given value(s) to number of decimal places provided</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector, matrix, array having same <code>dim</code></td>
</tr>
<tr class="even">
<td align="center"><code>signif(x, digits = 6)</code></td>
<td align="left">Round to <code>significant</code> digits</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector, matrix, array having same <code>dim</code></td>
</tr>
<tr class="odd">
<td align="center"><code>factorial()</code></td>
<td align="left">Returns factorial</td>
<td align="left">One Vector, matrix, array of <code>integer</code> type</td>
<td align="left">Vector having 1 element</td>
</tr>
<tr class="even">
<td align="center"><code>sqrt()</code></td>
<td align="left">Returns square root</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector, matrix, array having same <code>dim</code></td>
</tr>
<tr class="odd">
<td align="center"><code>log10()</code> or <code>log2()</code></td>
<td align="left">Logrithm with base 10 or 2 respectively</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector, matrix, array having same <code>dim</code></td>
</tr>
<tr class="even">
<td align="center"><code>exp(x)</code></td>
<td align="left">returns exponential</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector, matrix, array having same <code>dim</code></td>
</tr>
</tbody>
</table>
<p>See these examples.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1" tabindex="-1"></a><span class="fu">sum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 5105</code></pre>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1" tabindex="-1"></a>Mat1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb428-2"><a href="#cb428-2" tabindex="-1"></a>Mat2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb428-3"><a href="#cb428-3" tabindex="-1"></a></span>
<span id="cb428-4"><a href="#cb428-4" tabindex="-1"></a><span class="fu">prod</span>(Mat1, Mat2)</span></code></pre></div>
<pre><code>## [1] 87091200</code></pre>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1" tabindex="-1"></a><span class="fu">sqrt</span>(Mat2)</span></code></pre></div>
<pre><code>##          [,1]     [,2]
## [1,] 1.000000 1.732051
## [2,] 1.414214 2.000000</code></pre>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="#cb432-1" tabindex="-1"></a><span class="fu">log10</span>(Mat1)</span></code></pre></div>
<pre><code>##         [,1]      [,2]      [,3]     [,4]      [,5]
## [1,] 0.00000 0.4771213 0.6989700 0.845098 0.9542425
## [2,] 0.30103 0.6020600 0.7781513 0.903090 1.0000000</code></pre>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" tabindex="-1"></a><span class="fu">factorial</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>##  [1] 3628800  362880   40320    5040     720     120      24       6       2
## [10]       1</code></pre>
<div id="missing-values" class="section level3" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> Missing values</h3>
<p>If the vector on which we are calculating <code>sum</code> etc., has missing values, we will have to use argument <code>na.rm = TRUE</code> in these functions (Check documentation of these functions individually once). See these examples -</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="cn">NA</span>)</span>
<span id="cb436-2"><a href="#cb436-2" tabindex="-1"></a><span class="fu">sum</span>(x)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1" tabindex="-1"></a><span class="fu">sum</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 1275</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1" tabindex="-1"></a><span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 25.5</code></pre>
</div>
</div>
<div id="some-statistical-functions" class="section level2" number="4.8">
<h2><span class="header-section-number">4.8</span> Some Statistical functions</h2>
<table>
<caption>(#tab:table5) Some commonly used Statistical Functions</caption>
<colgroup>
<col width="15%" />
<col width="24%" />
<col width="25%" />
<col width="34%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Function</th>
<th align="left">Meaning</th>
<th align="left">Input</th>
<th align="left">Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>sd()</code></td>
<td align="left">Returns standard deviation</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector having 1 element only</td>
</tr>
<tr class="even">
<td align="center"><code>var()</code></td>
<td align="left">Returns variance</td>
<td align="left">One or more Vector, matrix, array</td>
<td align="left">Vector having 1 element only</td>
</tr>
<tr class="odd">
<td align="center"><code>median()</code></td>
<td align="left">Returns median value</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector having 1 element only</td>
</tr>
<tr class="even">
<td align="center"><code>range()</code></td>
<td align="left">Returns range</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector having 2 elements</td>
</tr>
<tr class="odd">
<td align="center"><code>IQR()</code></td>
<td align="left">Computes interquartile range of the x values</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Vector having 1 element only</td>
</tr>
<tr class="even">
<td align="center"><code>quantile()</code></td>
<td align="left">Computes percentile of given values for the given probabilities in <code>probs</code> argument</td>
<td align="left">One Vector, matrix, array</td>
<td align="left">Named Vector having 5 elements by default, OR equal to the length of <code>probs</code> vector given</td>
</tr>
</tbody>
</table>
<p>Examples-</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1" tabindex="-1"></a><span class="fu">median</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>## [1] 50.5</code></pre>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1" tabindex="-1"></a><span class="fu">range</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">45</span>, <span class="dv">789</span>)</span></code></pre></div>
<pre><code>## [1]   1 789</code></pre>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1" tabindex="-1"></a><span class="fu">quantile</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>##     0%    25%    50%    75%   100% 
##   1.00  25.75  50.50  75.25 100.00</code></pre>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1" tabindex="-1"></a><span class="fu">quantile</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">probs =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">/</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  10%  20%  30%  40%  50%  60%  70%  80%  90% 100% 
##   10   20   30   40   50   60   70   80   90  100</code></pre>
</div>
<div id="prob" class="section level2" number="4.9">
<h2><span class="header-section-number">4.9</span> Functions related to sampling and probability distributions</h2>
<div id="set-the-random-seed-with-set.seed" class="section level3" number="4.9.1">
<h3><span class="header-section-number">4.9.1</span> Set the random seed with <code>set.seed()</code></h3>
<p>It is a way to specify the random seed which is an integer vector, containing the random number generator (RNG) state for random number generation in R. It does not given any output but makes your code reproducible for further use.</p>
</div>
<div id="generate-random-numbers-with-rnorm-runif-rpois-etc." class="section level3" number="4.9.2">
<h3><span class="header-section-number">4.9.2</span> Generate random numbers with <code>rnorm()</code> / <code>runif()</code> / <code>rpois()</code> etc.</h3>
<p>Used to generate random numbers from normal, uniform and poisson distributions respectively. Of course there are numerous other functions not only to calculate random numbers but to calculate probability, density of these and other probability distributions (such as binomial, t), but those are beyond the scope of this book. E.g.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="co">#default mean is 0 and SD is 1</span></span></code></pre></div>
<pre><code>##  [1]  0.56245146 -1.03676642  0.07873034  0.23052746  0.17235037  0.75183691
##  [7] -0.31215139  1.54516434  0.67114670 -0.13168913</code></pre>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="co"># notice these will produce different results each time.</span></span></code></pre></div>
<pre><code>##  [1] -0.19987645 -0.35848565  0.22761820 -1.16122294  0.93957483 -0.68646154
##  [7] -0.17092149 -0.71216594  0.05745985 -0.13413754</code></pre>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="#cb454-1" tabindex="-1"></a><span class="co"># If however seed is fixed as above, these will be reproducible.</span></span>
<span id="cb454-2"><a href="#cb454-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb454-3"><a href="#cb454-3" tabindex="-1"></a><span class="fu">runif</span>(<span class="dv">10</span>) <span class="co"># default min and max are 0 and 1 respectively</span></span></code></pre></div>
<pre><code>##  [1] 0.2875775 0.7883051 0.4089769 0.8830174 0.9404673 0.0455565 0.5281055
##  [8] 0.8924190 0.5514350 0.4566147</code></pre>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="#cb456-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb456-2"><a href="#cb456-2" tabindex="-1"></a><span class="fu">runif</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 0.2875775 0.7883051 0.4089769 0.8830174 0.9404673 0.0455565 0.5281055
##  [8] 0.8924190 0.5514350 0.4566147</code></pre>
</div>
<div id="random-sample-with-sample" class="section level3" number="4.9.3">
<h3><span class="header-section-number">4.9.3</span> Random Sample with <code>sample()</code></h3>
<p>Used to take a sample of the specified <code>size</code> from the elements of x using either with or without replacement. E.g.</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb458-2"><a href="#cb458-2" tabindex="-1"></a><span class="fu">sample</span>(LETTERS, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;O&quot; &quot;S&quot; &quot;N&quot; &quot;C&quot; &quot;J&quot;</code></pre>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="#cb460-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">111</span>)</span>
<span id="cb460-2"><a href="#cb460-2" tabindex="-1"></a><span class="fu">sample</span>(LETTERS, <span class="dv">15</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;N&quot; &quot;T&quot; &quot;S&quot; &quot;O&quot; &quot;Y&quot; &quot;E&quot; &quot;C&quot; &quot;H&quot; &quot;Z&quot; &quot;Q&quot; &quot;M&quot; &quot;J&quot; &quot;D&quot; &quot;O&quot; &quot;H&quot;</code></pre>
<p>If the sampling is proportionate to given <code>probabilities</code> the same can be provided in <code>prob</code> argument.</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="#cb462-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb462-2"><a href="#cb462-2" tabindex="-1"></a><span class="fu">sample</span>(LETTERS, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>, <span class="at">prob =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Z&quot; &quot;K&quot; &quot;F&quot; &quot;V&quot; &quot;X&quot;</code></pre>
</div>
</div>
<div id="other-mathematical-functions" class="section level2" number="4.10">
<h2><span class="header-section-number">4.10</span> Other Mathematical functions</h2>
<div id="progressive-calculations-with-cumsum-cumprod" class="section level3" number="4.10.1">
<h3><span class="header-section-number">4.10.1</span> Progressive calculations with <code>cumsum()</code> /<code>cumprod()</code></h3>
<p>Used to calculate running total or product. Output vector length will be equal to that of input vector.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="#cb464-1" tabindex="-1"></a><span class="fu">cumsum</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1]  1  3  6 10 15 21 28 36 45 55</code></pre>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="#cb466-1" tabindex="-1"></a><span class="fu">cumprod</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>##  [1]   -5   20  -60  120 -120    0    0    0    0    0    0</code></pre>
<p>Other similar functions like <code>cummax()</code> (cumulative maximum) and <code>cummin()</code> may also be useful.</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb468-2"><a href="#cb468-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">10</span>)</span>
<span id="cb468-3"><a href="#cb468-3" tabindex="-1"></a><span class="fu">cummin</span>(x)</span></code></pre></div>
<pre><code>##  [1] 68 39  1  1  1  1  1  1  1  1</code></pre>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="#cb470-1" tabindex="-1"></a><span class="fu">cummax</span>(x)</span></code></pre></div>
<pre><code>##  [1] 68 68 68 68 87 87 87 87 87 87</code></pre>
</div>
<div id="progressive-difference-diff" class="section level3" number="4.10.2">
<h3><span class="header-section-number">4.10.2</span> Progressive difference <code>diff()</code></h3>
<p>Used to calculate running difference (difference between two consecutive elements) in the given numeric vector. Output will be shorter by one element. E.g.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="#cb472-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb472-2"><a href="#cb472-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb472-3"><a href="#cb472-3" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>##  [1] -0.56047565 -0.23017749  1.55870831  0.07050839  0.12928774  1.71506499
##  [7]  0.46091621 -1.26506123 -0.68685285 -0.44566197</code></pre>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="#cb474-1" tabindex="-1"></a><span class="fu">diff</span>(x)</span></code></pre></div>
<pre><code>## [1]  0.33029816  1.78888580 -1.48819992  0.05877934  1.58577725 -1.25414878
## [7] -1.72597744  0.57820838  0.24119088</code></pre>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">diff</span>(x))</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
</div>
</div>
<div id="string-manipulation-functions" class="section level2" number="4.11">
<h2><span class="header-section-number">4.11</span> String Manipulation functions</h2>
<div id="concatenate-strings-with-paste-and-paste0" class="section level3" number="4.11.1">
<h3><span class="header-section-number">4.11.1</span> Concatenate strings with <code>paste()</code> and <code>paste0()</code></h3>
<p>R’s inbuilt function <code>paste()</code> concatenates each element of one or more vectors given as argument. Argument <code>sep</code> is used to provide separator is any, which by default is a space i.e. <code>" "</code>. On the other <code>sep</code> argument is not available in <code>paste0</code> which thus concatenates elements without any separator.</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="#cb478-1" tabindex="-1"></a><span class="fu">paste</span>(LETTERS, letters)</span></code></pre></div>
<pre><code>##  [1] &quot;A a&quot; &quot;B b&quot; &quot;C c&quot; &quot;D d&quot; &quot;E e&quot; &quot;F f&quot; &quot;G g&quot; &quot;H h&quot; &quot;I i&quot; &quot;J j&quot; &quot;K k&quot; &quot;L l&quot;
## [13] &quot;M m&quot; &quot;N n&quot; &quot;O o&quot; &quot;P p&quot; &quot;Q q&quot; &quot;R r&quot; &quot;S s&quot; &quot;T t&quot; &quot;U u&quot; &quot;V v&quot; &quot;W w&quot; &quot;X x&quot;
## [25] &quot;Y y&quot; &quot;Z z&quot;</code></pre>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="#cb480-1" tabindex="-1"></a><span class="fu">paste0</span>(letters, <span class="st">&#39;_&#39;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>) <span class="co"># check replication here</span></span></code></pre></div>
<pre><code>##  [1] &quot;a_1&quot;  &quot;b_2&quot;  &quot;c_3&quot;  &quot;d_4&quot;  &quot;e_5&quot;  &quot;f_6&quot;  &quot;g_7&quot;  &quot;h_8&quot;  &quot;i_9&quot;  &quot;j_10&quot;
## [11] &quot;k_11&quot; &quot;l_12&quot; &quot;m_13&quot; &quot;n_14&quot; &quot;o_15&quot; &quot;p_16&quot; &quot;q_17&quot; &quot;r_18&quot; &quot;s_19&quot; &quot;t_20&quot;
## [21] &quot;u_21&quot; &quot;v_22&quot; &quot;w_23&quot; &quot;x_24&quot; &quot;y_25&quot; &quot;z_26&quot;</code></pre>
<p><em>Note:</em> that both <code>paste</code> and <code>paste0</code> returns vector with length equal to length of larger vector. <strong>Thus if the requirement is to concatenate each of the element in the given vector(s), use another argument <code>collapse</code>. See this example.</strong></p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="#cb482-1" tabindex="-1"></a><span class="fu">paste0</span>(letters, <span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>, <span class="at">collapse =</span> <span class="st">&#39;+&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;a1+b2+c3+d4+e5+f6+g7+h8+i9+j10+k11+l12+m13+n14+o15+p16+q17+r18+s19+t20+u21+v22+w23+x24+y25+z26&quot;</code></pre>
</div>
<div id="functions-startswith-endswith" class="section level3" number="4.11.2">
<h3><span class="header-section-number">4.11.2</span> Functions <code>startsWith()</code> / <code>endsWith()</code></h3>
<p>To check whether the given string vector say <code>x</code> start or end with string (entries of) <code>prefix</code> or <code>suffix</code> we can use <code>startsWith(x, prefix)</code> or <code>endsWith(x, suffix)</code> respectively. E.g.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="#cb484-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;apples&#39;</span>, <span class="st">&#39;oranges&#39;</span>, <span class="st">&#39;apples and oranges&#39;</span>, <span class="st">&#39;oranges and apples&#39;</span>, <span class="st">&#39;apricots&#39;</span>)</span>
<span id="cb484-2"><a href="#cb484-2" tabindex="-1"></a><span class="fu">startsWith</span>(x, <span class="st">&#39;apples&#39;</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="#cb486-1" tabindex="-1"></a><span class="fu">startsWith</span>(x, <span class="st">&#39;ap&#39;</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE FALSE  TRUE</code></pre>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="#cb488-1" tabindex="-1"></a><span class="fu">endsWith</span>(x, <span class="st">&#39;oranges&#39;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE FALSE FALSE</code></pre>
<p>Note that both these functions return logical vectors having same length as <code>x</code>.</p>
</div>
<div id="check-number-of-characters-in-string-vector-using-nchar" class="section level3" number="4.11.3">
<h3><span class="header-section-number">4.11.3</span> Check number of characters in string vector using <code>nchar()</code></h3>
<p>To count the number of characters in each of the element in string vector, say <code>x</code>, we can use <code>nchar(x)</code> which will return a vector of integer types. E.g.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="#cb490-1" tabindex="-1"></a><span class="fu">nchar</span>(x)</span></code></pre></div>
<pre><code>## [1]  6  7 18 18  8</code></pre>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="#cb492-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;&#39;</span>, <span class="st">&#39; &#39;</span>, <span class="st">&#39;   &#39;</span>, <span class="cn">NA</span>)</span>
<span id="cb492-2"><a href="#cb492-2" tabindex="-1"></a><span class="fu">nchar</span>(y)</span></code></pre></div>
<pre><code>## [1]  0  1  3 NA</code></pre>
</div>
<div id="change-case-using-toupper-tolower" class="section level3" number="4.11.4">
<h3><span class="header-section-number">4.11.4</span> Change case using <code>toupper()</code> / <code>tolower()</code></h3>
<p>Changes the case of given vector to all UPPER or lower case respectively.
Example-</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="#cb494-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Andrew&#39;</span>, <span class="st">&#39;Bob&#39;</span>)</span>
<span id="cb494-2"><a href="#cb494-2" tabindex="-1"></a><span class="fu">tolower</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;andrew&quot; &quot;bob&quot;</code></pre>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="#cb496-1" tabindex="-1"></a><span class="fu">toupper</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;ANDREW&quot; &quot;BOB&quot;</code></pre>
</div>
<div id="extract-a-portion-of-string-using-substr" class="section level3 unnumbered">
<h3 class="unnumbered">Extract a portion of string using <code>substr()</code></h3>
<p>To extract the characters from a given vector say <code>x</code> from a given <code>start</code> position to <code>stop</code> position (both being integers) we will use <code>substr(x, start, stop)</code>. E.g.</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="#cb498-1" tabindex="-1"></a><span class="fu">substr</span>(x, <span class="dv">2</span>, <span class="dv">8</span>)</span></code></pre></div>
<pre><code>## [1] &quot;ndrew&quot; &quot;ob&quot;</code></pre>
</div>
<div id="split-a-character-vector-using-strsplit" class="section level3" number="4.11.5">
<h3><span class="header-section-number">4.11.5</span> Split a character vector using <code>strsplit()</code></h3>
<p>To split the elements of a character vector <code>x</code> into sub-strings according to the matches to sub-string <code>split</code> within them. E.g.</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="#cb500-1" tabindex="-1"></a><span class="fu">strsplit</span>(x, <span class="at">split =</span> <span class="st">&#39; &#39;</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Andrew&quot;
## 
## [[2]]
## [1] &quot;Bob&quot;</code></pre>
<p><strong>Notice that output will be of <code>list</code> type.</strong></p>
</div>
<div id="replace-portions-of-string-vectors-sub-gsub" class="section level3" number="4.11.6">
<h3><span class="header-section-number">4.11.6</span> Replace portions of string vectors <code>sub()</code> / <code>gsub()</code></h3>
<p>These two functions are used to perform replacement of the first and all matches respectively. E.g.</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="#cb502-1" tabindex="-1"></a><span class="co">#Replace only first match</span></span>
<span id="cb502-2"><a href="#cb502-2" tabindex="-1"></a><span class="fu">sub</span>(<span class="at">pattern =</span> <span class="st">&#39;B&#39;</span>, <span class="at">replacement =</span> <span class="st">&#39;12&#39;</span>, x, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot; &quot;12ob&quot;</code></pre>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="#cb504-1" tabindex="-1"></a><span class="co"># Replace all matches</span></span>
<span id="cb504-2"><a href="#cb504-2" tabindex="-1"></a><span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&#39;B&#39;</span>, <span class="at">replacement =</span> <span class="st">&#39;12&#39;</span>, x, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot; &quot;12o12&quot;</code></pre>
</div>
<div id="match-patterns-using-grep-grepl-regexpr-gregexpr" class="section level3" number="4.11.7">
<h3><span class="header-section-number">4.11.7</span> Match patterns using <code>grep()</code> / <code>grepl()</code> / <code>regexpr()</code> / <code>gregexpr()</code></h3>
<p>These functions are used to match string passed as argument <code>pattern</code> under a string vector. These four however, differ in output/results. E.g.</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="#cb506-1" tabindex="-1"></a><span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">&#39;an&#39;</span>, x) <span class="co"># will give indices.  </span></span></code></pre></div>
<pre><code>## integer(0)</code></pre>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="#cb508-1" tabindex="-1"></a><span class="co">#                         Output will be integer vector and length may be shorter than that of `x`</span></span>
<span id="cb508-2"><a href="#cb508-2" tabindex="-1"></a><span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">&#39;an&#39;</span>, x) <span class="co"># will give a logical vector of same length as `x`</span></span></code></pre></div>
<pre><code>## [1] FALSE FALSE</code></pre>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="#cb510-1" tabindex="-1"></a><span class="fu">regexpr</span>(<span class="at">pattern =</span> <span class="st">&#39;an&#39;</span>, x) <span class="co"># output will have multiple attributes</span></span></code></pre></div>
<pre><code>## [1] -1 -1
## attr(,&quot;match.length&quot;)
## [1] -1 -1
## attr(,&quot;index.type&quot;)
## [1] &quot;chars&quot;
## attr(,&quot;useBytes&quot;)
## [1] TRUE</code></pre>
<p>Note that <code>regexpr()</code> outputs the character position of first instance of pattern match within the elements of given vector.
<code>gregexpr()</code> is same as <code>regexpr()</code> but finds all instances of pattern. Output will be in <code>list</code> format. E.g.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="#cb512-1" tabindex="-1"></a><span class="fu">gregexpr</span>(<span class="at">pattern =</span> <span class="st">&#39;an&#39;</span>, x)</span></code></pre></div>
<pre><code>## [[1]]
## [1] -1
## attr(,&quot;match.length&quot;)
## [1] -1
## attr(,&quot;index.type&quot;)
## [1] &quot;chars&quot;
## attr(,&quot;useBytes&quot;)
## [1] TRUE
## 
## [[2]]
## [1] -1
## attr(,&quot;match.length&quot;)
## [1] -1
## attr(,&quot;index.type&quot;)
## [1] &quot;chars&quot;
## attr(,&quot;useBytes&quot;)
## [1] TRUE</code></pre>
</div>
</div>
<div id="other-functions" class="section level2" number="4.12">
<h2><span class="header-section-number">4.12</span> Other functions</h2>
<div id="transpose-a-matrix-using-t" class="section level3" number="4.12.1">
<h3><span class="header-section-number">4.12.1</span> Transpose a matrix using <code>t()</code></h3>
<p>Used to return transpose of given matrix. E.g.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="#cb514-1" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">outer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">FUN =</span> \(x, y) <span class="fu">paste0</span>(<span class="st">&#39;A&#39;</span>, x, y))</span>
<span id="cb514-2"><a href="#cb514-2" tabindex="-1"></a>mat</span></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3]  [,4]  [,5] 
## [1,] &quot;A11&quot; &quot;A12&quot; &quot;A13&quot; &quot;A14&quot; &quot;A15&quot;
## [2,] &quot;A21&quot; &quot;A22&quot; &quot;A23&quot; &quot;A24&quot; &quot;A25&quot;
## [3,] &quot;A31&quot; &quot;A32&quot; &quot;A33&quot; &quot;A34&quot; &quot;A35&quot;
## [4,] &quot;A41&quot; &quot;A42&quot; &quot;A43&quot; &quot;A44&quot; &quot;A45&quot;
## [5,] &quot;A51&quot; &quot;A52&quot; &quot;A53&quot; &quot;A54&quot; &quot;A55&quot;</code></pre>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="#cb516-1" tabindex="-1"></a><span class="fu">t</span>(mat)</span></code></pre></div>
<pre><code>##      [,1]  [,2]  [,3]  [,4]  [,5] 
## [1,] &quot;A11&quot; &quot;A21&quot; &quot;A31&quot; &quot;A41&quot; &quot;A51&quot;
## [2,] &quot;A12&quot; &quot;A22&quot; &quot;A32&quot; &quot;A42&quot; &quot;A52&quot;
## [3,] &quot;A13&quot; &quot;A23&quot; &quot;A33&quot; &quot;A43&quot; &quot;A53&quot;
## [4,] &quot;A14&quot; &quot;A24&quot; &quot;A34&quot; &quot;A44&quot; &quot;A54&quot;
## [5,] &quot;A15&quot; &quot;A25&quot; &quot;A35&quot; &quot;A45&quot; &quot;A55&quot;</code></pre>
</div>
<div id="generate-a-frequency-table-using-table" class="section level3" number="4.12.2">
<h3><span class="header-section-number">4.12.2</span> Generate a frequency table using <code>table()</code></h3>
<p>Returns a frequency/contingency table of the counts at each combination of factor levels. E.g.</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="#cb518-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb518-2"><a href="#cb518-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb518-3"><a href="#cb518-3" tabindex="-1"></a><span class="fu">table</span>(x)</span></code></pre></div>
<pre><code>## x
##  A  B  C  D  E 
## 21 20 23 17 19</code></pre>
<p>If more than one argument is passed-</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="#cb520-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb520-2"><a href="#cb520-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">State_code =</span> x,</span>
<span id="cb520-3"><a href="#cb520-3" tabindex="-1"></a>                 <span class="at">Code2 =</span> <span class="fu">sample</span>(LETTERS[<span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>], <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb520-4"><a href="#cb520-4" tabindex="-1"></a>my_table <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>State_code, df<span class="sc">$</span>Code2)</span>
<span id="cb520-5"><a href="#cb520-5" tabindex="-1"></a>my_table</span></code></pre></div>
<pre><code>##    
##     K L M N O
##   A 5 5 4 4 3
##   B 4 3 6 2 5
##   C 6 3 3 6 5
##   D 2 2 4 6 3
##   E 2 6 4 4 3</code></pre>
</div>
<div id="generate-proportion-of-frequencies-using-prop.table" class="section level3" number="4.12.3">
<h3><span class="header-section-number">4.12.3</span> Generate proportion of frequencies using <code>prop.table()</code></h3>
<p>This function takes a table object as input and calculate the proportion of frequencies.</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="#cb522-1" tabindex="-1"></a><span class="fu">prop.table</span>(my_table)</span></code></pre></div>
<pre><code>##    
##        K    L    M    N    O
##   A 0.05 0.05 0.04 0.04 0.03
##   B 0.04 0.03 0.06 0.02 0.05
##   C 0.06 0.03 0.03 0.06 0.05
##   D 0.02 0.02 0.04 0.06 0.03
##   E 0.02 0.06 0.04 0.04 0.03</code></pre>
</div>
<div id="column-wise-or-row-wise-sums-using-colsums-rowsums" class="section level3" number="4.12.4">
<h3><span class="header-section-number">4.12.4</span> Column-wise or Row-wise sums using <code>colSums()</code> / <code>rowSums()</code></h3>
<p>Used to sum rows/columns in a matrix/data.frame. E.g.</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="#cb524-1" tabindex="-1"></a><span class="co"># Row sums</span></span>
<span id="cb524-2"><a href="#cb524-2" tabindex="-1"></a><span class="fu">rowSums</span>(my_table)</span></code></pre></div>
<pre><code>##  A  B  C  D  E 
## 21 20 23 17 19</code></pre>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="#cb526-1" tabindex="-1"></a><span class="co"># Col sums</span></span>
<span id="cb526-2"><a href="#cb526-2" tabindex="-1"></a><span class="fu">colSums</span>(my_table)</span></code></pre></div>
<pre><code>##  K  L  M  N  O 
## 19 19 21 22 19</code></pre>
<p>Note Similar to <code>colSums()</code>/ <code>rowSums()</code> we also have <code>colMeans()</code> and <code>rowMeans()</code>.</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="#cb528-1" tabindex="-1"></a><span class="fu">rowMeans</span>(my_table)</span></code></pre></div>
<pre><code>##   A   B   C   D   E 
## 4.2 4.0 4.6 3.4 3.8</code></pre>
</div>
<div id="extract-unique-values-using-unique" class="section level3" number="4.12.5">
<h3><span class="header-section-number">4.12.5</span> Extract unique values using <code>unique()</code></h3>
<p>Used to extract only unique values/elements from the given vector. E.g.</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="#cb530-1" tabindex="-1"></a><span class="fu">unique</span>(x) <span class="co"># note the output</span></span></code></pre></div>
<pre><code>## [1] &quot;C&quot; &quot;B&quot; &quot;E&quot; &quot;D&quot; &quot;A&quot;</code></pre>
</div>
<div id="check-if-two-vectors-are-identical-using-identical" class="section level3" number="4.12.6">
<h3><span class="header-section-number">4.12.6</span> Check if two vectors are identical using <code>identical()</code></h3>
<p>Used to check whether two given vectors/objects are identical.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="#cb532-1" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">unique</span>(x), LETTERS)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="retreive-duplicate-items-in-a-vector-using-duplicated" class="section level3" number="4.12.7">
<h3><span class="header-section-number">4.12.7</span> Retreive duplicate items in a vector using <code>duplicated()</code></h3>
<p>Used to check which elements have already appeared in the vector and are thus duplicate.</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="#cb534-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb534-2"><a href="#cb534-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">8</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb534-3"><a href="#cb534-3" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] &quot;C&quot; &quot;C&quot; &quot;B&quot; &quot;B&quot; &quot;C&quot; &quot;E&quot; &quot;D&quot; &quot;A&quot;</code></pre>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="#cb536-1" tabindex="-1"></a><span class="fu">duplicated</span>(x)</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE FALSE  TRUE  TRUE FALSE FALSE FALSE</code></pre>
</div>
<div id="generate-sequences-using-other-objects-with-seq_len-seq_along" class="section level3" number="4.12.8">
<h3><span class="header-section-number">4.12.8</span> Generate sequences using other objects with <code>seq_len()</code> / <code>seq_along()</code></h3>
<p>Used to generate sequence of given integer length starting with 1, or with length equal to given vector, respectively. E.g.</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="#cb538-1" tabindex="-1"></a><span class="fu">seq_len</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5</code></pre>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="#cb540-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Andrew&#39;</span>, <span class="st">&#39;Bob&#39;</span>)</span>
<span id="cb540-2"><a href="#cb540-2" tabindex="-1"></a><span class="fu">seq_along</span>(x)</span></code></pre></div>
<pre><code>## [1] 1 2</code></pre>
</div>
<div id="cutt" class="section level3" number="4.12.9">
<h3><span class="header-section-number">4.12.9</span> Divide a vector into categories (factor) using <code>cut()</code></h3>
<p>The function divides the range of <code>x</code> into intervals and codes the values in <code>x</code> according to which interval they fall. The leftmost interval corresponds to level one, the next leftmost to level two and so on. The output vector will be of type <code>factor.</code></p>
<p>Example-1:</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="#cb542-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)</span>
<span id="cb542-2"><a href="#cb542-2" tabindex="-1"></a><span class="fu">cut</span>(x, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  [1] (0.994,3] (0.994,3] (0.994,3] (3,5]     (3,5]     (0.994,3] (0.994,3]
##  [8] (3,5]     (3,5]     (5,7.01]  (5,7.01] 
## Levels: (0.994,3] (3,5] (5,7.01]</code></pre>
<p>Example-2:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="#cb544-1" tabindex="-1"></a><span class="fu">cut</span>(x, <span class="dv">3</span>, <span class="at">dig.lab =</span> <span class="dv">1</span>, <span class="at">ordered_result =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] (1,3] (1,3] (1,3] (3,5] (3,5] (1,3] (1,3] (3,5] (3,5] (5,7] (5,7]
## Levels: (1,3] &lt; (3,5] &lt; (5,7]</code></pre>
<p><strong>Note:</strong> that the output <code>factor</code> above is ordered.</p>
</div>
<div id="scale-the-columns-of-a-matrix-using-scale" class="section level3" number="4.12.10">
<h3><span class="header-section-number">4.12.10</span> Scale the columns of a matrix using <code>scale()</code></h3>
<p>Used to scale the columns of a numeric matrix.</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="#cb546-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb546-2"><a href="#cb546-2" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    6
## [2,]    2    7
## [3,]    3    8
## [4,]    4    9
## [5,]    5   10</code></pre>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="#cb548-1" tabindex="-1"></a><span class="fu">scale</span>(x)</span></code></pre></div>
<pre><code>##            [,1]       [,2]
## [1,] -1.2649111 -1.2649111
## [2,] -0.6324555 -0.6324555
## [3,]  0.0000000  0.0000000
## [4,]  0.6324555  0.6324555
## [5,]  1.2649111  1.2649111
## attr(,&quot;scaled:center&quot;)
## [1] 3 8
## attr(,&quot;scaled:scale&quot;)
## [1] 1.581139 1.581139</code></pre>
<p><strong>Note:</strong> The output will always be of a matrix type with two more attributes. See this example</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="#cb550-1" tabindex="-1"></a><span class="fu">scale</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>##            [,1]
## [1,] -1.2649111
## [2,] -0.6324555
## [3,]  0.0000000
## [4,]  0.6324555
## [5,]  1.2649111
## attr(,&quot;scaled:center&quot;)
## [1] 3
## attr(,&quot;scaled:scale&quot;)
## [1] 1.581139</code></pre>
</div>
<div id="cat" class="section level3" number="4.12.11">
<h3><span class="header-section-number">4.12.11</span> Output the results using <code>cat()</code></h3>
<p>Outputs the objects, concatenating the representations. <code>cat</code> performs much less conversion than <code>print</code>.</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="#cb552-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;ABCD&#39;</span>)</span></code></pre></div>
<pre><code>## ABCD</code></pre>
<p><strong>Note:</strong> that indices are now <em>not printed.</em> <code>cat</code> may print objects also. Example-2:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="#cb554-1" tabindex="-1"></a><span class="fu">cat</span>(month.name)</span></code></pre></div>
<pre><code>## January February March April May June July August September October November December</code></pre>
<p><code>cat</code> is useful to print <em>special characters.</em> Example-3:</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="#cb556-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&#39;Budget Allocation is \u20b91.5 crore&#39;</span>)</span></code></pre></div>
<pre><code>## Budget Allocation is ₹1.5 crore</code></pre>
</div>
<div id="sort-a-vector-using-sort" class="section level3" number="4.12.12">
<h3><span class="header-section-number">4.12.12</span> Sort a vector using <code>sort()</code></h3>
<p>Used to <strong>sort</strong> the given vector. Example-1:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="#cb558-1" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb558-2"><a href="#cb558-2" tabindex="-1"></a><span class="fu">sort</span>(vec)</span></code></pre></div>
<pre><code>## [1] 1 4 5 6 8</code></pre>
<p>Argumemt <code>decreasing = TRUE</code> is used to sort the vector in descending order instead of default ascending order.
Example-2:</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1" tabindex="-1"></a><span class="fu">sort</span>(vec, <span class="at">decreasing =</span>  <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 8 6 5 4 1</code></pre>
</div>
<div id="arrange-the-elements-of-a-vector-using-order" class="section level3" number="4.12.13">
<h3><span class="header-section-number">4.12.13</span> Arrange the elements of a vector using <code>order()</code></h3>
<p>In contrast to <code>sort()</code> explained above, <code>order()</code> returns the indices of given vector in ascending order. Example</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="#cb562-1" tabindex="-1"></a><span class="fu">order</span>(vec)</span></code></pre></div>
<pre><code>## [1] 4 3 1 5 2</code></pre>
<p>Thus, <code>sort(vec)</code> will essentially perform the same operations as <code>vec[order(vec)]</code>. We may check-</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="#cb564-1" tabindex="-1"></a><span class="fu">identical</span>(vec[<span class="fu">order</span>(vec)], <span class="fu">sort</span>(vec))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="check-structure-using-str" class="section level3" number="4.12.14">
<h3><span class="header-section-number">4.12.14</span> Check structure using <code>str()</code></h3>
<p>The short <code>str</code> is not to be confused with strings as it instead is short for <code>structure</code>. Thus, <code>str</code> returns structure of given object. Example</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="#cb566-1" tabindex="-1"></a><span class="fu">str</span>(vec)</span></code></pre></div>
<pre><code>##  num [1:5] 5 8 4 1 6</code></pre>
<p>Extremely useful when we need to inspect data frames.</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="#cb568-1" tabindex="-1"></a><span class="fu">str</span>(iris)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  5 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div id="generate-a-summary-using-summary" class="section level3 unnumbered">
<h3 class="unnumbered">Generate a summary using <code>summary()</code></h3>
<p>In addition to <code>str</code> explained above, <code>summary()</code> is also useful is getting result summaries of given objects. Example-1: When given object is vector</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="#cb570-1" tabindex="-1"></a><span class="fu">summary</span>(vec)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     1.0     4.0     5.0     4.8     6.0     8.0</code></pre>
<p>We observe that when numeric vector is passed, it produces quantile summary. Example-2: When input object is data frame.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="#cb572-1" tabindex="-1"></a><span class="fu">summary</span>(iris)</span></code></pre></div>
<pre><code>##   Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   
##  Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100  
##  1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300  
##  Median :5.800   Median :3.000   Median :4.350   Median :1.300  
##  Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199  
##  3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800  
##  Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500  
##        Species  
##  setosa    :50  
##  versicolor:50  
##  virginica :50  
##                 
##                 
## </code></pre>
</div>
</div>
</div>
<div id="pipes-in-r" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Pipes in R</h1>
<p>Now here I would like to introduce you with the concept of pipes in R. There are two types of pipes used-</p>
<ul>
<li><code>|&gt;</code> is native pipe of R. It was introduced in R version 4.1</li>
<li><code>%&gt;%</code> pipe introduced in <code>magrittr</code> package<span class="citation"><a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></span>, now part of <code>tidyverse</code> which we will use extensively in our data analysis tasks.</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/pipemag.png" alt="Magrittr, the R package, is named after the surrealist painter Rene' Magritte. His painting was self captioned, 'This is not a pipe.'" width="99%" />
<p class="caption">
(#fig:pipe2)Magrittr, the R package, is named after the surrealist painter Rene’ Magritte. His painting was self captioned, ‘This is not a pipe.’
</p>
</div>
<p>Actually <code>%&gt;%</code> is predecessor to native R’s pipe <code>|&gt;</code>. The pipes are powerful tools for clearly expressing a sequence of operations that transform an object, without the need of actually creating that object in each step. Let us understand this concept with the following example. Suppose, we have to three functions say <code>FIRST</code> , <code>SECOND</code> and <code>THIRD</code> to an object <code>OBJ</code> in sequence. So the order of operations would either be like-</p>
<pre><code>THIRD(SECOND(FIRST(OBJ)))</code></pre>
<p>or with creating intermediate objects, when instead we actually do not need those intermediate objects.</p>
<pre><code>OBJ1 &lt;- FIRST(OBJ)
OBJ2 &lt;- SECOND(OBJ1)
OBJ3 &lt;- THIRD(OBJ2)</code></pre>
<p>Here actually we do not require <code>OBJ1</code> and <code>OBJ2</code>. So in these cases we either have to compromise with the readability of code i.e. inside out or have to create unwanted objects. Pipes actually mitigate both these issues simultaneously. With pipes we can write above operations as either of these -</p>
<pre><code>OBJ1 |&gt; FIRST() |&gt; SECOND() |&gt; THIRD()
OBJ1 %&gt;% FIRST() %&gt;% SECOND() %&gt;% THIRD()</code></pre>
<p>A diagrammatic representation is given in figure @ref(fig:pipe).</p>
<div class="figure" style="text-align: center">
<img src="images/pipe.png" alt="A diagrammtic illustation of Pipe concept in base R and tidyverse" width="99%" />
<p class="caption">
(#fig:pipe)A diagrammtic illustation of Pipe concept in base R and tidyverse
</p>
</div>
<p>Now two questions may arise here-</p>
<ol style="list-style-type: decimal">
<li>What if there are multiple arguments to be passed in any of the operations?</li>
<li>Is there any difference between the two pipes? If yes, which is better OR what are the pros and cons of each?</li>
</ol>
<p>To answer these questions, we will discuss both pipes separately.</p>
<div class="figure" style="text-align: center">
<img src="images/pipes%20in%20R.png" alt="Using pipes in R" width="99%" />
<p class="caption">
(#fig:pipe3)Using pipes in R
</p>
</div>
<div id="magrittrdplyr-pipe" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Magrittr/Dplyr pipe <code>%&gt;%</code></h2>
<p>Pipes usually pass result of previous operation silently into first argument of next/right expression. So <code>data %&gt;% filter(col == 'A')</code> means <code>filter(data, col=='A')</code>. But there may be cases when result of previous (LHS) expression is required to be passed on second or other argument in RHS expression. A simple example may be of function <code>lm</code>, where <code>data</code> argument is second argument. In such cases we can make use special placeholder <code>.</code> as result of LHS specifically. In other words aforesaid filter example can be written with placeholder as <code>data %&gt;% filter(. , col == 'A')</code>. Now using this placeholder we can use result of LHS wherever we want. See this example</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="#cb577-1" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Sepal.Width, <span class="at">data =</span> .)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sepal.Length ~ Sepal.Width, data = .)
## 
## Coefficients:
## (Intercept)  Sepal.Width  
##      6.5262      -0.2234</code></pre>
<p>Thus <code>x %&gt;% f(y)</code> is equivalent to <code>f(x, y)</code> but <code>x %&gt;% f(y, .)</code> is equivalent to <code>f(y, x)</code>.</p>
</div>
<div id="base-r-pipe-version-4.2.0" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Base R pipe <code>|&gt;</code> (Version 4.2.0 +)</h2>
<p>R version 4.2.0 introduced concept of placeholder <code>_</code> similar to dplyr/magrittr, but with a few differences.</p>
<ul>
<li>The argument where <code>_</code> is to be used, must be named. So <code>f(y, z = x)</code> can be written as <code>x |&gt; f(y, z= _)</code>.</li>
</ul>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="#cb579-1" tabindex="-1"></a>iris <span class="sc">|&gt;</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Sepal.Width, <span class="at">data =</span> _) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sepal.Length ~ Sepal.Width, data = iris)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.5561 -0.6333 -0.1120  0.5579  2.2226 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   6.5262     0.4789   13.63   &lt;2e-16 ***
## Sepal.Width  -0.2234     0.1551   -1.44    0.152    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.8251 on 148 degrees of freedom
## Multiple R-squared:  0.01382,    Adjusted R-squared:  0.007159 
## F-statistic: 2.074 on 1 and 148 DF,  p-value: 0.1519</code></pre>
<p>The requirement of named argument is not there in dplyr pipe. So essentially, <code>iris %&gt;% lm(Sepal.Length ~ Sepal.Width, .)</code> will also work. But in base R <code>iris |&gt; lm(Sepal.Length ~ Sepal.Width, _)</code> would not work and throw an error. Thus, in cases where the argument of placeholder is not named, we have to use anonymous function. See these-</p>
<pre><code># placeholder without named argument
iris |&gt; lm(Sepal.Length ~ Sepal.Width, _)</code></pre>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="#cb582-1" tabindex="-1"></a><span class="co"># Correct way to use unnamed argument</span></span>
<span id="cb582-2"><a href="#cb582-2" tabindex="-1"></a>iris <span class="sc">|&gt;</span> {\(.x) <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Sepal.Width, .x)}() <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sepal.Length ~ Sepal.Width, data = .x)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.5561 -0.6333 -0.1120  0.5579  2.2226 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   6.5262     0.4789   13.63   &lt;2e-16 ***
## Sepal.Width  -0.2234     0.1551   -1.44    0.152    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.8251 on 148 degrees of freedom
## Multiple R-squared:  0.01382,    Adjusted R-squared:  0.007159 
## F-statistic: 2.074 on 1 and 148 DF,  p-value: 0.1519</code></pre>
<p>Type <code>?`|&gt;`</code> in console and see help page for more details.</p>
<!--chapter:end:04-functions.Rmd-->
</div>
</div>
<div id="control-statements" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Control statements</h1>
<p>In the previous chapter we learnt about many of the useful pre-built functions in R. In this chapter we will learn how to create customized functions suited to our needs.</p>
<p><strong><em>Though these are core concepts of a programming language, yet a reading to this chapter is advised for better understanding and better application while using r for data analytics.</em></strong></p>
<div id="control-flowloops" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Control flow/Loops</h2>
<div id="if-else" class="section level3 unnumbered">
<h3 class="unnumbered"><code>if else</code></h3>
<p>The basic form(s) of <code>if else</code> statement in R, are-</p>
<pre><code>if (test) do_this_if_true
if (test) do_this_if_true else else_do_this</code></pre>
<p>So, if <code>test</code> is true, <code>do_this_if_true</code> will be performed and optionally if <code>test</code> is not true <code>else_do_this</code> will be performed. See this example-</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="#cb585-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb585-2"><a href="#cb585-2" tabindex="-1"></a><span class="cf">if</span>(x <span class="sc">&lt;</span> <span class="dv">10</span>){</span>
<span id="cb585-3"><a href="#cb585-3" tabindex="-1"></a>  <span class="st">&#39;Smaller than 10&#39;</span></span>
<span id="cb585-4"><a href="#cb585-4" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb585-5"><a href="#cb585-5" tabindex="-1"></a>  <span class="st">&#39;10 or more&#39;</span></span>
<span id="cb585-6"><a href="#cb585-6" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;10 or more&quot;</code></pre>
<p><strong>Note</strong> that the <code>if</code>/<code>if else</code> are evaluated for a single <code>TRUE</code> or <code>FALSE</code> i.e. this control flow is <strong>not vectorised</strong> as we have in the case of <code>ifelse()</code> function which was vectorised.</p>
</div>
<div id="for-loop" class="section level3 unnumbered">
<h3 class="unnumbered"><code>for</code> loop</h3>
<p>The <code>for</code> loops in r are used to iterate over <em>given</em> items. So, the basic structure of these loops are -</p>
<pre><code>for(item in vector) perform_some_action

# OR

for(item in vector) {
  perform_some_action
}</code></pre>
<p>Thus, for each item in <code>vector</code>, <code>perform_some_action</code> is called once; updating the value of item each time. This can be understood by the following simple example-</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="#cb588-1" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb588-2"><a href="#cb588-2" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb588-3"><a href="#cb588-3" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3</code></pre>
<p>Conventionally <code>i</code> has been used in above example to iterate over given vector <code>1:3</code>, however any other symbol may also be used.</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="#cb590-1" tabindex="-1"></a><span class="cf">for</span>(item <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb590-2"><a href="#cb590-2" tabindex="-1"></a>  <span class="fu">print</span>(item)</span>
<span id="cb590-3"><a href="#cb590-3" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3</code></pre>
<p>If we use the name of any existing variable as <code>item</code> to iterate over the given object, <code>for loop</code> assigns the <code>item</code> to the current environment, overwriting any existing variable with the same name. See this example -</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="#cb592-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb592-2"><a href="#cb592-2" tabindex="-1"></a><span class="cf">for</span>(x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb592-3"><a href="#cb592-3" tabindex="-1"></a>  <span class="co"># do nothing</span></span>
<span id="cb592-4"><a href="#cb592-4" tabindex="-1"></a>}</span>
<span id="cb592-5"><a href="#cb592-5" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="figure" style="text-align: center">
<img src="images/for_loop.png" alt="A Diagrammatic representation of For Loop" width="99%" />
<p class="caption">
(#fig:unnamed-chunk-169)A Diagrammatic representation of For Loop
</p>
</div>
<p>The idea can also used to iterate over any object any <em>number of times</em> as we want. See these two examples.</p>
<p>Example-1</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="#cb594-1" tabindex="-1"></a>my_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Andrew&#39;</span>, <span class="st">&#39;Bob&#39;</span>, <span class="st">&#39;Charles&#39;</span>, <span class="st">&#39;Dylan&#39;</span>, <span class="st">&#39;Edward&#39;</span>)</span>
<span id="cb594-2"><a href="#cb594-2" tabindex="-1"></a><span class="co"># If we want first 4 elements</span></span>
<span id="cb594-3"><a href="#cb594-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb594-4"><a href="#cb594-4" tabindex="-1"></a>  <span class="fu">print</span>(my_names[i])</span>
<span id="cb594-5"><a href="#cb594-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot;
## [1] &quot;Bob&quot;
## [1] &quot;Charles&quot;
## [1] &quot;Dylan&quot;</code></pre>
<p>Example-2</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="#cb596-1" tabindex="-1"></a><span class="co"># if we want all elements</span></span>
<span id="cb596-2"><a href="#cb596-2" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(my_names)){</span>
<span id="cb596-3"><a href="#cb596-3" tabindex="-1"></a>  <span class="fu">print</span>(my_names[i])</span>
<span id="cb596-4"><a href="#cb596-4" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Andrew&quot;
## [1] &quot;Bob&quot;
## [1] &quot;Charles&quot;
## [1] &quot;Dylan&quot;
## [1] &quot;Edward&quot;</code></pre>
<p>There are 2 ways to terminate any <code>for loop</code> early-</p>
<ul>
<li><code>next</code> which exits the current iteration only</li>
<li><code>break</code> which breaks the entire loop.</li>
</ul>
<p>See these examples.</p>
<p>Example-1</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="#cb598-1" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb598-2"><a href="#cb598-2" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">4</span>){</span>
<span id="cb598-3"><a href="#cb598-3" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb598-4"><a href="#cb598-4" tabindex="-1"></a>  }</span>
<span id="cb598-5"><a href="#cb598-5" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb598-6"><a href="#cb598-6" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 5</code></pre>
<p>Example-2</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="#cb600-1" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb600-2"><a href="#cb600-2" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">4</span>){</span>
<span id="cb600-3"><a href="#cb600-3" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb600-4"><a href="#cb600-4" tabindex="-1"></a>  }</span>
<span id="cb600-5"><a href="#cb600-5" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb600-6"><a href="#cb600-6" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3</code></pre>
</div>
<div id="while-loop" class="section level3 unnumbered">
<h3 class="unnumbered"><code>while</code> loop</h3>
<p>We have seen that <code>for</code> loop is used to iterate over a set of <code>known values</code> or at least known number of times. If however, we want to perform some iterative action unknown number of times, we may use <code>while</code> loop which iterates till a given <code>condition</code> is <code>TRUE</code>. Another option is to have <code>repeat</code> loop which can be used to iterate any number of times till it encounters a <code>break</code>.</p>
<p>The basic syntax of <code>while</code> loop is-</p>
<pre><code>while (condition) action</code></pre>
<p>See these examples-</p>
<p>Example-1</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="#cb603-1" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb603-2"><a href="#cb603-2" tabindex="-1"></a><span class="cf">while</span>(i <span class="sc">&lt;=</span><span class="dv">4</span>){</span>
<span id="cb603-3"><a href="#cb603-3" tabindex="-1"></a>  <span class="fu">print</span>(LETTERS[i])</span>
<span id="cb603-4"><a href="#cb603-4" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb603-5"><a href="#cb603-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;A&quot;
## [1] &quot;B&quot;
## [1] &quot;C&quot;
## [1] &quot;D&quot;</code></pre>
<p>We may check the value of <code>i</code> here after executing the loop</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="#cb605-1" tabindex="-1"></a>i</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<p>Example-2:</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="#cb607-1" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb607-2"><a href="#cb607-2" tabindex="-1"></a><span class="cf">while</span>(i <span class="sc">&gt;=</span><span class="dv">0</span>){</span>
<span id="cb607-3"><a href="#cb607-3" tabindex="-1"></a>  <span class="fu">print</span>(LETTERS[i])</span>
<span id="cb607-4"><a href="#cb607-4" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i<span class="dv">-1</span></span>
<span id="cb607-5"><a href="#cb607-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;D&quot;
## [1] &quot;C&quot;
## [1] &quot;B&quot;
## [1] &quot;A&quot;
## character(0)</code></pre>
<p><strong>Note:</strong> We have to make sure that the statements inside the brackets modify the <code>while condition</code> so that sooner or later the given condition is no longer <code>TRUE</code> otherwise the loop will never end and will go on forever.</p>
<div class="figure" style="text-align: center">
<img src="images/while_loop.png" alt="Author's illustration of While Loop" width="99%" />
<p class="caption">
(#fig:unnamed-chunk-177)Author’s illustration of While Loop
</p>
</div>
<blockquote>
<p><strong><em>Looping in R can be inefficient and time consuming when you’re processing the rows or columns of large data-sets. Even one of greatest feature in R is its parallel processing of vector objects. Thus, whenever possible, it’s better to use R’s built-in numerical and character functions in conjunction with the <code>apply</code> family of functions.(We will discuss these in detail in the chapter related to functional programming)</em></strong></p>
</blockquote>
<!--chapter:end:05-1conditionals.Rmd-->
</div>
</div>
</div>
<div id="functional-programming" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Functional Programming</h1>
<div id="what-is-functional-programming" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> What is functional programming?</h2>
<p>Conceptually functional programming philosophy is based on lambda calculus. Lambda calculus is a framework developed by Alonzo Church<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> to study computations with functions.</p>
<p>Functional programming is a programming paradigm in which we try to bind everything in pure mathematical functions style. It is a declarative type of programming style. Its main focus is on <strong>what to solve</strong> in contrast to an imperative style where the main focus is <strong>how to solve</strong>. For a more elaborated definition readers may see this wikipedia <a href="https://en.wikipedia.org/wiki/Functional_programming">link</a>. Simply putting functional programming is like doing something repeatedly but in declarative style. Here, functions are the primary method with which we carry out tasks. All actions are just implementations of functions we are using.</p>
<p>Functional programming use high order functions. A high order function is actually a function that accepts a function as an argument, or returns a function; in short, function that operates upon a function. We have already seen one such example may be without noticing it, <code>args()</code> function take a function as an argument and in turn return its arguments.</p>
<p>Let us learn a bit more here.</p>
<div id="usage-of-functional-programming-in-r" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Usage of functional programming in R</h3>
<p>Strictly speaking R is not a functional programming language. But we have already seen that one of the greatest strengths of R is parallel operations on vectors. In fact we need functional programming where concurrency or parallelism is required. Till now we have seen that most of the functions work on all atomic objects (vectors, matrices, arrays, etc.), but what about working of these functions on recursive objects i.e. lists? Check this example (in your console)-</p>
<pre><code>list1 &lt;- list(50000, 5000, 56)
sum(list1)</code></pre>
<blockquote>
<p>Of course, we can solve the above problem by using for loops. See</p>
</blockquote>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="#cb610-1" tabindex="-1"></a>list1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">50000</span>, <span class="dv">5000</span>, <span class="dv">56</span>)</span>
<span id="cb610-2"><a href="#cb610-2" tabindex="-1"></a><span class="co"># for loop strategy</span></span>
<span id="cb610-3"><a href="#cb610-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb610-4"><a href="#cb610-4" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(list1)){</span>
<span id="cb610-5"><a href="#cb610-5" tabindex="-1"></a>  x[i] <span class="ot">&lt;-</span> list1[[i]]</span>
<span id="cb610-6"><a href="#cb610-6" tabindex="-1"></a>}</span>
<span id="cb610-7"><a href="#cb610-7" tabindex="-1"></a><span class="fu">sum</span>(x)</span></code></pre></div>
<pre><code>## [1] 55056</code></pre>
<p>Consider another list, where we want to calculate mean of each element of that list.</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="#cb612-1" tabindex="-1"></a>list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb612-2"><a href="#cb612-2" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb612-3"><a href="#cb612-3" tabindex="-1"></a>  <span class="dv">11</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb612-4"><a href="#cb612-4" tabindex="-1"></a>  <span class="dv">21</span><span class="sc">:</span><span class="dv">30</span></span>
<span id="cb612-5"><a href="#cb612-5" tabindex="-1"></a>)</span></code></pre></div>
<p>Of course, we may use a for loop again, but in R these operations can be done easily with <em>apply</em> group of functions, which are one of the most famous and most used features in R.</p>
</div>
</div>
<div id="apply-family-of-functions" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> <code>apply</code> family of functions</h2>
<p>First of these functions is <code>apply()</code> which works on matrices/data frames.</p>
<div id="function-apply" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Function <code>apply()</code></h3>
<p>The basic syntax of <code>apply</code> is</p>
<pre><code>apply(m, MARGIN, FUN, f_args)</code></pre>
<p>where</p>
<ul>
<li><code>m</code> is the matrix</li>
<li><code>MARGIN</code> is the dimension. If we want to <em>apply</em> function to each row then use <code>1</code> or else if it is to be column-wise use <code>2</code></li>
<li><code>FUN</code> is the desired function which we want to apply</li>
<li><code>f_args</code> are the optional set of arguments, if needed to be supplied to <code>fun</code>.</li>
</ul>
<p>An illustrative construction of <code>apply</code> function can be seen in @ref(fig:applyimage).</p>
<div class="figure" style="text-align: center">
<img src="images/apply.png" alt="Illustration of function apply" width="100%" />
<p class="caption">
(#fig:applyimage)Illustration of function apply
</p>
</div>
<p>Check this example</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="#cb614-1" tabindex="-1"></a>(mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">nrow =</span> <span class="dv">5</span>))</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    6
## [2,]    2    7
## [3,]    3    8
## [4,]    4    9
## [5,]    5   10</code></pre>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="#cb616-1" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, mean)</span></code></pre></div>
<pre><code>## [1] 3.5 4.5 5.5 6.5 7.5</code></pre>
<p><strong>Note:</strong> <code>rowMeans(mat)</code> in above example would have given similar results, but for sake of simplicity we have provided a simplest example.</p>
<p><strong>Further note that we may also write our own customised function in the argument.</strong> See this another example, where we will take sum of squares of each row. We may define our own custom function for the purpose and then <code>apply</code> it.</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="#cb618-1" tabindex="-1"></a>my_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb618-2"><a href="#cb618-2" tabindex="-1"></a>  <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb618-3"><a href="#cb618-3" tabindex="-1"></a>}</span>
<span id="cb618-4"><a href="#cb618-4" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, my_fun)</span></code></pre></div>
<pre><code>## [1]  37  53  73  97 125</code></pre>
<p>The need to writing a custom function before hand may be eliminated if the function so defined is not be used further. We may write anonymous function directly in the <code>apply</code> syntax -</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="#cb620-1" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1]  37  53  73  97 125</code></pre>
<div class="rmdnote">
<p><strong>In R version 4.1 and onwards R has devised shorthand style of defining inline custom functions, where we can write backslash i.e. <code>\</code> instead of writing <code>function</code>.</strong> We could have written above expression as-</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="#cb622-1" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, <span class="at">FUN =</span> \(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb622-2"><a href="#cb622-2" tabindex="-1"></a><span class="do">## [1]  37  53  73  97 125</span></span></code></pre></div>
</div>
<div id="apply-need-not-necessarily-output-vectors-only" class="section level4 unnumbered">
<h4 class="unnumbered"><code>apply()</code> need not necessarily output vectors only</h4>
<p>If <code>FUN</code> applied on rows/columns of matrix outputs vector of length more than 1, the output will be in matrix format. But the thing to note here is that matrix will be displayed columnwise always irrespective of fact whether <code>MARGIN</code> is <code>1</code> or <code>2</code>. As an easy example we could have shown this using function like <code>sqrt</code>, but <code>apply(matrix, MARGIN, sqrt)</code> will work like <code>sqrt(matrix)</code> only. So let’s take a different example. Suppose we want to calculate <code>column-wise</code> cumulative sum in a given matrix.</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="#cb623-1" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">2</span>, cumsum)</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    6
## [2,]    3   13
## [3,]    6   21
## [4,]   10   30
## [5,]   15   40</code></pre>
<p>The output here is eaxctly what was desired. But what if, our requirement was to take <code>row-wise</code> cumulative sum?</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="#cb625-1" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, cumsum)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    2    3    4    5
## [2,]    7    9   11   13   15</code></pre>
<p>It may now be noticed that the output is actually <em>transpose</em> of what we were expecting. Actually the output of each iteration of <code>apply</code> function is displayed in one column always. Let us check our understanding with one more example taking function which may give output that is not dependent on input vector length.</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="#cb627-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb627-2"><a href="#cb627-2" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, sample, <span class="dv">4</span>, <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    7    8    4   10
## [2,]    6    2    8    4   10
## [3,]    1    2    3    4   10
## [4,]    1    2    3    9    5</code></pre>
<p>Thus we may conclude that-</p>
<ul>
<li>If <code>FUN</code> outputs a scalar, the output of <code>apply</code> will be a vector of <strong>length</strong> equal to
<ul>
<li>number of <code>rows</code> in input matrix given that <code>MARGIN</code> selected in 1,</li>
<li>number of <code>columns</code> in input matrix given that <code>MARGIN</code> selected in 2.</li>
</ul></li>
<li>if <code>FUN</code> outputs a vector(of length &gt;1) then output of <code>apply</code> will be a matrix having <strong>number of columns</strong> equal to -
<ul>
<li>number of <code>rows</code> in input matrix given that <code>MARGIN</code> selected in 1,</li>
<li>number of <code>columns</code> in input matrix given that <code>MARGIN</code> selected in 2.</li>
</ul></li>
</ul>
<p>These have been tabulated in table @ref(tab:apply).</p>
<table>
<caption>(#tab:apply) Relation between input and output data structure in <code>apply</code></caption>
<thead>
<tr class="header">
<th>Input matrix <span class="math inline">\(m*n\)</span></th>
<th align="center"><code>MARGIN = 1</code></th>
<th align="center"><code>MARGIN = 2</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FUN gives scalar</td>
<td align="center">Vector size <span class="math inline">\(m\)</span></td>
<td align="center">Vector size <span class="math inline">\(n\)</span></td>
</tr>
<tr class="even">
<td>FUN gives vector size <span class="math inline">\(p\)</span></td>
<td align="center">Matrix <span class="math inline">\(p*m\)</span></td>
<td align="center">Matrix <span class="math inline">\(p*n\)</span></td>
</tr>
</tbody>
</table>
<p>We may thus have to be careful while getting the output from <code>apply</code> function as it may lead to introduction of bug in our code.</p>
</div>
<div id="apply-on-data-frames" class="section level4 unnumbered">
<h4 class="unnumbered"><code>apply()</code> on data frames</h4>
<p>Now we know that data frames despite being special type of lists also behave like matrices, we may use <code>apply</code> on data frames too. See this example.</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="#cb629-1" tabindex="-1"></a>(my_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mat))</span></code></pre></div>
<pre><code>##   V1 V2
## 1  1  6
## 2  2  7
## 3  3  8
## 4  4  9
## 5  5 10</code></pre>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="#cb631-1" tabindex="-1"></a><span class="fu">apply</span>(my_df, <span class="dv">2</span>, sum)</span></code></pre></div>
<pre><code>## V1 V2 
## 15 40</code></pre>
</div>
</div>
<div id="function-lapply" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Function <code>lapply()</code></h3>
<p>Another cousin of apply is <code>lapply</code> which can thought of <code>apply</code> to <code>l</code>ists. So as the name suggests it is applied on lists instead of matrices. Now since <code>data frame</code> is also a list <code>lapply</code> can be applied on these. The basic syntax of <code>lapply()</code> is -</p>
<pre><code>lapply(l, FUN, f_args)</code></pre>
<p>where</p>
<ul>
<li><code>l</code> is the list</li>
<li><code>FUN</code> is the desired function which we want to apply</li>
<li><code>f_args</code> are the optional set of arguments, if needed to be supplied to <code>fun</code>.</li>
</ul>
<p>It may be noted that <code>MRAGIN</code> argument is not available here. See these examples.</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="#cb634-1" tabindex="-1"></a><span class="fu">lapply</span>(my_df, sum)</span></code></pre></div>
<pre><code>## $V1
## [1] 15
## 
## $V2
## [1] 40</code></pre>
<p>Now you may have noticed two things here -</p>
<ol style="list-style-type: decimal">
<li>The output is of <code>list</code> type.</li>
<li>Unlike <code>apply</code> as <code>MARGIN</code> is not passed/available here, it applies <code>FUN</code> to every element of list. When we consider any <code>data.frame</code> as a list its each column is a separate element of that list. So <code>FUN</code> cannot be applied to <code>rows</code> in a <code>data.frame</code>.</li>
</ol>
<p>Thus <code>lapply()</code> -</p>
<ul>
<li>loops over a list, iterating over each element in that list</li>
<li>then <em>applies</em> the function <code>FUN</code> to each element</li>
<li>and then returns a list.</li>
</ul>
<p>Example-2: Let’s try to find type of each column in a given data frame.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="#cb636-1" tabindex="-1"></a><span class="fu">lapply</span>(iris, typeof)</span></code></pre></div>
<pre><code>## $Sepal.Length
## [1] &quot;double&quot;
## 
## $Sepal.Width
## [1] &quot;double&quot;
## 
## $Petal.Length
## [1] &quot;double&quot;
## 
## $Petal.Width
## [1] &quot;double&quot;
## 
## $Species
## [1] &quot;integer&quot;</code></pre>
<p>Similar to <code>apply</code> we can define <code>FUN</code> inline here (anonymously) also. Example-3:</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="#cb638-1" tabindex="-1"></a><span class="fu">lapply</span>(my_df, \(a) a<span class="sc">^</span><span class="dv">2</span>) </span></code></pre></div>
<pre><code>## $V1
## [1]  1  4  9 16 25
## 
## $V2
## [1]  36  49  64  81 100</code></pre>
<p>Example-4:</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="#cb640-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb640-2"><a href="#cb640-2" tabindex="-1"></a><span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, runif, <span class="at">min=</span><span class="dv">0</span>, <span class="at">max=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2.655087
## 
## [[2]]
## [1] 3.721239 5.728534
## 
## [[3]]
## [1] 9.082078 2.016819 8.983897
## 
## [[4]]
## [1] 9.4467527 6.6079779 6.2911404 0.6178627</code></pre>
<p><strong>Note</strong> that even if <code>lapply</code> is applied over a vector, it returns a list only.</p>
</div>
<div id="function-sapply" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Function <code>sapply()</code></h3>
<p>There is not much of the difference between <code>lapply()</code> and <code>sapply()</code>, as <code>sapply</code> is actually <code>s</code>implified l<code>apply</code>. It simplifies the argument as much as possible.</p>
<p>Example:</p>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="#cb642-1" tabindex="-1"></a><span class="fu">sapply</span>(my_df, sum)</span></code></pre></div>
<pre><code>## V1 V2 
## 15 40</code></pre>
</div>
</div>
<div id="other-loop-functions" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Other loop functions</h2>
<div id="function-replicate" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Function <code>replicate()</code></h3>
<p>Function <code>replicate()</code>(replicate) is used for repeated evaluation of an expression. Syntax is</p>
<pre><code>replicate(n, expr, simplify = &quot;array&quot;)</code></pre>
<p>where -</p>
<ul>
<li><code>n</code> is integer denoting the number of replications</li>
<li><code>expr</code> is the expression to evaluate repeatedly</li>
<li><code>simplify</code> takes either ‘character’ or ‘logical’ to value to indicate whether the results should be simplified.</li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="#cb645-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb645-2"><a href="#cb645-2" tabindex="-1"></a><span class="co"># Default value of simplify will simplify the results as much possible</span></span>
<span id="cb645-3"><a href="#cb645-3" tabindex="-1"></a><span class="fu">replicate</span>(<span class="dv">5</span>, <span class="fu">runif</span>(<span class="dv">3</span>))</span></code></pre></div>
<pre><code>##           [,1]      [,2]      [,3]      [,4]      [,5]
## [1,] 0.2875775 0.8830174 0.5281055 0.4566147 0.6775706
## [2,] 0.7883051 0.9404673 0.8924190 0.9568333 0.5726334
## [3,] 0.4089769 0.0455565 0.5514350 0.4533342 0.1029247</code></pre>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="#cb647-1" tabindex="-1"></a><span class="co"># Notice the difference with simplify=FALSE</span></span>
<span id="cb647-2"><a href="#cb647-2" tabindex="-1"></a><span class="fu">replicate</span>(<span class="dv">3</span>, <span class="fu">runif</span>(<span class="dv">5</span>), <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0.89982497 0.24608773 0.04205953 0.32792072 0.95450365
## 
## [[2]]
## [1] 0.8895393 0.6928034 0.6405068 0.9942698 0.6557058
## 
## [[3]]
## [1] 0.7085305 0.5440660 0.5941420 0.2891597 0.1471136</code></pre>
</div>
<div id="function-split" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Function <code>split()</code></h3>
<p>The <code>split()</code>(split() function) function takes object (vector or other) and splits it into groups determined by a given factor. The basic syntax is-</p>
<pre><code>split(x, f, drop=FALSE, ...)</code></pre>
<p>where</p>
<ul>
<li><code>x</code> is input object - <code>vector</code> or <code>list</code> or <code>data.frame</code></li>
<li><code>f</code> is a factor or a list of factors. If a factor is not provided, it will be coerced to factor.</li>
<li><code>drop</code> argument indicates whether empty factors should be dropped.</li>
</ul>
<p>Example: (To divide the given list by alternate elements)-</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="#cb650-1" tabindex="-1"></a><span class="fu">split</span>(LETTERS, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">13</span>))</span></code></pre></div>
<pre><code>## $`1`
##  [1] &quot;A&quot; &quot;C&quot; &quot;E&quot; &quot;G&quot; &quot;I&quot; &quot;K&quot; &quot;M&quot; &quot;O&quot; &quot;Q&quot; &quot;S&quot; &quot;U&quot; &quot;W&quot; &quot;Y&quot;
## 
## $`2`
##  [1] &quot;B&quot; &quot;D&quot; &quot;F&quot; &quot;H&quot; &quot;J&quot; &quot;L&quot; &quot;N&quot; &quot;P&quot; &quot;R&quot; &quot;T&quot; &quot;V&quot; &quot;X&quot; &quot;Z&quot;</code></pre>
<p>Example-2: Find out sum of every odd and even number from 1:100-</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="#cb652-1" tabindex="-1"></a><span class="fu">split</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, (<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">%%</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">lapply</span>(sum)</span></code></pre></div>
<pre><code>## $`0`
## [1] 2550
## 
## $`1`
## [1] 2500</code></pre>
<p>Example-3: Find out mean of <code>mpg</code> column splitting the <code>mtcars</code> data by <code>cyl</code></p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb654-1"><a href="#cb654-1" tabindex="-1"></a><span class="fu">split</span>(mtcars<span class="sc">$</span>mpg, mtcars<span class="sc">$</span>cyl) <span class="sc">|&gt;</span> <span class="fu">sapply</span>(mean)</span></code></pre></div>
<pre><code>##        4        6        8 
## 26.66364 19.74286 15.10000</code></pre>
</div>
<div id="tapply" class="section level3" number="7.3.3">
<h3><span class="header-section-number">7.3.3</span> <code>tapply()</code></h3>
<p>The <code>tapply()</code> function(tapply() function) can be thought of combination of <code>split</code> and <code>sapply</code> for vectors, exactly as used in above example. It actually applies the function over subsets of a given vector. The basic syntax is-</p>
<pre><code>tapply(X, INDEX, FUN = NULL, ..., default = NA, simplify = TRUE)</code></pre>
<p>Where -</p>
<ul>
<li><code>X</code> is a vector</li>
<li><code>INDEX</code> is factor or list of factors</li>
<li><code>FUN</code> is function to be applied</li>
<li><code>...</code> are other arguments, if any, of <code>FUN</code> to be passed</li>
<li><code>simplify</code> if TRUE simplifies the result.</li>
</ul>
<p>See this example</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="#cb657-1" tabindex="-1"></a><span class="fu">tapply</span>(mtcars<span class="sc">$</span>mpg, mtcars<span class="sc">$</span>cyl, mean)</span></code></pre></div>
<pre><code>##        4        6        8 
## 26.66364 19.74286 15.10000</code></pre>
<p>Needless to say if <code>simplify</code> is <code>FALSE</code> the results will not be simplified. See this example-</p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="#cb659-1" tabindex="-1"></a><span class="co"># month-wise mean of temperatures from `airquality` data</span></span>
<span id="cb659-2"><a href="#cb659-2" tabindex="-1"></a><span class="fu">tapply</span>(airquality<span class="sc">$</span>Temp, airquality<span class="sc">$</span>Month, mean, <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## $`5`
## [1] 65.54839
## 
## $`6`
## [1] 79.1
## 
## $`7`
## [1] 83.90323
## 
## $`8`
## [1] 83.96774
## 
## $`9`
## [1] 76.9</code></pre>
</div>
<div id="by-function" class="section level3" number="7.3.4">
<h3><span class="header-section-number">7.3.4</span> <code>by()</code> function</h3>
<p>This(by() function) works something like <code>tapply</code> but with the difference that input object here is <code>data.frame</code>. See this example</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="#cb661-1" tabindex="-1"></a><span class="co"># Split the data by `cyl` column and subset first six rows only</span></span>
<span id="cb661-2"><a href="#cb661-2" tabindex="-1"></a><span class="fu">by</span>(mtcars, mtcars<span class="sc">$</span>cyl, head)</span></code></pre></div>
<pre><code>## mtcars$cyl: 4
##                 mpg cyl  disp hp drat    wt  qsec vs am gear carb
## Datsun 710     22.8   4 108.0 93 3.85 2.320 18.61  1  1    4    1
## Merc 240D      24.4   4 146.7 62 3.69 3.190 20.00  1  0    4    2
## Merc 230       22.8   4 140.8 95 3.92 3.150 22.90  1  0    4    2
## Fiat 128       32.4   4  78.7 66 4.08 2.200 19.47  1  1    4    1
## Honda Civic    30.4   4  75.7 52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla 33.9   4  71.1 65 4.22 1.835 19.90  1  1    4    1
## ------------------------------------------------------------ 
## mtcars$cyl: 6
##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Valiant        18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Merc 280       19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C      17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## ------------------------------------------------------------ 
## mtcars$cyl: 8
##                     mpg cyl  disp  hp drat   wt  qsec vs am gear carb
## Hornet Sportabout  18.7   8 360.0 175 3.15 3.44 17.02  0  0    3    2
## Duster 360         14.3   8 360.0 245 3.21 3.57 15.84  0  0    3    4
## Merc 450SE         16.4   8 275.8 180 3.07 4.07 17.40  0  0    3    3
## Merc 450SL         17.3   8 275.8 180 3.07 3.73 17.60  0  0    3    3
## Merc 450SLC        15.2   8 275.8 180 3.07 3.78 18.00  0  0    3    3
## Cadillac Fleetwood 10.4   8 472.0 205 2.93 5.25 17.98  0  0    3    4</code></pre>
</div>
<div id="specifying-the-output-type-with-vapply" class="section level3" number="7.3.5">
<h3><span class="header-section-number">7.3.5</span> Specifying the output type with <code>vapply()</code></h3>
<p>Function <code>vapply()</code>(vapply() function) works exactly like <code>sapply()</code> described above, with only difference that type of return value (output) has to be specifically provided through <code>FUN.VALUE</code> argument. Its syntax is -</p>
<pre><code>vapply(X, FUN, FUN.VALUE, ..., USE.NAMES = TRUE)</code></pre>
<ul>
<li>In the argument <code>FUN.VALUE</code> we have to provide the format type of output. See this example.</li>
</ul>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="#cb664-1" tabindex="-1"></a><span class="fu">vapply</span>(mtcars, max, <span class="at">FUN.VALUE =</span> <span class="fu">double</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>##     mpg     cyl    disp      hp    drat      wt    qsec      vs      am    gear 
##  33.900   8.000 472.000 335.000   4.930   5.424  22.900   1.000   1.000   5.000 
##    carb 
##   8.000</code></pre>
<p>Through <code>FUN.VALUE = double(1)</code> we have specifically provided that our output should be of <code>double</code> type with length <code>1</code>. So in case we have to find out <code>range</code> of each column-</p>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="#cb666-1" tabindex="-1"></a><span class="fu">vapply</span>(mtcars, range, <span class="at">FUN.VALUE =</span> <span class="fu">double</span>(<span class="dv">2</span>))</span></code></pre></div>
<pre><code>##       mpg cyl  disp  hp drat    wt qsec vs am gear carb
## [1,] 10.4   4  71.1  52 2.76 1.513 14.5  0  0    3    1
## [2,] 33.9   8 472.0 335 4.93 5.424 22.9  1  1    5    8</code></pre>
<p>If we will try this function on a dataset having mixed type columns like <code>iris</code> dataset, <code>vapply</code> will throw an error.</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="#cb668-1" tabindex="-1"></a><span class="fu">vapply</span>(iris, range, <span class="at">FUN.VALUE =</span> <span class="fu">double</span>())</span></code></pre></div>
<pre><code>## Error in vapply(iris, range, FUN.VALUE = double()): values must be length 0,
##  but FUN(X[[1]]) result is length 2</code></pre>
</div>
</div>
<div id="purrr" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Functional Programming in <code>purrr</code></h2>
<p>Package <code>purrr</code><a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>, which is part of core <code>tidyverse</code>, enhances R’s functional programming (FP) toolkit by providing a complete and consistent set of tools for working with functions and vectors.</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="#cb670-1" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code></pre></div>
<div id="iterate-over-single-listvector-with-map_-family-of-functions" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Iterate over single list/vector with <code>map_*()</code> family of functions</h3>
<p>This package has many families of functions; and most primary family is <code>map</code> family of functions. <code>map_*()</code> works nearly similar to <code>vapply</code> where we can control the type of output. The syntax style of each of these functions is nearly same, where these accept one object (list or vector) as <code>.x</code> argument, one function (or alternatively a formula) as <code>.f</code> argument; and outputs an object of specified type.</p>
<p>Example</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="#cb671-1" tabindex="-1"></a><span class="fu">map</span>(mtcars, <span class="at">.f =</span> sum)</span></code></pre></div>
<pre><code>## $mpg
## [1] 642.9
## 
## $cyl
## [1] 198
## 
## $disp
## [1] 7383.1
## 
## $hp
## [1] 4694
## 
## $drat
## [1] 115.09
## 
## $wt
## [1] 102.952
## 
## $qsec
## [1] 571.16
## 
## $vs
## [1] 14
## 
## $am
## [1] 13
## 
## $gear
## [1] 118
## 
## $carb
## [1] 90</code></pre>
<p>Note that output type is list. If the output can be simplified to an atomic vector we can use either of these functions depending upon the output type of that vector.</p>
<ul>
<li><code>map_lgl</code> for <code>logical</code> format</li>
<li><code>map_int</code> for <code>integer</code> format</li>
<li><code>map_dbl</code> for <code>double</code> format</li>
<li><code>map_chr</code> for <code>character</code> format</li>
</ul>
<p><code>map</code> always return a list.
See these further examples.</p>
<p>Example-1:</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="#cb673-1" tabindex="-1"></a><span class="fu">map_dbl</span>(mtcars, max)</span></code></pre></div>
<pre><code>##     mpg     cyl    disp      hp    drat      wt    qsec      vs      am    gear 
##  33.900   8.000 472.000 335.000   4.930   5.424  22.900   1.000   1.000   5.000 
##    carb 
##   8.000</code></pre>
</div>
<div id="iterate-over-two-or-more-listsvectors-using-map2_-pmap_-family" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Iterate over two or more lists/vectors using <code>map2_*()</code>/ <code>pmap_*()</code> family</h3>
<p>So far we have seen that <code>map_*()</code> family of functions are used to iterate over elements of a list. Even if extra lists/vectors are provided as extra arguments, these are used as it is, in each iteration, as can be seen in first illustration in figure<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> @ref(fig:map2).</p>
<div class="figure" style="text-align: center">
<img src="images/map1.png" alt="Working of map vs map2 family of functions \hspace{\textwidth} Source Advanced R by Hadley Wickham" width="49%" /><img src="images/map2.png" alt="Working of map vs map2 family of functions \hspace{\textwidth} Source Advanced R by Hadley Wickham" width="49%" />
<p class="caption">
(#fig:map2)Working of map vs map2 family of functions Source Advanced R by Hadley Wickham
</p>
</div>
<p>In order to iterate over two vectors/lists, we will however, need <code>map2_*()</code> family of functions (Refer second illustration in figure @ref(fig:map2)).</p>
<p>See the following example</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="#cb675-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb675-2"><a href="#cb675-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>)</span>
<span id="cb675-3"><a href="#cb675-3" tabindex="-1"></a><span class="fu">map2</span>(x, y, <span class="st">`</span><span class="at">*</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 11
## 
## [[2]]
## [1] 24
## 
## [[3]]
## [1] 39</code></pre>
<p>Similarly, to iterate over multiple lists we will use <code>pmap_*()</code>, with the only difference being that here all the vectors/list should be collectively passed on to <code>pmap</code> in a list. This can be better understood with the illustration used by Hadley Wickham in his <a href="https://adv-r.hadley.nz/functionals.html">book</a>. For reference see figure @ref(fig:pmap).</p>
<div class="figure" style="text-align: center">
<img src="images/pmap.png" alt="Working of pmap family of functions \hspace{\textwidth} Source Advanced R by Hadley Wickham" width="49%" /><img src="images/pmap-arg.png" alt="Working of pmap family of functions \hspace{\textwidth} Source Advanced R by Hadley Wickham" width="49%" />
<p class="caption">
(#fig:pmap)Working of pmap family of functions Source Advanced R by Hadley Wickham
</p>
</div>
<!--chapter:end:06-1-functionalprog.Rmd-->
</div>
</div>
</div>
<div id="file" class="section level1" number="8">
<h1><span class="header-section-number">8</span> File handling operations in R</h1>
<p>In chapter @ref(read) we have already learned about reading and writing data from/to files. In this section, we will learn about some other functions that are useful while reading and writing data, such as - changing directory, creating a file, renaming a file, check the existence of the file, listing all files in the working directory, copying files and creating directories.</p>
<div id="handling-files" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Handling files</h2>
<div id="creating-a-file-within-r-using-file.create" class="section level3" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Creating a file within R, using <code>file.create()</code></h3>
<p>Using <code>file.create()</code> function, we can create a new file from console. If the file already exists it truncates. The function returns a <code>TRUE</code> logical value if file is created otherwise, returns <code>FALSE</code>.</p>
<p>Example - The following command will create a blank text file in the current working directory.</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="#cb677-1" tabindex="-1"></a><span class="fu">file.create</span>(<span class="st">&quot;my_new_text_file.txt&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="checking-whether-a-file-exists-using-file.exists" class="section level3" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Checking whether a file exists, using <code>file.exists()</code></h3>
<p>Similar to above, we can check whether a file with given name exists, using function <code>file.exists()</code>. Example-</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="#cb679-1" tabindex="-1"></a><span class="fu">file.exists</span>(<span class="st">&quot;my_new_text_file.txt&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="renaming-file-with-file.rename" class="section level3" number="8.1.3">
<h3><span class="header-section-number">8.1.3</span> Renaming file with <code>file.rename()</code></h3>
<p>The file name can be changed within the R console using, function <code>file.rename()</code>. Basic syntax is <code>file.rename(from = "old_name", to = "new_name")</code>. The function will return <code>TRUE</code> or <code>FALSE</code> depending upon the successful execution. See example</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="#cb681-1" tabindex="-1"></a><span class="fu">file.rename</span>(<span class="at">from =</span> <span class="st">&quot;my_new_text_file.txt&quot;</span>, <span class="at">to =</span> <span class="st">&quot;my_renamed_file.csv&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="#cb683-1" tabindex="-1"></a><span class="co"># Check whether old file exists</span></span>
<span id="cb683-2"><a href="#cb683-2" tabindex="-1"></a><span class="fu">file.exists</span>(<span class="st">&quot;my_new_text_file.txt&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="copying-file-with-file.copy-function" class="section level3" number="8.1.4">
<h3><span class="header-section-number">8.1.4</span> Copying file with <code>file.copy()</code> function</h3>
<p>Using <code>file.copy(from = "old_path", to = "new_path")</code> syntax files can be copied from one directory to another.</p>
</div>
<div id="deleting-file-with-file.remove" class="section level3" number="8.1.5">
<h3><span class="header-section-number">8.1.5</span> Deleting file with <code>file.remove()</code></h3>
<p>The syntax for function, that removes a file with given name, is also very simple. Example-</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="#cb685-1" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="st">&quot;my_renamed_file.csv&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Check whether the file has been really deleted.</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="#cb687-1" tabindex="-1"></a><span class="fu">file.exists</span>(<span class="st">&quot;my_renamed_file.csv&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
</div>
<div id="handling-directories" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Handling directories</h2>
<div id="getset-path-of-current-working-directory-using-getwd-setwd" class="section level3" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Get/Set path of current working directory using <code>getwd()</code>/ <code>setwd()</code></h3>
<p>We can check/get the path of current working directory (wd in short) as a character vector, using <code>getwd()</code> function.</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="#cb689-1" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;G:/OneDrive - A c GeM CAG of INDIA (1)/new book&quot;</code></pre>
<p>Similarly, using <code>setwd("given\\path\\here")</code> we can change the current working directory.</p>
<blockquote>
<p>Two things to be noted here - Either the path is to be given using forward slash <code>/</code> or if backslash <code>\</code> is used these need to be escaped, using an extra <code>\</code> as <code>\</code> is itself an escape character in R.</p>
</blockquote>
</div>
<div id="create-new-directory-using-dir.create-and-other-operations" class="section level3" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Create new directory using <code>dir.create()</code> and other operations</h3>
<p>A new directory can be created using function <code>dir.create()</code>. Example- the command below will create a new directory named ‘new_dir’ in the current working directory. If <code>TRUE</code> is returned, directory with given name is created.</p>
<div class="sourceCode" id="cb691"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb691-1"><a href="#cb691-1" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;new_dir&quot;</span>)</span></code></pre></div>
<p>We can check whether any directory named ‘new_dir’ exists in current working directory, using function <code>dir.exists()</code> function. Function will return either <code>TRUE</code> or <code>FALSE</code>.</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="#cb692-1" tabindex="-1"></a><span class="fu">dir.exists</span>(<span class="st">&quot;new_dir&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>We can also check all files that exists in current working directory/any other directory using <code>list.files()</code> function.</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="#cb694-1" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">list.files</span>() <span class="sc">==</span> <span class="st">&#39;new_dir&#39;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>A given directory can be removed using <code>unlink()</code> function be specifically setting argument <code>recursive</code> to <code>TRUE</code>. Example</p>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="#cb696-1" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;new_dir&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb696-2"><a href="#cb696-2" tabindex="-1"></a><span class="fu">dir.exists</span>(<span class="st">&quot;new_dir&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
</div>
<div id="an-important-function-for-opening-a-dialog-box-for-selecting-files-and-folder" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> An important function for opening a dialog box for selecting files and folder</h2>
<p>We may use either of <code>choose.dir()</code> or <code>file.choose()</code>, to let the user select directory or file of her/his choice respectively.</p>
<p>Try these in your console</p>
<pre><code>list.files(choose.dir())
file.copy(from = file.choose(), to = &quot;new_name&quot;)</code></pre>
</div>
<div id="other-useful-functions-for-listingremoving-variables" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Other useful functions for listing/removing variables</h2>
<p>We can list all the variables available in current environment using function <code>ls()</code>. Another function <code>rm()</code> will remove the given variables. So a command like <code>rm(lm())</code> will remove all the available variables from the environment(Use this will caution as it will erase all the saved variables/data).</p>
</div>
<div id="using-save-to-save-objectscollection-of-objects" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Using <code>save()</code> to save objects/collection of objects</h2>
<p>We can save objects using function <code>save()</code> which saves the objects on disk for later usage. The saved objects can be retrieved using <code>load()</code> function. See this example-</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="#cb699-1" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">hist</span>(Nile)</span></code></pre></div>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="#cb700-1" tabindex="-1"></a><span class="fu">save</span>(h, <span class="at">file=</span><span class="st">&quot;nile_hist&quot;</span>)</span>
<span id="cb700-2"><a href="#cb700-2" tabindex="-1"></a><span class="fu">rm</span>(h)</span>
<span id="cb700-3"><a href="#cb700-3" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">ls</span>() <span class="sc">==</span> <span class="st">&#39;h&#39;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb702-1"><a href="#cb702-1" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;nile_hist&quot;</span>)</span>
<span id="cb702-2"><a href="#cb702-2" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">ls</span>() <span class="sc">==</span> <span class="st">&#39;h&#39;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="working-with-projects-in-rstudio" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> Working with Projects in <code>RStudio</code></h2>
<p>While working on a project, often a requirement is to keep all scripts, data, results, charts, figures, etc. at a single place. R studio has thus, a concept of working in projects, which associates a specific directory with a specific project and creates a specific file with extension <code>.Rproj</code>, which can reopen the complete scripts/ data/ etc. associated with that project.</p>
<p>To open a new project in Rstudio, click <code>file</code> menu then <code>New Project</code>. Check the screenshot in Figure @ref(fig:proj1).</p>
<div class="figure" style="text-align: center">
<img src="images/Rproj1.png" alt="Creating Projects in R Studio" width="49%" height="49%" /><img src="images/Rproj2.png" alt="Creating Projects in R Studio" width="49%" height="49%" />
<p class="caption">
(#fig:proj1)Creating Projects in R Studio
</p>
</div>
<p>After Creating the projects you will notice that a file with an extension <code>.Rproj</code> has been created by R Studio in the selected directory/location of project.</p>
<p>To resume working in the same project directory, either double click the file, or open the project using file menu i.e. <code>file</code> <span class="math inline">\(-&gt;\)</span> <code>Open Project</code>.</p>
<p>In R Studio, we can create a project -</p>
<ul>
<li>In a new directory (first option in Figure @ref(fig:proj1))</li>
<li>In an Existing Directory (second option in Figure @ref(fig:proj1))</li>
<li>By cloning a Version Control (like Git, etc.) as shown in third option in Figure @ref(fig:proj1).</li>
</ul>
<p>Working in projects, one for each data analytics projects, has many benefits apart from streamlining the workflow, leading to improved productivity and focus on the analysis tasks, as against working directly using r scripts in RStudio-</p>
<ul>
<li>Can get rid of hassles of setting/finding the working directory after starting any session of RStudio.</li>
<li>All the paths are now relative to that project directory. This again saves us from a lot of hassles of finding path to the directory where our scripts and data as well as outputs (data, plots, etc.) are saved.</li>
<li>All our code and related outputs are now having a better reproducibility.</li>
<li>Each project can have its own R environment, preventing conflicts between packages and dependencies.</li>
<li>Working in projects also ensures a consistent setup across different machines or for different team members.</li>
<li>This also allows for project-specific settings and configurations, enhancing the user experience.</li>
</ul>
<!--chapter:end:06-2-workflow.Rmd-->
</div>
</div>
<div id="read" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Getting data in and out of R</h1>
<p>Till now, we have created our own datasets or we have used sample datasets available in R. In practical usage, there will hardly be any case when we get the data imported in R by itself. So we have to import and load our data sets in R, for our analytics tasks. Even after completing the analytics, the summarised data, other reports, charts, etc. need to be exported. This chapter is intended to do all these tasks.</p>
<p>First section deals about functions related to reading external data i.e. importing objects into R. This is followed by another section dealing with writing data to external files i.e. exporting data out of R.</p>
<div id="importing-external-data-in-r---base-r-methods" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Importing external data in R - Base R methods</h2>
<p>Base R has many functions which can fulfill nearly any of our jobs to import external data into R. However, there are packages which are customised to do certain tasks in easier way and thus, we will also learn two of the packages from <code>tidyverse</code> also.</p>
<p>There are some important functions in base R, which are used frequently to import external data into R environment. Let us discuss these one by one.</p>
<div id="reading-tables-through-read.table-andor-read.csv" class="section level3 unnumbered">
<h3 class="unnumbered">Reading tables through <code>read.table()</code> and/or <code>read.csv()</code></h3>
<p>Basically these two functions are most commonly used functions in R, to get tabular data out of flat files. The two functions namely <code>read.table()</code> and <code>read.csv()</code> are used respectively to read tabular data out of flat files having simple text format (.txt) and comma separated values (.csv) formats respectively. There are three more cousins to these functions.</p>
<ul>
<li><code>read.csv2()</code> to read csv files where <code>;</code> is used as delimiter and <code>,</code> is used for decimals instead.</li>
<li><code>read.delim()</code> to read delimited files where <code>tab character</code> has been used as delimiter and <code>.</code> as decimal.</li>
<li><code>read.delim2()</code>, similarly to read delimited files where <code>tab character</code> has been used as delimiter and <code>,</code> as decimal.</li>
</ul>
<p>Most important arguments to these functions are -</p>
<ul>
<li><code>file</code> the name of the file along with complete path as string<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>.</li>
<li><code>header</code> a logical value indicating if first line of the file has to be read as header or not.</li>
<li><code>sep</code> a string indicating a separator value to separate columns.</li>
<li><code>colClasses</code> a character vector indicating type of the columns if these are to be read explicitly in these types/formats only.</li>
<li><code>skip</code> an integer, indicating how many rows (from beginning) are to be skipped.</li>
</ul>
<p>Readers may check results of <code>?read.table()</code> to get a complete list of arguments of these functions.</p>
<p>Example: Let us try to download data related to <em>World Happiness Report 201=21</em> which is available on data.world portal.</p>
<pre><code>wh2021 &lt;- read.csv(&quot;https://query.data.world/s/qbsbmxlfj54sl4mq3y6uxsr3pkhhmo&quot;)
# Check dimensions
dim(wh2021)
# Check column names
colnames(wh2021)</code></pre>
<p>We can see that dataset named <code>wh2021</code> having <code>20</code> columns and <code>149</code> rows is now available in our environment.</p>
<blockquote>
<p><strong>Tip: Use <code>"clipboard"</code> in file argument for pasting copied data into R. E.g. Copy a few rows and cells from excel spreadsheet and run this command <code>read.delim("clipboard", header = FALSE)</code>.</strong></p>
</blockquote>
</div>
<div id="read-data-into-a-vector-through-scan-or-readline" class="section level3 unnumbered">
<h3 class="unnumbered">Read data into a vector through <code>scan()</code> or <code>readline()</code></h3>
<p>As afore-mentioned functions <code>read.table()</code> <em>et al</em> are used in reading data into tables, we may also require reading data into a vector or simple list. The two functions <code>scan()</code> and <code>readline()</code> are used for these purposes.</p>
<p>The basic syntax of <code>scan()</code> is -</p>
<pre><code>scan(file = &quot;&quot;,
     what = double(),
     nmax = -1,
     ...
)</code></pre>
<p>Where -</p>
<ul>
<li><code>file</code> is name of the file, or link</li>
<li><code>what</code> is format/data type to be read. Default type is double</li>
<li><code>nmax</code> is mux number of data values to be read, default is <code>-1</code> which means all.</li>
</ul>
<p>There are many other usefule arguments, for which please check results of <code>?scan</code> in your console.</p>
<p>Example -</p>
<pre><code>scan(&quot;http://mattmahoney.net/iq/digits.txt&quot;, nmax = 10)</code></pre>
<p>This function is sometimes useful to read data from keyboard into a vector. Just use a blank string <code>""</code> in file name. See this example</p>
<p><img src="images/scan.png" /></p>
<p>Function <code>readline()</code> on the other hand does similar job, but with a prompt. See this example</p>
<p><img src="images/readline.png" /></p>
</div>
<div id="reading-text-files-through-readlines" class="section level3 unnumbered">
<h3 class="unnumbered">Reading text files through <code>readLines()</code></h3>
<p>Function <code>readLines()</code> is used to read text lines from a file (or connection). To see this in action, prepare a text file (say <code>"txt.txt"</code>) and try reading it using <code>readLines("txt.txt")</code>.</p>
</div>
</div>
<div id="exporting-data-out-of-r---base-r-methods" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Exporting data out of R - Base R methods</h2>
<p>Since the nature of most of the data anaytic jobs carried out in R, will be followed after reading the external data which will be followed by wrangling, transformation, modelling, etc., all in R. Exporting files will not be used as much as reading external data. Still, there will be times, when wrangled data tables need to be exported out of R. For each of the different use cases, the following functions will almost complete our export requirements.</p>
<p>Let’s learn these.</p>
<div id="writing-tabular-data-through-write.table-andor-write.csv" class="section level3 unnumbered">
<h3 class="unnumbered">Writing tabular data through <code>write.table()</code> and/or <code>write.csv()</code></h3>
<p>Exporting data frames, whether after cleaning, wrangling, or transformation, etc., can be exported using these functions. Latter will be used to write data frames in csv formats specifically. The syntax is -</p>
<pre><code>write.table(x, file = &quot;&quot;, sep = &quot; &quot;, ...)
write.csv(x, file = &quot;&quot;, ...)
write.csv2(x, file = &quot;&quot;, ...)</code></pre>
<p>where -</p>
<ul>
<li><code>x</code> is the data frame object to be exported</li>
<li><code>file</code> is used to give file name (along with path)</li>
<li><code>sep</code> is separator</li>
<li><code>...</code> - there are many more arguments which are used to cutomised export needs. See <code>?write.table()</code> for full details.</li>
</ul>
<p>E.g. - The following command will export <code>iris</code> data frame as <code>iris.csv</code> file in the current working directory.</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb708-1"><a href="#cb708-1" tabindex="-1"></a><span class="fu">write.csv</span>(iris, <span class="st">&#39;iris.csv&#39;</span>)</span></code></pre></div>
</div>
<div id="writing-character-data-line-by-line-to-a-file-through-writelines" class="section level3 unnumbered">
<h3 class="unnumbered">Writing character data line by line to a file through <code>writeLines()</code></h3>
<p>Similar to <code>readLines</code>, function <code>writeLines()</code> will write the text data into a file with given file name. Type the following code in your console and check that a new file with name <code>my_new_file.txt</code> has been created with the given contents in your current working directory.</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="#cb709-1" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">&quot;Andrew 25</span></span>
<span id="cb709-2"><a href="#cb709-2" tabindex="-1"></a><span class="st">           Bob 45</span></span>
<span id="cb709-3"><a href="#cb709-3" tabindex="-1"></a><span class="st">           Charles 56&quot;</span>, <span class="st">&quot;my_new_file.txt&quot;</span>)</span></code></pre></div>
</div>
<div id="using-dput-to-get-a-code-representation-of-r-object" class="section level3 unnumbered">
<h3 class="unnumbered">Using <code>dput()</code> to get a code representation of R object</h3>
<p>This function will output the code representation of the given R object. This function is particularly useful, when you are searching for help online and you need to give some sample data to reproduce the problem. E.g. on <a href="https://stackoverflow.com/"><em>Stack Overflow</em></a> when asking for a solution to a specific problem, <a href="https://stackoverflow.com/questions/5963269/how-to-make-a-great-r-reproducible-example">reproducible data</a> needs to be furnished. Please also refer to section @ref(reprex) for more.</p>
<p>Example-1:</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb710-1"><a href="#cb710-1" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Name =</span> <span class="fu">c</span>(<span class="st">&quot;Andrew&quot;</span>, <span class="st">&quot;Bob&quot;</span>, <span class="st">&quot;Charles&quot;</span>),</span>
<span id="cb710-2"><a href="#cb710-2" tabindex="-1"></a>                      <span class="at">Age =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">45</span>, <span class="dv">56</span>))</span>
<span id="cb710-3"><a href="#cb710-3" tabindex="-1"></a><span class="fu">dput</span>(my_data)</span></code></pre></div>
<pre><code>## structure(list(Name = c(&quot;Andrew&quot;, &quot;Bob&quot;, &quot;Charles&quot;), Age = c(25, 
## 45, 56)), class = &quot;data.frame&quot;, row.names = c(NA, -3L))</code></pre>
<p>And while reproducing someone else’s dput-</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb712-1"><a href="#cb712-1" tabindex="-1"></a>now_mydata <span class="ot">&lt;-</span> <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">Name =</span> <span class="fu">c</span>(<span class="st">&quot;Andrew&quot;</span>, <span class="st">&quot;Bob&quot;</span>, <span class="st">&quot;Charles&quot;</span>), <span class="at">Age =</span> <span class="fu">c</span>(<span class="dv">25</span>, </span>
<span id="cb712-2"><a href="#cb712-2" tabindex="-1"></a><span class="dv">45</span>, <span class="dv">56</span>)), <span class="at">class =</span> <span class="st">&quot;data.frame&quot;</span>, <span class="at">row.names =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="sc">-</span><span class="dv">3</span><span class="dt">L</span>))</span>
<span id="cb712-3"><a href="#cb712-3" tabindex="-1"></a></span>
<span id="cb712-4"><a href="#cb712-4" tabindex="-1"></a>now_mydata</span></code></pre></div>
<pre><code>##      Name Age
## 1  Andrew  25
## 2     Bob  45
## 3 Charles  56</code></pre>
</div>
</div>
<div id="using-external-packages-for-readingwriting-data" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Using external packages for reading/writing data</h2>
<div id="package-readr" class="section level3" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Package <code>readr</code></h3>
<p>The <code>readr</code> package<span class="citation"><a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a></span> is part of core <code>tidyverse</code> and is loaded directly when we load it through <code>library(tidyverse)</code>. It provides a range of analogous functions for each of the reading functions in base R.</p>
<table>
<thead>
<tr class="header">
<th align="center">Base R</th>
<th align="center">readr</th>
<th align="left">Uses</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">read.table</td>
<td align="center">read_table</td>
<td align="left">Reading table</td>
</tr>
<tr class="even">
<td align="center">read.csv</td>
<td align="center">read_csv</td>
<td align="left">Reading CSV file with comma as sep</td>
</tr>
<tr class="odd">
<td align="center">read.csv2</td>
<td align="center">read_csv2</td>
<td align="left">Reading CSV file with semi-colon as sep</td>
</tr>
<tr class="even">
<td align="center">read.delim</td>
<td align="center">read_delim</td>
<td align="left">Reading files with any delimiter</td>
</tr>
<tr class="odd">
<td align="center">read.fwf</td>
<td align="center">read_fwf</td>
<td align="left">Reading fixed width files</td>
</tr>
<tr class="even">
<td align="center">read.tsv</td>
<td align="center">read_tsv</td>
<td align="left">Reading tab delimited file</td>
</tr>
<tr class="odd">
<td align="center">--</td>
<td align="center">write_delim</td>
<td align="left">Writing files with any delimiter</td>
</tr>
<tr class="even">
<td align="center">write.csv</td>
<td align="center">write_csv</td>
<td align="left">Writing files with comma delimiter</td>
</tr>
<tr class="odd">
<td align="center">write.csv2</td>
<td align="center">write_csv2</td>
<td align="left">Writing files with semi-colon delimiter</td>
</tr>
<tr class="even">
<td align="center">--</td>
<td align="center">write_tsv</td>
<td align="left">writing a tab delimited file</td>
</tr>
</tbody>
</table>
<p>So a question may be asked here that what’s the difference between these two sets of functions. Firstly, <code>readr</code> alternatives are much faster than their base R counterparts. Secondly, it provides an informative problem report when parsing leads to unexpected results.</p>
<p>For these, check results of these examples-</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="#cb714-1" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">readr_example</span>(<span class="st">&quot;chickens.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Rows: 5 Columns: 4
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (3): chicken, sex, motto
## dbl (1): eggs_laid
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## # A tibble: 5 × 4
##   chicken                 sex     eggs_laid motto                               
##   &lt;chr&gt;                   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;                               
## 1 Foghorn Leghorn         rooster         0 That&#39;s a joke, ah say, that&#39;s a jok…
## 2 Chicken Little          hen             3 The sky is falling!                 
## 3 Ginger                  hen            12 Listen. We&#39;ll either die free chick…
## 4 Camilla the Chicken     hen             7 Bawk, buck, ba-gawk.                
## 5 Ernie The Giant Chicken rooster         0 Put Captain Solo in the cargo hold.</code></pre>
<p>Note that the column types, while parsing the data frame, have now been printed. These column types have been guessed by <code>readr</code> actually. If the column types are not what were actually required to be parsed, then argument <code>col_types</code> may be used. We can also use <code>spec()</code> function to retrieve the data types guessed by <code>readr</code> later-on, so these can be modified and used again in <code>col_types</code> argument. See this example</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="#cb717-1" tabindex="-1"></a><span class="fu">write.csv</span>(iris, <span class="st">&quot;iris.csv&quot;</span>) <span class="co">#write a dummy data</span></span>
<span id="cb717-2"><a href="#cb717-2" tabindex="-1"></a><span class="fu">spec</span>(<span class="fu">read_csv</span>(<span class="st">&quot;iris.csv&quot;</span>))</span></code></pre></div>
<pre><code>## New names:
## Rows: 150 Columns: 6
## ── Column specification
## ──────────────────────────────────────────────────────── Delimiter: &quot;,&quot; chr
## (1): Species dbl (5): ...1, Sepal.Length, Sepal.Width, Petal.Length,
## Petal.Width
## ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
## Specify the column types or set `show_col_types = FALSE` to quiet this message.
## • `` -&gt; `...1`</code></pre>
<pre><code>## cols(
##   ...1 = col_double(),
##   Sepal.Length = col_double(),
##   Sepal.Width = col_double(),
##   Petal.Length = col_double(),
##   Petal.Width = col_double(),
##   Species = col_character()
## )</code></pre>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="#cb720-1" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="st">&quot;iris.csv&quot;</span>,</span>
<span id="cb720-2"><a href="#cb720-2" tabindex="-1"></a>         <span class="at">col_select =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb720-3"><a href="#cb720-3" tabindex="-1"></a>         <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb720-4"><a href="#cb720-4" tabindex="-1"></a>           <span class="at">Sepal.Length =</span> <span class="fu">col_double</span>(),</span>
<span id="cb720-5"><a href="#cb720-5" tabindex="-1"></a>           <span class="at">Sepal.Width =</span> <span class="fu">col_double</span>(),</span>
<span id="cb720-6"><a href="#cb720-6" tabindex="-1"></a>           <span class="at">Petal.Length =</span> <span class="fu">col_double</span>(),</span>
<span id="cb720-7"><a href="#cb720-7" tabindex="-1"></a>           <span class="at">Petal.Width =</span> <span class="fu">col_double</span>(),</span>
<span id="cb720-8"><a href="#cb720-8" tabindex="-1"></a>           <span class="at">Species =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;setosa&#39;</span>, <span class="st">&#39;versicolor&#39;</span>, <span class="st">&#39;virginica&#39;</span>))</span>
<span id="cb720-9"><a href="#cb720-9" tabindex="-1"></a>         )</span>
<span id="cb720-10"><a href="#cb720-10" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## New names:
## • `` -&gt; `...1`</code></pre>
<pre><code>## # A tibble: 2 × 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
## 1          5.1         3.5          1.4         0.2 setosa 
## 2          4.9         3            1.4         0.2 setosa</code></pre>
</div>
<div id="package-readxl" class="section level3" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Package <code>readxl</code></h3>
<p>This package is also part of <code>tidyverse</code> but this one has to be loaded specifically using <code>library(readxl)</code>. As the name suggests, it has functions which are useful to read/write data to/from excel files. Excel files (having extension .xls or .xlsx) are slightly different in a way that these may contain several <em>sheets</em> of data at once. The functions <code>read_excel()</code>, <code>read_xlsx</code>, and <code>read_xls</code> have been designed for reading sheets from excel files. The syntax is</p>
<pre><code>read_excel(path, sheet = NULL, range = NULL)
read_xlsx(path, sheet = NULL, range = NULL)
read_xls(path, sheet = NULL, range = NULL)</code></pre>
<p>To get the names of sheets in an excel file we can use <code>excel_sheets()</code> function from the library.</p>
<pre><code>excel_sheets(path)</code></pre>
</div>
<div id="reprex" class="section level3" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> Package <code>reprex</code></h3>
<p>This is again part of tidyverse, but has to be loaded specifically by calling <code>library(reprex)</code>. The name <code>reprex</code> is actually short for reproducible example. This is useful particularly when we are stuck in some problem and seek for online help on some forum such as <a href="https://stackoverflow.com/questions/5963269/how-to-make-a-great-r-reproducible-example">Stack Overflow</a>, <a href="https://community.rstudio.com">R Studio Community</a>, etc.</p>
<p>As an example do this in your console</p>
<pre><code>library(reprex)

x &lt;- dput(head(iris))
x</code></pre>
<p>Thereafter run <code>reprex()</code>, a small window in the <code>Viewer</code> tab will be opened like this. Moreover, the code has been copied on the clipboard.</p>
<p><img src="images/reprex.png" /></p>
<p>For more reading please refer <a href="https://www.tidyverse.org/help/">this page.</a><a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></p>
</div>
</div>
</div>
<div id="data-cleaning-in-r" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Data Cleaning in R</h1>
<p>Data cleansing is one of the important steps in data analysis. Multiple packages are available in r to clean the data sets. One of such packages is <code>janitor</code> which we will be using in this chapter along with few other packages.</p>
<p>Let’s load it</p>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb726-1"><a href="#cb726-1" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;janitor&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     chisq.test, fisher.test</code></pre>
<div id="cleaning-column-names." class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Cleaning Column names.</h2>
<p>We know that names of objects in R follow certain conventions like we may not have certain special characters in names. If a space has been used that is to be quoted under a pair of backticks `. But generally when we read data from files in excel, we can have some ‘dirty’ names, which we should clean before proceeding. In such <code>clean_names()</code> come handy. E.g.</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb729-1"><a href="#cb729-1" tabindex="-1"></a><span class="co"># Create a data.frame with dirty names</span></span>
<span id="cb729-2"><a href="#cb729-2" tabindex="-1"></a>test_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">6</span>))</span>
<span id="cb729-3"><a href="#cb729-3" tabindex="-1"></a></span>
<span id="cb729-4"><a href="#cb729-4" tabindex="-1"></a><span class="fu">names</span>(test_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;firstName&quot;</span>, <span class="st">&quot;ábc@!*&quot;</span>, <span class="st">&quot;% successful (2009)&quot;</span>,</span>
<span id="cb729-5"><a href="#cb729-5" tabindex="-1"></a>                    <span class="st">&quot;REPEAT VALUE&quot;</span>, <span class="st">&quot;REPEAT VALUE&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb729-6"><a href="#cb729-6" tabindex="-1"></a><span class="co"># View this data</span></span>
<span id="cb729-7"><a href="#cb729-7" tabindex="-1"></a>test_df</span></code></pre></div>
<pre><code>##   firstName ábc@!* % successful (2009) REPEAT VALUE REPEAT VALUE   
## 1        NA     NA                  NA           NA           NA NA</code></pre>
<p>Using <code>clean_names()</code> which is also pipe friendly, we can clean names in one step. (Results will be in snake case)</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb731-1"><a href="#cb731-1" tabindex="-1"></a>test_df <span class="sc">%&gt;%</span> </span>
<span id="cb731-2"><a href="#cb731-2" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span></code></pre></div>
<pre><code>##   first_name abc percent_successful_2009 repeat_value repeat_value_2  x
## 1         NA  NA                      NA           NA             NA NA</code></pre>
<p>It -</p>
<ul>
<li>Parses letter cases and separators to a consistent format.</li>
<li>Default is to <code>snake_case</code>, but other cases like <code>camelCase</code> are available</li>
<li>Handles special characters and spaces, including transliterating characters like <code>œ</code> to <code>oe</code>.</li>
<li>Appends numbers to duplicated names</li>
<li>Converts <code>“%”</code> to “percent” and <code>“#”</code> to <code>“number”</code> to retain meaning</li>
<li>Spacing (or lack thereof) around numbers is preserved</li>
</ul>
</div>
<div id="handling-duplicate-records" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Handling duplicate records</h2>
<p>In <code>janitor</code> package, we have a ready to use function <code>get_dupes()</code>. It allows us to find “similar” observations in a data set based on certain characteristics. Syntax is pretty simple, and function is pipe friendly too. Suppose we have to find out duplicate in <code>mtcars</code> dataset on each combination of <code>wt</code> and <code>cyl</code>.</p>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="#cb733-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb733-2"><a href="#cb733-2" tabindex="-1"></a>  <span class="fu">get_dupes</span>(wt, cyl)</span></code></pre></div>
<pre><code>##     wt cyl dupe_count  mpg  disp  hp drat  qsec vs am gear carb
## 1 3.44   6          2 19.2 167.6 123 3.92 18.30  1  0    4    4
## 2 3.44   6          2 17.8 167.6 123 3.92 18.90  1  0    4    4
## 3 3.57   8          2 14.3 360.0 245 3.21 15.84  0  0    3    4
## 4 3.57   8          2 15.0 301.0 335 3.54 14.60  0  1    5    8</code></pre>
<p>We can see that it returns all duplicate records with an additional column <code>dupe_count</code> so that these duplicates can be analysed separately.</p>
</div>
<div id="remove-constant-redundant-columns" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Remove Constant (Redundant) columns</h2>
<p>Dropping columns from a <code>data.frame</code> that contain only a single constant value throughout is again easy through <code>janitor::remove_constant()</code>.</p>
</div>
<div id="remove-empty-rows-andor-columns" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Remove empty rows and/or columns</h2>
<p>While importing messy data from excel files, we may get some empty rows and/or columns. Sorting out this issue, is easy using <code>janitor::remove_empty()</code>.</p>
</div>
<div id="fix-excel-dates-stored-as-serial-numbers" class="section level2" number="10.5">
<h2><span class="header-section-number">10.5</span> Fix excel dates stored as serial numbers</h2>
<p>While loading excel files in R, we may have sometimes noticed <code>41590</code> instead of having a <code>date format</code>. Sorting out this issue is again easy in <code>janitor</code> as we have a function <code>excel_numeric_to_date()</code> for this. Example</p>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="#cb735-1" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">excel_numeric_to_date</span>(<span class="dv">41590</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2013-11-12&quot;</code></pre>
</div>
<div id="convert-a-mix-of-date-and-datetime-formats-to-date" class="section level2" number="10.6">
<h2><span class="header-section-number">10.6</span> Convert a mix of date and datetime formats to date</h2>
<p>Similar to above, we can also sort out, if we have a column mix of different date formats, using <code>janitor::convert_to_date()</code> or <code>janitor::convert_to_datetime()</code>. See Examples-</p>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb737-1"><a href="#cb737-1" tabindex="-1"></a>unsorted_dates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;2018-05-31&#39;</span>, <span class="st">&#39;41590&#39;</span>, <span class="dv">41590</span>)</span>
<span id="cb737-2"><a href="#cb737-2" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">convert_to_date</span>(unsorted_dates)</span></code></pre></div>
<pre><code>## [1] &quot;2018-05-31&quot; &quot;2013-11-12&quot; &quot;2013-11-12&quot;</code></pre>
<p><strong>Note in above example, we have created a heterogeneous vector, but implicit coercion rules of R have converted all forms to character only.</strong></p>
<p>In real world examples, where data is entered through multiple machines/data points simultaneously, we may a column mix of date formats. In that case, we may use <code>parse_date_time()</code> function in <code>lubridate</code> package. To allow different formats we have use <code>order</code> agument in this function. Example</p>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb739-1"><a href="#cb739-1" tabindex="-1"></a>mixed_dates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;13-11-1991&quot;</span>, <span class="st">&quot;13-Sep-22&quot;</span>, </span>
<span id="cb739-2"><a href="#cb739-2" tabindex="-1"></a>                 <span class="st">&quot;20 August 2000&quot;</span>, <span class="st">&quot;15 August 87&quot;</span>, </span>
<span id="cb739-3"><a href="#cb739-3" tabindex="-1"></a>                 <span class="st">&quot;03/31/23&quot;</span>, <span class="st">&quot;12-31-2022&quot;</span>)</span>
<span id="cb739-4"><a href="#cb739-4" tabindex="-1"></a></span>
<span id="cb739-5"><a href="#cb739-5" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">parse_date_time</span>(mixed_dates,</span>
<span id="cb739-6"><a href="#cb739-6" tabindex="-1"></a>                           <span class="at">orders =</span> <span class="fu">c</span>(<span class="st">&quot;d m y&quot;</span>, <span class="st">&quot;d B Y&quot;</span>, <span class="st">&quot;m/d/y&quot;</span>, <span class="st">&quot;d B y&quot;</span>),</span>
<span id="cb739-7"><a href="#cb739-7" tabindex="-1"></a>                           <span class="at">locale =</span> <span class="st">&quot;eng&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1991-11-13 UTC&quot; &quot;2022-09-13 UTC&quot; &quot;2000-08-20 UTC&quot; &quot;1987-08-15 UTC&quot;
## [5] &quot;2023-03-31 UTC&quot; &quot;2022-12-31 UTC&quot;</code></pre>
<!--chapter:end:07-1-reading.Rmd-->
</div>
</div>
<div id="merging-large-number-of-similar-datasets-into-one" class="section level1" number="11">
<h1><span class="header-section-number">11</span> Merging large number of similar datasets into one</h1>
<p>Data preparation for performing analytics is an important task and may require more time than actual analytics because we rarely have data in ideal format. Importing csv or flat files is rather an easy job. However, considering large popularity of MS Excel, we at times have our data saved in excel files.</p>
<p>Sometimes, one single data frame/table is divided into multiple sheets in one excel file whereas sometimes these tables are divided in multiple files. Here we are discussing few of these cases, where we can reduce our data preparation time by effectively writing the code for import of such data into our environment.</p>
<div id="case-1-merging-multiple-excel-sheets-into-one-data-frame" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> <strong>Case-1</strong>: Merging multiple excel sheets into one data frame</h2>
<p>As an example, let’s say we have multiple States’ data saved on a different sheet in one excel file say <code>Daur.xlsx</code>. See preview in fig @ref(fig:prevexcel).</p>
<div class="figure" style="text-align: center">
<img src="images/excel.png" alt="Preview of example excel file" width="100%" />
<p class="caption">
(#fig:prevexcel)Preview of example excel file
</p>
</div>
<p>We will use library <code>readxl</code> to read excel files. This library is bundled with <code>tidyverse</code> but is not part of core tidyverse, so it has to be loaded explicitly, though explicit download is not required if <code>tidyverse</code> is installed in the system.</p>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="#cb741-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb741-2"><a href="#cb741-2" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code></pre></div>
<p>The following steps are used-</p>
<p>Step-1: Read path</p>
<p>Step-2: Collect Names of all sheets</p>
<p>Step-3: Set names of elements of above vector onto itself</p>
<p>Step-4: Read and combine all tables into one. We will use <code>purrr::map_dfr</code> for this.</p>
<div class="sourceCode" id="cb742"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb742-1"><a href="#cb742-1" tabindex="-1"></a><span class="co"># Step-1</span></span>
<span id="cb742-2"><a href="#cb742-2" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">&quot;data/daur1.xlsx&quot;</span></span>
<span id="cb742-3"><a href="#cb742-3" tabindex="-1"></a><span class="co"># Step-2</span></span>
<span id="cb742-4"><a href="#cb742-4" tabindex="-1"></a>states_data <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(path) <span class="sc">%&gt;%</span> </span>
<span id="cb742-5"><a href="#cb742-5" tabindex="-1"></a><span class="co"># step-3</span></span>
<span id="cb742-6"><a href="#cb742-6" tabindex="-1"></a>    <span class="fu">set_names</span>(., .) <span class="sc">%&gt;%</span> </span>
<span id="cb742-7"><a href="#cb742-7" tabindex="-1"></a><span class="co"># step-4</span></span>
<span id="cb742-8"><a href="#cb742-8" tabindex="-1"></a>    <span class="fu">map_dfr</span>(read_excel, <span class="at">path=</span>path, <span class="at">.id =</span> <span class="st">&#39;State_name&#39;</span>)</span>
<span id="cb742-9"><a href="#cb742-9" tabindex="-1"></a><span class="co"># print file</span></span>
<span id="cb742-10"><a href="#cb742-10" tabindex="-1"></a>states_data</span></code></pre></div>
<pre><code>## # A tibble: 18 × 4
##    State_name     Year    Metric_1 Metric_2
##    &lt;chr&gt;          &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1 Andhra Pradesh 2015-16      119      121
##  2 Andhra Pradesh 2016-17      114      134
##  3 Andhra Pradesh 2017-18      115      122
##  4 Andhra Pradesh 2018-19      129      137
##  5 Andhra Pradesh 2019-20      149      129
##  6 Andhra Pradesh 2020-21      104      124
##  7 Assam          2015-16      104      145
##  8 Assam          2016-17      114      144
##  9 Assam          2017-18      116      116
## 10 Assam          2018-19      129      130
## 11 Assam          2019-20      144      134
## 12 Assam          2020-21      124      116
## 13 Bihar          2015-16      109      148
## 14 Bihar          2016-17      134      106
## 15 Bihar          2017-18      131      133
## 16 Bihar          2018-19      131      100
## 17 Bihar          2019-20      131      127
## 18 Bihar          2020-21      128      103</code></pre>
<p>We can see that data from all the sheets have been merged into table and one extra column has been created using sheet name. The name of that column has been provided through <code>.id</code> argument. If the new column is not required, simply don’t use this argument.</p>
</div>
<div id="case-2-merging-multiple-files-into-one-data-frame" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> <strong>Case-2</strong>: Merging multiple files into one data frame</h2>
<p>Often we have our source data split into multiple files, which we will have to compile in one single data frame before proceeding In this case, we may collect all such files in one directory and follow these steps-</p>
<p>Step-1: Store all file names using <code>list.files()</code></p>
<p>Step-2: We may read all files in one list using either <code>lapply</code> or <code>purrr::map</code>.</p>
<p>Step-3: If data structures in all the files are same, we can directly use <code>purrr::map_dfr</code> which will read all files and give us a data frame. If however, the structure of data in all files are not same, we may convert all columns into character type before merging these files. We can thereafter proceed for merging all data using either <code>purrr::map_dfr</code> or <code>lapply</code> in combination with <code>do.call</code>.</p>
</div>
<div id="case-3-split-and-save-one-data-frame-into-multiple-excelcsv-files-simultaneously." class="section level2" number="11.3">
<h2><span class="header-section-number">11.3</span> <strong>Case-3</strong>: Split and save one data frame into multiple excel/csv files simultaneously.</h2>
<p>As an example will use <code>states_data</code> created in case-1. We can use the following algorithm</p>
<p>Step-1: Create a vector of file names using <code>paste0</code>
Step-2: Split data frame into a list with separate dataframe for each state
Step-3: Write to a separate file using <code>purrr::walk2()</code></p>
<p>The complete algorithm is</p>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb744-1"><a href="#cb744-1" tabindex="-1"></a><span class="co"># step-1 : create a vector of file names (output)</span></span>
<span id="cb744-2"><a href="#cb744-2" tabindex="-1"></a>file_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;data/&quot;</span>, <span class="fu">unique</span>(states_data<span class="sc">$</span>State_name), <span class="st">&quot;.csv&quot;</span>)</span>
<span id="cb744-3"><a href="#cb744-3" tabindex="-1"></a></span>
<span id="cb744-4"><a href="#cb744-4" tabindex="-1"></a>states_data <span class="sc">%&gt;%</span> </span>
<span id="cb744-5"><a href="#cb744-5" tabindex="-1"></a>  <span class="fu">group_split</span>(State_name) <span class="sc">%&gt;%</span> </span>
<span id="cb744-6"><a href="#cb744-6" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">walk2</span>(file_names, write.csv)</span></code></pre></div>
<p>We can check that 3 new files with state_names as filenames have been created in the <code>data</code> folder/directory as desired.</p>
</div>
<div id="case-4-splitting-one-data-into-muliple-files-having-multiple-sheets" class="section level2" number="11.4">
<h2><span class="header-section-number">11.4</span> <strong>Case-4</strong>: Splitting one data into muliple files having multiple sheets</h2>
<p>Sometimes, we may require to split a file not only into multiple files, but simultaeously require to split each file into multiple excel sheets. E.g. A data having States and districts is to be split into State-wise files having a separate sheet for each district.</p>
<p>This can be achieved using <code>writexl</code> library. In this case, we may write a custom function which can do our job easily.</p>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb745-1"><a href="#cb745-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb745-2"><a href="#cb745-2" tabindex="-1"></a><span class="fu">library</span>(writexl)</span>
<span id="cb745-3"><a href="#cb745-3" tabindex="-1"></a></span>
<span id="cb745-4"><a href="#cb745-4" tabindex="-1"></a>book_and_sheets <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x, y){</span>
<span id="cb745-5"><a href="#cb745-5" tabindex="-1"></a>  df_by_x <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb745-6"><a href="#cb745-6" tabindex="-1"></a>    <span class="fu">split</span>(.[[x]])</span>
<span id="cb745-7"><a href="#cb745-7" tabindex="-1"></a>  </span>
<span id="cb745-8"><a href="#cb745-8" tabindex="-1"></a>  save_to_excel <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b){</span>
<span id="cb745-9"><a href="#cb745-9" tabindex="-1"></a>    a <span class="sc">%&gt;%</span> </span>
<span id="cb745-10"><a href="#cb745-10" tabindex="-1"></a>      <span class="fu">split</span>(.[[y]]) <span class="sc">%&gt;%</span> </span>
<span id="cb745-11"><a href="#cb745-11" tabindex="-1"></a>      writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(</span>
<span id="cb745-12"><a href="#cb745-12" tabindex="-1"></a>        <span class="at">path =</span> <span class="fu">paste0</span>(<span class="st">&quot;data/data_by_&quot;</span>, b,<span class="st">&quot;_&quot;</span>,x, <span class="st">&quot;.xlsx&quot;</span>)</span>
<span id="cb745-13"><a href="#cb745-13" tabindex="-1"></a>      )</span>
<span id="cb745-14"><a href="#cb745-14" tabindex="-1"></a>    </span>
<span id="cb745-15"><a href="#cb745-15" tabindex="-1"></a>  }</span>
<span id="cb745-16"><a href="#cb745-16" tabindex="-1"></a>  </span>
<span id="cb745-17"><a href="#cb745-17" tabindex="-1"></a>  <span class="fu">imap</span>(df_by_x, save_to_excel)</span>
<span id="cb745-18"><a href="#cb745-18" tabindex="-1"></a>}</span></code></pre></div>
<p>The function <code>book_and_sheets</code> designed in above code helps us to write a data say <code>df</code> into separate files based on column <code>x</code> and each of these files is further divided into sheets based on column <code>y</code>. Only thing to be remembered is that we have to pass, <code>x</code> and <code>y</code> arguments as character strings; and <code>df</code> as variable.</p>
<p>Example - splitting <code>mtcars</code> into files based on <code>cyl</code> and sheets based on <code>gear</code></p>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="#cb746-1" tabindex="-1"></a><span class="fu">book_and_sheets</span>(mtcars, <span class="st">&#39;cyl&#39;</span>, <span class="st">&#39;gear&#39;</span>)</span></code></pre></div>
<pre><code>## $`4`
## [1] &quot;G:\\OneDrive - A c GeM CAG of INDIA (1)\\new book\\Data\\data_by_4_cyl.xlsx&quot;
## 
## $`6`
## [1] &quot;G:\\OneDrive - A c GeM CAG of INDIA (1)\\new book\\Data\\data_by_6_cyl.xlsx&quot;
## 
## $`8`
## [1] &quot;G:\\OneDrive - A c GeM CAG of INDIA (1)\\new book\\Data\\data_by_8_cyl.xlsx&quot;</code></pre>
<p>We can check that three excel files have been created in directory <code>data/</code>.</p>
<!--chapter:end:07-2-merge.Rmd-->
</div>
</div>
<div id="part-ii-exploratory-data-analysis" class="section level1 unnumbered">
<h1 class="unnumbered">Part-II: Exploratory Data Analysis</h1>
</div>
<div id="visualisations-in-base-r" class="section level1" number="12">
<h1><span class="header-section-number">12</span> Visualisations in Base R</h1>
<p>It is a common practice to visualize data as soon as we start analysing it. While small data can be easily visualised in data format, the most common being opening it in MS Excel format, it becomes a hurdle to look at it when the data is bigger. Undoubtedly, visualization is an essential tool for data analysis because it enables us to see patterns and relationships that may not be apparent from a simple numerical summary. For example, a histogram can show the distribution of a variable, which can help identify outliers or skewness that may be hidden in the summary statistics. Similarly, a scatter plot can show the relationship between two variables, which can help identify correlation or causation that may not be apparent from summary statistics.</p>
<p>Visualization also plays a crucial role in communicating data analysis results to others. A well-designed graph or chart can convey information more effectively than a table of numbers or a lengthy report. It can also help identify errors or anomalies in the data and facilitate better decision-making.</p>
<p>In R, the base graphics system provides a powerful set of functions for creating various types of graphs and plots. In this chapter, we will cover the most commonly used functions for creating visualizations in base R, including <code>plot()</code>, <code>boxplot()</code>, <code>barplot()</code>, <code>hist()</code>, <code>pie()</code>, <code>dotchart()</code> and kernel density plots.</p>
<blockquote>
<p>Note: In next chapter we will cover visulaisation through <code>ggplot2</code> library which is very extensive, and is developed on theortical framework known as ‘grammar of graphics’. This grammar, created by Leland Wilkinson, has been implemented in a variety of data visualisation software like Tableau<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>, Plotly, etc.</p>
</blockquote>
<div id="using-plot" class="section level2" number="12.1">
<h2><span class="header-section-number">12.1</span> Using <code>plot()</code></h2>
<p>The <code>plot()</code> function in R is a very versatile function that can create a wide variety of visualizations. Its primary purpose is to create scatterplots, but it can also create line plots, bar plots, box plots, and many other types of plots. The “plot” function can be customized in many ways, allowing users to create high-quality visualizations that are tailored to their specific needs.</p>
<p>The basic syntax of the “plot” function is as follows:</p>
<pre><code>plot(x, y, ...)</code></pre>
<p>The <code>x</code> and <code>y</code> arguments specify the variables to be plotted on the x-axis and y-axis, respectively. The <code>...</code> argument can include a wide range of optional arguments that customize the plot. Some of the most commonly used optional arguments include:</p>
<ul>
<li><code>xlab</code>: Specifies the label for the x-axis.</li>
<li><code>ylab</code>: Specifies the label for the y-axis.</li>
<li><code>main</code>: Specifies the main title for the plot.</li>
<li><code>xlim</code>: Specifies the limits for the x-axis.</li>
<li><code>ylim</code>: Specifies the limits for the y-axis.</li>
<li><code>type</code>: Specifies the type of plot to be created (e.g., <code>"p"</code> for points, <code>"l"</code> for lines,<code>"b"</code> for both points and lines, etc.).</li>
<li><code>col</code>: Specifies the color of the plot elements (e.g., points, lines, etc.).</li>
<li><code>pch</code>: Specifies the symbol used for the points in the plot.</li>
<li><code>cex</code>: Specifies the size of the plot elements (e.g., points, lines, etc.).</li>
</ul>
<blockquote>
<p>Note: Here <code>x</code> and <code>y</code> refer to vectors instead of column names, as we will see in next chapter on ggplot2 where we will use column names, instead of individual vectors. You’ll understand the difference in the following example.</p>
</blockquote>
<p>Example of scatterplot: (This will create a scatterplot with “wt” on the x-axis and “mpg” on the y-axis, with axis labels and a main title.)</p>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb749-1"><a href="#cb749-1" tabindex="-1"></a><span class="fu">plot</span>(mtcars<span class="sc">$</span>wt, </span>
<span id="cb749-2"><a href="#cb749-2" tabindex="-1"></a>     mtcars<span class="sc">$</span>mpg, </span>
<span id="cb749-3"><a href="#cb749-3" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Car Weight (1000 lbs)&quot;</span>, </span>
<span id="cb749-4"><a href="#cb749-4" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Miles per Gallon&quot;</span>, </span>
<span id="cb749-5"><a href="#cb749-5" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Scatterplot of MPG vs Car Weight&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p1-1.png" width="672" height="55%" style="display: block; margin: auto;" /></p>
<p>Example-2: Lineplot (This will create a line plot with “pressure”<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a> on the y-axis and “time” on the x-axis, with axis labels and a main title.)</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb750-1"><a href="#cb750-1" tabindex="-1"></a><span class="fu">plot</span>(pressure, </span>
<span id="cb750-2"><a href="#cb750-2" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, </span>
<span id="cb750-3"><a href="#cb750-3" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Time&quot;</span>, </span>
<span id="cb750-4"><a href="#cb750-4" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Pressure&quot;</span>, </span>
<span id="cb750-5"><a href="#cb750-5" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Line Plot of Pressure vs Time&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p2-1.png" width="672" height="55%" style="display: block; margin: auto;" />
Note in above example that, the “type” argument is set to “l” to specify that a line plot should be created.</p>
<p>Example-3: Bar-Plot (bar plot of the number of cars by “cyl” i.e. number of cylinders)</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="#cb751-1" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(mtcars<span class="sc">$</span>cyl), </span>
<span id="cb751-2"><a href="#cb751-2" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Number of Cylinders&quot;</span>, </span>
<span id="cb751-3"><a href="#cb751-3" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Frequency&quot;</span>, </span>
<span id="cb751-4"><a href="#cb751-4" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Barplot of Number of Cars by Cylinders&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p3-1.png" width="672" height="55%" style="display: block; margin: auto;" />
Note: In above example we have used <code>table()</code> function to get the frequency table of <code>mtcars$cyl</code>.</p>
<p>Example-4: Boxplot ()</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="#cb752-1" tabindex="-1"></a><span class="co"># Create a boxplot of &quot;Sepal.Length&quot; by &quot;Species&quot; in the iris dataset</span></span>
<span id="cb752-2"><a href="#cb752-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> iris<span class="sc">$</span>Species, </span>
<span id="cb752-3"><a href="#cb752-3" tabindex="-1"></a>     <span class="at">y =</span> iris<span class="sc">$</span>Sepal.Length, </span>
<span id="cb752-4"><a href="#cb752-4" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Boxplot of Sepal Length by Species&quot;</span>,</span>
<span id="cb752-5"><a href="#cb752-5" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Species&quot;</span>, </span>
<span id="cb752-6"><a href="#cb752-6" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Sepal Length&quot;</span>, </span>
<span id="cb752-7"><a href="#cb752-7" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;darkgray&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p4-1.png" width="672" height="55%" style="display: block; margin: auto;" /></p>
<p>Example-5: density plot</p>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb753-1"><a href="#cb753-1" tabindex="-1"></a><span class="co"># Create a density plot of &quot;Sepal.Length&quot; in the iris dataset</span></span>
<span id="cb753-2"><a href="#cb753-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(iris<span class="sc">$</span>Sepal.Length), <span class="at">main =</span> <span class="st">&quot;Density Plot of Sepal Length in the iris dataset&quot;</span>,</span>
<span id="cb753-3"><a href="#cb753-3" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Sepal Length&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Density&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p5-1.png" width="672" height="55%" style="display: block; margin: auto;" />
Note that we have used <code>density()</code> function within <code>plot()</code> to create a density plot.</p>
<p>Let us learn about other plotting functions in base R.</p>
</div>
<div id="bar-plots-using-barplot" class="section level2" number="12.2">
<h2><span class="header-section-number">12.2</span> Bar plots using <code>barplot()</code></h2>
<p>As the name suggests <code>barplot()</code> function is used to create bar charts in R. The basic syntax is <code>barplot(height, ...)</code> where <code>height</code> should be a vector providing heights of each bar. Other arguments in ellipsis <code>...</code> can be checked by using <code>?barplot()</code>.</p>
<p>Here are a few examples of how to use the function:</p>
<p>Example: Basic Bar Chart</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="#cb754-1" tabindex="-1"></a><span class="co"># Create a basic bar chart of the &quot;mpg&quot; dataset</span></span>
<span id="cb754-2"><a href="#cb754-2" tabindex="-1"></a></span>
<span id="cb754-3"><a href="#cb754-3" tabindex="-1"></a><span class="fu">barplot</span>(mtcars<span class="sc">$</span>mpg, <span class="at">names.arg =</span> <span class="fu">rownames</span>(mtcars), <span class="at">main =</span> <span class="st">&quot;Miles Per gallon - mtcars&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Car Model&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;MPG&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p6-1.png" width="672" height="55%" style="display: block; margin: auto;" /></p>
<p>Example- Bar chart with summarised data</p>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb755-1"><a href="#cb755-1" tabindex="-1"></a><span class="co"># Create a summarised bar chart of the &quot;PlantGrowth&quot; dataset</span></span>
<span id="cb755-2"><a href="#cb755-2" tabindex="-1"></a><span class="fu">data</span>(PlantGrowth)</span>
<span id="cb755-3"><a href="#cb755-3" tabindex="-1"></a><span class="fu">barplot</span>(<span class="at">height =</span> <span class="fu">t</span>(<span class="fu">tapply</span>(PlantGrowth<span class="sc">$</span>weight, </span>
<span id="cb755-4"><a href="#cb755-4" tabindex="-1"></a>                          <span class="fu">list</span>(PlantGrowth<span class="sc">$</span>group), </span>
<span id="cb755-5"><a href="#cb755-5" tabindex="-1"></a>                          mean)), </span>
<span id="cb755-6"><a href="#cb755-6" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Mean Weight of Plants by Group&quot;</span>, </span>
<span id="cb755-7"><a href="#cb755-7" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Group&quot;</span>, </span>
<span id="cb755-8"><a href="#cb755-8" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Weight&quot;</span>, </span>
<span id="cb755-9"><a href="#cb755-9" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb755-10"><a href="#cb755-10" tabindex="-1"></a>        <span class="at">beside =</span> <span class="cn">TRUE</span>, </span>
<span id="cb755-11"><a href="#cb755-11" tabindex="-1"></a>        <span class="at">horiz =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p7-1.png" width="672" height="55%" style="display: block; margin: auto;" /></p>
<p>Example- Grouped Bar Chart</p>
<div class="sourceCode" id="cb756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb756-1"><a href="#cb756-1" tabindex="-1"></a><span class="co"># Create a grouped bar chart of the &quot;ChickWeight&quot; dataset</span></span>
<span id="cb756-2"><a href="#cb756-2" tabindex="-1"></a><span class="fu">data</span>(ChickWeight)</span>
<span id="cb756-3"><a href="#cb756-3" tabindex="-1"></a><span class="fu">barplot</span>(<span class="at">height =</span> <span class="fu">t</span>(<span class="fu">tapply</span>(ChickWeight<span class="sc">$</span>weight, </span>
<span id="cb756-4"><a href="#cb756-4" tabindex="-1"></a>                          <span class="fu">list</span>(ChickWeight<span class="sc">$</span>Diet, ChickWeight<span class="sc">$</span>Time), </span>
<span id="cb756-5"><a href="#cb756-5" tabindex="-1"></a>                          mean)), </span>
<span id="cb756-6"><a href="#cb756-6" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Mean Weight of Chicks by Diet and Time&quot;</span>, </span>
<span id="cb756-7"><a href="#cb756-7" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Diet and Time&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Weight&quot;</span>, </span>
<span id="cb756-8"><a href="#cb756-8" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;yellow&quot;</span>), </span>
<span id="cb756-9"><a href="#cb756-9" tabindex="-1"></a>        <span class="at">beside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb756-10"><a href="#cb756-10" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">c</span>(<span class="st">&quot;Diet 1&quot;</span>, <span class="st">&quot;Diet 2&quot;</span>, <span class="st">&quot;Diet 3&quot;</span>, <span class="st">&quot;Diet 4&quot;</span>))</span></code></pre></div>
<p><img src="DauR_files/figure-html/p8-1.png" width="672" height="55%" style="display: block; margin: auto;" /></p>
<p>Example: Stacked Bar Chart</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="#cb757-1" tabindex="-1"></a><span class="co"># Create a stacked bar chart of the &quot;VADeaths&quot; dataset</span></span>
<span id="cb757-2"><a href="#cb757-2" tabindex="-1"></a><span class="fu">data</span>(VADeaths)</span>
<span id="cb757-3"><a href="#cb757-3" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">as.matrix</span>(VADeaths), </span>
<span id="cb757-4"><a href="#cb757-4" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Death Rates by Age Group and Gender&quot;</span>, </span>
<span id="cb757-5"><a href="#cb757-5" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Age Group&quot;</span>, </span>
<span id="cb757-6"><a href="#cb757-6" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Death Rate&quot;</span>, </span>
<span id="cb757-7"><a href="#cb757-7" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;purple&quot;</span>), </span>
<span id="cb757-8"><a href="#cb757-8" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">c</span>(<span class="st">&quot;Females&quot;</span>, <span class="st">&quot;Males&quot;</span>), </span>
<span id="cb757-9"><a href="#cb757-9" tabindex="-1"></a>        <span class="at">beside =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p9-1.png" width="672" height="55%" style="display: block; margin: auto;" /></p>
<p>In fact, we can also create barplots using formula directly. See this example</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb758-1"><a href="#cb758-1" tabindex="-1"></a><span class="fu">barplot</span>(GNP <span class="sc">~</span> Year, <span class="at">data =</span> longley)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p10-1.png" width="672" height="55%" style="display: block; margin: auto;" /></p>
</div>
<div id="histograms-using-hist" class="section level2" number="12.3">
<h2><span class="header-section-number">12.3</span> Histograms using <code>hist()</code></h2>
<p>The <code>hist()</code> function in R is used to create a histogram, which is a graphical representation of the distribution of a numeric variable. The basic syntax for <code>hist()</code> is as follows:</p>
<pre><code>hist(x, breaks = &quot;Sturges&quot;, freq = TRUE, main = NULL,
     xlab = NULL, ylab = &quot;Frequency&quot;, ...)</code></pre>
<p>where -</p>
<ul>
<li><code>x</code>: The data to be plotted, which should be a numeric vector or a matrix.</li>
<li><code>breaks</code>: The number of bins to use in the histogram. By default, R uses the Sturges formula to determine the number of bins, but you can also specify a different number of bins or a vector of breakpoints.</li>
<li><code>freq</code>: A logical value indicating whether to plot the frequency or density of the data. If <code>TRUE</code>, the y-axis represents the number of observations in each bin. If <code>FALSE</code>, the y-axis represents the density of the data.</li>
<li><code>main</code>: A character string specifying the title of the histogram.</li>
<li><code>xlab</code>: A character string specifying the label of the x-axis.</li>
<li><code>ylab</code>: A character string specifying the label of the y-axis.</li>
<li><code>...</code>: Additional arguments passed to the <code>plot()</code> function, such as <code>col</code>, <code>border</code>, and <code>xlim</code>.</li>
</ul>
<p>Example -</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb760-1"><a href="#cb760-1" tabindex="-1"></a><span class="fu">hist</span>(iris<span class="sc">$</span>Sepal.Length, <span class="at">breaks =</span> <span class="dv">10</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb760-2"><a href="#cb760-2" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Sepal Length&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Frequency&quot;</span>,</span>
<span id="cb760-3"><a href="#cb760-3" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Histogram of Sepal Length in Iris Dataset&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p11-1.png" width="672" height="55%" style="display: block; margin: auto;" /></p>
<p>Another example using two layers</p>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="#cb761-1" tabindex="-1"></a><span class="fu">hist</span>(mtcars<span class="sc">$</span>mpg,</span>
<span id="cb761-2"><a href="#cb761-2" tabindex="-1"></a>     <span class="at">freq=</span><span class="cn">FALSE</span>,</span>
<span id="cb761-3"><a href="#cb761-3" tabindex="-1"></a>     <span class="at">breaks=</span><span class="dv">12</span>,</span>
<span id="cb761-4"><a href="#cb761-4" tabindex="-1"></a>     <span class="at">col=</span><span class="st">&quot;red&quot;</span>,</span>
<span id="cb761-5"><a href="#cb761-5" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Miles Per Gallon&quot;</span>,</span>
<span id="cb761-6"><a href="#cb761-6" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Histogram, with density curve&quot;</span>)</span>
<span id="cb761-7"><a href="#cb761-7" tabindex="-1"></a><span class="co"># add density curve</span></span>
<span id="cb761-8"><a href="#cb761-8" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(mtcars<span class="sc">$</span>mpg), <span class="at">col=</span><span class="st">&quot;blue&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p12-1.png" width="672" height="55%" style="display: block; margin: auto;" /></p>
<p>In above example we have used <code>lines()</code> function to add another layer to existing plot.</p>
</div>
<div id="boxplots-and-variants-using-boxplot" class="section level2" number="12.4">
<h2><span class="header-section-number">12.4</span> Boxplot(s) and variants using <code>boxplot()</code></h2>
A Box-plot is also called box and whiskers plot and is used to show distribution of a numerical variable using graphical summaries. Deciphering box plot can be understood using the following illustration.
<div class="figure" style="text-align: center">
<img src="images/boxplots.png" alt="Understanding boxplots" width="336" height="45%" />
<p class="caption">
(#fig:boxplots)Understanding boxplots
</p>
</div>
<p>Using <code>boxplot()</code> function is simple, as the syntax is <code>boxplot(x, ...)</code> where <code>x</code> is a numeric vector or a list of numeric vectors to be plotted, and <code>...</code> represents any additional arguments that can be used to customize the appearance of the box plot.</p>
<p>Example-</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb762-1"><a href="#cb762-1" tabindex="-1"></a><span class="fu">boxplot</span>(mtcars<span class="sc">$</span>mpg)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p13-1.png" width="672" height="55%" style="display: block; margin: auto;" /></p>
<p>However, the boxplots are particularly useful when drawn in parallel over several categories. To draw these, we can directly use formula as we did in example above. E.g. the following code will create box-plots of for each type of spray, from InsectSprays<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a> data.</p>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="#cb763-1" tabindex="-1"></a><span class="fu">boxplot</span>(count <span class="sc">~</span> spray, </span>
<span id="cb763-2"><a href="#cb763-2" tabindex="-1"></a>        <span class="at">data =</span> InsectSprays, </span>
<span id="cb763-3"><a href="#cb763-3" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">&quot;lightgray&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/p14-1.png" width="672" height="55%" style="display: block; margin: auto;" /></p>
</div>
<div id="saving-and-exporting-charts" class="section level2" number="12.5">
<h2><span class="header-section-number">12.5</span> Saving and exporting charts</h2>
<p>See last section of next chapter.</p>
</div>
<div id="use-of-par" class="section level2" number="12.6">
<h2><span class="header-section-number">12.6</span> Use of <code>par()</code></h2>
<p>One of the useful functions while using base R’s graphics is <code>par()</code> which is used to set or query graphical <strong>par</strong>ameters. See the following example, where one of its argument <code>mfrow = c(nr, nc)</code> has been used inside this function to draw subsequent plots in an <code>nr</code>-by-<code>nc</code> array on the device.</p>
<div class="sourceCode" id="cb764"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb764-1"><a href="#cb764-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb764-2"><a href="#cb764-2" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">walk</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb764-3"><a href="#cb764-3" tabindex="-1"></a>     <span class="sc">~</span><span class="fu">plot</span>(anscombe[[<span class="fu">paste0</span>(<span class="st">&#39;x&#39;</span>, .x)]], </span>
<span id="cb764-4"><a href="#cb764-4" tabindex="-1"></a>           anscombe[[<span class="fu">paste0</span>(<span class="st">&#39;y&#39;</span>, .x)]], </span>
<span id="cb764-5"><a href="#cb764-5" tabindex="-1"></a>           <span class="at">xlab =</span> <span class="fu">paste0</span>(<span class="st">&#39;x&#39;</span>, .x),</span>
<span id="cb764-6"><a href="#cb764-6" tabindex="-1"></a>           <span class="at">ylab =</span> <span class="fu">paste0</span>(<span class="st">&#39;y&#39;</span>, .x),</span>
<span id="cb764-7"><a href="#cb764-7" tabindex="-1"></a>           <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;Anscombe&#39;s Quartet Chart No.&quot;</span>, .x))</span>
<span id="cb764-8"><a href="#cb764-8" tabindex="-1"></a>     )</span></code></pre></div>
<p><img src="DauR_files/figure-html/unnamed-chunk-238-1.png" width="672" /></p>
<!--chapter:end:08-plot.Rmd-->
</div>
</div>
<div id="visualising-data-with-ggplot2" class="section level1" number="13">
<h1><span class="header-section-number">13</span> Visualising data with <code>ggplot2</code></h1>
<div id="core-concepts-of-grammar-of-graphics" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> Core concepts of <strong>grammar of graphics</strong></h2>
<p><strong>ggplot2</strong><a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a><span class="citation"><a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a></span> is the package developed by Hadley Wickham, which is based on concepts laid (2005) down by Leland Wilkinson in his <em>The Grammar of Graphics</em>.<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a> Basically, <strong>grammar of graphics</strong> is a framework which follows a layered approach to describe and construct visualizations or graphics in a structured manner. Even the letters <code>gg</code> in ggplot2 stand for <code>g</code>grammar of <code>g</code>raphics.</p>
<p>Hadley Wickham, in his paper titled <strong>A Layered Grammar of Graphics</strong><a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a>(2010)<span class="citation"><a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a></span> proposed his idea of layered grammar of graphics in detail and simultaneously put forward his idea of <em>ggplot2</em> as an open source implementation framework for building graphics. Readers/Users are advised to check the paper as it describes the concept of grammar of graphics in detail. By the end of the decade the package progressed<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a> to one of the most used and popular packages in R.</p>
<p>The relationship between the components explained in both the grammars can be illustrated with the image<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a> in Figure @ref(fig:rgg1). The components on the left have been put forward by Wilkinson whereas those on right were proposed by Wickham. It may be seen that <code>TRANS</code> has no relation in <code>ggplot2</code> as its role is played by in-built features of R.</p>
<div class="figure" style="text-align: center">
<img src="images/layers_gg.png" alt="Layers in Grammar of Graphics mapped in GGPLOT2" width="50%" height="40%" />
<p class="caption">
(#fig:rgg1)Layers in Grammar of Graphics mapped in GGPLOT2
</p>
</div>
<p>Thus, to build a graphic having one or more dimensions, from a given data, we use <em>seven</em> major components -</p>
<ol style="list-style-type: decimal">
<li><strong>Data:</strong> Unarguably, a graphic/visualisation should start with a
data. It is also the first argument in most important function in
the package i.e. <code>ggplot(data =)</code>.</li>
<li><strong>Aesthetics:</strong> or <code>aes()</code> in short, provide a <strong>mapping</strong> of
various data dimensions to axes so as to provide positions to
various data points in the output plot/graphic.</li>
<li><strong>Geometries:</strong> or <code>geoms</code> for short, are used to provide the
<em>geometries</em> so that data points may take a concrete shape on the
visualisation. For e.g. the data points should be depicted as bars
or scatter points or else are decided by the provided <code>geoms.</code></li>
<li><strong>Statistics:</strong> or <code>stat</code> for short, provides the statistics to show
in the visualisation like measures of central tendency, etc.</li>
<li><strong>Scale:</strong> This component is used to decide whether any dimension
needs some scaling like logarithmic transformation, etc.</li>
<li><strong>Coordinate System:</strong> Though most of the time <em>Cartesian coordinate
system</em> is used, yet there are times when <em>polar coordinate system</em>
(e.g. pie chart) or <em>spherical coordinate system</em> (e.g. geographical
maps) are used.</li>
<li><strong>Facets:</strong> Used when based on certain dimension, the plot is
divided into further sub-plots.</li>
</ol>
<p>Out of the afore-mentioned components, first three (<code>data</code>, <code>aesthetics</code> and <code>geometries</code>) are to be explicitly provided and thus can be understood as mandatory components. Whilst these three components are mandatorily provided, it is not that others are not mandatory. It is just that other components have their defaults (e.g. default coordinate system is Cartesian coordinate system). Let us dive into these three essential components and build a plot using these.</p>
</div>
<div id="building-a-basic-plot-using-key-components" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> Building a basic plot using key components</h2>
<p>We will use <code>mtcars</code> data-sets, which is a default dataset in the package, to learn the concepts. Let us see what happens when <code>data</code> is provided to <code>ggplot</code> function-</p>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="#cb765-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb765-2"><a href="#cb765-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>mtcars)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/figblank-1.png" alt="Data provided to ggplot2" width="100%" />
<p class="caption">
(#fig:figblank)Data provided to ggplot2
</p>
</div>
<p>In Figure @ref(fig:figblank) we can see that a blank chart/plot space has been created as our data <code>mtcars</code> has now mapped with ggplot2. Now, let us provide aesthetic mappings to this using function <code>aes()</code>, through the argument <code>mapping</code> in <code>ggplot2</code> function itself.</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb766-1"><a href="#cb766-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mtcars, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>wt, <span class="at">y=</span>mpg))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg2-1.png" alt="Data and mapping provided to ggplot2" width="100%" />
<p class="caption">
(#fig:rgg2)Data and mapping provided to ggplot2
</p>
</div>
<p>In Figure @ref(fig:rgg2), we may now notice that apart from creating a blank space for plot, the two dimensions provided, i.e. <code>wt</code> and <code>mpg</code> have been <em>mapped</em> with <code>x</code> and <code>y</code> axes respectively. Since no geometry has been provided, the plot area is still blank. Now we will provide geometry to our dimension say <em>point</em>. To do this we will use another family of functions i.e. <code>geom_*</code> (<code>geom_point()</code> in this case specifically).</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="#cb767-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mtcars, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb767-2"><a href="#cb767-2" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg3-1.png" alt="Data plotted as points in a scatterplot" width="100%" />
<p class="caption">
(#fig:rgg3)Data plotted as points in a scatterplot
</p>
</div>
<p>In Figure @ref(fig:rgg3) we may now notice that data has been plotted
as points (due to the geometry we used <code>geom_point</code>) as soon as we added
another layer of function <code>ggplot()</code> using a <code>+</code> sign in the earlier
code. <strong>Using the code above, we have actually plotted the relationship
between weight of the vehicle (<code>wt</code>) and mileage in miles per gallon
(<code>mpg</code>) of the vehicles available in <code>mpg</code> dataset.</strong></p>
<p>We could have plotted the data as box-plot if we had used another
geometry say <code>geom_boxplot</code> here. Refer Figure @ref(fig:rgg4).</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb768-1"><a href="#cb768-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mtcars, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> wt)) <span class="sc">+</span></span>
<span id="cb768-2"><a href="#cb768-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg4-1.png" alt="Data plotted as boxplot" width="100%" />
<p class="caption">
(#fig:rgg4)Data plotted as boxplot
</p>
</div>
<p>That’s the basic architecture for construction of a plot in this
package. Up to this point it may be noted that we have provided <code>data</code>
and <code>aesthetics</code> as argument to function <code>ggplot</code> and for <code>geometry</code> we
have used another function <code>geom_*</code> and added it to above components
using a plus <code>+</code> sign. In the above code(s) it may also be noted that
<code>data</code> and <code>mapping</code> are the first two arguments of function <code>ggplot</code>;
<code>x</code> and <code>y</code> are the default first two arguments of function <code>aes</code> so we
may draw the same plot in Figure @ref(fig:rgg3) using the following
code wherein we haven’t used these as named arguments. We will follow
the same convention in subsequent sections.</p>
<pre><code>ggplot(mtcars, aes(wt, mpg)) +
  geom_point()</code></pre>
<p>Now lets discuss more on <code>aesthetics</code> and <code>geometries</code> and using these
to build the desired plots, before moving on to other components of plot
in the package.</p>
</div>
<div id="AESTH" class="section level2" number="13.3">
<h2><span class="header-section-number">13.3</span> Other Aesthetic attributes (color, shape, size, etc.)</h2>
<p>In previous section of this chapter we mapped the attributes in data
using the <code>position</code> in coordinate system (<code>x</code> and/or <code>y</code> in Cartesian
coordinate system). We can, however, map other variables in the data to
the plot using aesthetic attributes like <code>shape</code>, <code>size</code>, <code>color</code>,
<code>alpha</code> (transparency), etc., as shown in the image in Figure
@ref(fig:rrgg5).</p>
<div class="figure" style="text-align: center">
<img src="images/aes.png" alt="Some Common Aesthetic mappings.  Image Source: Claus Wilke's book on Fundamentals of Data Visualization" width="576" />
<p class="caption">
(#fig:rrgg5)Some Common Aesthetic mappings. Image Source: Claus Wilke’s book on Fundamentals of Data Visualization
</p>
</div>
<p>These aesthetics may be divided broadly into two categories -</p>
<ul>
<li>aesthetics those can be mapped with <code>continuous</code> data variable(s);
and</li>
<li>aesthetics those can be mapped with <code>discrete</code> or categorical data
variables.</li>
</ul>
<p>For example, <code>position</code> (coordinates in a coordinate system), <code>size</code>,
<code>color</code>, <code>linewidth</code> can represent continuous data; but <code>shape</code>,
<code>linetype</code> etc. aesthetics can be mapped with discrete data. Numerical
data which can be used to represent both <code>continuous</code> and <code>discrete</code>
data (we will see example shortly) if mapped to an aesthetic will by
default represent continuous data and thus, need to be converted to a
discrete data type (factor, in most of the cases will suffice) before
mapping to an aesthetic representing discrete data.</p>
<p>Some commonly used aesthetics are -</p>
<ul>
<li><code>shape</code> = Display a point with <code>geom_point()</code> as a dot, star,
triangle, or square</li>
<li><code>fill</code> = The interior color (e.g. of a bar or box-plot)</li>
<li><code>color</code> = The exterior line of a <code>bar</code>, <code>boxplot</code>, etc., or the
point color if using <code>geom_point()</code></li>
<li><code>size</code> = Size (e.g. line thickness, point size)</li>
<li><code>alpha</code> = Transparency (<code>1 = opaque</code>, <code>0 = invisible</code>)</li>
<li><code>binwidth</code> = Width of histogram bins</li>
<li><code>width</code> = Width of “bar plot” columns</li>
<li><code>linetype</code> = Line type (e.g. solid, dashed, dotted)</li>
</ul>
<div id="color-the-most-important-aesthetic" class="section level3" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> Color, the most important aesthetic</h3>
<p>Data elements can be colored in a data visualisation using aesthetic
named <code>color</code> (Alternative British spelling <code>colour</code> will also work in
exactly same way). We can use color in a plot/visualisation primarily
for three purposes-</p>
<ul>
<li>highlight specific or all values.</li>
<li>grouping the data points i.e. using color to distinguish data
elements from each other.</li>
<li>mapping a variable, i.e. using color to represent different data
elements.</li>
</ul>
<p>To understand the use cases, let us fill the color of all points in
Figure @(fig:rgg3) with say, <code>"red"</code> color. To do this, we can provide
the value of <code>color</code> aesthetic directly inside the <code>geom_*</code> function
(Figure @ref(fig:rgg5)).</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb770-1"><a href="#cb770-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb770-2"><a href="#cb770-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg5-1.png" alt="Highlighting all data points with a static color" width="672" />
<p class="caption">
(#fig:rgg5)Highlighting all data points with a static color
</p>
</div>
<p>As the argument <code>color='red'</code> was mentioned inside the <code>geom_point()</code>
function, it turned every point to red (i.e. with a static color) in
Figure @ref(fig:rgg5). But if the requirement was to highlight specific
points in the plot, we have to use the <code>color</code> inside <code>aes</code> function. Or
in other words, we have to use color <code>aesthetics</code> to visualise the data.</p>
<p>So let us color the data points in Figure @ref(fig:rgg5) using the
variable <code>cyl</code> (number of cylinders in the vehicle), so that the
scatter-points are colored on the basis of number of cylinders instead.</p>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb771-1"><a href="#cb771-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb771-2"><a href="#cb771-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>cyl))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg6-1.png" alt="Mapping a numeric variable with color aesthetic" width="672" />
<p class="caption">
(#fig:rgg6)Mapping a numeric variable with color aesthetic
</p>
</div>
<p>We may notice in Figure @ref(fig:rgg6) that scatter-points are now
colored on the basis of number of cylinders in the cars. Simultaneously,
a color scale has been produced as a legend. Since the <code>cyl</code> column was
a numeric column, and we mapped that with a <code>continuous</code> type aesthetic
color, it mapped the continuous variable with the aesthetic by default.
Now in this case, though the <code>cyl</code> is having numerical values, the plot
will be more meaningful if the corresponding <code>discrete</code> variable is
mapped with color aesthetic. So we can convert it into a factor type
variable, on the fly.</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb772-1"><a href="#cb772-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb772-2"><a href="#cb772-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="fu">as.factor</span>(cyl)))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg7-1.png" alt="Mapping a discrete variable with color aesthetic" width="672" />
<p class="caption">
(#fig:rgg7)Mapping a discrete variable with color aesthetic
</p>
</div>
<p>In Figure @ref(fig:rgg7) we may see that the points have been grouped
using different color of each of the group. Readers may also that the
<code>color</code> aesthetic was provided through <code>aes()</code> function in the second
layer which was wrapped in <code>geom_point()</code> function. The aesthetic could
have been wrapped in <code>ggplot()</code> layer also. So basically the following
code will also produce exactly the same chart-</p>
<pre><code>ggplot(mtcars, aes(wt, mpg, color = as.factor(cyl))) +
  geom_point()</code></pre>
<p>So is there any difference between the two? Yes, basically aesthetics if
provided under the <code>geoms</code>, will override those aesthetics which are
already provided under <code>ggplot</code> function. To understand the difference,
see the result of following code in Figure @ref(fig:rgg8).</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb774-1"><a href="#cb774-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg, <span class="at">color =</span> <span class="fu">as.factor</span>(cyl))) <span class="sc">+</span></span>
<span id="cb774-2"><a href="#cb774-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg8-1.png" alt="Over-riding aesthetics" width="672" />
<p class="caption">
(#fig:rgg8)Over-riding aesthetics
</p>
</div>
<p>As the third use-case, i.e. using color to describe the variable, let us
analyse the mean mileage of cars for each group of cars for (i) number
of cylinders <code>cyl</code> and (ii) number of carburetors <code>carb</code>. A good
visualisation to plot the values will be <em>heat-map</em> (sometimes also
called as <em>highlight table</em>). We will generate a grouped summary before
proceeding, which can be understood using the concepts explained in
chapter related to data manipulation in dplyr i.e. Chapter
@ref(DPLYRR).</p>
<p>To draw the rectangular boxes in heat-map we will use another geometry
namely <code>geom_tile()</code> and map two categorical variables with <code>x</code> and <code>y</code>
coordinates in the Cartesian system. To fill the color values on the
basis of variable <code>mpg</code> we will use <code>fill</code> aesthetic instead of <code>color</code>
(we will understand the difference between <code>fill</code> and <code>color</code> aesthetics
shortly).</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="#cb775-1" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span> </span>
<span id="cb775-2"><a href="#cb775-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mpg =</span> <span class="fu">mean</span>(mpg, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb775-3"><a href="#cb775-3" tabindex="-1"></a>            <span class="at">.by =</span> <span class="fu">c</span>(cyl, carb)) <span class="sc">|&gt;</span> </span>
<span id="cb775-4"><a href="#cb775-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb775-5"><a href="#cb775-5" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">y =</span> carb, <span class="at">fill =</span> mpg))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg9-1.png" alt="using color to plot variable directly" width="672" />
<p class="caption">
(#fig:rgg9)using color to plot variable directly
</p>
</div>
<p>Referring plot in Figure @ref(fig:rgg9) we may see that cars with 4
cylinders and 1 carburetor have highest mileage.</p>
<p>So up to now, we have seen that to map color dynamically with a
variable, we have pass this aesthetic inside <code>aes</code> function; and
otherwise if we intend to use color only as a static value, we may pass
it outside the <code>aes</code> i.e. directly in the corresponding <code>geom</code> function.
Package ggplot2 recognises most of the color names and we have discussed
more about colors in Appendix @ref(COLORR). But what if we pass a
static color value to <code>color</code> aesthetic inside the <code>aes</code> function? Let
us check ourselves.</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb776-1"><a href="#cb776-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb776-2"><a href="#cb776-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="st">&#39;blue&#39;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg10-1.png" alt="Mapping Static color inside aes" width="672" />
<p class="caption">
(#fig:rgg10)Mapping Static color inside aes
</p>
</div>
<p>Interesting! GGPLOT2 has not only mapped a dummy variable called
<code>'blue'</code> with color of points, but also created a legend. More
interestingly the color is not what we wanted. Actually, what happened
was, that when we mapped color aesthetic inside <code>aes()</code>, ggplot2 created
a new variable on the fly, and then mapped it with the aesthetic and
thus producing a legend for the newly created variable.</p>
</div>
<div id="color-vs.-fill" class="section level3" number="13.3.2">
<h3><span class="header-section-number">13.3.2</span> Color Vs. Fill</h3>
<p>Till now we use used <code>color</code> aesthetic with the <code>point</code> geom (Figure
@ref(fig:rgg7)) and <code>fill</code> aesthetic in <code>tile</code> geom (Figure
@ref(fig:rgg9)) to map colors to the variables. Why did we use
different aesthetics? Typically, the <code>color</code> aesthetic changes the
outline of a geom and the <code>fill</code> aesthetic changes the inside.
<code>geom_point()</code> was an exception, we used <code>color</code> (not <code>fill</code>) for the
point color. Actually, it was not an exception too. The reason was that
the default point shape used by <code>geom_point()</code> was <code>shape = 19</code>: a solid
circle.</p>
<p>We can see the subtle difference if we override the default shape in
figure @ref(fig:rgg7) with <code>shape = 21</code>: a circle that allows us to use
both <code>fill</code> for the inside and <code>color</code> for the outline. (Figures
@ref(fig:rgg11).)</p>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="#cb777-1" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb777-2"><a href="#cb777-2" tabindex="-1"></a></span>
<span id="cb777-3"><a href="#cb777-3" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb777-4"><a href="#cb777-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="fu">as.factor</span>(cyl)), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb777-5"><a href="#cb777-5" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Using color aesthetic&quot;</span>)</span>
<span id="cb777-6"><a href="#cb777-6" tabindex="-1"></a></span>
<span id="cb777-7"><a href="#cb777-7" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb777-8"><a href="#cb777-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill=</span><span class="fu">as.factor</span>(cyl)), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb777-9"><a href="#cb777-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Using fill aesthetic&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg11-1.png" alt="Color Vs. Fill aesthetics" width="672" /><img src="DauR_files/figure-html/rgg11-2.png" alt="Color Vs. Fill aesthetics" width="672" />
<p class="caption">
(#fig:rgg11)Color Vs. Fill aesthetics
</p>
</div>
</div>
<div id="transparency-through-alpha" class="section level3" number="13.3.3">
<h3><span class="header-section-number">13.3.3</span> Transparency through <code>alpha</code></h3>
<p>In <code>ggplot2</code>, there is one more aesthetic which is used to change color
of the geometries, <code>alpha</code> which is used to control the transparency of
the elements in a plot. By adjusting the <code>alpha</code> value, which ranges
from 0 (completely transparent) to 1 (fully opaque), we can manage the
visibility and layering of overlapping elements. This is particularly
useful when dealing with dense data, as it helps to reduce over-plotting
and allows for better visualization of distributions and relationships.
Usually, it is used to map a continuous variable with it. Example-</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb778-1"><a href="#cb778-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb778-2"><a href="#cb778-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> cyl), <span class="at">size =</span> <span class="dv">4</span>) </span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg12-1.png" alt="Setting transparency with the number of cylinders" width="672" />
<p class="caption">
(#fig:rgg12)Setting transparency with the number of cylinders
</p>
</div>
<p>We may see in figure @ref(fig:rgg12) that points transparency nor
varies according to the number of cylinders i.e. <code>cyl</code> variable in the
data. Similar to other aesthetics we may pass static value between 0 to
1 to <code>alpha</code> for setting the transparency of geometries as desired.</p>
</div>
<div id="shape-aesthetic" class="section level3" number="13.3.4">
<h3><span class="header-section-number">13.3.4</span> Shape Aesthetic</h3>
<p>In figure @ref(fig:rgg11), we already saw the shape aesthetic to change
the shape of points from solid color to hollow color. Actually, in
<code>ggplot2</code>, the <code>shape</code> aesthetic is used to differentiate points in a
plot by assigning different symbols to them. Moreover, as we have
already discussed, this aesthetic should either be mapped with a
discrete variable; or if using shape from pre-existing shapes in the
package (see <code>?points</code>). <code>ggplot2</code> supports a variety of shapes, such as
circles, triangles, squares, and more, each represented by a unique
integer or character.</p>
<p>For instance, when plotting data with a categorical variable, we can map
this variable to the <code>shape</code> aesthetic to visually separate the groups.
However, it’s important to note that shapes can be less effective for
groups with many categories, as the distinctiveness of each shape may
diminish.</p>
<p>So in the above plots, we may map <code>cyl</code> variable to shape instead, by
converting it into factor variable.</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="#cb779-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb779-2"><a href="#cb779-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape=</span><span class="fu">as.factor</span>(cyl)), <span class="at">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg13-1.png" alt="Mapping shape aesthetic" width="672" />
<p class="caption">
(#fig:rgg13)Mapping shape aesthetic
</p>
</div>
<p>In above we may notice that different shapes have been used for 4, 6 and
8 cylinder vehicles.</p>
<p><strong>A few shapes available in <code>shape</code> aesthetics, with <code>fill</code> aesthetic
shown in <code>orange' and</code>color` aesthetic shown in ‘blue’ color in
figure</strong> @ref(fig:shapes)<strong>.</strong></p>
<div class="figure" style="text-align: center">
<img src="shapes.png" alt="Some Shapes available in GGplot" width="99%" />
<p class="caption">
(#fig:shapes)Some Shapes available in GGplot
</p>
</div>
</div>
<div id="size-aesthetic" class="section level3" number="13.3.5">
<h3><span class="header-section-number">13.3.5</span> Size Aesthetic</h3>
<p>As we have already seen that the <code>size</code> aesthetic controls the size of
plot elements or geometries, such as points in a scatter plot. By
mapping a continuous or discrete variable to <code>size</code>, we can represent
additional dimensions of our data, making the plot more informative.</p>
<p>For example, in a scatter plot of car weight versus fuel efficiency, we
might use the <code>size</code> aesthetic to represent the horsepower of each car,
where larger points indicate more powerful cars.</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb780-1"><a href="#cb780-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb780-2"><a href="#cb780-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size=</span>hp))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg14-1.png" alt="Mapping size aesthetic" width="672" />
<p class="caption">
(#fig:rgg14)Mapping size aesthetic
</p>
</div>
<p>In figure @ref(fig:rgg14) we may see that a visual layer has been added
that helps to identify relationships and patterns across multiple
variables simultaneously. However, it’s essential to use the <code>size</code>
aesthetic judiciously, as overly large or small elements can distort the
readability of the plot.</p>
</div>
<div id="using-multiple-aesthetics-simultaneously" class="section level3" number="13.3.6">
<h3><span class="header-section-number">13.3.6</span> Using multiple aesthetics simultaneously</h3>
<p>Multiple aesthetics can also be mapped simultaneously, as per
requirement. See this example-</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="#cb781-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars,</span>
<span id="cb781-2"><a href="#cb781-2" tabindex="-1"></a>       <span class="fu">aes</span>(</span>
<span id="cb781-3"><a href="#cb781-3" tabindex="-1"></a>         <span class="at">x =</span> wt,</span>
<span id="cb781-4"><a href="#cb781-4" tabindex="-1"></a>         <span class="at">y =</span> mpg,</span>
<span id="cb781-5"><a href="#cb781-5" tabindex="-1"></a>         <span class="at">shape =</span> <span class="fu">as.factor</span>(cyl),</span>
<span id="cb781-6"><a href="#cb781-6" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">as.factor</span>(gear),</span>
<span id="cb781-7"><a href="#cb781-7" tabindex="-1"></a>         <span class="at">alpha =</span> wt,</span>
<span id="cb781-8"><a href="#cb781-8" tabindex="-1"></a>         <span class="at">size =</span> hp</span>
<span id="cb781-9"><a href="#cb781-9" tabindex="-1"></a>       )) <span class="sc">+</span></span>
<span id="cb781-10"><a href="#cb781-10" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg15-1.png" alt="Using multiple aesthetics" width="672" />
<p class="caption">
(#fig:rgg15)Using multiple aesthetics
</p>
</div>
<p>We will learn about some other aesthetics like <code>binwidth</code>, <code>linetype</code>,
<code>width</code>, etc., in the next section @ref(geoms) when we will learn about
the use of other geometries.</p>
</div>
</div>
<div id="geoms" class="section level2" number="13.4">
<h2><span class="header-section-number">13.4</span> More on Geoms</h2>
<p>In previous section we have seen that as soon as we passed a <code>geom_*</code>
function/layer to <code>data</code> &amp; <code>aesthetics</code> layers, the chart/graph was
constructed. Actually, <code>geom_point()</code> function, in the background added
three more layers i.e. <code>stat</code>, <code>geom</code> and <code>position</code>, because <code>geom_*</code>
are actually shortcuts, which add these three layers. So in our example,
<code>ggplot(mtcars, aes(wt, mpg)) + geom_point()</code> is actually equivalent to
-</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="#cb782-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb782-2"><a href="#cb782-2" tabindex="-1"></a>  <span class="fu">layer</span>(</span>
<span id="cb782-3"><a href="#cb782-3" tabindex="-1"></a>    <span class="at">data =</span> mtcars,</span>
<span id="cb782-4"><a href="#cb782-4" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(wt, mpg),</span>
<span id="cb782-5"><a href="#cb782-5" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>,</span>
<span id="cb782-6"><a href="#cb782-6" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb782-7"><a href="#cb782-7" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">&quot;identity&quot;</span></span>
<span id="cb782-8"><a href="#cb782-8" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg16-1.png" alt="Components of GGPLOT2" width="672" />
<p class="caption">
(#fig:rgg16)Components of GGPLOT2
</p>
</div>
<p>Some common <code>geoms</code> are listed below:</p>
<ul>
<li>Histograms - <code>geom_histogram()</code></li>
<li>Bar charts - <code>geom_bar()</code> or <code>geom_col()</code></li>
<li>Box plots - <code>geom_boxplot()</code></li>
<li>Points (e.g. scatter plots) - <code>geom_point()</code></li>
<li>Line graphs - <code>geom_line()</code> or <code>geom_path()</code></li>
<li>Trend lines - <code>geom_smooth()</code></li>
<li>Heat-map - <code>geom_tile()</code></li>
<li>Label charts using <code>geom_text()</code> and/or <code>geom_label()</code></li>
</ul>
<p>Of these, we have already seen examples of <code>geom_point</code>, <code>geom_boxplot</code>
and <code>geom_tile</code>. Let us discuss some other geoms in a bit detail.</p>
<div id="univariate-bar-charts-through-geom_bar" class="section level3" number="13.4.1">
<h3><span class="header-section-number">13.4.1</span> Univariate Bar Charts through <code>geom_bar()</code></h3>
<p>Bar charts though form simplest of the visualisations but can be
deceptive if we try to build these without understanding the mechanics
behind the bars, literally :). Bar charts can both be univariate and
bivariate. Even multivariate data can be visualised through bar charts.</p>
<p>Simplest of bar charts can be a plot showing distribution of a
categorical variable in the data. In other words, the number of data
points available per category of the variable. Example - How many cars
with different cylinder count are available in the data.</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb783-1"><a href="#cb783-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(cyl)) <span class="sc">+</span></span>
<span id="cb783-2"><a href="#cb783-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg17-1.png" alt="Univariate Bar Chart" width="672" />
<p class="caption">
(#fig:rgg17)Univariate Bar Chart
</p>
</div>
<p>In figure @ref(fig:rgg17) we may see the numbers of cars available per
category (of cylinders therein). As we have used numerical variable on
the x-axis, a numerical scale has been shown. Also notice that our data
was not summarised and ggplot2 itself aggregated it on the basis of
variable passed in aesthetics (position) by applying <code>count</code> summary
function. This can be confirmed from the label on <code>y</code> axis.</p>
<p>Readers are advised to note the change in x-axis as soon as the variable
is converted to a categorical variable, by executing the code-</p>
<pre><code>ggplot(mtcars, aes(as.factor(cyl))) +
  geom_bar()</code></pre>
<p>That was about aggregating data by itself in bar-plot using <code>count</code>
function. But sometimes, other aggregation methods may be required. That
can be done if we understand the mechanics behind the code. Actually
<code>aes(cyl)</code> was a shortcut to <code>aes(x = cyl, y = after_stat(count))</code> where
<code>count</code> is a special variable representing the counts in each of the
category present in the variable.</p>
<p>So now, let us calculate proportions instead of count (frequency) of the
categories available in the variable. For a change, now let us use
another dataset <code>mpg</code> which comes by default with <code>ggplot2</code> package. We
will analyse proportion of vehicles under each <code>class</code> (which is a
categorical variable).</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb785-1"><a href="#cb785-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(class, <span class="at">y =</span> <span class="fu">after_stat</span>(count<span class="sc">/</span><span class="fu">sum</span>(count)))) <span class="sc">+</span></span>
<span id="cb785-2"><a href="#cb785-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg18-1.png" alt="Univariate Bar Chart representing proportions" width="672" />
<p class="caption">
(#fig:rgg18)Univariate Bar Chart representing proportions
</p>
</div>
<p>In figure @ref(fig:rgg18) we may see that now the proportions have been
plotted (notice y axis).</p>
</div>
<div id="bivariate-bar-charts-through-geom_bar" class="section level3" number="13.4.2">
<h3><span class="header-section-number">13.4.2</span> Bivariate Bar Charts through <code>geom_bar()</code></h3>
<p>We have learn how the <code>geom_bar()</code> carries out a summarisation on
un-aggregated or granular data and draws plots for us. To tweak the
summary function, as per our requirement, we used <code>y</code> position
aesthetic. But in same granular data, we may sometimes require to
perform an aggregation on another variable.</p>
<p>As an example let us see the mean city mileage <code>cty</code> for every <code>class</code>
of car in <code>mpg</code> data-set. To achieve this, we will another aesthetics
<code>stat</code> with special value <code>"summary_bin"</code>. Moreover, the <code>stat</code>
aesthetics also requires a <code>fun</code> statistic which is <code>mean</code> in our case.</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="#cb786-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">y =</span> cty)) <span class="sc">+</span> </span>
<span id="cb786-2"><a href="#cb786-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;summary_bin&quot;</span>, <span class="at">fun =</span> mean)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg19-1.png" alt="Bivariate Bar Chart representing mean milaege per class of car" width="672" />
<p class="caption">
(#fig:rgg19)Bivariate Bar Chart representing mean milaege per class of car
</p>
</div>
<p>In figure @ref(fig:rgg19) we can see that <code>subcompact</code> class of cars
has highest mean mileage in city.</p>
<p>In these two sections, we have learnt to draw plots using un-aggregated
data. However, we can also plot pre-aggregated data to bar-plots using
<code>geom_bar</code>. So let us draw the same plot as in figure @ref(fig:rgg19),
but this time aggregating data by ourselves, beforehand. The trick is to
use <code>stat = "identity"</code> aesthetics in a <code>geom_bar()</code> layer. We will see
what this aesthetic is doing actually in a short-while. For a change,
this time let’s draw the plot with x and y axes flipped.</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb787-1"><a href="#cb787-1" tabindex="-1"></a>aggregated_mpg <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb787-2"><a href="#cb787-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_cty =</span> <span class="fu">mean</span>(cty),</span>
<span id="cb787-3"><a href="#cb787-3" tabindex="-1"></a>            <span class="at">.by =</span> class) </span>
<span id="cb787-4"><a href="#cb787-4" tabindex="-1"></a></span>
<span id="cb787-5"><a href="#cb787-5" tabindex="-1"></a><span class="fu">ggplot</span>(aggregated_mpg, <span class="fu">aes</span>(<span class="at">x =</span> mean_cty, <span class="at">y =</span> class)) <span class="sc">+</span></span>
<span id="cb787-6"><a href="#cb787-6" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg20-1.png" alt="Bivariate Bar Chart representing mean milaege per class of car" width="672" />
<p class="caption">
(#fig:rgg20)Bivariate Bar Chart representing mean milaege per class of car
</p>
</div>
<p>In figure @ref(fig:rgg20) we can see the desired have been generated.
Readers may try the above-mentioned code by removing <code>stat - "identity"</code>
from the <code>geom_bar()</code>.</p>
<p>Now, as promised we will discuss what <code>stat</code> aesthetic does. While
generating summary in a bivariate chart we used <code>stat = "summary_bin"</code>
which created summary using <code>fun</code> of un-aggregated data. Whereas
<code>stat = "identity"</code> tells ggplot2 that data is either already aggregated
or there is only value of <code>y</code> per category of <code>x</code> variable. So are there
other <code>stat</code> aesthetics available for us? The answer is yes. However,
readers are advised to plot bar charts on aggregated data using
<code>geom_col</code> which has been discussed in subsequent sections, instead of
trying the complex aggregations within ggplot2 as it gets trickier from
here.</p>
</div>
<div id="stacked-bar-charts-through-geom_bar" class="section level3" number="13.4.3">
<h3><span class="header-section-number">13.4.3</span> Stacked bar charts through <code>geom_bar</code></h3>
<p>In section @ref(AESTH), we learnt that we can plot other variables in
the two-dimensional plots using aesthetic attributes like color, size,
etc. As size of the bar, in a bar chart is already mapped to a variable,
most suitable aesthetic to be mapped to another variable is <code>fill</code> or
<code>color</code>.</p>
<p>Let us aggregate the cars (count) on the basis of <code>class</code> again. But
let’s map <code>fill</code> to fuel type <code>fl</code> variable.</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="#cb788-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">fill =</span> fl)) <span class="sc">+</span></span>
<span id="cb788-2"><a href="#cb788-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg24-1.png" alt="Color Stacked bar chart" width="672" />
<p class="caption">
(#fig:rgg24)Color Stacked bar chart
</p>
</div>
<p>In figure @ref(fig:rgg24) we achieved our desired results simply by
mapping <code>fill</code> to our additional variable. Actually, this was possible
due to default value of <code>position</code> aesthetic in <code>geom_bar()</code> layer
<code>"stack"</code> matches our requirement. By default, multiple bars occupying
the same x position will be stacked atop one another by
<code>position_stack()</code>.</p>
<p>A useful argument <code>reverse</code> in this <code>position_stack()</code> is also helpful
in reversing the order of <code>fill</code> values. E.g. if the above plot is drawn
at y-axis instead.</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="#cb789-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">y =</span> class, <span class="at">fill =</span> fl)) <span class="sc">+</span></span>
<span id="cb789-2"><a href="#cb789-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb789-3"><a href="#cb789-3" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg25-1.png" alt="Color Stacked bar chart on Y axis" width="672" />
<p class="caption">
(#fig:rgg25)Color Stacked bar chart on Y axis
</p>
</div>
<p>In figure @ref(fig:rgg25) we can see that legend values now align with
the values represented in bar chart.</p>
<p>To use the bars, side by side, in a plot we can use another position
stat function <code>position_dodge()</code>. Redrawing the same plot above with
bars side by side-</p>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb790-1"><a href="#cb790-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">fill =</span> fl)) <span class="sc">+</span></span>
<span id="cb790-2"><a href="#cb790-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb790-3"><a href="#cb790-3" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg26-1.png" alt="Dodged Bar Chart" width="672" />
<p class="caption">
(#fig:rgg26)Dodged Bar Chart
</p>
</div>
<p>In figure @ref(fig:rgg26) we may see that separate bar for each fill
axis have now been drawn. The bars’ widths have been preserved as the
default parameter for <code>preserve</code> inside <code>position_dodge()</code> is <code>total</code>.
We may have to change it to <code>"single"</code> if we want bars of equal width
irrespective of the fact that whether each fill category is available
for each of the <code>x</code> value. Refer figure @ref(fig:rgg27) wherein bars’
widths are equal.</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="#cb791-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">fill =</span> fl)) <span class="sc">+</span></span>
<span id="cb791-2"><a href="#cb791-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>)) <span class="sc">+</span></span>
<span id="cb791-3"><a href="#cb791-3" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg27-1.png" alt="Dodged Bar Chart with equal bar widths" width="672" />
<p class="caption">
(#fig:rgg27)Dodged Bar Chart with equal bar widths
</p>
</div>
<p>Similar to <code>position_dodge</code> there is another <code>position_dodge2()</code>
function which works better for bar charts. We may tweak the padding
between bars (Refer figure @ref(fig:rgg28)).</p>
<div class="sourceCode" id="cb792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb792-1"><a href="#cb792-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">fill =</span> fl)) <span class="sc">+</span></span>
<span id="cb792-2"><a href="#cb792-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>, <span class="at">padding =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb792-3"><a href="#cb792-3" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg28-1.png" alt="Dodged Bar Chart with padding between bars" width="672" />
<p class="caption">
(#fig:rgg28)Dodged Bar Chart with padding between bars
</p>
</div>
<p>Finally, there is one more position namely <code>position_fill()</code> which
stacks bars and standardises each stack to have constant height. Refer
figure @ref(fig:rgg29).</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="#cb793-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">fill =</span> fl)) <span class="sc">+</span></span>
<span id="cb793-2"><a href="#cb793-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_fill</span>()) <span class="sc">+</span></span>
<span id="cb793-3"><a href="#cb793-3" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg29-1.png" alt="100% stacked bar chart" width="672" />
<p class="caption">
(#fig:rgg29)100% stacked bar chart
</p>
</div>
</div>
<div id="bar-charts-through-geom_col" class="section level3" number="13.4.4">
<h3><span class="header-section-number">13.4.4</span> Bar Charts through <code>geom_col()</code></h3>
<p>As stated earlier, plotting bar charts on tedious aggregations through
ggplot2 gets trickier, it is always advisable to plot bar charts through
<code>geom_col()</code> in such cases after aggregating thee data ourselves. Since
the difference between <code>geom_bar</code> and <code>geom_col</code> is that former uses by
default: it counts the number of cases at each x position. On the other
hand, latter uses <code>stat = “identity”</code> by default. So to draw the plot as
in figure @ref(fig:rgg20) through <code>geom_col()</code> we may not have to use
<code>stat</code> explicitly. (Refer figure @ref(fig:rgg30).)</p>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb794-1"><a href="#cb794-1" tabindex="-1"></a>aggregated_mpg <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb794-2"><a href="#cb794-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_cty =</span> <span class="fu">mean</span>(cty),</span>
<span id="cb794-3"><a href="#cb794-3" tabindex="-1"></a>            <span class="at">.by =</span> class) </span>
<span id="cb794-4"><a href="#cb794-4" tabindex="-1"></a></span>
<span id="cb794-5"><a href="#cb794-5" tabindex="-1"></a><span class="fu">ggplot</span>(aggregated_mpg, <span class="fu">aes</span>(<span class="at">x =</span> mean_cty, <span class="at">y =</span> class)) <span class="sc">+</span></span>
<span id="cb794-6"><a href="#cb794-6" tabindex="-1"></a>  <span class="fu">geom_col</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg30-1.png" alt="Plotting through geom col" width="672" />
<p class="caption">
(#fig:rgg30)Plotting through geom col
</p>
</div>
<p>Once the readers have understood the functioning of <code>position</code> and
<code>stat</code> arguments in <code>geom_bar</code> it is now pretty easy to draw stacked bar
charts, dodged bar charts and 100 percent stacked bar charts through
geom_col in a much easier way. Readers may try themselves drawing these
charts using pre-aggregated data keeping in mind that <code>geom_col</code> is
using <code>stat = “identity”</code> by default and is thus not performing any
aggregation.</p>
</div>
<div id="adding-labels-to-charts-using-geom_text-or-geom_label" class="section level3" number="13.4.5">
<h3><span class="header-section-number">13.4.5</span> Adding labels to charts using <code>geom_text</code> or <code>geom_label</code></h3>
<p>Before laerning how to draw other plots using <code>geom_*</code> family of
functions, it is the right time to learn labelling the geometries in the
plots.</p>
<p>To label data points in ggplot2, we can use either of the functions (i)
<code>geom_text()</code>; (ii)<code>geom_label()</code>. <code>geom_text()</code> adds only text to the
plot; whereas <code>geom_label()</code> draws a rectangle behind the text, making
it easier to read.</p>
<p>These functions adds text provided through <code>label</code> aesthetics, to the
plot at the specified <code>x</code> and <code>y</code> coordinates. Moreover, we can
customize the appearance of the labels by adding additional arguments to
<code>geom_text()</code> -</p>
<ul>
<li><code>size</code> to set font size</li>
<li><code>color</code> to color the fonts</li>
<li><code>hjust</code> or <code>vjust</code> to adjust the labels vertically or horizontally,
respectively. We can modify text alignment with these aesthetics.
These can either be a number between <code>0</code> (right/bottom) and <code>1</code>
(top/left) or a character (<code>"left"</code>, <code>"middle"</code>, <code>"right"</code>,
<code>"bottom"</code>, <code>"center"</code>, <code>"top"</code>). There are two special alignments:
<code>"inward"</code> and <code>"outward"</code>. Inward always aligns text towards the
center, and outward aligns it away from the center.</li>
<li><code>family</code> for font family [the options are <code>“sans”</code> (the default),
<code>“serif”</code>, or <code>“mono”</code>]</li>
<li><code>fontface</code> for face of the font [options: <code>“plain”</code> (the default),
<code>“bold”</code>, <code>"italic"</code> or <code>“bold.italic”</code>]</li>
</ul>
<p>Example-</p>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="#cb795-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> hp, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb795-2"><a href="#cb795-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb795-3"><a href="#cb795-3" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">rownames</span>(mtcars)),</span>
<span id="cb795-4"><a href="#cb795-4" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb795-5"><a href="#cb795-5" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;dodgerblue&quot;</span>,</span>
<span id="cb795-6"><a href="#cb795-6" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="co"># -1 pushes he value further upwards (vjust)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg31-1.png" alt="Adding labels to geoms" width="672" />
<p class="caption">
(#fig:rgg31)Adding labels to geoms
</p>
</div>
<p>In figure @ref(fig:rgg31) we can see the geometries (i.e points) have
been labelled slighly above the points (due to <code>vjust = -1</code>). We may
observe that some labels are overlapped. There is a fantastic package
<code>ggrepel</code> which works for <code>ggplot2</code> plots and places the overlapped
labels in a nicer way. See figure @ref(fig:rgg32).</p>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb796-1"><a href="#cb796-1" tabindex="-1"></a><span class="co"># Load package</span></span>
<span id="cb796-2"><a href="#cb796-2" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb796-3"><a href="#cb796-3" tabindex="-1"></a><span class="co"># Set global options for max overlaps</span></span>
<span id="cb796-4"><a href="#cb796-4" tabindex="-1"></a><span class="fu">options</span>(<span class="at">ggrepel.max.overlaps =</span> <span class="cn">Inf</span>)</span>
<span id="cb796-5"><a href="#cb796-5" tabindex="-1"></a></span>
<span id="cb796-6"><a href="#cb796-6" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> hp, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb796-7"><a href="#cb796-7" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb796-8"><a href="#cb796-8" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">rownames</span>(mtcars)),</span>
<span id="cb796-9"><a href="#cb796-9" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb796-10"><a href="#cb796-10" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;seagreen&quot;</span>,</span>
<span id="cb796-11"><a href="#cb796-11" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb796-12"><a href="#cb796-12" tabindex="-1"></a>            <span class="at">fontface =</span> <span class="st">&quot;bold.italic&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg32-1.png" alt="Adding labels to geoms through external ggrepel package" width="672" />
<p class="caption">
(#fig:rgg32)Adding labels to geoms through external ggrepel package
</p>
</div>
<p>labelling bar charts generated through granular data using <code>geom_bar()</code>
may be sometimes tricky as we have to use <code>stat</code> functions used to
generate summary/aggregation. See Example in figure @ref(fig:rgg35)</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="#cb797-1" tabindex="-1"></a><span class="co"># Labelling a bar plot</span></span>
<span id="cb797-2"><a href="#cb797-2" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(class)) <span class="sc">+</span></span>
<span id="cb797-3"><a href="#cb797-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb797-4"><a href="#cb797-4" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb797-5"><a href="#cb797-5" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb797-6"><a href="#cb797-6" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">after_stat</span>(count <span class="sc">+</span> <span class="dv">2</span>), <span class="co"># shift the label slightly</span></span>
<span id="cb797-7"><a href="#cb797-7" tabindex="-1"></a>      <span class="at">label =</span> <span class="fu">after_stat</span>(count)</span>
<span id="cb797-8"><a href="#cb797-8" tabindex="-1"></a>    ),</span>
<span id="cb797-9"><a href="#cb797-9" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span></span>
<span id="cb797-10"><a href="#cb797-10" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg35-1.png" alt="Labelled bar chart" width="672" />
<p class="caption">
(#fig:rgg35)Labelled bar chart
</p>
</div>
<p>If we want to label chart in @ref(fig:rgg19), we have to provide some
special values aesthetics to <code>geom_text</code> (or <code>geom_label</code>). See figure
@ref(fig:rgg33).</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="#cb798-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(class, cty)) <span class="sc">+</span></span>
<span id="cb798-2"><a href="#cb798-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;summary_bin&quot;</span>, <span class="at">fun =</span> mean) <span class="sc">+</span></span>
<span id="cb798-3"><a href="#cb798-3" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb798-4"><a href="#cb798-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(<span class="fu">round</span>(y, <span class="dv">2</span>))),</span>
<span id="cb798-5"><a href="#cb798-5" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;summary_bin&quot;</span>,</span>
<span id="cb798-6"><a href="#cb798-6" tabindex="-1"></a>    <span class="at">fun =</span> mean,</span>
<span id="cb798-7"><a href="#cb798-7" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb798-8"><a href="#cb798-8" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg33-1.png" alt="Bivariate bar chart labelled" width="672" />
<p class="caption">
(#fig:rgg33)Bivariate bar chart labelled
</p>
</div>
<p>One more example of labelling boxplots with maximum value for each
category may be -</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="#cb799-1" tabindex="-1"></a><span class="co"># Labelling the upper hinge of a boxplot,</span></span>
<span id="cb799-2"><a href="#cb799-2" tabindex="-1"></a><span class="co"># inspired by June Choe</span></span>
<span id="cb799-3"><a href="#cb799-3" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, class)) <span class="sc">+</span></span>
<span id="cb799-4"><a href="#cb799-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb799-5"><a href="#cb799-5" tabindex="-1"></a>  <span class="fu">geom_label</span>(</span>
<span id="cb799-6"><a href="#cb799-6" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb799-7"><a href="#cb799-7" tabindex="-1"></a>      <span class="at">label =</span> <span class="fu">after_stat</span>(xmax),</span>
<span id="cb799-8"><a href="#cb799-8" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">stage</span>(displ, <span class="at">after_stat =</span> xmax)</span>
<span id="cb799-9"><a href="#cb799-9" tabindex="-1"></a>    ),</span>
<span id="cb799-10"><a href="#cb799-10" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;boxplot&quot;</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb799-11"><a href="#cb799-11" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg34-1.png" alt="Upper Hinge labelled in Boxplot" width="672" />
<p class="caption">
(#fig:rgg34)Upper Hinge labelled in Boxplot
</p>
</div>
<p>Labeling color stacked bar charts can also get trickier, as we have to
provide appropriate position argument to <code>geom_text</code> layer also. See
example in figure @ref(fig:rgg36).</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb800-1"><a href="#cb800-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(class, <span class="at">fill =</span> fl)) <span class="sc">+</span></span>
<span id="cb800-2"><a href="#cb800-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb800-3"><a href="#cb800-3" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb800-4"><a href="#cb800-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(count)),</span>
<span id="cb800-5"><a href="#cb800-5" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>,</span>
<span id="cb800-6"><a href="#cb800-6" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb800-7"><a href="#cb800-7" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg36-1.png" alt="Colored bar chart labelled" width="672" />
<p class="caption">
(#fig:rgg36)Colored bar chart labelled
</p>
</div>
<p>As we have discussed the difference between <code>geom_bar</code> and <code>geom_col</code> in
details, readers may find it pretty easier to draw the above chart
(Figure @ref(fig:rgg36)) using <code>geom_col</code> on pre-aggregated data. Refer
figure @ref(fig:rgg37) wherein we have to only handle the placements of
labels through <code>position_stack</code> argument.</p>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb801-1"><a href="#cb801-1" tabindex="-1"></a>mpg_agg <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb801-2"><a href="#cb801-2" tabindex="-1"></a>  <span class="fu">count</span>(class, fl)</span>
<span id="cb801-3"><a href="#cb801-3" tabindex="-1"></a></span>
<span id="cb801-4"><a href="#cb801-4" tabindex="-1"></a><span class="fu">ggplot</span>(mpg_agg, <span class="fu">aes</span>(</span>
<span id="cb801-5"><a href="#cb801-5" tabindex="-1"></a>  <span class="at">x =</span> class,</span>
<span id="cb801-6"><a href="#cb801-6" tabindex="-1"></a>  <span class="at">y =</span> n,</span>
<span id="cb801-7"><a href="#cb801-7" tabindex="-1"></a>  <span class="at">fill =</span> fl,</span>
<span id="cb801-8"><a href="#cb801-8" tabindex="-1"></a>  <span class="at">label =</span> n <span class="co"># provided globally</span></span>
<span id="cb801-9"><a href="#cb801-9" tabindex="-1"></a>)) <span class="sc">+</span></span>
<span id="cb801-10"><a href="#cb801-10" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb801-11"><a href="#cb801-11" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb801-12"><a href="#cb801-12" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>) <span class="co">#labels centered vertically</span></span>
<span id="cb801-13"><a href="#cb801-13" tabindex="-1"></a>    )</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg37-1.png" alt="Colored bar chart labelled" width="672" />
<p class="caption">
(#fig:rgg37)Colored bar chart labelled
</p>
</div>
</div>
<div id="histograms-and-related-plots" class="section level3" number="13.4.6">
<h3><span class="header-section-number">13.4.6</span> Histograms and related plots</h3>
<p>Readers by now, mayhave understood why ggplot2 is such a vast topic that
often it requires separate book. Full coverage in a single chapter is
nearly impossible. However, there are several other geoms which are not
as trickier as <code>geom_bar</code> and simultaneously useful while analysing the
data. One of those is <code>geom_histogram</code> which plots histogram for a
univariate numerical (continuous variable) data.</p>
<p>Like <code>geom_bar</code> it also aggregates the data itself using default
statistic <code>stat = "bin"</code>. For a change let us now use <code>diamonds</code>
data-set, which is also loaded by default with ggplot2 package. It
contains over 50,000 observations for round-cut diamonds. As an example
let us visualise the distribution of <code>carat</code> variable.</p>
<div class="sourceCode" id="cb802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="#cb802-1" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat)) <span class="sc">+</span></span>
<span id="cb802-2"><a href="#cb802-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg38-1.png" alt="A simple histogram" width="672" />
<p class="caption">
(#fig:rgg38)A simple histogram
</p>
</div>
<p>In figure @ref(fig:rgg38) a histogram has been generated with a warning
to pick better value for bin-width. So let us modify the bin-width to
say, 0.025.</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="#cb804-1" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat)) <span class="sc">+</span></span>
<span id="cb804-2"><a href="#cb804-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.025</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg21-1.png" alt="Histogram with custom binwidth" width="672" />
<p class="caption">
(#fig:rgg21)Histogram with custom binwidth
</p>
</div>
<p>We may use <code>bins</code> aesthetic to choose the number of bins in histogram.
Other aestheics like <code>fill</code> or <code>color</code> may also be used.</p>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb805-1"><a href="#cb805-1" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(price, <span class="at">fill =</span> cut)) <span class="sc">+</span></span>
<span id="cb805-2"><a href="#cb805-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">500</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg39-1.png" alt="Filled Histogram" width="672" />
<p class="caption">
(#fig:rgg39)Filled Histogram
</p>
</div>
<p>Related geom is <code>geom_freqpoly</code> (short for frequency polygon) which
display the counts with lines. So histogram in figure @ref(fig:rgg39)
may be drawn as frequency polygon usingthis geom layer. Refer figure
@ref(fig:rgg40).</p>
<div class="sourceCode" id="cb806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="#cb806-1" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(price, <span class="at">color =</span> cut)) <span class="sc">+</span></span>
<span id="cb806-2"><a href="#cb806-2" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">500</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg40-1.png" alt="Filled frequency polygon" width="672" />
<p class="caption">
(#fig:rgg40)Filled frequency polygon
</p>
</div>
<p>To make it easier to compare distributions with very different counts,
we may put <code>density</code> on the <code>y</code> axis instead of the default count. Refer
figure @ref(fig:rgg41).</p>
<div class="sourceCode" id="cb807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb807-1"><a href="#cb807-1" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(price, <span class="fu">after_stat</span>(density), <span class="at">colour =</span> cut)) <span class="sc">+</span></span>
<span id="cb807-2"><a href="#cb807-2" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">500</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg41-1.png" alt="Filled frequency polygon with density" width="672" />
<p class="caption">
(#fig:rgg41)Filled frequency polygon with density
</p>
</div>
</div>
<div id="line-charts" class="section level3" number="13.4.7">
<h3><span class="header-section-number">13.4.7</span> Line Charts</h3>
<p>Since almost all geoms in ggplot2 have been named intuitively, we can
have a correct guess that line charts canbe drawn using <code>geom_line()</code>.
However, unlike geoms we have seen till now, <code>geom_line()</code> is a special
geom and works correctly in groups. It is thus sometimes referred to as
grouped or collective geom.</p>
<p>To understand the concept of group, let us construct a simple data,
having an index variable (for x axis), another numerical variable
<code>values</code> and also having a categorical variable say <code>gr</code>. Let us plot
<code>values</code> vs. <code>index</code> on a line plot.</p>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="#cb808-1" tabindex="-1"></a><span class="co"># Constructing example data</span></span>
<span id="cb808-2"><a href="#cb808-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb808-3"><a href="#cb808-3" tabindex="-1"></a>exdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb808-4"><a href="#cb808-4" tabindex="-1"></a>  <span class="at">gr =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;G1&quot;</span>, <span class="st">&quot;G2&quot;</span>), <span class="dv">5</span>),</span>
<span id="cb808-5"><a href="#cb808-5" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb808-6"><a href="#cb808-6" tabindex="-1"></a>  <span class="at">values =</span> <span class="fu">sample</span>(<span class="dv">100</span><span class="sc">:</span><span class="dv">200</span>, <span class="dv">10</span>)</span>
<span id="cb808-7"><a href="#cb808-7" tabindex="-1"></a>)</span>
<span id="cb808-8"><a href="#cb808-8" tabindex="-1"></a><span class="co"># print the data</span></span>
<span id="cb808-9"><a href="#cb808-9" tabindex="-1"></a>exdata</span></code></pre></div>
<pre><code>##    gr index values
## 1  G1     1    108
## 2  G2     1    173
## 3  G1     2    175
## 4  G2     2    154
## 5  G1     3    171
## 6  G2     3    153
## 7  G1     4    138
## 8  G2     4    182
## 9  G1     5    187
## 10 G2     5    114</code></pre>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb810-1"><a href="#cb810-1" tabindex="-1"></a><span class="co"># Line chart</span></span>
<span id="cb810-2"><a href="#cb810-2" tabindex="-1"></a><span class="fu">ggplot</span>(exdata, <span class="fu">aes</span>(index, values)) <span class="sc">+</span></span>
<span id="cb810-3"><a href="#cb810-3" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg42-1.png" alt="A simple line chart" width="672" />
<p class="caption">
(#fig:rgg42)A simple line chart
</p>
</div>
<p>In figure @ref(fig:rgg42), we can see that values have been plotted but
for each index these have been joined first then moving onto another
index. This inadvertant thing can be fixed by use of aesthetic <code>group</code>.
The group aesthetic determines which observations are connected. See
figure @ref(fig:rgg43).</p>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="#cb811-1" tabindex="-1"></a><span class="fu">ggplot</span>(exdata, <span class="fu">aes</span>(index, values, <span class="at">group =</span> gr)) <span class="sc">+</span></span>
<span id="cb811-2"><a href="#cb811-2" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg43-1.png" alt="A line chart without legend" width="672" />
<p class="caption">
(#fig:rgg43)A line chart without legend
</p>
</div>
<p>In figure @ref(fig:rgg43), we got two different lines for each as
intended, but corresponding legend to identify the group is not there.
So, if we map <code>color</code> aesthetic with our group variable we can get the
legend. Moreover, mapping this aesthetic may have over-riding effect (in
this case) on <code>group</code> aesthetic, so this aesthetic will be kind of
redundant. Refer plot in figure @ref(fig:rgg44).</p>
<div class="sourceCode" id="cb812"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb812-1"><a href="#cb812-1" tabindex="-1"></a><span class="fu">ggplot</span>(exdata, <span class="fu">aes</span>(index, values, <span class="at">color =</span> gr)) <span class="sc">+</span></span>
<span id="cb812-2"><a href="#cb812-2" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg44-1.png" alt="A line chart with legend" width="672" />
<p class="caption">
(#fig:rgg44)A line chart with legend
</p>
</div>
<p>If a group isn’t defined by a single variable, but instead by a
combination of multiple variables, we may use <code>interaction()</code> to combine
them.</p>
<p>Now we will use two data-sets (i) <code>economics</code> and <code>economics_long</code>; both
of which are part of <code>tidyr</code> package. Readers using <code>ggplot2</code> library
only are thus, advised to load the package <code>tidyr</code> (or alternatively
<code>tidyverse</code> which contains both of these packages). These data-sets
contains some economic parameters, on a monthly basis from US.</p>
<p>In figure @ref(fig:rgg46), separate lines for each variable and for
each of the months across the years have been plotted.</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="#cb813-1" tabindex="-1"></a>economics_long <span class="sc">|&gt;</span> </span>
<span id="cb813-2"><a href="#cb813-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb813-3"><a href="#cb813-3" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">month</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb813-4"><a href="#cb813-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, value01, <span class="at">group =</span> <span class="fu">interaction</span>(month, variable))) <span class="sc">+</span></span>
<span id="cb813-5"><a href="#cb813-5" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg45-1.png" alt="Groups in multiple variables" width="672" />
<p class="caption">
(#fig:rgg45)Groups in multiple variables
</p>
</div>
<p>There is another related geom i.e. <code>geom_path()</code> which also draws a line
chart. While <code>geom_line()</code> connects points from left to right;
<code>geom_path()</code> connects points in the order they appear in the data. In
figure @ref(fig:rgg46) the <code>exdata</code> we created earlier has been
re-arranged to show the difference. Both <code>geom_line()</code> and <code>geom_path()</code>
also understand the aesthetic <code>linetype</code>, which maps a categorical
variable to <code>'solid'</code> (default), <code>'dotted'</code> , <code>'dashed'</code> and <code>'dotdash'</code>
lines.</p>
<div class="sourceCode" id="cb814"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb814-1"><a href="#cb814-1" tabindex="-1"></a>exdata <span class="sc">|&gt;</span></span>
<span id="cb814-2"><a href="#cb814-2" tabindex="-1"></a>  <span class="co"># Rearranging the data points</span></span>
<span id="cb814-3"><a href="#cb814-3" tabindex="-1"></a>  <span class="fu">arrange</span>(values) <span class="sc">|&gt;</span></span>
<span id="cb814-4"><a href="#cb814-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(index, values)) <span class="sc">+</span></span>
<span id="cb814-5"><a href="#cb814-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="st">&quot;dotdash&quot;</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb814-6"><a href="#cb814-6" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Using line geom&quot;</span>)</span>
<span id="cb814-7"><a href="#cb814-7" tabindex="-1"></a></span>
<span id="cb814-8"><a href="#cb814-8" tabindex="-1"></a>exdata <span class="sc">|&gt;</span></span>
<span id="cb814-9"><a href="#cb814-9" tabindex="-1"></a>  <span class="co"># Rearranging the data points</span></span>
<span id="cb814-10"><a href="#cb814-10" tabindex="-1"></a>  <span class="fu">arrange</span>(values) <span class="sc">|&gt;</span></span>
<span id="cb814-11"><a href="#cb814-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(index, values)) <span class="sc">+</span></span>
<span id="cb814-12"><a href="#cb814-12" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb814-13"><a href="#cb814-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Using path geom&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg46-1.png" alt="Path vs Line geoms" width="49%" /><img src="DauR_files/figure-html/rgg46-2.png" alt="Path vs Line geoms" width="49%" />
<p class="caption">
(#fig:rgg46)Path vs Line geoms
</p>
</div>
</div>
<div id="smoothing-through-geom_smooth" class="section level3" number="13.4.8">
<h3><span class="header-section-number">13.4.8</span> Smoothing through <code>geom_smooth</code></h3>
<p>Essentially, <code>geom_smooth()</code> adds a trend line over an existing plot, be
it a scatter plot or line plot. For e.g. if we draw the trend of
unemployment in US, we can use <code>geom_smooth</code> to see smoothed trend over
the period. Refer plot in figure @ref(fig:rgg48).</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="#cb815-1" tabindex="-1"></a><span class="fu">ggplot</span>(economics, <span class="fu">aes</span>(date, unemploy)) <span class="sc">+</span></span>
<span id="cb815-2"><a href="#cb815-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;indianred4&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb815-3"><a href="#cb815-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula = &#39;y ~ x&#39;</code></pre>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg48-1.png" alt="Line Chart with smoothed trend" width="672" />
<p class="caption">
(#fig:rgg48)Line Chart with smoothed trend
</p>
</div>
<p>A warning shows that <code>method</code> argument used to smooth the curve is
<code>loess</code>. The other methods available are <code>lm</code>, <code>glm</code> , <code>gam</code> etc. These
require <code>formula</code> to be provided. We may also smooth a scatter plot
using this function, to see a regression (linear) line. Refer plot in
figure @ref(fig:rgg49).</p>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb817-1"><a href="#cb817-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(cty, hwy)) <span class="sc">+</span></span>
<span id="cb817-2"><a href="#cb817-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb817-3"><a href="#cb817-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">formula =</span> <span class="st">&quot;y ~ x&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg49-1.png" alt="Scatter plot with regression line" width="672" />
<p class="caption">
(#fig:rgg49)Scatter plot with regression line
</p>
</div>
<p>Readers may note, in figure @ref(fig:rgg49) that there much lesser
points seen in this plot than actually available due to overlapping of
points. This overlapping issue can either be solved using <code>alpha</code>
aesthetic or by using <code>jitter</code> method in scatter plots. <code>geom_jitter</code>
adds a random noise to the data, so that the overlapping points are seen
clearly. Jittered scatterplot may be seen in @ref(fig:rgg47).</p>
<div class="sourceCode" id="cb818"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb818-1"><a href="#cb818-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(cty, hwy)) <span class="sc">+</span></span>
<span id="cb818-2"><a href="#cb818-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb818-3"><a href="#cb818-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">formula =</span> <span class="st">&quot;y ~ x&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg47-1.png" alt="Scatter plot with regression line" width="672" />
<p class="caption">
(#fig:rgg47)Scatter plot with regression line
</p>
</div>
</div>
<div id="combining-multiple-geoms" class="section level3" number="13.4.9">
<h3><span class="header-section-number">13.4.9</span> Combining multiple geoms</h3>
<p>We have already used multiple geoms in the same plot while labeling them
as well as while smoothing the trend. Multiple geoms can be used in same
plot, which will add further layers over the existing layers produced by
earlier geoms. As an example let us add data points in figure
@ref(fig:rgg42).</p>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb819-1"><a href="#cb819-1" tabindex="-1"></a><span class="fu">ggplot</span>(exdata, <span class="fu">aes</span>(index, values)) <span class="sc">+</span></span>
<span id="cb819-2"><a href="#cb819-2" tabindex="-1"></a>  <span class="co"># layer with line</span></span>
<span id="cb819-3"><a href="#cb819-3" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb819-4"><a href="#cb819-4" tabindex="-1"></a>  <span class="co"># layer with points</span></span>
<span id="cb819-5"><a href="#cb819-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">stroke =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg50-1.png" alt="Combining Geoms" width="672" />
<p class="caption">
(#fig:rgg50)Combining Geoms
</p>
</div>
<p>In figure @ref(fig:rgg50) we can see that points have been added over
the line. If we reverse the order, we can see in figure #ref(fig:rgg51)
that line (latter layer) is drawn over points (former layer).</p>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb820-1"><a href="#cb820-1" tabindex="-1"></a><span class="fu">ggplot</span>(exdata, <span class="fu">aes</span>(index, values))  <span class="sc">+</span></span>
<span id="cb820-2"><a href="#cb820-2" tabindex="-1"></a>  <span class="co"># layer with points</span></span>
<span id="cb820-3"><a href="#cb820-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">stroke =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb820-4"><a href="#cb820-4" tabindex="-1"></a>  <span class="co"># layer with line</span></span>
<span id="cb820-5"><a href="#cb820-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg51-1.png" alt="Understanding overlapping in geoms" width="672" />
<p class="caption">
(#fig:rgg51)Understanding overlapping in geoms
</p>
</div>
</div>
<div id="other-geoms" class="section level3" number="13.4.10">
<h3><span class="header-section-number">13.4.10</span> Other geoms</h3>
<p>Several other geoms which are useful to depict meaningful information in
afore-mentioned charts are-</p>
<ul>
<li><code>geom_vline()</code>, <code>geom_hline</code> or <code>geom_abline()</code> to add vertical,
horizontal or other reference lines in the plot.</li>
<li><code>geom_rect()</code> to draw a constant/reference rectangle in the data
using four corners of the rectangle, <code>xmin</code>, <code>ymin</code>, <code>xmax</code> and
<code>ymax</code>.</li>
<li><code>geom_area()</code> which draws an area plot, which is a line plot filled
to the y-axis (filled lines). Multiple groups will be stacked on top
of each other.</li>
</ul>
<p>Example</p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb821-1"><a href="#cb821-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb821-2"><a href="#cb821-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb821-3"><a href="#cb821-3" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">37</span>, <span class="at">slope =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb821-4"><a href="#cb821-4" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg52-1.png" alt="Adding reference lines" width="672" />
<p class="caption">
(#fig:rgg52)Adding reference lines
</p>
</div>
</div>
<div id="list-of-geoms-available-in-ggplot2" class="section level3" number="13.4.11">
<h3><span class="header-section-number">13.4.11</span> List of geoms available in <code>ggplot2</code></h3>
<p>Apart from the geoms discussed, there are many more geoms available in
ggplot2. Some of those have been discussed in subsequent
chapters/sections, as per the use case. However, readers may explore
themselves those geoms if they want to explore un<em>chart</em>ered
territories.</p>
<p>For reference, the geoms available in the ggplot2 version used to
compile the book, are listed in table @ref(tab:geoms) for reference.</p>
<table>
<caption>(#tab:geoms)List of Geoms available in ggplot2</caption>
<colgroup>
<col width="26%" />
<col width="73%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Entry</th>
<th align="left">Title</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">geom_abline</td>
<td align="left">Reference lines: horizontal, vertical, and diagonal</td>
</tr>
<tr class="even">
<td align="left">geom_hline</td>
<td align="left">Reference lines: horizontal, vertical, and diagonal</td>
</tr>
<tr class="odd">
<td align="left">geom_vline</td>
<td align="left">Reference lines: horizontal, vertical, and diagonal</td>
</tr>
<tr class="even">
<td align="left">geom_bar</td>
<td align="left">Bar charts</td>
</tr>
<tr class="odd">
<td align="left">geom_col</td>
<td align="left">Bar charts</td>
</tr>
<tr class="even">
<td align="left">geom_bin_2d</td>
<td align="left">Heatmap of 2d bin counts</td>
</tr>
<tr class="odd">
<td align="left">geom_bin2d</td>
<td align="left">Heatmap of 2d bin counts</td>
</tr>
<tr class="even">
<td align="left">geom_blank</td>
<td align="left">Draw nothing</td>
</tr>
<tr class="odd">
<td align="left">geom_boxplot</td>
<td align="left">A box and whiskers plot (in the style of Tukey)</td>
</tr>
<tr class="even">
<td align="left">geom_contour</td>
<td align="left">2D contours of a 3D surface</td>
</tr>
<tr class="odd">
<td align="left">geom_contour_filled</td>
<td align="left">2D contours of a 3D surface</td>
</tr>
<tr class="even">
<td align="left">geom_count</td>
<td align="left">Count overlapping points</td>
</tr>
<tr class="odd">
<td align="left">geom_density</td>
<td align="left">Smoothed density estimates</td>
</tr>
<tr class="even">
<td align="left">geom_density_2d</td>
<td align="left">Contours of a 2D density estimate</td>
</tr>
<tr class="odd">
<td align="left">geom_density2d</td>
<td align="left">Contours of a 2D density estimate</td>
</tr>
<tr class="even">
<td align="left">geom_density_2d_filled</td>
<td align="left">Contours of a 2D density estimate</td>
</tr>
<tr class="odd">
<td align="left">geom_density2d_filled</td>
<td align="left">Contours of a 2D density estimate</td>
</tr>
<tr class="even">
<td align="left">geom_dotplot</td>
<td align="left">Dot plot</td>
</tr>
<tr class="odd">
<td align="left">geom_errorbarh</td>
<td align="left">Horizontal error bars</td>
</tr>
<tr class="even">
<td align="left">geom_function</td>
<td align="left">Draw a function as a continuous curve</td>
</tr>
<tr class="odd">
<td align="left">geom_hex</td>
<td align="left">Hexagonal heatmap of 2d bin counts</td>
</tr>
<tr class="even">
<td align="left">geom_freqpoly</td>
<td align="left">Histograms and frequency polygons</td>
</tr>
<tr class="odd">
<td align="left">geom_histogram</td>
<td align="left">Histograms and frequency polygons</td>
</tr>
<tr class="even">
<td align="left">geom_jitter</td>
<td align="left">Jittered points</td>
</tr>
<tr class="odd">
<td align="left">geom_crossbar</td>
<td align="left">Vertical intervals: lines, crossbars &amp; errorbars</td>
</tr>
<tr class="even">
<td align="left">geom_errorbar</td>
<td align="left">Vertical intervals: lines, crossbars &amp; errorbars</td>
</tr>
<tr class="odd">
<td align="left">geom_linerange</td>
<td align="left">Vertical intervals: lines, crossbars &amp; errorbars</td>
</tr>
<tr class="even">
<td align="left">geom_pointrange</td>
<td align="left">Vertical intervals: lines, crossbars &amp; errorbars</td>
</tr>
<tr class="odd">
<td align="left">geom_map</td>
<td align="left">Polygons from a reference map</td>
</tr>
<tr class="even">
<td align="left">geom_path</td>
<td align="left">Connect observations</td>
</tr>
<tr class="odd">
<td align="left">geom_line</td>
<td align="left">Connect observations</td>
</tr>
<tr class="even">
<td align="left">geom_step</td>
<td align="left">Connect observations</td>
</tr>
<tr class="odd">
<td align="left">geom_point</td>
<td align="left">Points</td>
</tr>
<tr class="even">
<td align="left">geom_polygon</td>
<td align="left">Polygons</td>
</tr>
<tr class="odd">
<td align="left">geom_qq_line</td>
<td align="left">A quantile-quantile plot</td>
</tr>
<tr class="even">
<td align="left">geom_qq</td>
<td align="left">A quantile-quantile plot</td>
</tr>
<tr class="odd">
<td align="left">geom_quantile</td>
<td align="left">Quantile regression</td>
</tr>
<tr class="even">
<td align="left">geom_ribbon</td>
<td align="left">Ribbons and area plots</td>
</tr>
<tr class="odd">
<td align="left">geom_area</td>
<td align="left">Ribbons and area plots</td>
</tr>
<tr class="even">
<td align="left">geom_rug</td>
<td align="left">Rug plots in the margins</td>
</tr>
<tr class="odd">
<td align="left">geom_segment</td>
<td align="left">Line segments and curves</td>
</tr>
<tr class="even">
<td align="left">geom_curve</td>
<td align="left">Line segments and curves</td>
</tr>
<tr class="odd">
<td align="left">geom_smooth</td>
<td align="left">Smoothed conditional means</td>
</tr>
<tr class="even">
<td align="left">geom_spoke</td>
<td align="left">Line segments parameterised by location, direction and distance</td>
</tr>
<tr class="odd">
<td align="left">geom_label</td>
<td align="left">Text</td>
</tr>
<tr class="even">
<td align="left">geom_text</td>
<td align="left">Text</td>
</tr>
<tr class="odd">
<td align="left">geom_raster</td>
<td align="left">Rectangles</td>
</tr>
<tr class="even">
<td align="left">geom_rect</td>
<td align="left">Rectangles</td>
</tr>
<tr class="odd">
<td align="left">geom_tile</td>
<td align="left">Rectangles</td>
</tr>
<tr class="even">
<td align="left">geom_violin</td>
<td align="left">Violin plot</td>
</tr>
<tr class="odd">
<td align="left">geom_sf</td>
<td align="left">Visualise sf objects</td>
</tr>
<tr class="even">
<td align="left">geom_sf_label</td>
<td align="left">Visualise sf objects</td>
</tr>
<tr class="odd">
<td align="left">geom_sf_text</td>
<td align="left">Visualise sf objects</td>
</tr>
<tr class="even">
<td align="left">update_geom_defaults</td>
<td align="left">Modify geom/stat aesthetic defaults for future plots</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="modifying-scales" class="section level2" number="13.5">
<h2><span class="header-section-number">13.5</span> Modifying scales</h2>
<p>Scales in ggplot2 control the mapping from data to aesthetics so that
the data can be seen. In other words, these provide us a way to
customise aesthetics such as size, color, position, shape, etc.</p>
<p>In the charts we have generated so far, the aesthetic mappings with data
were default and we haven’t customised those default scales. We may
divide our customisation requirements of these scales into three broad
categories, which we will learn in this section.</p>
<ul>
<li>Modifying scales related to position aesthetics,</li>
<li>Modifying scale related to color (or fill) aesthetics,</li>
<li>Scales mapped to other aesthetics.</li>
</ul>
<div id="modifying-scales-mapped-to-position-aesthetics-i.e.-transforming-axes" class="section level3" number="13.5.1">
<h3><span class="header-section-number">13.5.1</span> Modifying scales mapped to position aesthetics i.e. transforming axes</h3>
<p>We have seen that default coordinate system used by ggplot2 is Cartesian
and to plot the data two position aesthetics <code>x</code> and <code>y</code> are required.
While drawing figure @ref(fig:rgg2) we provided these aesthetics
explicitly, whereas at the time of drawing bar chart in @ref(fig:rgg17)
we provided one <code>x</code> aesthetic and ggplot2 generated <code>y</code> aesthetic by
itself (remember <code>after_stat(count)</code>).</p>
<p>To customise position scales we have <code>scale_*_#()</code> group of functions,
where <code>*</code> represent position aesthetic usually <code>x</code> or <code>y</code>; and <code>#</code>
represents variable type. For example we have these two functions for
continuous axis/variables.</p>
<pre><code>scale_x_continuous(name, breaks, labels, limits, trans)
scale_y_continuous(name, breaks, labels, limits, trans)</code></pre>
<p>In arguments to above functions, we can see that axis title (name), axis
breaks, axis labels, axis limits, and transformations can be dealt with.
See the following examples wherein we have changed the limits of axes,
renamed them using <code>scale</code> functions (Refer @ref(fig:scale1)).</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb823-1"><a href="#cb823-1" tabindex="-1"></a><span class="co"># Basic Scatter Plot</span></span>
<span id="cb823-2"><a href="#cb823-2" tabindex="-1"></a><span class="fu">ggplot</span>(cars, <span class="fu">aes</span>(<span class="at">x =</span> speed, <span class="at">y =</span> dist)) <span class="sc">+</span> </span>
<span id="cb823-3"><a href="#cb823-3" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb823-4"><a href="#cb823-4" tabindex="-1"></a><span class="co"># Modifying scales both axis title and axis limits</span></span>
<span id="cb823-5"><a href="#cb823-5" tabindex="-1"></a><span class="fu">ggplot</span>(cars, <span class="fu">aes</span>(<span class="at">x =</span> speed, <span class="at">y =</span> dist)) <span class="sc">+</span> </span>
<span id="cb823-6"><a href="#cb823-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb823-7"><a href="#cb823-7" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name=</span><span class="st">&quot;Speed of cars&quot;</span>, <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb823-8"><a href="#cb823-8" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name=</span><span class="st">&quot;Stopping distance&quot;</span>, <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/scale1-1.png" alt="Modifying Scales in GGplot2" width="49%" /><img src="DauR_files/figure-html/scale1-2.png" alt="Modifying Scales in GGplot2" width="49%" />
<p class="caption">
(#fig:scale1)Modifying Scales in GGplot2
</p>
</div>
<p>We can also applying transformation on axes using <code>trans</code> argument
(refer figure @ref(fig:scale2)).</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="#cb824-1" tabindex="-1"></a><span class="fu">ggplot</span>(cars, <span class="fu">aes</span>(<span class="at">x =</span> speed, <span class="at">y =</span> dist)) <span class="sc">+</span> </span>
<span id="cb824-2"><a href="#cb824-2" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb824-3"><a href="#cb824-3" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">&#39;log10&#39;</span>) <span class="sc">+</span></span>
<span id="cb824-4"><a href="#cb824-4" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">&#39;log10&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/scale2-1.png" alt="Transforming Axes in GGplot2" width="672" />
<p class="caption">
(#fig:scale2)Transforming Axes in GGplot2
</p>
</div>
<p>The transformation is actually carried out by a <code>"transformer"</code>, which describes the transformation, its inverse, and how to draw the labels. A Few of these transformations are listed in table @ref(tab:modscales) following.</p>
<table>
<caption>(#tab:modscales) Some transformations</caption>
<thead>
<tr class="header">
<th>Name</th>
<th>Equivalent function <span class="math inline">\(f(x)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>"asn"</code></td>
<td><span class="math inline">\(\tanh^{-1}(x)\)</span></td>
</tr>
<tr class="even">
<td><code>"exp"</code></td>
<td><span class="math inline">\(e ^ x\)</span></td>
</tr>
<tr class="odd">
<td><code>"identity"</code></td>
<td><span class="math inline">\(x\)</span></td>
</tr>
<tr class="even">
<td><code>"log"</code></td>
<td><span class="math inline">\(\log(x)\)</span></td>
</tr>
<tr class="odd">
<td><code>"log10"</code></td>
<td><span class="math inline">\(\log_{10}(x)\)</span></td>
</tr>
<tr class="even">
<td><code>"log2"</code></td>
<td><span class="math inline">\(\log_2(x)\)</span></td>
</tr>
<tr class="odd">
<td><code>"logit"</code></td>
<td><span class="math inline">\(\log(\frac{x}{1 - x})\)</span></td>
</tr>
<tr class="even">
<td><code>"probit"</code></td>
<td><span class="math inline">\(\Phi(x)\)</span></td>
</tr>
<tr class="odd">
<td><code>"reciprocal"</code></td>
<td><span class="math inline">\(x^{-1}\)</span></td>
</tr>
<tr class="even">
<td><code>"reverse"</code></td>
<td><span class="math inline">\(-x\)</span></td>
</tr>
<tr class="odd">
<td><code>"sqrt"</code></td>
<td><span class="math inline">\(x^{1/2}\)</span></td>
</tr>
</tbody>
</table>
<p>However, there are certain scale functions dedicated to transform axes in ggplot2. Some of these are listed below. Obviously all these functions have corresponding <code>y</code> variants available.</p>
<ul>
<li><code>scale_x_log10()</code></li>
<li><code>scale_x_reverse()</code></li>
<li><code>scale_x_sqrt()</code></li>
</ul>
<p>Of these, <code>scale_x_reverse</code> or its <code>y</code> variant are sometimes really useful.</p>
<p>In the above examples, though we have seen scale functions dealing with <code>numerical</code> data, we have plenty of other functions to deal with other data. Such as,</p>
<ul>
<li><code>scale_x_date</code></li>
<li><code>scale_x_datetime()</code></li>
<li><code>scale_x_discrete()</code></li>
<li><code>scale_x_binned()</code></li>
</ul>
<p>One example of using date scale can be of economics data. (refer figure @ref(fig:scale4)).</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb825-1"><a href="#cb825-1" tabindex="-1"></a><span class="fu">ggplot</span>(economics, <span class="fu">aes</span>(date, psavert)) <span class="sc">+</span></span>
<span id="cb825-2"><a href="#cb825-2" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb825-3"><a href="#cb825-3" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">name =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb825-4"><a href="#cb825-4" tabindex="-1"></a>               <span class="at">date_breaks =</span> <span class="st">&quot;2 years&quot;</span>,</span>
<span id="cb825-5"><a href="#cb825-5" tabindex="-1"></a>               <span class="at">date_labels =</span> <span class="st">&quot;%y&quot;</span>,</span>
<span id="cb825-6"><a href="#cb825-6" tabindex="-1"></a>               <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">ymd</span>(<span class="st">&quot;19800101&quot;</span>), <span class="fu">ymd</span>(<span class="st">&quot;19991231&quot;</span>))) <span class="sc">+</span></span>
<span id="cb825-7"><a href="#cb825-7" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">&quot;Personal Savings Rate&quot;</span>,</span>
<span id="cb825-8"><a href="#cb825-8" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">scale =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/scale4-1.png" alt="Transforming Axes in GGplot2" width="672" />
<p class="caption">
(#fig:scale4)Transforming Axes in GGplot2
</p>
</div>
<p>In figure @ref(fig:scale4), we have modified (i) name of <code>x</code> axis, (ii) breaks, which places the label, (iii) label for 2 digits of year, (iv) limited the data to be plotted using <code>limits</code>, (v) name of <code>y</code> axis and (vi) modified the bales of <code>y</code> axis as percentages; all using scale functions.</p>
<p>Readers may have noticed that we have modified the axes lables in plot in figure @ref(fig:scale4) using <code>scales</code> package. Using <code>scales</code> library we may modify format of labels (refer plot in figure @ref(fig:scale3)).</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="#cb826-1" tabindex="-1"></a>state.x77 <span class="sc">%&gt;%</span> </span>
<span id="cb826-2"><a href="#cb826-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb826-3"><a href="#cb826-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Area, Illiteracy<span class="sc">/</span><span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb826-4"><a href="#cb826-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb826-5"><a href="#cb826-5" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">&quot;Area in Square Miles&quot;</span>, <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb826-6"><a href="#cb826-6" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">&quot;Illiteracy as % of Population&quot;</span>, <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>())</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/scale3-1.png" alt="Transforming Axes in GGplot2" width="672" />
<p class="caption">
(#fig:scale3)Transforming Axes in GGplot2
</p>
</div>
<p>Some other functions in <code>scales</code> library useful for displaying numerical data on axes are -</p>
<ul>
<li><code>scales::label_bytes()</code> formats numbers as kilobytes, megabytes etc.</li>
<li><code>scales::label_dollar()</code> formats numbers as currency.</li>
<li><code>scales::label_ordinal()</code> formats numbers in rank order: 1st, 2nd, 3rd etc.</li>
<li><code>scales::label_pvalue()</code> formats numbers as p-values: &lt;.05, &lt;.01,
.34, etc.</li>
<li><code>scales::label_date()</code></li>
<li><code>scales::label_date_short()</code> formats dates</li>
<li><code>scale::label_wrap()</code> useful to wrap long strings across multiple
lines.</li>
</ul>
<p>In figure @ref(fig:scale4), though we have limited the scale for a fixed duration, readers may notice that there is still an empty space on both sides of the scale. In figure @ref(fig:rgg20) the space between <code>y</code> axis labels and bars may be annoying to some. To modify this empty space on scales (usually position scales) we can use <code>expand</code> argument of <code>scale_*_*</code> function through another function <code>expansion</code>. This function <code>expansion</code> has two arguments namely <code>mult</code> and <code>add</code>.</p>
<ul>
<li><code>mult</code> argument takes a vector with two numeric elements which indicate range expansion factors.</li>
<li><code>add</code> argument also takes a vector with two numeric elements but these indicate additive range expansion constants.</li>
</ul>
<p>To understand this let’s again consider the example in figure @ref(fig:rgg20). Providing <code>mult = c(0, 0.2)</code> in <code>expansion</code> multiplies <code>x</code> axis (continuous in this case) with <code>0</code> times on left side, and <code>0.2</code> times of <code>limit</code> on right side. See output in figure @ref(fig:scale5).</p>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb827-1"><a href="#cb827-1" tabindex="-1"></a>aggregated_mpg <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb827-2"><a href="#cb827-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_cty =</span> <span class="fu">mean</span>(cty),</span>
<span id="cb827-3"><a href="#cb827-3" tabindex="-1"></a>            <span class="at">.by =</span> class) </span>
<span id="cb827-4"><a href="#cb827-4" tabindex="-1"></a></span>
<span id="cb827-5"><a href="#cb827-5" tabindex="-1"></a><span class="fu">ggplot</span>(aggregated_mpg, <span class="fu">aes</span>(<span class="at">x =</span> mean_cty, <span class="at">y =</span> class)) <span class="sc">+</span></span>
<span id="cb827-6"><a href="#cb827-6" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb827-7"><a href="#cb827-7" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/scale5-1.png" alt="Modifying scale limits though expansion" width="672" />
<p class="caption">
(#fig:scale5)Modifying scale limits though expansion
</p>
</div>
</div>
<div id="adding-secondary-position-axis" class="section level3" number="13.5.2">
<h3><span class="header-section-number">13.5.2</span> Adding secondary position axis</h3>
<p>Most of the times two different position aesthetics are shown in same plot having different scales altogether. In such cases secondary axes can be useful for comparing datasets with different magnitudes or units, allowing for a clearer representation of diverse data sets within a single chart. However, caution is needed as secondary axes can sometimes lead to misleading interpretations. If not used carefully, they might obscure important trends or create confusion, especially if the scale differences are not immediately obvious to the viewer.</p>
<p>Secondary axes can be added in ggplot2, using <code>sec_axis</code> function as an argument to <code>sec.axis</code> inside <code>scale</code>s. As an example, we can see the two <code>y</code> axis representing same data both in degree Fahrenheit and degree Celsius in figure @ref(fig:scale6). First argument of <code>sec_axis</code> takes a transformation function using tidyverse style syntax. Another useful argument is <code>name</code> apart from other usual functions like <code>labels</code>, etc.</p>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb828-1"><a href="#cb828-1" tabindex="-1"></a>airquality <span class="sc">|&gt;</span></span>
<span id="cb828-2"><a href="#cb828-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">factor</span>(month.abb[Month], <span class="at">ordered =</span> <span class="cn">TRUE</span>, <span class="at">levels =</span> month.abb)) <span class="sc">|&gt;</span></span>
<span id="cb828-3"><a href="#cb828-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_rev</span>(Month), Temp)) <span class="sc">+</span></span>
<span id="cb828-4"><a href="#cb828-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb828-5"><a href="#cb828-5" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;summary&quot;</span>,</span>
<span id="cb828-6"><a href="#cb828-6" tabindex="-1"></a>    <span class="at">fun =</span> mean</span>
<span id="cb828-7"><a href="#cb828-7" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb828-8"><a href="#cb828-8" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">&quot;Average Temp (\u00B0F)&quot;</span>,</span>
<span id="cb828-9"><a href="#cb828-9" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>)),</span>
<span id="cb828-10"><a href="#cb828-10" tabindex="-1"></a>                     <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> (. <span class="sc">-</span> <span class="dv">32</span>) <span class="sc">*</span> <span class="dv">5</span> <span class="sc">/</span> <span class="dv">9</span>,</span>
<span id="cb828-11"><a href="#cb828-11" tabindex="-1"></a>                                         <span class="at">name =</span> <span class="st">&quot; Average Temp (\u00B0C)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb828-12"><a href="#cb828-12" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Month&quot;</span>) </span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/scale6-1.png" alt="Adding Secondary Axis" width="672" />
<p class="caption">
(#fig:scale6)Adding Secondary Axis
</p>
</div>
</div>
<div id="customising-color-or-fill-mappings" class="section level3" number="13.5.3">
<h3><span class="header-section-number">13.5.3</span> Customising color (or fill) mappings</h3>
<p><em>Readers are advised to read appendix</em> @ref(COLORR) <em>wherein we have
discussed color aesthetic in pretty details.</em> By far we know that
continuous data if mapped to a color aesthetic gives us a gradient color
scale and discrete data on the other hand, provides us discrete color
values.</p>
<p>For continuous variables we thus have <code>scale_fill_continuous()</code> function
in turn defaulting to <code>scale_fill_gradient()</code>. In other words, the
default colors are picked by <code>scale_fill_gradient</code> function, which uses
following mentioned colors. Readers may also note that all <code>fill</code> scale
functions have a corresponding <code>color</code> scale function to be used with
<code>color</code> aesthetic.</p>
<pre><code>scale_colour_gradient(
  name = waiver(),
  ...,
  low = &quot;#132B43&quot;,
  high = &quot;#56B1F7&quot;,
  space = &quot;Lab&quot;,
  na.value = &quot;grey50&quot;,
  guide = &quot;colourbar&quot;,
  aesthetics = &quot;colour&quot;
)</code></pre>
<p>So we may change the desired colors in the color gradient. There are two
more related scales.</p>
<ul>
<li><code>scale_fill_gradient2()</code> which produces a three-colour gradient with
specified midpoint</li>
<li><code>scale_fill_gradientn()</code> which produces an n-colour gradient.</li>
</ul>
<p>The usage may be clear with the following examples.</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="#cb830-1" tabindex="-1"></a>economics <span class="sc">|&gt;</span> </span>
<span id="cb830-2"><a href="#cb830-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">TRUE</span>),</span>
<span id="cb830-3"><a href="#cb830-3" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb830-4"><a href="#cb830-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, month)) <span class="sc">+</span></span>
<span id="cb830-5"><a href="#cb830-5" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> psavert)) <span class="sc">+</span></span>
<span id="cb830-6"><a href="#cb830-6" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb830-7"><a href="#cb830-7" tabindex="-1"></a>                       <span class="at">high =</span> <span class="st">&quot;seagreen&quot;</span>,</span>
<span id="cb830-8"><a href="#cb830-8" tabindex="-1"></a>                       <span class="at">midpoint =</span> <span class="fu">mean</span>(economics<span class="sc">$</span>psavert))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg53-1.png" alt="Customising Fill scale" width="672" />
<p class="caption">
(#fig:rgg53)Customising Fill scale
</p>
</div>
<p>If however, the variable mapped with <code>fill</code> or <code>color</code> scale is
discrete, the default scale picked up by ggplot2 is
<code>scale_fill_discrete</code> which picks its values from corresponding
<code>scale_fill_hue()</code> by default.</p>
<p>However, for discrete color/fill scales it is advised to use <code>brewer</code>
palettes as described in Appendix @ref(COLORR), due to slight
complexity involved in <code>hue</code> scales. Moreover, if we want to pick our
colors manually, we may use <code>scale_fill_manual()</code> which takes color
values from a named vector where names are the categories available in
the variable. See the following example in figure @ref(fig:rgg54).</p>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="#cb831-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(fl, <span class="at">fill =</span> fl)) <span class="sc">+</span></span>
<span id="cb831-2"><a href="#cb831-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb831-3"><a href="#cb831-3" tabindex="-1"></a></span>
<span id="cb831-4"><a href="#cb831-4" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(fl, <span class="at">fill =</span> fl)) <span class="sc">+</span></span>
<span id="cb831-5"><a href="#cb831-5" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb831-6"><a href="#cb831-6" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">c =</span> <span class="st">&quot;seagreen&quot;</span>, <span class="at">d =</span> <span class="st">&quot;tomato4&quot;</span>,</span>
<span id="cb831-7"><a href="#cb831-7" tabindex="-1"></a>                               <span class="at">e =</span> <span class="st">&quot;dodgerblue&quot;</span>, <span class="at">p =</span> <span class="st">&quot;cadetblue3&quot;</span>,</span>
<span id="cb831-8"><a href="#cb831-8" tabindex="-1"></a>                               <span class="at">r =</span> <span class="st">&quot;indianred&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg54-1.png" alt="Customising Fill scale manually" width="49%" /><img src="DauR_files/figure-html/rgg54-2.png" alt="Customising Fill scale manually" width="49%" />
<p class="caption">
(#fig:rgg54)Customising Fill scale manually
</p>
</div>
<p>Another set of scales in ggplot2, sometimes useful are
<code>scale_color_identity()</code> which are useful when the data has already been
scaled, i.e. it already represents aesthetic values that ggplot2 can
handle directly. See the following example in figure @ref(fig:rgg55).</p>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb832-1"><a href="#cb832-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb832-2"><a href="#cb832-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb832-3"><a href="#cb832-3" tabindex="-1"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb832-4"><a href="#cb832-4" tabindex="-1"></a>  <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;yellow&quot;</span>)</span>
<span id="cb832-5"><a href="#cb832-5" tabindex="-1"></a>)</span>
<span id="cb832-6"><a href="#cb832-6" tabindex="-1"></a></span>
<span id="cb832-7"><a href="#cb832-7" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb832-8"><a href="#cb832-8" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> colour))</span>
<span id="cb832-9"><a href="#cb832-9" tabindex="-1"></a></span>
<span id="cb832-10"><a href="#cb832-10" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb832-11"><a href="#cb832-11" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> colour)) <span class="sc">+</span></span>
<span id="cb832-12"><a href="#cb832-12" tabindex="-1"></a>  <span class="fu">scale_fill_identity</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg55-1.png" alt="Identity Color Scale" width="49%" /><img src="DauR_files/figure-html/rgg55-2.png" alt="Identity Color Scale" width="49%" />
<p class="caption">
(#fig:rgg55)Identity Color Scale
</p>
</div>
</div>
<div id="other-scale-aesthetics" class="section level3" number="13.5.4">
<h3><span class="header-section-number">13.5.4</span> Other scale aesthetics</h3>
<p>Similar to position and color/fill scales there are scale functions for
other aesthetics which are appropriately named and can be used to modify
mappings as per our requirement. For e.g. to change shape aesthetic with
that of values available in data, we have <code>scale_shape_identity()</code> or to
change shapes manually we have <code>scale_shape_manual</code> which takes a named
vector. Readers are advised to go through these functions through their
help pages and use-cases by themselves.</p>
</div>
</div>
<div id="coordinate-systems" class="section level2" number="13.6">
<h2><span class="header-section-number">13.6</span> Coordinate systems</h2>
<p>So far, we know that default coordinate system adopted by ggplot2 is
Cartesian, which requires <code>x</code> and <code>y</code> position aesthetics to map data in
two-dimensional plots. It uses <code>coord_cartesian()</code> function along with
its default values. Other linear coordinate systems are <code>coord_flip()</code>,
which flips x and y axes; and <code>coord_fixed()</code> which preserves the fixed
aspect ratio.</p>
<p><code>coord_cartesian()</code> has arguments <code>xlim</code> and <code>ylim</code> which can be used to
set limits of <code>x</code> and <code>y</code> axes respectively, but unlike <code>limits</code>
argument of <code>scale_*_*</code> function does not discard the data, which is out
of the limits. As an example, refer three plots in Figure
@ref(fig:rgg56), wherein <code>scale_x_continuous</code> has changed the shape of
smoothed curve as the data out of the plot has been discarded.</p>
<div class="sourceCode" id="cb833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb833-1"><a href="#cb833-1" tabindex="-1"></a>base <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy)) <span class="sc">+</span> </span>
<span id="cb833-2"><a href="#cb833-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb833-3"><a href="#cb833-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb833-4"><a href="#cb833-4" tabindex="-1"></a></span>
<span id="cb833-5"><a href="#cb833-5" tabindex="-1"></a><span class="co"># Full dataset</span></span>
<span id="cb833-6"><a href="#cb833-6" tabindex="-1"></a>base</span>
<span id="cb833-7"><a href="#cb833-7" tabindex="-1"></a></span>
<span id="cb833-8"><a href="#cb833-8" tabindex="-1"></a><span class="co"># Scaling to 4--6 throws away data outside that range</span></span>
<span id="cb833-9"><a href="#cb833-9" tabindex="-1"></a>base <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>))</span>
<span id="cb833-10"><a href="#cb833-10" tabindex="-1"></a></span>
<span id="cb833-11"><a href="#cb833-11" tabindex="-1"></a><span class="co"># Zooming to 4--6 keeps all the data but only shows some of it</span></span>
<span id="cb833-12"><a href="#cb833-12" tabindex="-1"></a>base <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg56-1.png" alt="Setting limits" width="33%" /><img src="DauR_files/figure-html/rgg56-2.png" alt="Setting limits" width="33%" /><img src="DauR_files/figure-html/rgg56-3.png" alt="Setting limits" width="33%" />
<p class="caption">
(#fig:rgg56)Setting limits
</p>
</div>
<p>Another coordinate system <code>coord_flip</code>, flips the axes and is useful to
flip the axes. One thing to note that here <code>x</code> axis is drawn vertically
and thus, if any <code>geom</code> is drawn which takes <code>x</code> value will take the
values from vertical axis and not from horizontal axis.</p>
<p>However there are other coordinate systems available in ggplot2, which
have been listed in table @ref(tab:coords) for ready reference.</p>
<table>
<caption>(#tab:coords)List of Coordinate Systems available in ggplot2</caption>
<thead>
<tr class="header">
<th align="left">Entry</th>
<th align="left">Title</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">coord_cartesian</td>
<td align="left">Cartesian coordinates</td>
</tr>
<tr class="even">
<td align="left">coord_fixed</td>
<td align="left">Cartesian coordinates with fixed “aspect ratio”</td>
</tr>
<tr class="odd">
<td align="left">coord_equal</td>
<td align="left">Cartesian coordinates with fixed “aspect ratio”</td>
</tr>
<tr class="even">
<td align="left">coord_flip</td>
<td align="left">Cartesian coordinates with x and y flipped</td>
</tr>
<tr class="odd">
<td align="left">coord_map</td>
<td align="left">Map projections</td>
</tr>
<tr class="even">
<td align="left">coord_quickmap</td>
<td align="left">Map projections</td>
</tr>
<tr class="odd">
<td align="left">coord_munch</td>
<td align="left">Munch coordinates data</td>
</tr>
<tr class="even">
<td align="left">coord_polar</td>
<td align="left">Polar coordinates</td>
</tr>
<tr class="odd">
<td align="left">coord_radial</td>
<td align="left">Polar coordinates</td>
</tr>
<tr class="even">
<td align="left">coord_trans</td>
<td align="left">Transformed Cartesian coordinate system</td>
</tr>
<tr class="odd">
<td align="left">coord_sf</td>
<td align="left">Visualise sf objects</td>
</tr>
</tbody>
</table>
<p>Out of the listed coordinate systems, some are really important and
cannot be skipped for gaining the basic architecture of ggplot2. Do you
know that a pie chart is basically a bar chart drawn in polar coordinate
system? The answer is yes. So let’s understand polar coordinate system
and recently introduced radial coordinate system which help us to draw a
pie chart.</p>
<p>In the following code, a 100% stacked bar chart (flipped on y axis) is
converted to a pie chart by adopting <code>coord_polar()</code> and to a bulls-eye
chart by setting <code>theta</code> position aesthetic to <code>"y"</code> position. Refer
three plots in figure @ref(fig:rgg57).</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="#cb834-1" tabindex="-1"></a>base <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(<span class="dv">1</span>), <span class="at">fill =</span> <span class="fu">factor</span>(cyl))) <span class="sc">+</span></span>
<span id="cb834-2"><a href="#cb834-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb834-3"><a href="#cb834-3" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb834-4"><a href="#cb834-4" tabindex="-1"></a>                   <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb834-5"><a href="#cb834-5" tabindex="-1"></a>                   <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb834-6"><a href="#cb834-6" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb834-7"><a href="#cb834-7" tabindex="-1"></a></span>
<span id="cb834-8"><a href="#cb834-8" tabindex="-1"></a><span class="co"># Stacked barchart</span></span>
<span id="cb834-9"><a href="#cb834-9" tabindex="-1"></a>base</span>
<span id="cb834-10"><a href="#cb834-10" tabindex="-1"></a></span>
<span id="cb834-11"><a href="#cb834-11" tabindex="-1"></a><span class="co"># Pie chart</span></span>
<span id="cb834-12"><a href="#cb834-12" tabindex="-1"></a>base <span class="sc">+</span> <span class="fu">coord_polar</span>()</span>
<span id="cb834-13"><a href="#cb834-13" tabindex="-1"></a></span>
<span id="cb834-14"><a href="#cb834-14" tabindex="-1"></a><span class="co"># The bullseye chart</span></span>
<span id="cb834-15"><a href="#cb834-15" tabindex="-1"></a>base <span class="sc">+</span> <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg57-1.png" alt="Polar Coordinates" width="33%" /><img src="DauR_files/figure-html/rgg57-2.png" alt="Polar Coordinates" width="33%" /><img src="DauR_files/figure-html/rgg57-3.png" alt="Polar Coordinates" width="33%" />
<p class="caption">
(#fig:rgg57)Polar Coordinates
</p>
</div>
<p>By recently introduced <code>coord_radial</code> which is specifically designed for
pie charts, the base layer (i.e. 100% stacked bar chart) can be
converted to a pie chart. (Refer plots in figure @ref(fig:rgg58).)</p>
<div class="sourceCode" id="cb835"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb835-1"><a href="#cb835-1" tabindex="-1"></a><span class="co"># With default value</span></span>
<span id="cb835-2"><a href="#cb835-2" tabindex="-1"></a>base <span class="sc">+</span> <span class="fu">coord_radial</span>()</span>
<span id="cb835-3"><a href="#cb835-3" tabindex="-1"></a></span>
<span id="cb835-4"><a href="#cb835-4" tabindex="-1"></a><span class="co"># Without expansion</span></span>
<span id="cb835-5"><a href="#cb835-5" tabindex="-1"></a>base <span class="sc">+</span> <span class="fu">coord_radial</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg58-1.png" alt="Using Radial Coordinates" width="49%" /><img src="DauR_files/figure-html/rgg58-2.png" alt="Using Radial Coordinates" width="49%" />
<p class="caption">
(#fig:rgg58)Using Radial Coordinates
</p>
</div>
<p>The <code>coord_radial</code> can also be used to create donut charts easily by
setting parameter <code>inner.radius</code> as can be seen in Figure
@ref(fig:rgg59).</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb836-1"><a href="#cb836-1" tabindex="-1"></a><span class="co"># Donut Chart</span></span>
<span id="cb836-2"><a href="#cb836-2" tabindex="-1"></a>base <span class="sc">+</span> <span class="fu">coord_radial</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>,</span>
<span id="cb836-3"><a href="#cb836-3" tabindex="-1"></a>                    <span class="at">inner.radius =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg59-1.png" alt="Donut Charts with Radial Coordinates" width="672" />
<p class="caption">
(#fig:rgg59)Donut Charts with Radial Coordinates
</p>
</div>
<p><code>coord_radial</code> also places the labels automatically, while adjusting
<code>inner.radius</code>. Refer plots in @ref(fig:rgg60).</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb837-1"><a href="#cb837-1" tabindex="-1"></a>base2 <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb837-2"><a href="#cb837-2" tabindex="-1"></a>    <span class="fu">count</span>(class) <span class="sc">|&gt;</span> </span>
<span id="cb837-3"><a href="#cb837-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> n, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb837-4"><a href="#cb837-4" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb837-5"><a href="#cb837-5" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), </span>
<span id="cb837-6"><a href="#cb837-6" tabindex="-1"></a>                 <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb837-7"><a href="#cb837-7" tabindex="-1"></a></span>
<span id="cb837-8"><a href="#cb837-8" tabindex="-1"></a>base2 <span class="sc">+</span> <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>)</span>
<span id="cb837-9"><a href="#cb837-9" tabindex="-1"></a></span>
<span id="cb837-10"><a href="#cb837-10" tabindex="-1"></a>base2 <span class="sc">+</span></span>
<span id="cb837-11"><a href="#cb837-11" tabindex="-1"></a>  <span class="fu">coord_radial</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>, </span>
<span id="cb837-12"><a href="#cb837-12" tabindex="-1"></a>               <span class="at">theta =</span> <span class="st">&quot;y&quot;</span>, </span>
<span id="cb837-13"><a href="#cb837-13" tabindex="-1"></a>               <span class="at">inner.radius =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg60-1.png" alt="Labels adjustments in Donut Charts with Radial Coordinates" width="49%" /><img src="DauR_files/figure-html/rgg60-2.png" alt="Labels adjustments in Donut Charts with Radial Coordinates" width="49%" />
<p class="caption">
(#fig:rgg60)Labels adjustments in Donut Charts with Radial Coordinates
</p>
</div>
<p>Though there is a lot more that can be done in <code>coord_radial</code> , one
final example of using <code>coord_radial</code> can be drawing bar plots in
circle, as shown in figure @ref(fig:rgg61).</p>
<div class="sourceCode" id="cb838"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb838-1"><a href="#cb838-1" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span></span>
<span id="cb838-2"><a href="#cb838-2" tabindex="-1"></a>  <span class="co">#arrange(-mpg) |&gt;</span></span>
<span id="cb838-3"><a href="#cb838-3" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&#39;Car&#39;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb838-4"><a href="#cb838-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">seq_along</span>(mpg), mpg, <span class="at">fill =</span> <span class="fu">factor</span>(cyl))) <span class="sc">+</span></span>
<span id="cb838-5"><a href="#cb838-5" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>,</span>
<span id="cb838-6"><a href="#cb838-6" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb838-7"><a href="#cb838-7" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">32</span>, <span class="at">label =</span> Car),</span>
<span id="cb838-8"><a href="#cb838-8" tabindex="-1"></a>            <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb838-9"><a href="#cb838-9" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb838-10"><a href="#cb838-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb838-11"><a href="#cb838-11" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">32</span>, <span class="at">label =</span> mpg),</span>
<span id="cb838-12"><a href="#cb838-12" tabindex="-1"></a>    <span class="at">angle =</span> <span class="dv">90</span>,</span>
<span id="cb838-13"><a href="#cb838-13" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb838-14"><a href="#cb838-14" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span></span>
<span id="cb838-15"><a href="#cb838-15" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb838-16"><a href="#cb838-16" tabindex="-1"></a>  <span class="fu">coord_radial</span>(<span class="at">rotate.angle =</span> <span class="cn">TRUE</span>, <span class="at">expand =</span> <span class="cn">FALSE</span>)  <span class="sc">+</span></span>
<span id="cb838-17"><a href="#cb838-17" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;dodgerblue&quot;</span>, <span class="st">&quot;seagreen&quot;</span>, <span class="st">&quot;orange&quot;</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb838-18"><a href="#cb838-18" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb838-19"><a href="#cb838-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;aliceblue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb838-20"><a href="#cb838-20" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Miles per gallon for different cars&quot;</span>) <span class="sc">+</span></span>
<span id="cb838-21"><a href="#cb838-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>,</span>
<span id="cb838-22"><a href="#cb838-22" tabindex="-1"></a>                                  <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg61-1.png" alt="Bar plot in circle" width="672" />
<p class="caption">
(#fig:rgg61)Bar plot in circle
</p>
</div>
</div>
<div id="faceting" class="section level2" number="13.7">
<h2><span class="header-section-number">13.7</span> Faceting</h2>
<p>The amount of data also makes a difference: if there is a lot of data it
can be hard to distinguish different groups. An alternative solution is
to use faceting, as described next. Facets, or “small-multiples”, are
used to split one plot into a multi-panel figure, with one panel
(“facet”) per group of data. The same type of plot is created multiple
times, each one using a sub-group of the same dataset.</p>
<p>In <code>ggplot2</code> faceting can be achieved using either of the functions -</p>
<ul>
<li><code>facet_grid()</code> creates a grid of plots, with each plot showing a
subset of the data. We may also specify the number of columns to use
in the grid using the <code>ncol</code> argument.</li>
<li><code>facet_wrap()</code> creates a grid of plots with different variables on
each axis. We may also specify the scales to use for each axis using
the <code>scales</code> argument.</li>
</ul>
<p>Let us understand this, with the following examples. In figure
@ref(fig:rgg62) <code>facet_grid()</code> has been used. Notice that
<code>facet_grid()</code> arranges the plots in a grid with different variables on
each axis. We specify the variables to use for faceting using the <code>~</code>
operator. For example, <code>facet_grid(variable1 ~ variable2)</code> will create a
grid of plots with <code>variable1</code> on the y-axis and <code>variable2</code> on the
x-axis. This is useful when we want to compare the relationship between
two variables across different levels of a third variable.</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb839-1"><a href="#cb839-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span> </span>
<span id="cb839-2"><a href="#cb839-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb839-3"><a href="#cb839-3" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> class, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg62-1.png" alt="Wrapping sub plots in facets" width="672" />
<p class="caption">
(#fig:rgg62)Wrapping sub plots in facets
</p>
</div>
<p>On the other hand, <code>facet_wrap()</code> creates a grid of plots, each showing
a subset of your data based on a single variable. We specify the
variable to use for faceting using the same <code>~</code> operator here too. For
example, <code>facet_wrap(~ variable)</code> will create a grid of plots, each
showing a different level of the variable. This is useful when you have
a single categorical variable that you want to use for faceting. See
example in figure @ref(fig:rgg63).</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="#cb840-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span> </span>
<span id="cb840-2"><a href="#cb840-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb840-3"><a href="#cb840-3" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> class)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg63-1.png" alt="Grid alignment of sub plots in facets" width="672" />
<p class="caption">
(#fig:rgg63)Grid alignment of sub plots in facets
</p>
</div>
</div>
<div id="labeling-and-annotating-charts" class="section level2" number="13.8">
<h2><span class="header-section-number">13.8</span> Labeling and Annotating Charts</h2>
<p>Labeling is an essential aspect of data visualization because it provides context and information about the data being presented. Labels can include titles, axis labels, legends, and annotations that describe the data and provide important information that helps the viewer understand what they are looking at. Proper labeling can help to make the data more understandable, clear, and accessible, which enhances its overall value and impact.</p>
<div id="annotations" class="section level3" number="13.8.1">
<h3><span class="header-section-number">13.8.1</span> Annotations</h3>
<p>We have already covered use of <code>geoms</code> like <code>geom_text</code>, <code>geom_label</code>, <code>geom_vline</code>, <code>geom_abline</code>, etc., used to label or annotate geometries in a plot. There are several other geoms used to annotate charts in ggplot2. Let us discuss a few of these.</p>
<ul>
<li><code>geom_rect()</code> is used to draw a rectangle in plot area using aesthetics <code>xmin</code>, <code>xmax</code>, <code>ymin</code> and <code>ymax</code></li>
<li><code>geom_segment()</code> can create a line segment.</li>
</ul>
<p>Moreover, there is a helper function <code>annotate</code> which also adds geoms to a plot, but unlike a typical geom function, the properties of the geoms are not mapped from variables of a data frame, but are instead passed in as vectors. This is useful for adding small annotations (such as text labels) or if we have your data in vectors, and for some reason don’t want to put them in a data frame. See an example in plot in Figure @ref(fig:rrgg63) wherein we have added five annotation elements (i) a rectangle, (ii) two text labels and (iii) two arrows.</p>
<div class="sourceCode" id="cb841"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb841-1"><a href="#cb841-1" tabindex="-1"></a><span class="fu">ggplot</span>(economics, <span class="fu">aes</span>(date, unemploy)) <span class="sc">+</span></span>
<span id="cb841-2"><a href="#cb841-2" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb841-3"><a href="#cb841-3" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>,</span>
<span id="cb841-4"><a href="#cb841-4" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="fu">ymd</span>(<span class="st">&quot;20071201&quot;</span>),</span>
<span id="cb841-5"><a href="#cb841-5" tabindex="-1"></a>    <span class="at">xmax =</span> <span class="fu">ymd</span>(<span class="st">&quot;20091231&quot;</span>),</span>
<span id="cb841-6"><a href="#cb841-6" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>,</span>
<span id="cb841-7"><a href="#cb841-7" tabindex="-1"></a>    <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb841-8"><a href="#cb841-8" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;orange&quot;</span>,</span>
<span id="cb841-9"><a href="#cb841-9" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb841-10"><a href="#cb841-10" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb841-11"><a href="#cb841-11" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb841-12"><a href="#cb841-12" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;label&quot;</span>,</span>
<span id="cb841-13"><a href="#cb841-13" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">ymd</span>(<span class="st">&quot;20070801&quot;</span>),</span>
<span id="cb841-14"><a href="#cb841-14" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">2500</span>,</span>
<span id="cb841-15"><a href="#cb841-15" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">&quot;Global Financial Crisis&quot;</span>,</span>
<span id="cb841-16"><a href="#cb841-16" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span></span>
<span id="cb841-17"><a href="#cb841-17" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb841-18"><a href="#cb841-18" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb841-19"><a href="#cb841-19" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;curve&quot;</span>,</span>
<span id="cb841-20"><a href="#cb841-20" tabindex="-1"></a>    <span class="at">xend =</span> <span class="fu">ymd</span>(<span class="st">&quot;20080101&quot;</span>),</span>
<span id="cb841-21"><a href="#cb841-21" tabindex="-1"></a>    <span class="at">yend =</span> <span class="dv">4000</span>,</span>
<span id="cb841-22"><a href="#cb841-22" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">ymd</span>(<span class="st">&quot;20000101&quot;</span>),</span>
<span id="cb841-23"><a href="#cb841-23" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">3000</span>,</span>
<span id="cb841-24"><a href="#cb841-24" tabindex="-1"></a>    <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb841-25"><a href="#cb841-25" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&#39;cm&#39;</span>))</span>
<span id="cb841-26"><a href="#cb841-26" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb841-27"><a href="#cb841-27" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb841-28"><a href="#cb841-28" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb841-29"><a href="#cb841-29" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">ymd</span>(<span class="st">&quot;20070801&quot;</span>),</span>
<span id="cb841-30"><a href="#cb841-30" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">14000</span>,</span>
<span id="cb841-31"><a href="#cb841-31" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">&quot;Sharp rise in unemployment&quot;</span>,</span>
<span id="cb841-32"><a href="#cb841-32" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb841-33"><a href="#cb841-33" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">&quot;bold.italic&quot;</span></span>
<span id="cb841-34"><a href="#cb841-34" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb841-35"><a href="#cb841-35" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb841-36"><a href="#cb841-36" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">&quot;curve&quot;</span>,</span>
<span id="cb841-37"><a href="#cb841-37" tabindex="-1"></a>    <span class="at">xend =</span> <span class="fu">ymd</span>(<span class="st">&quot;20080701&quot;</span>),</span>
<span id="cb841-38"><a href="#cb841-38" tabindex="-1"></a>    <span class="at">yend =</span> <span class="dv">12000</span>,</span>
<span id="cb841-39"><a href="#cb841-39" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">ymd</span>(<span class="st">&quot;20000101&quot;</span>),</span>
<span id="cb841-40"><a href="#cb841-40" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">13500</span>,</span>
<span id="cb841-41"><a href="#cb841-41" tabindex="-1"></a>    <span class="at">curvature =</span> <span class="fl">0.5</span>,</span>
<span id="cb841-42"><a href="#cb841-42" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">&#39;cm&#39;</span>))</span>
<span id="cb841-43"><a href="#cb841-43" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb841-44"><a href="#cb841-44" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;indianred4&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rrgg63-1.png" alt="Annotating charts" width="672" />
<p class="caption">
(#fig:rrgg63)Annotating charts
</p>
</div>
</div>
<div id="labels" class="section level3" number="13.8.2">
<h3><span class="header-section-number">13.8.2</span> Labels</h3>
<p>Effective labeling is crucial for ensuring that plots are accessible and comprehensible to a wider audience. To achieve this, it’s important to use full variable names for axis and legend labels, as this enhances clarity. The plot’s <code>title</code> and <code>subtitle</code> should be employed to communicate the primary insights and key takeaways, making the information more digestible at a glance. The <code>caption</code> serves as a valuable space to include details about the data source, providing context and credibility. Furthermore, the <code>tag</code> feature can be utilized to add identification markers, which is particularly helpful when comparing or displaying multiple plots within a project.</p>
<p>There are several ways to add labels to ggplot2 charts, but we will focus on using the <code>labs()</code> function, which allows us to add <code>titles</code>, <code>subtitles</code>, <code>axis labels</code>, and other annotations like <code>caption</code>, etc., to the plot. Example -</p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="#cb842-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> hp, <span class="at">y =</span> mpg, <span class="at">color =</span> <span class="fu">factor</span>(cyl))) <span class="sc">+</span></span>
<span id="cb842-2"><a href="#cb842-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb842-3"><a href="#cb842-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Scatter plot of mpg vs. hp&quot;</span>,</span>
<span id="cb842-4"><a href="#cb842-4" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Data from mtcars dataset&quot;</span>,</span>
<span id="cb842-5"><a href="#cb842-5" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Horsepower&quot;</span>,</span>
<span id="cb842-6"><a href="#cb842-6" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Miles per gallon&quot;</span>,</span>
<span id="cb842-7"><a href="#cb842-7" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Cylinders&quot;</span>,</span>
<span id="cb842-8"><a href="#cb842-8" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Source: R datasets&quot;</span>, </span>
<span id="cb842-9"><a href="#cb842-9" tabindex="-1"></a>       <span class="at">tag =</span> <span class="st">&quot;Chart-1&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/rgg64-1.png" alt="A properly labelled chart" width="672" />
<p class="caption">
(#fig:rgg64)A properly labelled chart
</p>
</div>
</div>
</div>
<div id="themes" class="section level2" number="13.9">
<h2><span class="header-section-number">13.9</span> Themes</h2>
<p>Till now (except in a few cases) we have used the default themes of plots generated in ggplot2. Themes can be however be used to customise the appearance, visual aesthetics by exercising fine control over the non-data elements in the plot. We can customize the appearance of plots, such as the axis labels, titles, background colors, and font sizes, styles, etc. by applying themes to the plot.</p>
<p>There are certain complete themes available in <code>ggplot2</code> which set all of the theme elements to values designed to work harmoniously. Defualt theme applied to a plot in ggplot2 is <code>theme_gray()</code>. A complete list of themes available in ggplot2 is given in the table @ref(tab:themesp) below:</p>
<table>
<caption>(#tab:themesp) Themes in ggplot2</caption>
<colgroup>
<col width="27%" />
<col width="72%" />
</colgroup>
<thead>
<tr class="header">
<th>Theme name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>theme_gray()</code></td>
<td>The signature ggplot2 theme with a grey background and white gridlines, designed to put the data forward yet make comparisons easy.</td>
</tr>
<tr class="even">
<td><code>theme_bw()</code></td>
<td>The classic dark-on-light ggplot2 theme. May work better for presentations displayed with a projector.</td>
</tr>
<tr class="odd">
<td><code>theme_linedraw()</code></td>
<td>A theme with only black lines of various widths on white backgrounds, reminiscent of a line drawing. Serves a purpose similar to <code>theme_bw()</code>. Note that this theme has some very thin <code>lines (\&lt;\&lt; 1 pt)</code> which some journals may refuse.</td>
</tr>
<tr class="even">
<td><code>theme_light()</code></td>
<td>A theme similar to <code>theme_linedraw()</code> but with light grey lines and axes, to direct more attention towards the data.</td>
</tr>
<tr class="odd">
<td><code>theme_dark()</code></td>
<td>The dark cousin of <code>theme_light()</code>, with similar line sizes but a dark background. Useful to make thin coloured lines pop out.</td>
</tr>
<tr class="even">
<td><code>theme_minimal()</code></td>
<td>A minimalistic theme with no background annotations.</td>
</tr>
<tr class="odd">
<td><code>theme_classic()</code></td>
<td>A classic-looking theme, with x and y axis lines and no gridlines.</td>
</tr>
<tr class="even">
<td><code>theme_void()</code></td>
<td>A completely empty theme.</td>
</tr>
<tr class="odd">
<td><code>theme_test()</code></td>
<td>A theme for visual unit tests. It should ideally never change except for new features.</td>
</tr>
</tbody>
</table>
<p>Example plots having four of such themes can be seen in figure @ref(fig:theme1).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/theme1-1.png" alt="Some complete themes available in ggplot2" width="672" />
<p class="caption">
(#fig:theme1)Some complete themes available in ggplot2
</p>
</div>
<p>Individual elements can also, however, be modified through function <code>theme</code> available in ggplot2. This <code>theme</code> function should consist of <code>element</code> name which is to be modified, as an argument to the function. That element can then be modified through providing values to that argument, which most of the times is provided through <code>element function</code> like <code>element_text</code>, etc. Some of the elements commonly requiring a customisation through theme function is explained in figure @ref(fig:rgg65).</p>
<div class="figure" style="text-align: center">
<img src="images/elements.png" alt="Some theme elements" width="95%" height="40%" />
<p class="caption">
(#fig:rgg65)Some theme elements
</p>
</div>
<p>As an example refer plot in figure @ref(fig:theme2) wherein certain plot elements have been modified using <code>theme</code> function.</p>
<div class="sourceCode" id="cb843"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb843-1"><a href="#cb843-1" tabindex="-1"></a>myplot<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb843-2"><a href="#cb843-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">seed =</span> <span class="dv">42</span>), <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(class))) <span class="sc">+</span></span>
<span id="cb843-3"><a href="#cb843-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>, <span class="at">size =</span> <span class="fl">4.5</span>, <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">seed =</span> <span class="dv">42</span>), <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(class))) <span class="sc">+</span></span>
<span id="cb843-4"><a href="#cb843-4" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">formula =</span> <span class="st">&quot;y ~ x&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb843-5"><a href="#cb843-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;City Vs. Highway Mileages&quot;</span>,</span>
<span id="cb843-6"><a href="#cb843-6" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Data Source: MPG Dataset&quot;</span>,</span>
<span id="cb843-7"><a href="#cb843-7" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Mileage in City (Miles per Gallon)&quot;</span>,</span>
<span id="cb843-8"><a href="#cb843-8" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Milaege in Highway (Miles per Gallon)&quot;</span>,</span>
<span id="cb843-9"><a href="#cb843-9" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Class&quot;</span>) <span class="sc">+</span></span>
<span id="cb843-10"><a href="#cb843-10" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb843-11"><a href="#cb843-11" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb843-12"><a href="#cb843-12" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;seagreen4&quot;</span>,</span>
<span id="cb843-13"><a href="#cb843-13" tabindex="-1"></a>                             <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>),</span>
<span id="cb843-14"><a href="#cb843-14" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;darkorchid4&quot;</span>),</span>
<span id="cb843-15"><a href="#cb843-15" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb843-16"><a href="#cb843-16" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb843-17"><a href="#cb843-17" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb843-18"><a href="#cb843-18" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb843-19"><a href="#cb843-19" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb843-20"><a href="#cb843-20" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold.italic&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb843-21"><a href="#cb843-21" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb843-22"><a href="#cb843-22" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb843-23"><a href="#cb843-23" tabindex="-1"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb843-24"><a href="#cb843-24" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb843-25"><a href="#cb843-25" tabindex="-1"></a>  )</span>
<span id="cb843-26"><a href="#cb843-26" tabindex="-1"></a></span>
<span id="cb843-27"><a href="#cb843-27" tabindex="-1"></a>myplot</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/theme2-1.png" alt="Customising Themes in GGplot2" width="672" />
<p class="caption">
(#fig:theme2)Customising Themes in GGplot2
</p>
</div>
<p>We can combine multiple customization options together to create a customized theme that fits our specific needs using <code>theme_set()</code>. The possibilities for customization are endless, so feel free to experiment and create your own unique theme!</p>
</div>
<div id="savingexporting-plots" class="section level2" number="13.10">
<h2><span class="header-section-number">13.10</span> Saving/exporting plots</h2>
<p>Of course, after creating charts/plots we would like to save them for further usage in our reports/documents, etc. Though there may be many options to save a plot to disk, we will be focusing on three different methods.</p>
<div id="saving-through-rstudio-menu" class="section level3 unnumbered">
<h3 class="unnumbered">Saving through Rstudio menu</h3>
<p>To save a graph using the RStudio menus, go to the Plots tab and choose <code>Export</code>.</p>
<div class="figure" style="text-align: center">
<img src="images/export.png" alt="Exporting Charts" width="95%" />
<p class="caption">
(#fig:export1)Exporting Charts
</p>
</div>
<p>Three options are available here.</p>
<ul>
<li>Save as Image</li>
<li>Save as PDF</li>
<li>Copy to clipboard.</li>
</ul>
<p>We can use the options as per requirement.</p>
</div>
<div id="saving-through-code" class="section level3 unnumbered">
<h3 class="unnumbered">Saving through code</h3>
<p>We may also save our plots using function <code>ggsave()</code> here. Its syntax is simple</p>
<pre><code>ggsave(
  filename,
  plot = last_plot(),
  device = NULL,
  path = NULL,
  scale = 1,
  width = NA,
  height = NA,
  units = c(&quot;in&quot;, &quot;cm&quot;, &quot;mm&quot;, &quot;px&quot;),
  dpi = 300,
  limitsize = TRUE,
  bg = NULL,
  ...
)</code></pre>
<p>All arguments are simple to understand. Thus for example if we need to save the plot we generated in figure @ref(fig:theme2), we can use <code>ggsave</code>.</p>
<pre><code>ggsave(&#39;Mileages.png&#39;, myplot, height = 10, width = 8)</code></pre>
</div>
<div id="graphics-devices-base-r-plots" class="section level3 unnumbered">
<h3 class="unnumbered">Graphics Devices (Base R Plots)</h3>
<p>If we have created plots outside of ggplot (with <code>plot()</code>, <code>hist()</code>,
<code>boxplot()</code>, etc.), we cannot use <code>ggsave()</code> to save our plots since it
only supports plots made with ggplot.</p>
<p>Base R provides a way to save these plots with its graphic device
functions. There are three steps involved in this process-</p>
<ul>
<li>Specify the file extension and properties (size, resolution, etc.)
along with units</li>
<li>create the plot, in base R or/and ggplot2</li>
<li>Signal that the plot is finished and save it by running <code>dev.off()</code>.
Thus, using this way we can insert as many charts in a single pdf
without turning off the device till our pdf is ready.</li>
</ul>
<p>Example-</p>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb846-1"><a href="#cb846-1" tabindex="-1"></a><span class="co"># Creates a png file</span></span>
<span id="cb846-2"><a href="#cb846-2" tabindex="-1"></a><span class="fu">png</span>(</span>
<span id="cb846-3"><a href="#cb846-3" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;scatter.png&quot;</span>,</span>
<span id="cb846-4"><a href="#cb846-4" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb846-5"><a href="#cb846-5" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">3</span>,</span>
<span id="cb846-6"><a href="#cb846-6" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb846-7"><a href="#cb846-7" tabindex="-1"></a>  <span class="at">res =</span> <span class="dv">300</span></span>
<span id="cb846-8"><a href="#cb846-8" tabindex="-1"></a>)</span>
<span id="cb846-9"><a href="#cb846-9" tabindex="-1"></a><span class="co"># Prints a ggplot2 in it</span></span>
<span id="cb846-10"><a href="#cb846-10" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb846-11"><a href="#cb846-11" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb846-12"><a href="#cb846-12" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">5</span>,</span>
<span id="cb846-13"><a href="#cb846-13" tabindex="-1"></a>              <span class="at">slope =</span> <span class="dv">3</span>,</span>
<span id="cb846-14"><a href="#cb846-14" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;seagreen&quot;</span>)</span>
<span id="cb846-15"><a href="#cb846-15" tabindex="-1"></a><span class="co"># Device is off</span></span>
<span id="cb846-16"><a href="#cb846-16" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb848-1"><a href="#cb848-1" tabindex="-1"></a><span class="co"># Creates a new PDF file</span></span>
<span id="cb848-2"><a href="#cb848-2" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">&quot;two_page.pdf&quot;</span>,</span>
<span id="cb848-3"><a href="#cb848-3" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb848-4"><a href="#cb848-4" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">4</span>)</span>
<span id="cb848-5"><a href="#cb848-5" tabindex="-1"></a><span class="co">#first plot</span></span>
<span id="cb848-6"><a href="#cb848-6" tabindex="-1"></a><span class="fu">plot</span>(mtcars<span class="sc">$</span>wt, mtcars<span class="sc">$</span>mpg)</span>
<span id="cb848-7"><a href="#cb848-7" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">5</span>, <span class="at">b =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb848-8"><a href="#cb848-8" tabindex="-1"></a><span class="co"># Second Plot</span></span>
<span id="cb848-9"><a href="#cb848-9" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb848-10"><a href="#cb848-10" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb848-11"><a href="#cb848-11" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">5</span>,</span>
<span id="cb848-12"><a href="#cb848-12" tabindex="-1"></a>              <span class="at">slope =</span> <span class="dv">3</span>,</span>
<span id="cb848-13"><a href="#cb848-13" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;seagreen&quot;</span>)</span>
<span id="cb848-14"><a href="#cb848-14" tabindex="-1"></a><span class="co"># Device Off</span></span>
<span id="cb848-15"><a href="#cb848-15" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## png 
##   2</code></pre>
<hr />
<!--chapter:end:09-1ggplot2.Rmd-->
</div>
</div>
</div>
<div id="DPLYRR" class="section level1" number="14">
<h1><span class="header-section-number">14</span> Data Transformation in <code>dplyr</code></h1>
<p><strong>Prerequisites</strong>
Obviously <code>dplyr</code><span class="citation"><a href="#fn22" class="footnote-ref" id="fnref22"><sup>22</sup></a></span> will be needed. This package also comes with matrittr pipe i.e. <code>%&gt;%</code> and therefore in dplyr syntax we will be using these pipes. <code>library(magrittr)</code> is not needed.</p>
<div class="sourceCode" id="cb850"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb850-1"><a href="#cb850-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb850-2"><a href="#cb850-2" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code></pre></div>
<p>The package <code>dplyr</code> (@ref(fig:dplyrr)) calls its functions as ‘verbs’ because these are actually doing some action. So <code>dplyr verbs</code> can be divided in three classifications depending upon where they operate -</p>
<ul>
<li>‘Row’ verbs that operate on Rows</li>
<li>‘Column’ verbs</li>
<li>‘group’ verbs that operate on table split into different groups.</li>
</ul>
<div class="figure" style="text-align: center">
<img src="images/dplyr.png" alt="Package Dplyr" width="99%" />
<p class="caption">
(#fig:dplyrr)Package Dplyr
</p>
</div>
<p>Let’s learn each of these -</p>
<div id="column-verb-select" class="section level2" number="14.1">
<h2><span class="header-section-number">14.1</span> Column verb <code>select()</code></h2>
<p>In real world data sets we will often come across with data frames having numerous columns. However for many of the data analysis tasks, most of these columns are not needed. As already stated <code>select</code> (figure @ref(fig:selectr)) operates on columns. Like <code>SELECT</code> in <code>SQL</code>, it just <em>select</em> the column(s) from the given data frame. The basic syntax is - <code>select(data_frame, column_names, ...)</code>. So with pipes the same syntax goes like this</p>
<pre><code>data_frame %&gt;% 
  select(column_name)</code></pre>
<div class="figure" style="text-align: center">
<img src="images/select_dplyr.png" alt="Illustration of dplyr::select()" width="99%" />
<p class="caption">
(#fig:selectr)Illustration of dplyr::select()
</p>
</div>
<p>For example, let’s try our hands on <code>mtcars</code> dataset.<br />
Example-1</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb852-1"><a href="#cb852-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb852-2"><a href="#cb852-2" tabindex="-1"></a>  <span class="fu">select</span>(mpg)</span></code></pre></div>
<pre><code>##                      mpg
## Mazda RX4           21.0
## Mazda RX4 Wag       21.0
## Datsun 710          22.8
## Hornet 4 Drive      21.4
## Hornet Sportabout   18.7
## Valiant             18.1
## Duster 360          14.3
## Merc 240D           24.4
## Merc 230            22.8
## Merc 280            19.2
## Merc 280C           17.8
## Merc 450SE          16.4
## Merc 450SL          17.3
## Merc 450SLC         15.2
## Cadillac Fleetwood  10.4
## Lincoln Continental 10.4
## Chrysler Imperial   14.7
## Fiat 128            32.4
## Honda Civic         30.4
## Toyota Corolla      33.9
## Toyota Corona       21.5
## Dodge Challenger    15.5
## AMC Javelin         15.2
## Camaro Z28          13.3
## Pontiac Firebird    19.2
## Fiat X1-9           27.3
## Porsche 914-2       26.0
## Lotus Europa        30.4
## Ford Pantera L      15.8
## Ferrari Dino        19.7
## Maserati Bora       15.0
## Volvo 142E          21.4</code></pre>
<p><strong>Note</strong> that output is still a data frame unlike the <code>mtcars[['mpg']]</code> which returns a vector. We can subset multiple columns here. Example-2</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb854-1"><a href="#cb854-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb854-2"><a href="#cb854-2" tabindex="-1"></a>  <span class="fu">select</span>(mpg, qsec) <span class="sc">%&gt;%</span> </span>
<span id="cb854-3"><a href="#cb854-3" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##                    mpg  qsec
## Mazda RX4         21.0 16.46
## Mazda RX4 Wag     21.0 17.02
## Datsun 710        22.8 18.61
## Hornet 4 Drive    21.4 19.44
## Hornet Sportabout 18.7 17.02
## Valiant           18.1 20.22</code></pre>
<p>We can also provide column numbers instead of names. Example-3</p>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb856-1"><a href="#cb856-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb856-2"><a href="#cb856-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">4</span>, <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb856-3"><a href="#cb856-3" tabindex="-1"></a>  <span class="fu">tail</span>()</span></code></pre></div>
<pre><code>##                 hp    wt
## Porsche 914-2   91 2.140
## Lotus Europa   113 1.513
## Ford Pantera L 264 3.170
## Ferrari Dino   175 2.770
## Maserati Bora  335 3.570
## Volvo 142E     109 2.780</code></pre>
<p>We can also use <code>select</code> to reorder the columns in output, by using a <code>dplyr</code> <em>helping verb</em> <code>everything()</code> which is basically <em>everything else.</em> See this example-</p>
<div class="sourceCode" id="cb858"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb858-1"><a href="#cb858-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb858-2"><a href="#cb858-2" tabindex="-1"></a>  <span class="fu">select</span>(qsec, mpg, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb858-3"><a href="#cb858-3" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;qsec&quot; &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;
## [11] &quot;carb&quot;</code></pre>
<p>We may also use mix and match of <em>column names</em> and <em>column numbers</em>. See</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb860-1"><a href="#cb860-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb860-2"><a href="#cb860-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">5</span>, <span class="dv">7</span>, mpg, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb860-3"><a href="#cb860-3" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;drat&quot; &quot;qsec&quot; &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;wt&quot;   &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;
## [11] &quot;carb&quot;</code></pre>
<p>Operator <code>:</code> can also be used with column names. Ex-</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="#cb862-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb862-2"><a href="#cb862-2" tabindex="-1"></a>  <span class="fu">select</span>(mpg<span class="sc">:</span>drat) <span class="sc">%&gt;%</span> </span>
<span id="cb862-3"><a href="#cb862-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">4</span>)</span></code></pre></div>
<pre><code>##                 mpg cyl disp  hp drat
## Mazda RX4      21.0   6  160 110 3.90
## Mazda RX4 Wag  21.0   6  160 110 3.90
## Datsun 710     22.8   4  108  93 3.85
## Hornet 4 Drive 21.4   6  258 110 3.08</code></pre>
<p><strong>Other helping verbs</strong>
There are other helping verbs, apart from <code>everything()</code> that can be used within <code>select()</code> just to eliminate need to type the column names and select columns based on some conditions. These verbs are self explanatory-</p>
<ul>
<li><code>starts_with('ABC')</code> will select all columns the names of which <strong>starts with</strong> string <code>ABC</code></li>
<li><code>ends_with('ABC')</code> will select all columns the names of which <strong>ends with</strong> string <code>ABC</code></li>
<li><code>contains('ABC')</code> will select all columns the names of which <strong>contains</strong> string <code>ABC</code></li>
<li><code>num_range('A', 1:3)</code> will select all columns named <code>A1</code>, <code>A2</code> and <code>A3</code></li>
</ul>
<p>Some Examples.</p>
<ol style="list-style-type: decimal">
<li>This syntax will select all columns which ends with <code>"color"</code> in column names.</li>
</ol>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb864-1"><a href="#cb864-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb864-2"><a href="#cb864-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&#39;color&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    hair_color    skin_color  eye_color
##    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    
##  1 blond         fair        blue     
##  2 &lt;NA&gt;          gold        yellow   
##  3 &lt;NA&gt;          white, blue red      
##  4 none          white       yellow   
##  5 brown         light       brown    
##  6 brown, grey   light       blue     
##  7 brown         light       blue     
##  8 &lt;NA&gt;          white, red  red      
##  9 black         light       brown    
## 10 auburn, white fair        blue-gray
## # ℹ 77 more rows</code></pre>
<p>Example-2: This syntax will select all columns contains characters <code>"or"</code> in column names.</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb866-1"><a href="#cb866-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb866-2"><a href="#cb866-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&#39;or&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 87 × 4
##    hair_color    skin_color  eye_color homeworld
##    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;    
##  1 blond         fair        blue      Tatooine 
##  2 &lt;NA&gt;          gold        yellow    Tatooine 
##  3 &lt;NA&gt;          white, blue red       Naboo    
##  4 none          white       yellow    Tatooine 
##  5 brown         light       brown     Alderaan 
##  6 brown, grey   light       blue      Tatooine 
##  7 brown         light       blue      Tatooine 
##  8 &lt;NA&gt;          white, red  red       Tatooine 
##  9 black         light       brown     Tatooine 
## 10 auburn, white fair        blue-gray Stewjon  
## # ℹ 77 more rows</code></pre>
<p><strong>Using <code>where()</code></strong>: This selection helper selects the variables for which a <em>function</em> when applied to column names, returns <code>TRUE</code>.</p>
<p>Example-3: This syntax will select all numeric columns from the dataset.</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb868-1"><a href="#cb868-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb868-2"><a href="#cb868-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
##    height  mass birth_year
##     &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1    172    77       19  
##  2    167    75      112  
##  3     96    32       33  
##  4    202   136       41.9
##  5    150    49       19  
##  6    178   120       52  
##  7    165    75       47  
##  8     97    32       NA  
##  9    183    84       24  
## 10    182    77       57  
## # ℹ 77 more rows</code></pre>
</div>
<div id="column-verbmutate" class="section level2" number="14.2">
<h2><span class="header-section-number">14.2</span> Column verb<code>mutate()</code></h2>
<p>This perhaps is one of the most important functions in <code>dplyr</code> kitty. It enables us to create new column(s) that are functions of one or more existing columns. Refer figure @ref(fig:mutater)</p>
<div class="figure" style="text-align: center">
<img src="images/mutate_dplyr.png" alt="Illustration of dplyr::mutate()" width="99%" />
<p class="caption">
(#fig:mutater)Illustration of dplyr::mutate()
</p>
</div>
<p>More than one column can be added simultaneously. Newly created column may also be used for creation of another new column. See example.</p>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb870-1"><a href="#cb870-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb870-2"><a href="#cb870-2" tabindex="-1"></a>  <span class="fu">select</span>(name<span class="sc">:</span>mass) <span class="sc">%&gt;%</span> </span>
<span id="cb870-3"><a href="#cb870-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name_upper =</span> <span class="fu">toupper</span>(name),</span>
<span id="cb870-4"><a href="#cb870-4" tabindex="-1"></a>         <span class="at">BMI =</span> mass<span class="sc">/</span>(height<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 5
##    name               height  mass name_upper           BMI
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
##  1 Luke Skywalker        172    77 LUKE SKYWALKER      26.0
##  2 C-3PO                 167    75 C-3PO               26.9
##  3 R2-D2                  96    32 R2-D2               34.7
##  4 Darth Vader           202   136 DARTH VADER         33.3
##  5 Leia Organa           150    49 LEIA ORGANA         21.8
##  6 Owen Lars             178   120 OWEN LARS           37.9
##  7 Beru Whitesun Lars    165    75 BERU WHITESUN LARS  27.5
##  8 R5-D4                  97    32 R5-D4               34.0
##  9 Biggs Darklighter     183    84 BIGGS DARKLIGHTER   25.1
## 10 Obi-Wan Kenobi        182    77 OBI-WAN KENOBI      23.2
## # ℹ 77 more rows</code></pre>
<p>By default the new column will be added to the last of data frame. As shown in above example, more operations can be combined in one using <code>%&gt;%</code>. There is a cousin <code>transmute()</code> of <em>mutate</em> which drops all the old columns and keeps only newly created columns. Example</p>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb872-1"><a href="#cb872-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb872-2"><a href="#cb872-2" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">name_upper =</span> <span class="fu">toupper</span>(name))</span></code></pre></div>
<pre><code>## # A tibble: 87 × 1
##    name_upper        
##    &lt;chr&gt;             
##  1 LUKE SKYWALKER    
##  2 C-3PO             
##  3 R2-D2             
##  4 DARTH VADER       
##  5 LEIA ORGANA       
##  6 OWEN LARS         
##  7 BERU WHITESUN LARS
##  8 R5-D4             
##  9 BIGGS DARKLIGHTER 
## 10 OBI-WAN KENOBI    
## # ℹ 77 more rows</code></pre>
<p><strong>Other useful dplyr functions</strong> Another good use of <code>mutate</code> is to generate summarised result and display it corresponding to each row in data. For example if the requirement is to calculate proportion of say <code>wt</code> column in <code>mtcars</code> data.</p>
<div class="sourceCode" id="cb874"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb874-1"><a href="#cb874-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb874-2"><a href="#cb874-2" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb874-3"><a href="#cb874-3" tabindex="-1"></a>  <span class="fu">select</span>(wt) <span class="sc">%&gt;%</span> </span>
<span id="cb874-4"><a href="#cb874-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_wt =</span> <span class="fu">sum</span>(wt),</span>
<span id="cb874-5"><a href="#cb874-5" tabindex="-1"></a>         <span class="at">wt_proportion =</span> wt<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span>total_wt) </span></code></pre></div>
<pre><code>##                      wt total_wt wt_proportion
## Mazda RX4         2.620    17.93      14.61238
## Mazda RX4 Wag     2.875    17.93      16.03458
## Datsun 710        2.320    17.93      12.93921
## Hornet 4 Drive    3.215    17.93      17.93084
## Hornet Sportabout 3.440    17.93      19.18572
## Valiant           3.460    17.93      19.29727</code></pre>
<ol style="list-style-type: decimal">
<li><code>n()</code> is used to count number of rows</li>
<li><code>n_distinct()</code> is used to count number of distinct values for the given variable</li>
</ol>
<div class="sourceCode" id="cb876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="#cb876-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb876-2"><a href="#cb876-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb876-3"><a href="#cb876-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_cars =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb876-4"><a href="#cb876-4" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##                    mpg cyl disp  hp drat total_cars
## Mazda RX4         21.0   6  160 110 3.90         32
## Mazda RX4 Wag     21.0   6  160 110 3.90         32
## Datsun 710        22.8   4  108  93 3.85         32
## Hornet 4 Drive    21.4   6  258 110 3.08         32
## Hornet Sportabout 18.7   8  360 175 3.15         32
## Valiant           18.1   6  225 105 2.76         32</code></pre>
</div>
<div id="column-verb-rename" class="section level2" number="14.3">
<h2><span class="header-section-number">14.3</span> Column verb <code>rename()</code></h2>
<p>It is used to <em>rename</em> the column names. Refer figure @ref(fig:renamer) for illustration.</p>
<div class="figure" style="text-align: center">
<img src="images/rename_dplyr.png" alt="Illustration of dplyr::rename()" width="99%" />
<p class="caption">
(#fig:renamer)Illustration of dplyr::rename()
</p>
</div>
<p>See this example</p>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="#cb878-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb878-2"><a href="#cb878-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">miles_per_gallon =</span> mpg) <span class="sc">%&gt;%</span> </span>
<span id="cb878-3"><a href="#cb878-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##               miles_per_gallon cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4                 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag             21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710                22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</code></pre>
<p><strong>Note</strong> that <code>select</code> can also rename the columns but will drop all unselected columns. Check this</p>
<div class="sourceCode" id="cb880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb880-1"><a href="#cb880-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb880-2"><a href="#cb880-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">miles_per_gallon =</span> mpg) <span class="sc">%&gt;%</span> </span>
<span id="cb880-3"><a href="#cb880-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##               miles_per_gallon
## Mazda RX4                 21.0
## Mazda RX4 Wag             21.0
## Datsun 710                22.8</code></pre>
</div>
<div id="column-verb-relocate" class="section level2" number="14.4">
<h2><span class="header-section-number">14.4</span> Column verb <code>relocate()</code></h2>
<p>It <em>relocates</em> column or block of columns simultaneosly either before the column mentioned in argument <code>.before</code> or after mentioned in <code>.after</code>. See the example-</p>
<div class="sourceCode" id="cb882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb882-1"><a href="#cb882-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb882-2"><a href="#cb882-2" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">ends_with</span>(<span class="st">&#39;color&#39;</span>), <span class="at">.after =</span> name) <span class="sc">%&gt;%</span> </span>
<span id="cb882-3"><a href="#cb882-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 14
##   name      hair_color skin_color eye_color height  mass birth_year sex   gender
##   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Luke Sky… blond      fair       blue         172    77       19   male  mascu…
## 2 C-3PO     &lt;NA&gt;       gold       yellow       167    75      112   none  mascu…
## 3 R2-D2     &lt;NA&gt;       white, bl… red           96    32       33   none  mascu…
## 4 Darth Va… none       white      yellow       202   136       41.9 male  mascu…
## 5 Leia Org… brown      light      brown        150    49       19   fema… femin…
## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
<div id="row-verb-filter" class="section level2" number="14.5">
<h2><span class="header-section-number">14.5</span> Row verb <code>filter</code></h2>
<p>This verb/function is used to subset the data, or in other words filter rows of data frame based on certain condition. Refer figure @ref(fig:filterr) for illustration.</p>
<div class="figure" style="text-align: center">
<img src="images/filter_dplyr.png" alt="Illustration of dplyr::filter()" width="99%" />
<p class="caption">
(#fig:filterr)Illustration of dplyr::filter()
</p>
</div>
<p>See this example-</p>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="#cb884-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb884-2"><a href="#cb884-2" tabindex="-1"></a>  <span class="fu">filter</span>(eye_color <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;red&#39;</span>, <span class="st">&#39;yellow&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 16 × 14
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
##  2 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
##  3 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
##  4 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
##  5 Palpati…    170    75 grey       pale       yellow          82   male  mascu…
##  6 IG-88       200   140 none       metal      red             15   none  mascu…
##  7 Bossk       190   113 none       green      red             53   male  mascu…
##  8 Nute Gu…    191    90 none       mottled g… red             NA   male  mascu…
##  9 Watto       137    NA black      blue, grey yellow          NA   male  mascu…
## 10 Darth M…    175    80 none       red        yellow          54   male  mascu…
## 11 Dud Bolt     94    45 none       blue, grey yellow          NA   male  mascu…
## 12 Ki-Adi-…    198    82 white      pale       yellow          92   male  mascu…
## 13 Yarael …    264    NA none       white      yellow          NA   male  mascu…
## 14 Poggle …    183    80 none       green      yellow          NA   male  mascu…
## 15 Zam Wes…    168    55 blonde     fair, gre… yellow          NA   fema… femin…
## 16 Dexter …    198   102 none       brown      yellow          NA   male  mascu…
## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Multiple conditions can be passed simultaneously. Example</p>
<div class="sourceCode" id="cb886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb886-1"><a href="#cb886-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb886-2"><a href="#cb886-2" tabindex="-1"></a>  <span class="fu">filter</span>(skin_color <span class="sc">==</span> <span class="st">&#39;white&#39;</span>,</span>
<span id="cb886-3"><a href="#cb886-3" tabindex="-1"></a>         height <span class="sc">&gt;=</span> <span class="dv">150</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
## 2 Yarael P…    264    NA none       white      yellow          NA   male  mascu…
## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p><strong>Note</strong> that these conditions act simultaneously as in operator <code>AND</code> is used. So if <code>OR</code> is to be used, use <code>|</code> explicitly</p>
<div class="sourceCode" id="cb888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb888-1"><a href="#cb888-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb888-2"><a href="#cb888-2" tabindex="-1"></a>  <span class="fu">filter</span>(skin_color <span class="sc">==</span> <span class="st">&#39;white&#39;</span> <span class="sc">|</span> height <span class="sc">&gt;=</span> <span class="dv">150</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb888-3"><a href="#cb888-3" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 71</code></pre>
</div>
<div id="slice_func" class="section level2" number="14.6">
<h2><span class="header-section-number">14.6</span> Row verbs <code>slice()</code> / <code>slice_*()</code></h2>
<p><code>slice()</code> and its cousins also filters rows but based on rows placement. So, <code>data_fr %&gt;% slice(1:5)</code> will filter out first five rows of the <code>data_fr</code>. See example</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="#cb890-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb890-2"><a href="#cb890-2" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">10</span>) <span class="co"># filter 4 to 10th row</span></span></code></pre></div>
<pre><code>## # A tibble: 7 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
## 2 Leia Org…    150    49 brown      light      brown           19   fema… femin…
## 3 Owen Lars    178   120 brown, gr… light      blue            52   male  mascu…
## 4 Beru Whi…    165    75 brown      light      blue            47   fema… femin…
## 5 R5-D4         97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
## 6 Biggs Da…    183    84 black      light      brown           24   male  mascu…
## 7 Obi-Wan …    182    77 auburn, w… fair       blue-gray       57   male  mascu…
## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Other <code>slice()</code> cousins -</p>
<ul>
<li><code>slice_head(5)</code> will slice out first 5 rows</li>
<li><code>slice_tail(10)</code> will slice out last 10 rows</li>
<li><code>slice_min()</code> or <code>slice_max()</code> will slice rows with highest or lowest values of given variable. The full syntax is <code>slice_max(.data, order_by, ..., n, prop, with_ties = TRUE)</code> or equivalent</li>
<li><code>slice_sample()</code> will randomly select the rows. Its syntax is <code>slice_sample(.data, ..., n, prop, weight_by = NULL, replace = FALSE)</code></li>
</ul>
<p>Example-1:</p>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="#cb892-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb892-2"><a href="#cb892-2" tabindex="-1"></a>  <span class="fu">slice_min</span>(height, <span class="at">n=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Yoda          66    17 white      green      brown            896 male  mascu…
## 2 Ratts Ty…     79    15 none       grey, blue unknown           NA male  mascu…
## 3 Wicket S…     88    20 brown      brown      brown              8 male  mascu…
## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p>Example-2:</p>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb894-1"><a href="#cb894-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb894-2"><a href="#cb894-2" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb894-3"><a href="#cb894-3" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.1</span>) <span class="co">#sample 10% rows</span></span></code></pre></div>
<pre><code>## # A tibble: 8 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Ki-Adi-M…    198  82   white      pale       yellow            92 male  mascu…
## 2 Grievous     216 159   none       brown, wh… green, y…         NA male  mascu…
## 3 Saesee T…    188  NA   none       pale       orange            NA male  mascu…
## 4 Wat Tamb…    193  48   none       green, gr… unknown           NA male  mascu…
## 5 Jango Fe…    183  79   black      tan        brown             66 male  mascu…
## 6 Owen Lars    178 120   brown, gr… light      blue              52 male  mascu…
## 7 Luminara…    170  56.2 black      yellow     blue              58 fema… femin…
## 8 BB8           NA  NA   none       none       black             NA none  mascu…
## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
<div id="row-verb-arrange" class="section level2" number="14.7">
<h2><span class="header-section-number">14.7</span> Row verb <code>arrange()</code></h2>
<p>This verb also act upon rows and it actually <em>rearranges</em> them on the basis of some condition. Refer figure @ref(fig:arranger) for illustration.</p>
<div class="figure" style="text-align: center">
<img src="images/arrange_dplyr.png" alt="Illustration of dplyr::arrange()" width="99%" />
<p class="caption">
(#fig:arranger)Illustration of dplyr::arrange()
</p>
</div>
<p>Example-</p>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="#cb896-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb896-2"><a href="#cb896-2" tabindex="-1"></a>  <span class="fu">arrange</span>(height) <span class="sc">%&gt;%</span> </span>
<span id="cb896-3"><a href="#cb896-3" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 14
##   name      height  mass hair_color skin_color eye_color birth_year sex   gender
##   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 Yoda          66    17 white      green      brown            896 male  mascu…
## 2 Ratts Ty…     79    15 none       grey, blue unknown           NA male  mascu…
## 3 Wicket S…     88    20 brown      brown      brown              8 male  mascu…
## 4 Dud Bolt      94    45 none       blue, grey yellow            NA male  mascu…
## 5 R2-D2         96    32 &lt;NA&gt;       white, bl… red               33 none  mascu…
## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
<div id="group-verb-group_by" class="section level2" number="14.8">
<h2><span class="header-section-number">14.8</span> Group verb <code>group_by()</code></h2>
<p>A data analyst will be hard to find who is not using <code>group_by</code>. It basically groups the rows on the basis of values of a given variable or block of variables. The returned result is still a data frame (and one too) but now the rows are grouped. Refer figure @ref(fig:groupby) for illustration. So any of the above functions we learnt above will give a different result after group by.</p>
<div class="figure" style="text-align: center">
<img src="images/groupby_dplyr.png" alt="Illustration of Grouped Operations in dplyr" width="99%" />
<p class="caption">
(#fig:groupby)Illustration of Grouped Operations in dplyr
</p>
</div>
<p>Note the output of this simple example</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="#cb898-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb898-2"><a href="#cb898-2" tabindex="-1"></a>  <span class="fu">group_by</span>(sex)</span></code></pre></div>
<pre><code>## # A tibble: 87 × 14
## # Groups:   sex [5]
##    name     height  mass hair_color skin_color eye_color birth_year sex   gender
##    &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
##  2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
##  3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
##  4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
##  5 Leia Or…    150    49 brown      light      brown           19   fema… femin…
##  6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
##  7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
##  8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
##  9 Biggs D…    183    84 black      light      brown           24   male  mascu…
## 10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
## # ℹ 77 more rows
## # ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<p><strong>Note</strong> that output now has 5 groups, though nothing different is seen in the displayed data.</p>
<p>This operation/verb is thus more useful if used in combination with other verbs.</p>
<p>Example-1: How many total characters are with same skin_color?</p>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="#cb900-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb900-2"><a href="#cb900-2" tabindex="-1"></a>  <span class="fu">select</span>(name, skin_color) <span class="sc">%&gt;%</span> </span>
<span id="cb900-3"><a href="#cb900-3" tabindex="-1"></a>  <span class="fu">group_by</span>(skin_color) <span class="sc">%&gt;%</span> </span>
<span id="cb900-4"><a href="#cb900-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_with_s_c =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 87 × 3
## # Groups:   skin_color [31]
##    name               skin_color  total_with_s_c
##    &lt;chr&gt;              &lt;chr&gt;                &lt;int&gt;
##  1 Luke Skywalker     fair                    17
##  2 C-3PO              gold                     1
##  3 R2-D2              white, blue              2
##  4 Darth Vader        white                    2
##  5 Leia Organa        light                   11
##  6 Owen Lars          light                   11
##  7 Beru Whitesun Lars light                   11
##  8 R5-D4              white, red               1
##  9 Biggs Darklighter  light                   11
## 10 Obi-Wan Kenobi     fair                    17
## # ℹ 77 more rows</code></pre>
<p>Example- 2: Sample 2 rows of each <code>cyl</code> size from <code>mtcars</code>?</p>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb902-1"><a href="#cb902-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb902-2"><a href="#cb902-2" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb902-3"><a href="#cb902-3" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb902-4"><a href="#cb902-4" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 11
## # Groups:   cyl [3]
##     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 2  21.4     4  121    109  4.11  2.78  18.6     1     1     4     2
## 3  21       6  160    110  3.9   2.88  17.0     0     1     4     4
## 4  19.7     6  145    175  3.62  2.77  15.5     0     1     5     6
## 5  10.4     8  472    205  2.93  5.25  18.0     0     0     3     4
## 6  13.3     8  350    245  3.73  3.84  15.4     0     0     3     4</code></pre>
<p>Also note that <code>grouped</code> varaible(s) will always be available in the output.</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb904-1"><a href="#cb904-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb904-2"><a href="#cb904-2" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb904-3"><a href="#cb904-3" tabindex="-1"></a>  <span class="fu">select</span>(drat) <span class="sc">%&gt;%</span> <span class="co"># despite not selecting cyl</span></span>
<span id="cb904-4"><a href="#cb904-4" tabindex="-1"></a>  <span class="fu">head</span>() <span class="co"># it is available in output</span></span></code></pre></div>
<pre><code>## Adding missing grouping variables: `cyl`</code></pre>
<pre><code>## # A tibble: 6 × 2
## # Groups:   cyl [3]
##     cyl  drat
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     6  3.9 
## 2     6  3.9 
## 3     4  3.85
## 4     6  3.08
## 5     8  3.15
## 6     6  2.76</code></pre>
</div>
<div id="group-verb-summarise" class="section level2" number="14.9">
<h2><span class="header-section-number">14.9</span> Group verb <code>summarise()</code></h2>
<p>This verb creates a summary row for each group if grouped data frame is in input, otherwise one single for complete operation.<br />
Example-1:</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="#cb907-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb907-2"><a href="#cb907-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_wt =</span> <span class="fu">sum</span>(wt))</span></code></pre></div>
<pre><code>##   total_wt
## 1  102.952</code></pre>
<p>Example-2:</p>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb909-1"><a href="#cb909-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb909-2"><a href="#cb909-2" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb909-3"><a href="#cb909-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_wt =</span> <span class="fu">sum</span>(wt))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##     cyl total_wt
##   &lt;dbl&gt;    &lt;dbl&gt;
## 1     4     25.1
## 2     6     21.8
## 3     8     56.0</code></pre>
</div>
<div id="group-verb-ungroup" class="section level2" number="14.10">
<h2><span class="header-section-number">14.10</span> Group verb <code>ungroup()</code></h2>
<p>But now, it may have been noticed that grouping the data with <code>group_by</code> and thereafter performing some operation like <code>mutate</code> or <code>slice</code> returns the grouped data. But our requirement in next steps would be of ungrouped data. so there is specially designed function in dplyr which ungroups the grouped data.</p>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb911-1"><a href="#cb911-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb911-2"><a href="#cb911-2" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb911-3"><a href="#cb911-3" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb911-4"><a href="#cb911-4" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb911-5"><a href="#cb911-5" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 11
##     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 2  21.4     4  121    109  4.11  2.78  18.6     1     1     4     2
## 3  21       6  160    110  3.9   2.88  17.0     0     1     4     4
## 4  19.7     6  145    175  3.62  2.77  15.5     0     1     5     6
## 5  10.4     8  472    205  2.93  5.25  18.0     0     0     3     4
## 6  13.3     8  350    245  3.73  3.84  15.4     0     0     3     4</code></pre>
</div>
<div id="new-argument-.by-in-mutate-summarise-filter-etc." class="section level2" number="14.11">
<h2><span class="header-section-number">14.11</span> New argument <code>.by</code> in <code>mutate</code>, <code>summarise</code>, <code>filter</code>, etc.</h2>
<p>Since grouping the data in one step, then performing required step and then again ungrouping it is somewhat cumbersome, coming dplyr 1.1.0 version, the functions <code>mutate()</code>, <code>summarise</code>, <code>slice</code> etc. have gained an additional argument <code>.by</code> wherein the variable names for performing grouped operations may be provided directly, thus eliminating the need of both grouping and ungrouping it. So the following two syntax would produce exactly same results.</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="#cb913-1" tabindex="-1"></a><span class="co"># Syntax - 1 (old style)</span></span>
<span id="cb913-2"><a href="#cb913-2" tabindex="-1"></a></span>
<span id="cb913-3"><a href="#cb913-3" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb913-4"><a href="#cb913-4" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb913-5"><a href="#cb913-5" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb913-6"><a href="#cb913-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 × 11
##     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
## 2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
## 3  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4</code></pre>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb915-1"><a href="#cb915-1" tabindex="-1"></a><span class="co"># Syntax 2 (Dplyr 1.1.0 +)</span></span>
<span id="cb915-2"><a href="#cb915-2" tabindex="-1"></a></span>
<span id="cb915-3"><a href="#cb915-3" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb915-4"><a href="#cb915-4" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">2</span>, <span class="at">.by =</span> cyl)</span></code></pre></div>
<pre><code>##                mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4 Wag 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Merc 240D     24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Duster 360    14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4</code></pre>
</div>
<div id="group-verb-reframe" class="section level2" number="14.12">
<h2><span class="header-section-number">14.12</span> Group verb <code>reframe()</code></h2>
<p><strong>The content is under development.</strong></p>
</div>
<div id="other-useful-functions-in-dplyr" class="section level2" number="14.13">
<h2><span class="header-section-number">14.13</span> Other Useful functions in <code>dplyr</code></h2>
<div id="if_else" class="section level3 unnumbered">
<h3 class="unnumbered"><code>if_else()</code></h3>
<p>This function operates nearly as similar to base R’s <code>ifelse()</code> with two exceptions-</p>
<ul>
<li>There is an extra argument to provide values when missing values are encountered. (See example-1)</li>
<li><code>NA</code> will have to be provided specifically. (See Example-2)</li>
</ul>
<p>See these examples. Example-1:</p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb917-1"><a href="#cb917-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">:</span><span class="dv">2</span>, <span class="cn">NA</span>)</span>
<span id="cb917-2"><a href="#cb917-2" tabindex="-1"></a><span class="fu">if_else</span>(x<span class="sc">&gt;=</span><span class="dv">0</span>, <span class="st">&quot;positive&quot;</span>, <span class="st">&quot;negative&quot;</span>, <span class="st">&quot;missing&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;negative&quot; &quot;negative&quot; &quot;positive&quot; &quot;positive&quot; &quot;positive&quot; &quot;missing&quot;</code></pre>
<p>Example-2:</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="#cb919-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">:</span><span class="dv">2</span>, <span class="cn">NA</span>)</span>
<span id="cb919-2"><a href="#cb919-2" tabindex="-1"></a><span class="fu">if_else</span>(x<span class="sc">&gt;=</span><span class="dv">0</span>, <span class="st">&quot;positive&quot;</span>, <span class="st">&quot;negative&quot;</span>, <span class="cn">NA_character_</span>)</span></code></pre></div>
<pre><code>## [1] &quot;negative&quot; &quot;negative&quot; &quot;positive&quot; &quot;positive&quot; &quot;positive&quot; NA</code></pre>
<p>Due to the additional restrictions, this function is sometimes faster than its base R alternative and may also be useful in prevention of bugs in code as the output will be known beforehand.</p>
</div>
<div id="case_when" class="section level3 unnumbered">
<h3 class="unnumbered"><code>case_when()</code></h3>
<p>Though both <code>ifelse</code> and <code>if_else</code> variants provide for nesting multiple conditions, yet <code>case_when</code> provides a simpler alternative in these conditions as here multiple conditions can be provided simultaneously. Syntax follows this style-</p>
<pre><code>case_when(
  condition1 ~ value_if_true,
  condition2 ~ value_if_true,
  ...,
  TRUE ~ value_if_all_above_are_false
)</code></pre>
<p>See this example.</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="#cb922-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb922-2"><a href="#cb922-2" tabindex="-1"></a><span class="co"># Generate Incomes from random (uniform) distribution</span></span>
<span id="cb922-3"><a href="#cb922-3" tabindex="-1"></a>income <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">9</span>)<span class="sc">*</span><span class="dv">100000</span></span>
<span id="cb922-4"><a href="#cb922-4" tabindex="-1"></a>income</span></code></pre></div>
<pre><code>## [1] 330062.0 730644.1 427181.5 806413.9 852373.8 136445.2 522484.4</code></pre>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="#cb924-1" tabindex="-1"></a><span class="co"># tax brackets say 0% upto 2 lakh, then 10% upto 5 Lakh</span></span>
<span id="cb924-2"><a href="#cb924-2" tabindex="-1"></a><span class="co"># then 20% upto 7.5 lakh otherwise 30%</span></span>
<span id="cb924-3"><a href="#cb924-3" tabindex="-1"></a>tax_slab <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb924-4"><a href="#cb924-4" tabindex="-1"></a>  income <span class="sc">&lt;=</span> <span class="dv">200000</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb924-5"><a href="#cb924-5" tabindex="-1"></a>  income <span class="sc">&lt;=</span> <span class="dv">500000</span> <span class="sc">~</span> <span class="dv">10</span>,</span>
<span id="cb924-6"><a href="#cb924-6" tabindex="-1"></a>  income <span class="sc">&lt;=</span> <span class="dv">750000</span> <span class="sc">~</span> <span class="dv">20</span>,</span>
<span id="cb924-7"><a href="#cb924-7" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">30</span></span>
<span id="cb924-8"><a href="#cb924-8" tabindex="-1"></a>)</span>
<span id="cb924-9"><a href="#cb924-9" tabindex="-1"></a></span>
<span id="cb924-10"><a href="#cb924-10" tabindex="-1"></a><span class="co"># check tax_slab</span></span>
<span id="cb924-11"><a href="#cb924-11" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb924-12"><a href="#cb924-12" tabindex="-1"></a>  <span class="at">income=</span>income,</span>
<span id="cb924-13"><a href="#cb924-13" tabindex="-1"></a>  <span class="at">tax_slab =</span> tax_slab</span>
<span id="cb924-14"><a href="#cb924-14" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##     income tax_slab
## 1 330062.0       10
## 2 730644.1       20
## 3 427181.5       10
## 4 806413.9       30
## 5 852373.8       30
## 6 136445.2        0
## 7 522484.4       20</code></pre>
</div>
<div id="case_match" class="section level3 unnumbered">
<h3 class="unnumbered"><code>case_match()</code></h3>
<p>This function is somewhat similar to <code>case_when</code>. While <code>case_when()</code> uses logical expressions on the left-hand side of the formula, <code>case_match()</code> uses values to match with. Syntax is like</p>
<pre><code>case_match(
  .x,  # A vector whose values are to be matched
  ..., # Basically for a condition like .x %in% Y, only Y has to be specified
  .default = NULL, # Default values to be specified for if no match is found
)</code></pre>
<p>So, above example could be rewritten as</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb927-1"><a href="#cb927-1" tabindex="-1"></a>tax_slab <span class="ot">&lt;-</span> <span class="fu">case_match</span>(</span>
<span id="cb927-2"><a href="#cb927-2" tabindex="-1"></a>  <span class="fu">floor</span>(income), <span class="co"># Vector to be checked</span></span>
<span id="cb927-3"><a href="#cb927-3" tabindex="-1"></a>  <span class="dv">0</span><span class="sc">:</span><span class="dv">200000</span> <span class="sc">~</span> <span class="dv">0</span>, <span class="co"># slab 1</span></span>
<span id="cb927-4"><a href="#cb927-4" tabindex="-1"></a>  <span class="dv">200001</span><span class="sc">:</span><span class="dv">500000</span> <span class="sc">~</span> <span class="dv">10</span>, <span class="co"># slab 2</span></span>
<span id="cb927-5"><a href="#cb927-5" tabindex="-1"></a>  <span class="dv">500001</span><span class="sc">:</span><span class="dv">750000</span> <span class="sc">~</span> <span class="dv">20</span>, <span class="co"># slab 3</span></span>
<span id="cb927-6"><a href="#cb927-6" tabindex="-1"></a>  <span class="at">.default =</span> <span class="dv">30</span> <span class="co"># Slab 4</span></span>
<span id="cb927-7"><a href="#cb927-7" tabindex="-1"></a>)</span>
<span id="cb927-8"><a href="#cb927-8" tabindex="-1"></a></span>
<span id="cb927-9"><a href="#cb927-9" tabindex="-1"></a><span class="co"># check tax_slab</span></span>
<span id="cb927-10"><a href="#cb927-10" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb927-11"><a href="#cb927-11" tabindex="-1"></a>  <span class="at">income=</span>income,</span>
<span id="cb927-12"><a href="#cb927-12" tabindex="-1"></a>  <span class="at">tax_slab =</span> tax_slab</span>
<span id="cb927-13"><a href="#cb927-13" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##     income tax_slab
## 1 330062.0       10
## 2 730644.1       20
## 3 427181.5       10
## 4 806413.9       30
## 5 852373.8       30
## 6 136445.2        0
## 7 522484.4       20</code></pre>
</div>
</div>
<div id="across" class="section level2" number="14.14">
<h2><span class="header-section-number">14.14</span> Functional programming in dplyr through <code>across()</code></h2>
<p><strong>The content is under development.</strong></p>
</div>
<div id="window-functionsoperations" class="section level2" number="14.15">
<h2><span class="header-section-number">14.15</span> Window functions/operations</h2>
<p>We learnt that by using <code>group_by</code> function we can create windows in data and we can make our calculations in each separate window specifically.</p>
<p>Dplyr provides us with some useful window functions which will operate on these windows.</p>
<ol style="list-style-type: decimal">
<li><code>row_number()</code> can be used to generate row number</li>
<li><code>dense_rank</code> / <code>min_rank</code> / <code>percent_rank()</code> / <code>ntile()</code> / <code>cume_dist()</code> are other windowed functions in dplyr. Check <code>?dplyr::ranking</code> for complete reference.</li>
<li><code>lead()</code> and <code>lag()</code> will give leading/lagging value in that window.</li>
<li><code>consecutive_id()</code> generates a unique identifier that increments every time a variable (or combination of variables) changes.</li>
</ol>
<p>These functions can be very helpful while analyzing time series data.</p>
<p>Example-1: Generating row numbers and ranks</p>
<div class="sourceCode" id="cb929"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb929-1"><a href="#cb929-1" tabindex="-1"></a><span class="co"># example data</span></span>
<span id="cb929-2"><a href="#cb929-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb929-3"><a href="#cb929-3" tabindex="-1"></a>  <span class="at">val =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="cn">NA</span>)</span>
<span id="cb929-4"><a href="#cb929-4" tabindex="-1"></a>)</span>
<span id="cb929-5"><a href="#cb929-5" tabindex="-1"></a></span>
<span id="cb929-6"><a href="#cb929-6" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb929-7"><a href="#cb929-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb929-8"><a href="#cb929-8" tabindex="-1"></a>    <span class="at">row =</span> <span class="fu">row_number</span>(),</span>
<span id="cb929-9"><a href="#cb929-9" tabindex="-1"></a>    <span class="at">min_rank =</span> <span class="fu">min_rank</span>(val),</span>
<span id="cb929-10"><a href="#cb929-10" tabindex="-1"></a>    <span class="at">dense_rank =</span> <span class="fu">dense_rank</span>(val),</span>
<span id="cb929-11"><a href="#cb929-11" tabindex="-1"></a>    <span class="at">perc_rank =</span> <span class="fu">percent_rank</span>(val),</span>
<span id="cb929-12"><a href="#cb929-12" tabindex="-1"></a>    <span class="at">cume_dist =</span> <span class="fu">cume_dist</span>(val)</span>
<span id="cb929-13"><a href="#cb929-13" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>##   val row min_rank dense_rank perc_rank cume_dist
## 1  10   1        4          3 1.0000000      1.00
## 2   2   2        1          1 0.0000000      0.50
## 3   3   3        3          2 0.6666667      0.75
## 4   2   4        1          1 0.0000000      0.50
## 5  NA   5       NA         NA        NA        NA</code></pre>
<p>Example-2: Using previous and next values</p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb931-1"><a href="#cb931-1" tabindex="-1"></a>Orange <span class="sc">%&gt;%</span> </span>
<span id="cb931-2"><a href="#cb931-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Tree) <span class="sc">%&gt;%</span> </span>
<span id="cb931-3"><a href="#cb931-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prev_circ =</span> <span class="fu">lag</span>(circumference),</span>
<span id="cb931-4"><a href="#cb931-4" tabindex="-1"></a>         <span class="at">next_circ =</span> <span class="fu">lead</span>(circumference))</span></code></pre></div>
<pre><code>## # A tibble: 35 × 5
## # Groups:   Tree [5]
##    Tree    age circumference prev_circ next_circ
##    &lt;ord&gt; &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 1       118            30        NA        58
##  2 1       484            58        30        87
##  3 1       664            87        58       115
##  4 1      1004           115        87       120
##  5 1      1231           120       115       142
##  6 1      1372           142       120       145
##  7 1      1582           145       142        NA
##  8 2       118            33        NA        69
##  9 2       484            69        33       111
## 10 2       664           111        69       156
## # ℹ 25 more rows</code></pre>
<p>Example-3: generating run length encoding/consecutive ID</p>
<div class="sourceCode" id="cb933"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb933-1"><a href="#cb933-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb933-2"><a href="#cb933-2" tabindex="-1"></a>  <span class="at">grp =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb933-3"><a href="#cb933-3" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span> , <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb933-4"><a href="#cb933-4" tabindex="-1"></a>)</span>
<span id="cb933-5"><a href="#cb933-5" tabindex="-1"></a></span>
<span id="cb933-6"><a href="#cb933-6" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb933-7"><a href="#cb933-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RLE =</span> <span class="fu">consecutive_id</span>(grp))</span></code></pre></div>
<pre><code>##   grp value RLE
## 1   A     1   1
## 2   B     2   2
## 3   B     3   2
## 4   A     4   3
## 5   A     5   3
## 6   B     6   4</code></pre>
<!--chapter:end:10-1-dplyr.Rmd-->
</div>
</div>
<div id="combining-tablestabular-data" class="section level1" number="15">
<h1><span class="header-section-number">15</span> Combining Tables/tabular data</h1>
<div class="figure" style="text-align: center">
<img src="images/conf.jpg" alt="Most of times, joining two or more tables will be required to perform analytics" width="75%" height="75%" />
<p class="caption">
(#fig:unnamed-chunk-280)Most of times, joining two or more tables will be required to perform analytics
</p>
</div>
<p>In real world scenarios, there may hardly be a case when we have to analyse one single table. There may be cases when we have to either join tables split into multiple smaller tables (e.g. we can have smaller tables split States-wise), or the tables may be divided into various smaller master and transaction tables (relational databases).</p>
<p>We may thus divide the data tables joining requirements into three broad categories-</p>
<ul>
<li>Simple joins or concatenation</li>
<li>Relational Joins</li>
<li>Filtering Joins</li>
</ul>
<p>Let us discuss each of these with examples.</p>
<div id="simple-joinsconcatenation" class="section level2" number="15.1">
<h2><span class="header-section-number">15.1</span> Simple joins/concatenation</h2>
<p>Many times tables split into smaller tables have to be joined back before proceeding further for data analytics. We may have to join two or more tables either columnwise (e.g. some of the features for all rows have been split into a separate table) or row wise (e.g. all the fields/columns are split into smaller tables like a separate table for each State). Diagramatically these joins may be depicted as shown in figure @ref(fig:joins).</p>
<div class="figure" style="text-align: center">
<img src="images/concat_joins.png" alt="Illustration of Simple joins/concatenation" width="99%" />
<p class="caption">
(#fig:joins)Illustration of Simple joins/concatenation
</p>
</div>
<div id="column-binding" class="section level3" number="15.1.1">
<h3><span class="header-section-number">15.1.1</span> Column binding</h3>
<p>As we have already seen that data frames act like matrices in many ways except to that fact that these support heterogeneous data unlike matrices. We have also discussed the ways two matrices can be joined. Base R has two dedicated functions i.e. <code>cbind()</code> and <code>rbind()</code> for these operations.</p>
<p>In <em>tidyverse</em> (dplyr specifically) we have two similar functions <code>bind_cols()</code> and <code>bind_rows</code> respectively which provide us better functionality for these use cases. The syntax for finction <code>bind_cols()</code> used for concatenating two or more tables <em>column wise</em> is -</p>
<pre><code>bind_cols(
  ...,
  .name_repair = c(&quot;unique&quot;, &quot;universal&quot;, &quot;check_unique&quot;)
)</code></pre>
<p>Where -</p>
<ul>
<li><code>...</code> represent data frames to be combined</li>
<li><code>.name_repair</code> argument chooses method to rename duplicate column names, if any.</li>
</ul>
<p>Example-1:</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="#cb936-1" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>)]</span>
<span id="cb936-2"><a href="#cb936-2" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb936-3"><a href="#cb936-3" tabindex="-1"></a></span>
<span id="cb936-4"><a href="#cb936-4" tabindex="-1"></a><span class="fu">bind_cols</span>(df1, df2, <span class="at">.name_repair =</span> <span class="st">&#39;universal&#39;</span>)</span></code></pre></div>
<pre><code>## New names:
## • `Species` -&gt; `Species...3`
## • `Species` -&gt; `Species...6`</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Species...3 Petal.Length Petal.Width Species...6
## 1          5.1         3.5      setosa          1.4         0.2      setosa
## 2          4.9         3.0      setosa          1.4         0.2      setosa
## 3          4.7         3.2      setosa          1.3         0.2      setosa</code></pre>
<blockquote>
<p>Note: The data frames to be merged should be row-consistent for column binding. Try this <code>bind_cols(iris[1:3, 1:2], iris[1:4, 3:4])</code> and see the results.</p>
</blockquote>
</div>
<div id="row-binding" class="section level3" number="15.1.2">
<h3><span class="header-section-number">15.1.2</span> Row binding</h3>
<p>The syntax used for appending rows of one or more tables together in one table is -</p>
<pre><code>bind_rows(..., .id = NULL)</code></pre>
<p>where -</p>
<ul>
<li><code>...</code> represent data frames to be combined</li>
<li><code>.id</code> argument creates a new column of identifiers.</li>
</ul>
<p>To understand it better, let us see this example</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="#cb940-1" tabindex="-1"></a>setosa <span class="ot">&lt;-</span> iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb940-2"><a href="#cb940-2" tabindex="-1"></a>versicolor <span class="ot">&lt;-</span> iris[<span class="dv">51</span><span class="sc">:</span><span class="dv">53</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb940-3"><a href="#cb940-3" tabindex="-1"></a>virginica <span class="ot">&lt;-</span> iris[<span class="dv">101</span><span class="sc">:</span><span class="dv">103</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb940-4"><a href="#cb940-4" tabindex="-1"></a></span>
<span id="cb940-5"><a href="#cb940-5" tabindex="-1"></a><span class="fu">bind_rows</span>(setosa, versicolor, virginica, <span class="at">.id =</span> <span class="st">&#39;groups&#39;</span>)</span></code></pre></div>
<pre><code>##   groups Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1      1          5.1         3.5          1.4         0.2
## 2      1          4.9         3.0          1.4         0.2
## 3      1          4.7         3.2          1.3         0.2
## 4      2          7.0         3.2          4.7         1.4
## 5      2          6.4         3.2          4.5         1.5
## 6      2          6.9         3.1          4.9         1.5
## 7      3          6.3         3.3          6.0         2.5
## 8      3          5.8         2.7          5.1         1.9
## 9      3          7.1         3.0          5.9         2.1</code></pre>
<blockquote>
<p>Note: In the above example if the requirement is to store data tables names into the new <em>identifier</em> column just list convert the databases into a list and <code>.id</code> will take element_names as the values in identifiers. Try this <code>bind_rows(list(setosa=setosa, versicolor=versicolor, virginica=virginica), .id = 'Species')</code></p>
</blockquote>
</div>
</div>
<div id="relational-joins" class="section level2" number="15.2">
<h2><span class="header-section-number">15.2</span> Relational joins</h2>
<p>Relational Joins are usually needed to join multiple tables based on <em>primary key</em> and <em>secondary keys</em>. The joins may either be <em>one-to-one</em> key join or <em>one-to-many</em> key joins. Broadly these can either be <em>inner joins</em> or <em>outer joins</em>. Diagrammatically these may be represented as shown in figure @ref(fig:joinm) wherein it may be noticed that additional columns from <code>right</code> data frame gets appended to <code>left</code> data frame. For this reason, these four joins are also known as mutating joins.</p>
<div class="figure" style="text-align: center">
<img src="images/mutating_joins.png" alt="Illustration of Mutating Joins in dplyr" width="99%" />
<p class="caption">
(#fig:joinm)Illustration of Mutating Joins in dplyr
</p>
</div>
<p>The syntax of all these joins is nearly same-</p>
<pre><code>*_join(x, y, by = NULL, copy = FALSE, suffix = c(&#39;.x&#39;, &#39;.y&#39;), ... , keep = FALSE)</code></pre>
<p>where -</p>
<ul>
<li><code>x</code> and <code>y</code> are data frames to be joined</li>
<li><code>by</code> is a character vector of column names to be joined by</li>
<li><code>suffix</code> argument provides suffixes to be added to column names, if any of those are duplicate</li>
<li><code>keep</code> argument decides whether the join keys from both x and y be preserved in the output?</li>
</ul>
<p>Let’s discuss each of these joins individually.</p>
<div id="inner-joins" class="section level3" number="15.2.1">
<h3><span class="header-section-number">15.2.1</span> Inner Joins</h3>
<p>Inner Joins keeps only those rows where matching keys are present in both the data frames.</p>
<p>Example-1:</p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb943-1"><a href="#cb943-1" tabindex="-1"></a>band_members</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 Mick  Stones 
## 2 John  Beatles
## 3 Paul  Beatles</code></pre>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="#cb945-1" tabindex="-1"></a>band_instruments</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   name  plays 
##   &lt;chr&gt; &lt;chr&gt; 
## 1 John  guitar
## 2 Paul  bass  
## 3 Keith guitar</code></pre>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb947-1"><a href="#cb947-1" tabindex="-1"></a><span class="fu">inner_join</span>(band_members, band_instruments)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(name)`</code></pre>
<pre><code>## # A tibble: 2 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass</code></pre>
</div>
<div id="left-joins" class="section level3" number="15.2.2">
<h3><span class="header-section-number">15.2.2</span> Left Joins</h3>
<p>Left Joins on the other hand preserves all rows of data frame passed as <code>x</code> i.e. first argument irrespective of the fact that matching key record is available in second data table or not.</p>
<p>Example-1:</p>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="#cb950-1" tabindex="-1"></a><span class="fu">left_join</span>(band_members, band_instruments)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(name)`</code></pre>
<pre><code>## # A tibble: 3 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass</code></pre>
</div>
<div id="right-joins" class="section level3" number="15.2.3">
<h3><span class="header-section-number">15.2.3</span> Right Joins</h3>
<p>Right join, is similar to left join and preserves all rows of data frame passed as <code>y</code> i.e. second argument irrespective of the fact that matching key record is available in first data table or not.</p>
<p>Example-1:</p>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb953-1"><a href="#cb953-1" tabindex="-1"></a><span class="fu">right_join</span>(band_members, band_instruments)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(name)`</code></pre>
<pre><code>## # A tibble: 3 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass  
## 3 Keith &lt;NA&gt;    guitar</code></pre>
</div>
<div id="full-joins" class="section level3" number="15.2.4">
<h3><span class="header-section-number">15.2.4</span> Full Joins</h3>
<p>Full join returns all the rows of both the data tables despite non-availability of matching key in either of the tables.</p>
<p>Example-1:</p>
<div class="sourceCode" id="cb956"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb956-1"><a href="#cb956-1" tabindex="-1"></a><span class="fu">full_join</span>(band_members, band_instruments)</span></code></pre></div>
<pre><code>## Joining with `by = join_by(name)`</code></pre>
<pre><code>## # A tibble: 4 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass  
## 4 Keith &lt;NA&gt;    guitar</code></pre>
<p>You must have noticed that each of the examples shown above has thrown a warning that join has been performed on variable <code>name</code>. We may override this warning by specifically providing the joining <em>key</em> column name(s) in <code>by</code> argument i.e. <code>by = "name"</code>.</p>
<p>There may be cases when the joining <em>key</em> column(s) in the two data frames are of different names. These cases can also be handled by using <code>by</code> argument.</p>
<p>Example-</p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb959-1"><a href="#cb959-1" tabindex="-1"></a>band_instruments2</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   artist plays 
##   &lt;chr&gt;  &lt;chr&gt; 
## 1 John   guitar
## 2 Paul   bass  
## 3 Keith  guitar</code></pre>
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb961-1"><a href="#cb961-1" tabindex="-1"></a><span class="fu">left_join</span>(band_members, band_instruments2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;name&#39;</span> <span class="ot">=</span> <span class="st">&#39;artist&#39;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass</code></pre>
<blockquote>
<p>Note: Each of the <code>*_join()</code> can be joined on multiple keys/columns (i.e. more than one) using <code>by</code> argument as explained above.</p>
</blockquote>
</div>
<div id="many-to-many-joins" class="section level3 unnumbered">
<h3 class="unnumbered">Many-to-many Joins</h3>
<p>Example of four of the above-mentioned joins are many to many joins and thus need to be used carefully. See the following example</p>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb963-1"><a href="#cb963-1" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb963-2"><a href="#cb963-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>),</span>
<span id="cb963-3"><a href="#cb963-3" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">21</span>)</span>
<span id="cb963-4"><a href="#cb963-4" tabindex="-1"></a>)</span>
<span id="cb963-5"><a href="#cb963-5" tabindex="-1"></a>df1</span></code></pre></div>
<pre><code>##    x  y
## 1  1 11
## 2  1 12
## 3 NA 21</code></pre>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="#cb965-1" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb965-2"><a href="#cb965-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb965-3"><a href="#cb965-3" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">c</span>(<span class="dv">101</span>, <span class="dv">102</span>, <span class="dv">201</span>, <span class="dv">202</span>)</span>
<span id="cb965-4"><a href="#cb965-4" tabindex="-1"></a>)</span>
<span id="cb965-5"><a href="#cb965-5" tabindex="-1"></a>df2</span></code></pre></div>
<pre><code>##    x   z
## 1  1 101
## 2  1 102
## 3 NA 201
## 4 NA 202</code></pre>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb967-1"><a href="#cb967-1" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(df2, <span class="at">by =</span> <span class="st">&#39;x&#39;</span>)</span></code></pre></div>
<pre><code>## Warning in left_join(., df2, by = &quot;x&quot;): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 1 of `x` matches multiple rows in `y`.
## ℹ Row 1 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship =
##   &quot;many-to-many&quot;` to silence this warning.</code></pre>
<pre><code>##    x  y   z
## 1  1 11 101
## 2  1 11 102
## 3  1 12 101
## 4  1 12 102
## 5 NA 21 201
## 6 NA 21 202</code></pre>
<p>In fact, we can use argument <code>relationship</code> explicitly to silence this warning and avoid errors. This argument can take one of these values</p>
<ul>
<li><code>NULL</code> (default)</li>
<li><code>"one-to-one"</code></li>
<li><code>"one-to-many"</code></li>
<li><code>"many-to-one"</code></li>
<li><code>"many-to-many"</code></li>
</ul>
<p>Example above re-coded</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="#cb970-1" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(df2, <span class="at">by =</span> <span class="st">&#39;x&#39;</span>, <span class="at">relationship =</span> <span class="st">&quot;many-to-many&quot;</span>)</span></code></pre></div>
<pre><code>##    x  y   z
## 1  1 11 101
## 2  1 11 102
## 3  1 12 101
## 4  1 12 102
## 5 NA 21 201
## 6 NA 21 202</code></pre>
</div>
</div>
<div id="filtering-joins" class="section level2" number="15.3">
<h2><span class="header-section-number">15.3</span> Filtering Joins</h2>
<p>The other joins available in <code>dplyr</code> are basically filtering joins. These joins will not result in appending additional columns present in <code>right</code> data frame to <code>left</code> data frame. Only the common keys (columns) from right data frame will be used to filter left data frame.</p>
<div id="semi-joins" class="section level3" number="15.3.1">
<h3><span class="header-section-number">15.3.1</span> Semi Joins</h3>
<p>First of these is <code>semi_join</code> which essentially filters those rows from a data frame, which are based on another data frame. See this example-</p>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb972-1"><a href="#cb972-1" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb972-2"><a href="#cb972-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>),</span>
<span id="cb972-3"><a href="#cb972-3" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">21</span>, <span class="dv">100</span>)</span>
<span id="cb972-4"><a href="#cb972-4" tabindex="-1"></a>)</span>
<span id="cb972-5"><a href="#cb972-5" tabindex="-1"></a>df1</span></code></pre></div>
<pre><code>##    x   y
## 1  1  11
## 2  2  21
## 3 NA 100</code></pre>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb974-1"><a href="#cb974-1" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb974-2"><a href="#cb974-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="cn">NA</span>),</span>
<span id="cb974-3"><a href="#cb974-3" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">c</span>(<span class="dv">101</span>, <span class="dv">301</span>, <span class="dv">401</span>, <span class="dv">501</span>)</span>
<span id="cb974-4"><a href="#cb974-4" tabindex="-1"></a>)</span>
<span id="cb974-5"><a href="#cb974-5" tabindex="-1"></a>df2</span></code></pre></div>
<pre><code>##    x   z
## 1  1 101
## 2  3 301
## 3  4 401
## 4 NA 501</code></pre>
<div class="sourceCode" id="cb976"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb976-1"><a href="#cb976-1" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">semi_join</span>(df2, <span class="at">by =</span> <span class="st">&#39;x&#39;</span>)</span></code></pre></div>
<pre><code>##    x   y
## 1  1  11
## 2 NA 100</code></pre>
</div>
<div id="anti-joins" class="section level3" number="15.3.2">
<h3><span class="header-section-number">15.3.2</span> Anti Joins</h3>
<p>The <code>anti_join</code> is basically opposite to that of <code>semi_join</code>. It keeps only those records from left data-frame which are not available in right data-frame. Example</p>
<div class="sourceCode" id="cb978"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb978-1"><a href="#cb978-1" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">anti_join</span>(df2, <span class="at">by =</span> <span class="st">&#39;x&#39;</span>)</span></code></pre></div>
<pre><code>##   x  y
## 1 2 21</code></pre>
</div>
</div>
<div id="relational-but-non-equi-joins" class="section level2" number="15.4">
<h2><span class="header-section-number">15.4</span> Relational, but non-equi joins</h2>
<p>Till now, we have learnt joins that use syntax of dplyr version before 1.1.0. However, in dplyr newest version, 1.1.0, released in January 2023, a new helper function <code>join_by()</code> has been introduced. It actually, constructs a specification that describes how to join two tables using a small domain specific language. The result can be supplied as the by argument to any of the join functions that we have learnt above. For equal joins, we have learnt above, there are two slight but easier to implement changes if we use <code>join_by()</code> -</p>
<ul>
<li>we may pass variable names in by argument instead of using characters as described above.</li>
<li>instead of using <code>=</code> we have to use <code>==</code> which is actually the equality operator as opposed to assignment operator we were using earlier.</li>
</ul>
<p>So our syntax for <code>left_join</code> example is</p>
<div class="sourceCode" id="cb980"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb980-1"><a href="#cb980-1" tabindex="-1"></a>band_instruments2</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   artist plays 
##   &lt;chr&gt;  &lt;chr&gt; 
## 1 John   guitar
## 2 Paul   bass  
## 3 Keith  guitar</code></pre>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb982-1"><a href="#cb982-1" tabindex="-1"></a><span class="fu">left_join</span>(band_members, band_instruments2, <span class="at">by =</span> <span class="fu">join_by</span>(name <span class="sc">==</span> artist))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass</code></pre>
<p>Simple, isn’t it. But now using the potential of this new helper function, we can on the other hand join two (or more data frames) using inequality conditions.</p>
<div id="inequality-joins" class="section level3" number="15.4.1">
<h3><span class="header-section-number">15.4.1</span> Inequality Joins</h3>
<p>Inequality joins match on an inequality, such as <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, or <code>&lt;=</code>, and are common in time series analysis and genomics. To construct an inequality join using <code>join_by()</code>, we have to supply two column names separated by one of the above mentioned inequalities. See the following example for better understanding of inequality joins.</p>
<p>Example- Suppose we have two tables, one containing product-wise <code>sales</code> and another containing <code>rates</code> as and when these are revised. So, in order to have total sales amount, we can use inequality join.</p>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="#cb984-1" tabindex="-1"></a><span class="co"># sales</span></span>
<span id="cb984-2"><a href="#cb984-2" tabindex="-1"></a>sales <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb984-3"><a href="#cb984-3" tabindex="-1"></a>  <span class="at">product.id =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb984-4"><a href="#cb984-4" tabindex="-1"></a>  <span class="at">sales.date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;01-01-2022&quot;</span>,</span>
<span id="cb984-5"><a href="#cb984-5" tabindex="-1"></a>                 <span class="st">&quot;02-02-2022&quot;</span>,<span class="st">&quot;05-11-2022&quot;</span>,<span class="st">&quot;05-04-2022&quot;</span>,</span>
<span id="cb984-6"><a href="#cb984-6" tabindex="-1"></a>                 <span class="st">&quot;05-10-2022&quot;</span>,<span class="st">&quot;01-02-2022&quot;</span>,<span class="st">&quot;01-01-2023&quot;</span>), <span class="at">format =</span> <span class="st">&quot;%d-%m-%Y&quot;</span>),</span>
<span id="cb984-7"><a href="#cb984-7" tabindex="-1"></a>  <span class="at">quantity =</span> <span class="fu">c</span>(<span class="dv">5</span><span class="dt">L</span>, <span class="dv">10</span><span class="dt">L</span>, <span class="dv">15</span><span class="dt">L</span>, <span class="dv">5</span><span class="dt">L</span>, <span class="dv">15</span><span class="dt">L</span>, <span class="dv">1</span><span class="dt">L</span>, <span class="dv">2</span><span class="dt">L</span>)</span>
<span id="cb984-8"><a href="#cb984-8" tabindex="-1"></a>)</span>
<span id="cb984-9"><a href="#cb984-9" tabindex="-1"></a><span class="co"># Print it</span></span>
<span id="cb984-10"><a href="#cb984-10" tabindex="-1"></a>sales</span></code></pre></div>
<pre><code>##   product.id sales.date quantity
## 1          A 2022-01-01        5
## 2          A 2022-02-02       10
## 3          A 2022-11-05       15
## 4          A 2022-04-05        5
## 5          A 2022-10-05       15
## 6          B 2022-02-01        1
## 7          B 2023-01-01        2</code></pre>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="#cb986-1" tabindex="-1"></a><span class="co"># rates</span></span>
<span id="cb986-2"><a href="#cb986-2" tabindex="-1"></a>rates <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb986-3"><a href="#cb986-3" tabindex="-1"></a>  <span class="at">product.id =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb986-4"><a href="#cb986-4" tabindex="-1"></a>  <span class="at">revision.date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;01-02-2022&quot;</span>,</span>
<span id="cb986-5"><a href="#cb986-5" tabindex="-1"></a>                    <span class="st">&quot;03-04-2022&quot;</span>,<span class="st">&quot;05-10-2022&quot;</span>,<span class="st">&quot;01-01-2022&quot;</span>,</span>
<span id="cb986-6"><a href="#cb986-6" tabindex="-1"></a>                    <span class="st">&quot;05-10-2022&quot;</span>), <span class="at">format =</span> <span class="st">&quot;%d-%m-%Y&quot;</span>),</span>
<span id="cb986-7"><a href="#cb986-7" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">c</span>(<span class="dv">50</span><span class="dt">L</span>, <span class="dv">60</span><span class="dt">L</span>, <span class="dv">70</span><span class="dt">L</span>, <span class="dv">500</span><span class="dt">L</span>, <span class="dv">1500</span><span class="dt">L</span>)</span>
<span id="cb986-8"><a href="#cb986-8" tabindex="-1"></a>)</span>
<span id="cb986-9"><a href="#cb986-9" tabindex="-1"></a><span class="co">#print it</span></span>
<span id="cb986-10"><a href="#cb986-10" tabindex="-1"></a>rates</span></code></pre></div>
<pre><code>##   product.id revision.date rate
## 1          A    2022-02-01   50
## 2          A    2022-04-03   60
## 3          A    2022-10-05   70
## 4          B    2022-01-01  500
## 5          B    2022-10-05 1500</code></pre>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="#cb988-1" tabindex="-1"></a><span class="co"># total sale(1st attempt)</span></span>
<span id="cb988-2"><a href="#cb988-2" tabindex="-1"></a>sales <span class="sc">%&gt;%</span> </span>
<span id="cb988-3"><a href="#cb988-3" tabindex="-1"></a>  <span class="fu">left_join</span>(rates,</span>
<span id="cb988-4"><a href="#cb988-4" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(product.id,</span>
<span id="cb988-5"><a href="#cb988-5" tabindex="-1"></a>                         sales.date <span class="sc">&gt;=</span> revision.date))</span></code></pre></div>
<pre><code>##    product.id sales.date quantity revision.date rate
## 1           A 2022-01-01        5          &lt;NA&gt;   NA
## 2           A 2022-02-02       10    2022-02-01   50
## 3           A 2022-11-05       15    2022-02-01   50
## 4           A 2022-11-05       15    2022-04-03   60
## 5           A 2022-11-05       15    2022-10-05   70
## 6           A 2022-04-05        5    2022-02-01   50
## 7           A 2022-04-05        5    2022-04-03   60
## 8           A 2022-10-05       15    2022-02-01   50
## 9           A 2022-10-05       15    2022-04-03   60
## 10          A 2022-10-05       15    2022-10-05   70
## 11          B 2022-02-01        1    2022-01-01  500
## 12          B 2023-01-01        2    2022-01-01  500
## 13          B 2023-01-01        2    2022-10-05 1500</code></pre>
<p>We got the results, but the results/rates are obtained fixed on all earlier dates. To solve this issue, we have <strong>rolling joins</strong>. See next section.</p>
</div>
<div id="rolling-joins" class="section level3" number="15.4.2">
<h3><span class="header-section-number">15.4.2</span> Rolling Joins</h3>
<p>Rolling joins are a variant of inequality joins that limit the results returned from an inequality join condition. They are useful for “rolling” the closest match forward/backwards when there isn’t an exact match. To construct a rolling join, we have to wrap inequality condition with <code>closest()</code>.</p>
<p>Above example solved by wrapping date condition in <code>closest()</code></p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb990-1"><a href="#cb990-1" tabindex="-1"></a>sales <span class="sc">%&gt;%</span> </span>
<span id="cb990-2"><a href="#cb990-2" tabindex="-1"></a>  <span class="fu">left_join</span>(rates,</span>
<span id="cb990-3"><a href="#cb990-3" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(product.id,</span>
<span id="cb990-4"><a href="#cb990-4" tabindex="-1"></a>                         <span class="fu">closest</span>(sales.date <span class="sc">&gt;=</span> revision.date)))</span></code></pre></div>
<pre><code>##   product.id sales.date quantity revision.date rate
## 1          A 2022-01-01        5          &lt;NA&gt;   NA
## 2          A 2022-02-02       10    2022-02-01   50
## 3          A 2022-11-05       15    2022-10-05   70
## 4          A 2022-04-05        5    2022-04-03   60
## 5          A 2022-10-05       15    2022-10-05   70
## 6          B 2022-02-01        1    2022-01-01  500
## 7          B 2023-01-01        2    2022-10-05 1500</code></pre>
<p>We may see that we do not have rates for product <code>A</code> for sales made on <code>01-01-2022</code>.</p>
</div>
<div id="overlap-joins" class="section level3" number="15.4.3">
<h3><span class="header-section-number">15.4.3</span> Overlap Joins</h3>
<p>Overlap joins are a special case of inequality joins involving one or two columns from the left-hand table overlapping a range defined by two columns from the right-hand table. There are three helpers that <code>join_by()</code> recognizes to assist with constructing overlap joins, all of which can be constructed from simpler inequalities.</p>
<ul>
<li><p><code>between(x, y_lower, y_upper, ..., bounds = "[]")</code> which is just short for <code>x &gt;= y_lower, x &lt;= y_upper</code></p></li>
<li><p><code>within(x_lower, x_upper, y_lower, y_upper)</code> which is just short for <code>x_lower &gt;= y_lower, x_upper &lt;= y_upper</code></p></li>
<li><p><code>overlaps(x_lower, x_upper, y_lower, y_upper, ..., bounds = "[]")</code> which is short for <code>x_lower &lt;= y_upper, x_upper &gt;= y_lower</code></p></li>
</ul>
<p>We can make use of these functions as per our need.</p>
<p>Example-2: Suppose we have <code>orders</code> data where we have customer-wise orders, corresponsing order dates and ship dates. Let us suppose we want to know about customers who placed another order, without waiting for shipping of any of their previous/earlier order.</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb992-1"><a href="#cb992-1" tabindex="-1"></a>orders <span class="ot">&lt;-</span> <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">customer_id =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, </span>
<span id="cb992-2"><a href="#cb992-2" tabindex="-1"></a><span class="st">&quot;C&quot;</span>), <span class="at">order_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">order_date =</span> <span class="fu">c</span>(<span class="st">&quot;2019-01-01&quot;</span>, <span class="st">&quot;2019-01-05&quot;</span>, </span>
<span id="cb992-3"><a href="#cb992-3" tabindex="-1"></a><span class="st">&quot;2019-01-16&quot;</span>, <span class="st">&quot;2019-01-05&quot;</span>, <span class="st">&quot;2019-01-06&quot;</span>, <span class="st">&quot;2019-01-07&quot;</span>, <span class="st">&quot;2019-01-09&quot;</span></span>
<span id="cb992-4"><a href="#cb992-4" tabindex="-1"></a>), <span class="at">ship_date =</span> <span class="fu">c</span>(<span class="st">&quot;2019-01-30&quot;</span>, <span class="st">&quot;2019-02-10&quot;</span>, <span class="st">&quot;2019-01-18&quot;</span>, <span class="st">&quot;2019-01-08&quot;</span>, </span>
<span id="cb992-5"><a href="#cb992-5" tabindex="-1"></a><span class="st">&quot;2019-01-08&quot;</span>, <span class="st">&quot;2019-01-08&quot;</span>, <span class="st">&quot;2019-01-10&quot;</span>)), <span class="at">row.names =</span> <span class="fu">c</span>(<span class="cn">NA</span>, </span>
<span id="cb992-6"><a href="#cb992-6" tabindex="-1"></a><span class="sc">-</span><span class="dv">7</span><span class="dt">L</span>), <span class="at">class =</span> <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb992-7"><a href="#cb992-7" tabindex="-1"></a></span>
<span id="cb992-8"><a href="#cb992-8" tabindex="-1"></a><span class="co"># print </span></span>
<span id="cb992-9"><a href="#cb992-9" tabindex="-1"></a>orders</span></code></pre></div>
<pre><code>##   customer_id order_id order_date  ship_date
## 1           A        1 2019-01-01 2019-01-30
## 2           A        2 2019-01-05 2019-02-10
## 3           A        3 2019-01-16 2019-01-18
## 4           B        4 2019-01-05 2019-01-08
## 5           B        5 2019-01-06 2019-01-08
## 6           C        6 2019-01-07 2019-01-08
## 7           C        7 2019-01-09 2019-01-10</code></pre>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb994-1"><a href="#cb994-1" tabindex="-1"></a><span class="co"># customers who placed the orders without</span></span>
<span id="cb994-2"><a href="#cb994-2" tabindex="-1"></a><span class="co"># waiting to ship their earlier order</span></span>
<span id="cb994-3"><a href="#cb994-3" tabindex="-1"></a>orders <span class="sc">%&gt;%</span> </span>
<span id="cb994-4"><a href="#cb994-4" tabindex="-1"></a>  <span class="fu">inner_join</span>(orders,</span>
<span id="cb994-5"><a href="#cb994-5" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">join_by</span>(customer_id,</span>
<span id="cb994-6"><a href="#cb994-6" tabindex="-1"></a>                          <span class="fu">overlaps</span>(order_date, ship_date, order_date, ship_date),</span>
<span id="cb994-7"><a href="#cb994-7" tabindex="-1"></a>                          order_id <span class="sc">&lt;</span> order_id)) </span></code></pre></div>
<pre><code>##   customer_id order_id.x order_date.x ship_date.x order_id.y order_date.y
## 1           A          1   2019-01-01  2019-01-30          2   2019-01-05
## 2           A          1   2019-01-01  2019-01-30          3   2019-01-16
## 3           A          2   2019-01-05  2019-02-10          3   2019-01-16
## 4           B          4   2019-01-05  2019-01-08          5   2019-01-06
##   ship_date.y
## 1  2019-02-10
## 2  2019-01-18
## 3  2019-01-18
## 4  2019-01-08</code></pre>
</div>
<div id="example-uses-of-rolling-joins." class="section level3" number="15.4.4">
<h3><span class="header-section-number">15.4.4</span> Example uses of rolling joins.</h3>
<p><strong>The content is under development.</strong></p>
</div>
<div id="cross-joins" class="section level3" number="15.4.5">
<h3><span class="header-section-number">15.4.5</span> Cross Joins</h3>
<p>This join matches everything with everything and therefore can be thought of as a cross product of two data frames. We can use <code>cross_join</code> for this special join. If we have <code>m</code> and <code>n</code> rows in two data frames, then as a result of cross join we will have <code>m*n</code> rows.</p>
<p>Example-</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="#cb996-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">products =</span> <span class="fu">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>, <span class="st">&#39;C&#39;</span>))</span>
<span id="cb996-2"><a href="#cb996-2" tabindex="-1"></a></span>
<span id="cb996-3"><a href="#cb996-3" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb996-4"><a href="#cb996-4" tabindex="-1"></a>  <span class="fu">cross_join</span>(df)</span></code></pre></div>
<pre><code>##   products.x products.y
## 1          A          A
## 2          A          B
## 3          A          C
## 4          B          A
## 5          B          B
## 6          B          C
## 7          C          A
## 8          C          B
## 9          C          C</code></pre>
<!--chapter:end:10-2-joins.Rmd-->
</div>
</div>
</div>
<div id="data-wrangling-in-tidyr" class="section level1" number="16">
<h1><span class="header-section-number">16</span> Data Wrangling in <code>tidyr</code></h1>
<p>In this chapter we will learn about reshaping data to the format most suitable for our data analysis work. To reshape the data, we will use <code>tidyr</code> package<span class="citation"><a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a></span> which is part of core <code>tidyverse</code> and can be loaded either by calling <code>library(tidyr)</code> or <code>library(tidyverse)</code>.</p>
<p><strong>Prerequisites</strong></p>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb998-1"><a href="#cb998-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="concepts-of-tidy-data" class="section level2" number="16.1">
<h2><span class="header-section-number">16.1</span> Concepts of tidy data</h2>
<p><a href="https://hadley.nz/">Hadley Wickham</a>, the chief scientist behind development of RStudio, tidyverse, and much more, introduced the concept of tidy data in a paper<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a> published in the Journal of Statistical Software.<span class="citation"><a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a></span> Tidy data is a framework to structure data sets so they can be easily analyzed and visualized. It can be thought of as a goal one should aim for when cleaning data. Once we understand what tidy data is, that knowledge will make our data analysis, visualization, and collection much easier.<span class="citation"><a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a></span></p>
<p>A tidy data-set has the following properties:</p>
<ol style="list-style-type: decimal">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table.</li>
</ol>
<p>Diagrammatically<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a> this can be represented as in figure @ref(fig:tidy).</p>
<div class="figure" style="text-align: center">
<img src="images/tidy-1.png" alt="Diagrammatic representation of tidy data" width="99%" />
<p class="caption">
(#fig:tidy)Diagrammatic representation of tidy data
</p>
</div>
<p>Once a dataset is tidy, it can be used as input into a variety of other functions that may transform, model, or visualize the data.</p>
<p>Consider these five examples<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a>. All these examples<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a> represent same data but shown in different formats-</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="#cb999-1" tabindex="-1"></a><span class="co">#Example-1</span></span>
<span id="cb999-2"><a href="#cb999-2" tabindex="-1"></a>tidyr<span class="sc">::</span>table1</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1001-1"><a href="#cb1001-1" tabindex="-1"></a><span class="co"># Example-2</span></span>
<span id="cb1001-2"><a href="#cb1001-2" tabindex="-1"></a>tidyr<span class="sc">::</span>table2</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
##    country      year type            count
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1003-1"><a href="#cb1003-1" tabindex="-1"></a><span class="co"># Example-3</span></span>
<span id="cb1003-2"><a href="#cb1003-2" tabindex="-1"></a>tidyr<span class="sc">::</span>table3</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   country      year rate             
##   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1005-1"><a href="#cb1005-1" tabindex="-1"></a><span class="co"># Example-4 (Same data in 2 data tables now)</span></span>
<span id="cb1005-2"><a href="#cb1005-2" tabindex="-1"></a>tidyr<span class="sc">::</span>table4a</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   country     `1999` `2000`
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="#cb1007-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table4b</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   country         `1999`     `2000`
##   &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan   19987071   20595360
## 2 Brazil       172006362  174504898
## 3 China       1272915272 1280428583</code></pre>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1009-1"><a href="#cb1009-1" tabindex="-1"></a><span class="co"># Example-5</span></span>
<span id="cb1009-2"><a href="#cb1009-2" tabindex="-1"></a>tidyr<span class="sc">::</span>table5</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country     century year  rate             
##   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 19      99    745/19987071     
## 2 Afghanistan 20      00    2666/20595360    
## 3 Brazil      19      99    37737/172006362  
## 4 Brazil      20      00    80488/174504898  
## 5 China       19      99    212258/1272915272
## 6 China       20      00    213766/1280428583</code></pre>
<p>Let us discuss these example one by one -</p>
<ul>
<li><code>table1</code> fulfills all three rules stated above and is thus, in tidy format. Notice that every observation has its own row, and each variable is stored in a separate column.</li>
<li><code>table2</code> stores one observation in two columns (separately for cases and population) and is thus not tidy.</li>
<li><code>table3</code> stores two variables in one column (cases and population together) and is thus not tidy.</li>
<li><code>table4a</code> and <code>table4b</code> clearly stores one observation in two different tables and is thus not tidy. We may further notice that both these tables use values as column headers, which also violate rule no.3 stated above.</li>
<li><code>table5</code> again stores one variable i.e. year in two separate columns, and thus does not follow rule no.2 stated above.</li>
</ul>
<div id="reshaping-data" class="section level5 unnumbered">
<h5 class="unnumbered">Reshaping data</h5>
<p>In real world problems we will mostly come across data-sets that are not in tidy formats and for data analysis, visualisation we will need <code>tidying</code> the datasets. To do this we will first need to understand what actually is a value, a variable/field and an observation. As a second step of <em>tidying</em> we will require to reshape the data by either -</p>
<ul>
<li>re-organising the observation originally spread into multiple rows (e.g. <code>table2</code>), in one row; OR</li>
<li>re-organising the variable spread into multiple columns (e.g. <code>table3</code>, etc.), in one single column.</li>
</ul>
<p>To perform this <em>tidying</em> exercise, we will need two most important functions from <code>tidyr</code> i.e. <code>pivot_longer</code> and <code>pivot_wider</code>. So let us understand the functioning of these.</p>
</div>
</div>
<div id="longer-format-through-function-pivot_longer" class="section level2" number="16.2">
<h2><span class="header-section-number">16.2</span> LONGER format through function <code>pivot_longer()</code></h2>
<p>Often we will come across data sets that will have values (instead of actual variable name) as column headers. Let us take the example of <code>table4a</code> or <code>table4b</code> shown above. Both these tables have values of variable <code>year</code> as column names. So we need to re-structure these tables into a longer format where these values form part of columns instead of column names. We will use <code>pivot_longer()</code> function for this. Th basic syntax is-</p>
<pre><code>pivot_longer(
  data,
  cols,
  names_to = &quot;name&quot;,
  values_to = &quot;value&quot;,
  ...
)</code></pre>
<p><em>Note that there many more useful arguments to this function, but first let us consider on these only.</em></p>
<ul>
<li><code>cols</code> indicate names of columns (as a character vector) to be converted into longer format</li>
<li><code>names_to = "name"</code> argument will actually convert values used as column headers back to a column with given “name”</li>
<li><code>values_to = "value"</code> argument will convert values of all those columns back into one column with given name “value” (e.g. population in table4b).</li>
</ul>
<p>This can be understood through the gif (animated) image @ref(fig:tidy1).</p>
<div class="figure" style="text-align: center">
<img src="images/long.gif" alt="Data Reshaping to longer format"  />
<p class="caption">
(#fig:tidy1)Data Reshaping to longer format
</p>
</div>
<p>Basic functionality can be understood using the following example-</p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="#cb1012-1" tabindex="-1"></a>iris_summary <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span> </span>
<span id="cb1012-2"><a href="#cb1012-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb1012-3"><a href="#cb1012-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Sepal.Width),</span>
<span id="cb1012-4"><a href="#cb1012-4" tabindex="-1"></a>            <span class="at">st_dev =</span> <span class="fu">sd</span>(Sepal.Width))</span>
<span id="cb1012-5"><a href="#cb1012-5" tabindex="-1"></a>iris_summary</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   Species     mean st_dev
##   &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1 setosa      3.43  0.379
## 2 versicolor  2.77  0.314
## 3 virginica   2.97  0.322</code></pre>
<p>Using <code>pivot_wider</code> we can convert column headers into values. Check the diagram in figure @ref(fig:plong).</p>
<div class="figure" style="text-align: center">
<img src="images/pivot_longer.png" alt="Diagrammatic representation of pivot\_longer" width="99%" />
<p class="caption">
(#fig:plong)Diagrammatic representation of pivot_longer
</p>
</div>
<p>Now we are ready to convert <code>table4a</code> into a tidier format.</p>
<div id="case-i-when-values-are-in-column-headers" class="section level3 unnumbered">
<h3 class="unnumbered">Case-I when values are in column headers</h3>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1014-1"><a href="#cb1014-1" tabindex="-1"></a><span class="fu">pivot_longer</span>(</span>
<span id="cb1014-2"><a href="#cb1014-2" tabindex="-1"></a>  table4a, </span>
<span id="cb1014-3"><a href="#cb1014-3" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&#39;1999&#39;</span>, <span class="st">&#39;2000&#39;</span>), </span>
<span id="cb1014-4"><a href="#cb1014-4" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">&#39;year&#39;</span>, </span>
<span id="cb1014-5"><a href="#cb1014-5" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">&#39;cases&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   country     year   cases
##   &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
## 1 Afghanistan 1999     745
## 2 Afghanistan 2000    2666
## 3 Brazil      1999   37737
## 4 Brazil      2000   80488
## 5 China       1999  212258
## 6 China       2000  213766</code></pre>
<p>With <em>pipes</em> and a little tweaking, the above syntax could have been written as-</p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1016-1"><a href="#cb1016-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table4a <span class="sc">%&gt;%</span>                         <span class="co"># first argument passed through pipe </span></span>
<span id="cb1016-2"><a href="#cb1016-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>country,     <span class="co"># all columns except country</span></span>
<span id="cb1016-3"><a href="#cb1016-3" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb1016-4"><a href="#cb1016-4" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;cases&quot;</span>)</span></code></pre></div>
</div>
<div id="case-ii-when-both-variables-and-variable-names-are-combined-together-as-column-names" class="section level3 unnumbered">
<h3 class="unnumbered">Case-II when both variables and variable names are combined together as column names</h3>
<p>We have seen a simple case to tidy the table when the values (e.g. years) were depicted as column names instead of variables i.e. actual data. There may be cases when column names are a combination of both.</p>
<p>Example - Say we have a table <code>table6</code> as</p>
<pre><code>## # A tibble: 3 × 5
##   country     cases_1999 cases_2000   pop_1999   pop_2000
##   &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan        745       2666   19987071   20595360
## 2 Brazil           37737      80488  172006362  174504898
## 3 China           212258     213766 1272915272 1280428583</code></pre>
<p>We may use <code>names_sep</code> argument in this case, which will separate the combined variables from the column names -</p>
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1018-1"><a href="#cb1018-1" tabindex="-1"></a>table6 <span class="sc">%&gt;%</span> </span>
<span id="cb1018-2"><a href="#cb1018-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>country,</span>
<span id="cb1018-3"><a href="#cb1018-3" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1018-4"><a href="#cb1018-4" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;count_type&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb1018-5"><a href="#cb1018-5" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
##    country     count_type year       count
##    &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;dbl&gt;
##  1 Afghanistan cases      1999         745
##  2 Afghanistan cases      2000        2666
##  3 Afghanistan pop        1999    19987071
##  4 Afghanistan pop        2000    20595360
##  5 Brazil      cases      1999       37737
##  6 Brazil      cases      2000       80488
##  7 Brazil      pop        1999   172006362
##  8 Brazil      pop        2000   174504898
##  9 China       cases      1999      212258
## 10 China       cases      2000      213766
## 11 China       pop        1999  1272915272
## 12 China       pop        2000  1280428583</code></pre>
<blockquote>
<p>Note that we have two column names in argument <code>names_to</code>.</p>
</blockquote>
<p>Though the above table is still not in tidy format, yet the example was taken to show the functioning of other arguments of the <code>pivot_longer</code>. We provided two static column names to the related argument and the variables were created after splitting the headers with sep <code>_</code>. We actually require one dynamic value to be retained as column name (<code>cases</code> and <code>pop</code> here) but need to convert <code>year</code> to variables.</p>
<p>To do so we will use special value <code>".value"</code> in the related argument. Understanding the special value becomes clear with the animated figure @ref(fig:tidy2).</p>
<div class="figure" style="text-align: center">
<img src="images/case3.gif" alt="When headers contain both headers and data combined together"  />
<p class="caption">
(#fig:tidy2)When headers contain both headers and data combined together
</p>
</div>
<p>Example-</p>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1020-1"><a href="#cb1020-1" tabindex="-1"></a>table6 <span class="sc">%&gt;%</span> </span>
<span id="cb1020-2"><a href="#cb1020-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>country,</span>
<span id="cb1020-3"><a href="#cb1020-3" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1020-4"><a href="#cb1020-4" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb1020-5"><a href="#cb1020-5" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country     year   cases        pop
##   &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan 1999     745   19987071
## 2 Afghanistan 2000    2666   20595360
## 3 Brazil      1999   37737  172006362
## 4 Brazil      2000   80488  174504898
## 5 China       1999  212258 1272915272
## 6 China       2000  213766 1280428583</code></pre>
<blockquote>
<p>Note that by using <code>.value</code> the argument <code>values_to</code> becomes meaning less.</p>
</blockquote>
</div>
</div>
<div id="wider-format-through-pivot_wider" class="section level2" number="16.3">
<h2><span class="header-section-number">16.3</span> WIDER format through <code>pivot_wider()</code></h2>
<p>As the name suggests, <code>pivot_wider()</code> does exactly opposite to what a <code>pivot_longer</code> does. Additionally, this function is used to create summary reports, as pivot functionality in MS Excel, through <code>values_fn</code> argument. Diagrammatically this can be represented as in figure @ref(fig:pwide). The basic syntax (with commonly used arguments) is-</p>
<pre><code>pivot_wider(
  data,
  id_cols = NULL,
  names_from = name,
  values_from = value,
  values_fill = NULL,
  values_fn = NULL,
  ...
)</code></pre>
<p>where-</p>
<ul>
<li><code>id_cols</code> is a vector of columns that uniquely identifies each observation</li>
<li><code>names_from</code> is a vector of columns to get the name of the output column</li>
<li><code>values_from</code> similarly provides columns to get the cell values from</li>
<li><code>values_fill</code> provides what each value should be filled in with when missing</li>
<li><code>values_fn</code> is a named list - to apply different aggregations to different <code>values_from</code> columns</li>
</ul>
<blockquote>
<p>Also note that there are many other arguments for this function, which may be used to deal with complicated tables.</p>
</blockquote>
Basic functionality of this function can be understood with the following animated figure @ref(fig:tidy3).
<div class="figure" style="text-align: center">
<img src="images/wider.gif" alt="Basic functionality of Pivot wider"  />
<p class="caption">
(#fig:tidy3)Basic functionality of Pivot wider
</p>
</div>
<p>A diagrammtic representation of the mechanics behind the function is also shown in Figure @ref(fig:pwide).</p>
<div class="figure" style="text-align: center">
<img src="images/pivot_wider.png" alt="Diagrammatic representation of pivot\_wider" width="99%" />
<p class="caption">
(#fig:pwide)Diagrammatic representation of pivot_wider
</p>
</div>
<p>Example-1:</p>
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1023-1"><a href="#cb1023-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1023-2"><a href="#cb1023-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;type&quot;</span>,</span>
<span id="cb1023-3"><a href="#cb1023-3" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Example-2:</p>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="#cb1025-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1025-2"><a href="#cb1025-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year,</span>
<span id="cb1025-3"><a href="#cb1025-3" tabindex="-1"></a>              <span class="at">values_from =</span> count)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country     type           `1999`     `2000`
##   &lt;chr&gt;       &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan cases             745       2666
## 2 Afghanistan population   19987071   20595360
## 3 Brazil      cases           37737      80488
## 4 Brazil      population  172006362  174504898
## 5 China       cases          212258     213766
## 6 China       population 1272915272 1280428583</code></pre>
<p>Example-3: Summarisation</p>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="#cb1027-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1027-2"><a href="#cb1027-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> country,</span>
<span id="cb1027-3"><a href="#cb1027-3" tabindex="-1"></a>              <span class="at">names_from =</span> type,</span>
<span id="cb1027-4"><a href="#cb1027-4" tabindex="-1"></a>              <span class="at">values_from =</span> count,</span>
<span id="cb1027-5"><a href="#cb1027-5" tabindex="-1"></a>              <span class="at">values_fn =</span> mean)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   country       cases  population
##   &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;
## 1 Afghanistan   1706.   20291216.
## 2 Brazil       59112.  173255630 
## 3 China       213012  1276671928.</code></pre>
<p>Example-4: Summarisation with different id_cols</p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="#cb1029-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1029-2"><a href="#cb1029-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> year,</span>
<span id="cb1029-3"><a href="#cb1029-3" tabindex="-1"></a>              <span class="at">names_from =</span> type,</span>
<span id="cb1029-4"><a href="#cb1029-4" tabindex="-1"></a>              <span class="at">values_from =</span> count,</span>
<span id="cb1029-5"><a href="#cb1029-5" tabindex="-1"></a>              <span class="at">values_fn =</span> sum)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##    year  cases population
##   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1  1999 250740 1464908705
## 2  2000 296920 1475528841</code></pre>
<p>Example-5: Use of multiple columns in <code>names_from</code> argument</p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="#cb1031-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1031-2"><a href="#cb1031-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(year, type),</span>
<span id="cb1031-3"><a href="#cb1031-3" tabindex="-1"></a>               <span class="at">values_from =</span> count)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   country     `1999_cases` `1999_population` `2000_cases` `2000_population`
##   &lt;chr&gt;              &lt;dbl&gt;             &lt;dbl&gt;        &lt;dbl&gt;             &lt;dbl&gt;
## 1 Afghanistan          745          19987071         2666          20595360
## 2 Brazil             37737         172006362        80488         174504898
## 3 China             212258        1272915272       213766        1280428583</code></pre>
<p>What if order is reversed in <code>names_from</code> arg. See Example-6:</p>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1033-1"><a href="#cb1033-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1033-2"><a href="#cb1033-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(type, year),</span>
<span id="cb1033-3"><a href="#cb1033-3" tabindex="-1"></a>               <span class="at">values_from =</span> count)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   country     cases_1999 population_1999 cases_2000 population_2000
##   &lt;chr&gt;            &lt;dbl&gt;           &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;
## 1 Afghanistan        745        19987071       2666        20595360
## 2 Brazil           37737       172006362      80488       174504898
## 3 China           212258      1272915272     213766      1280428583</code></pre>
<p>Example-7: Multiple columns in <code>values_from</code></p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="#cb1035-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table1 <span class="sc">%&gt;%</span> </span>
<span id="cb1035-2"><a href="#cb1035-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year,</span>
<span id="cb1035-3"><a href="#cb1035-3" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(cases, population))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   country     cases_1999 cases_2000 population_1999 population_2000
##   &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
## 1 Afghanistan        745       2666        19987071        20595360
## 2 Brazil           37737      80488       172006362       174504898
## 3 China           212258     213766      1272915272      1280428583</code></pre>
<p>Example-8: Use of names_vary argument to control the order of output columns</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="#cb1037-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table1 <span class="sc">%&gt;%</span> </span>
<span id="cb1037-2"><a href="#cb1037-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year,</span>
<span id="cb1037-3"><a href="#cb1037-3" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(cases, population),</span>
<span id="cb1037-4"><a href="#cb1037-4" tabindex="-1"></a>              <span class="at">names_vary =</span> <span class="st">&quot;slowest&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   country     cases_1999 population_1999 cases_2000 population_2000
##   &lt;chr&gt;            &lt;dbl&gt;           &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;
## 1 Afghanistan        745        19987071       2666        20595360
## 2 Brazil           37737       172006362      80488       174504898
## 3 China           212258      1272915272     213766      1280428583</code></pre>
<p>For more details please refer to <a href="https://tidyr.tidyverse.org/articles/pivot.html">package vignette</a> or <a href="https://r4ds.had.co.nz/tidy-data.html">Chapter-12 of R for Data Science book</a>.</p>
</div>
<div id="separate-columns-into-multiple-columns-join-columns-into-one-column" class="section level2" number="16.4">
<h2><span class="header-section-number">16.4</span> Separate Column(s) into multiple columns/ Join columns into one column</h2>
<div id="separate-a-character-column-into-multiple-with-separate" class="section level3 unnumbered">
<h3 class="unnumbered">Separate a character column into multiple with <code>separate()</code></h3>
<p>As the name suggests, <code>separate()</code> function is used to separate a given character column into multiple columns either using a regular expression or a vector of character positions.
The syntax is -</p>
<pre><code>separate(
  data,
  col,
  into,
  sep = &quot;[^[:alnum:]]+&quot;,
  remove = TRUE,
  convert = FALSE,
  extra = &quot;warn&quot;,
  fill = &quot;warn&quot;,
  ...
)</code></pre>
<p>Explanation of purpose of different arguments in above syntax -</p>
<ol style="list-style-type: decimal">
<li><code>data</code> is as usual name of the data frame</li>
<li><code>col</code> is the name of the column which is required to be separated.</li>
<li><code>into</code> should be a character vector, which usually should be equal length of maximum number of new columns which will be created out of such separation. (Refer examples nos. 1)</li>
<li><code>sep</code> provides a separator value. (Refer Example -3 below).</li>
<li><code>remove</code> if <code>FALSE</code>, the original column is not removed from the output. (Refer Example -3 below).</li>
<li><code>convert</code> if <code>TRUE</code>, the component columns are converted to double/integer/logical/NA, if possible. This is useful if the component columns are integer, numeric or logical. (Refer Example-1 below).</li>
<li><code>extra</code> argument is used to control when number of desired component columns are less than the maximum possible count. (Refer Example-4 below).</li>
<li><code>fill</code> argument is on the other hand, useful when the number of components are different for each row. (Refer Example-2 below)</li>
</ol>
<p>Example-1:</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="#cb1040-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table3 <span class="sc">%&gt;%</span> </span>
<span id="cb1040-2"><a href="#cb1040-2" tabindex="-1"></a>  <span class="fu">separate</span>(rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1040-3"><a href="#cb1040-3" tabindex="-1"></a>           <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="co"># optional - will convert the values</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Example-2:</p>
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1042-1"><a href="#cb1042-1" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb1042-2"><a href="#cb1042-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;a+b&quot;</span>, <span class="st">&quot;c+d+e&quot;</span>)</span>
<span id="cb1042-3"><a href="#cb1042-3" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb1042-4"><a href="#cb1042-4" tabindex="-1"></a>  <span class="fu">separate</span>(x,</span>
<span id="cb1042-5"><a href="#cb1042-5" tabindex="-1"></a>           <span class="at">into=</span><span class="fu">c</span>(<span class="st">&#39;X1&#39;</span>, <span class="st">&#39;X2&#39;</span>, <span class="st">&#39;X3&#39;</span>),</span>
<span id="cb1042-6"><a href="#cb1042-6" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<pre><code>##     X1   X2 X3
## 1 &lt;NA&gt; &lt;NA&gt;  a
## 2 &lt;NA&gt;    a  b
## 3    c    d  e</code></pre>
<p>Example-3:</p>
<div class="sourceCode" id="cb1044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="#cb1044-1" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb1044-2"><a href="#cb1044-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;A$B&quot;</span>, <span class="st">&quot;C+D&quot;</span>, <span class="st">&quot;E-F&quot;</span>)</span>
<span id="cb1044-3"><a href="#cb1044-3" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb1044-4"><a href="#cb1044-4" tabindex="-1"></a>  <span class="fu">separate</span>(x, </span>
<span id="cb1044-5"><a href="#cb1044-5" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">-|</span><span class="sc">\\</span><span class="st">$&quot;</span>,</span>
<span id="cb1044-6"><a href="#cb1044-6" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&#39;X1&#39;</span>, <span class="st">&#39;X2&#39;</span>),</span>
<span id="cb1044-7"><a href="#cb1044-7" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1 rows [2].</code></pre>
<pre><code>##     x  X1   X2
## 1 A$B   A    B
## 2 C+D C+D &lt;NA&gt;
## 3 E-F   E    F</code></pre>
<p>Example-4:</p>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="#cb1047-1" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb1047-2"><a href="#cb1047-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;a+b&quot;</span>, <span class="st">&quot;c+d+e&quot;</span>)</span>
<span id="cb1047-3"><a href="#cb1047-3" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb1047-4"><a href="#cb1047-4" tabindex="-1"></a>  <span class="fu">separate</span>(x,</span>
<span id="cb1047-5"><a href="#cb1047-5" tabindex="-1"></a>           <span class="at">into=</span><span class="fu">c</span>(<span class="st">&#39;X1&#39;</span>, <span class="st">&#39;X2&#39;</span>),</span>
<span id="cb1047-6"><a href="#cb1047-6" tabindex="-1"></a>           <span class="at">extra =</span> <span class="st">&quot;merge&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1 rows [1].</code></pre>
<pre><code>##   X1   X2
## 1  a &lt;NA&gt;
## 2  a    b
## 3  c  d+e</code></pre>
</div>
<div id="unite-multiple-character-columns-into-one-using-unite" class="section level3 unnumbered">
<h3 class="unnumbered">Unite multiple character columns into one using <code>unite()</code></h3>
<p>It complements <code>separate</code> by uniting the columns into one. Its syntax is</p>
<pre><code>unite(data, 
      col, 
      ..., 
      sep = &quot;_&quot;, 
      remove = TRUE, 
      na.rm = FALSE)</code></pre>
<p>Explanation of arguments in the above syntax-</p>
<ol style="list-style-type: decimal">
<li><code>data</code> is as usual name of the data frame.</li>
<li><code>col</code> should be the name of new column to be formed (should be a string),</li>
<li><code>...</code> the names of columns to be united should be provided</li>
<li><code>sep</code> is separator to be used for uniting</li>
<li><code>remove</code> if <code>FALSE</code>, will not remove original component columns</li>
<li><code>na.rm</code> if <code>TRUE</code>, the missing values will be removed beforehand.</li>
</ol>
<p>Example-1a:</p>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="#cb1051-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table5 <span class="sc">%&gt;%</span> </span>
<span id="cb1051-2"><a href="#cb1051-2" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">&quot;Year&quot;</span>,</span>
<span id="cb1051-3"><a href="#cb1051-3" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">&quot;century&quot;</span>, <span class="st">&quot;year&quot;</span>), </span>
<span id="cb1051-4"><a href="#cb1051-4" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb1051-5"><a href="#cb1051-5" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   country     Year  century year  rate             
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 1999  19      99    745/19987071     
## 2 Afghanistan 2000  20      00    2666/20595360    
## 3 Brazil      1999  19      99    37737/172006362  
## 4 Brazil      2000  20      00    80488/174504898  
## 5 China       1999  19      99    212258/1272915272
## 6 China       2000  20      00    213766/1280428583</code></pre>
<p>Example-1b:
We may complete the tidying process in the next step</p>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1053-1"><a href="#cb1053-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table5 <span class="sc">%&gt;%</span> </span>
<span id="cb1053-2"><a href="#cb1053-2" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">&quot;Year&quot;</span>,</span>
<span id="cb1053-3"><a href="#cb1053-3" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">&quot;century&quot;</span>, <span class="st">&quot;year&quot;</span>), </span>
<span id="cb1053-4"><a href="#cb1053-4" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1053-5"><a href="#cb1053-5" tabindex="-1"></a>  <span class="fu">separate</span>(rate, </span>
<span id="cb1053-6"><a href="#cb1053-6" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1053-7"><a href="#cb1053-7" tabindex="-1"></a>           <span class="at">convert =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country     Year   cases population
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan 1999     745   19987071
## 2 Afghanistan 2000    2666   20595360
## 3 Brazil      1999   37737  172006362
## 4 Brazil      2000   80488  174504898
## 5 China       1999  212258 1272915272
## 6 China       2000  213766 1280428583</code></pre>
<p>Example-</p>
</div>
</div>
<div id="separate-rows-into-multiple-rows" class="section level2" number="16.5">
<h2><span class="header-section-number">16.5</span> Separate row(s) into multiple rows</h2>
<div id="split-data-into-multiple-rows-with-separate_rows" class="section level3 unnumbered">
<h3 class="unnumbered">Split data into multiple rows with <code>separate_rows()</code></h3>
<p>This function is used to separate delimited values placed in one single cell/column into multiple rows (as against in rows using <code>separate</code>).
See Example-</p>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1055-1"><a href="#cb1055-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table3 <span class="sc">%&gt;%</span> </span>
<span id="cb1055-2"><a href="#cb1055-2" tabindex="-1"></a>  <span class="fu">separate_rows</span>(</span>
<span id="cb1055-3"><a href="#cb1055-3" tabindex="-1"></a>    rate,</span>
<span id="cb1055-4"><a href="#cb1055-4" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>,</span>
<span id="cb1055-5"><a href="#cb1055-5" tabindex="-1"></a>    <span class="at">convert =</span> <span class="cn">TRUE</span></span>
<span id="cb1055-6"><a href="#cb1055-6" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##    country      year       rate
##    &lt;chr&gt;       &lt;dbl&gt;      &lt;int&gt;
##  1 Afghanistan  1999        745
##  2 Afghanistan  1999   19987071
##  3 Afghanistan  2000       2666
##  4 Afghanistan  2000   20595360
##  5 Brazil       1999      37737
##  6 Brazil       1999  172006362
##  7 Brazil       2000      80488
##  8 Brazil       2000  174504898
##  9 China        1999     212258
## 10 China        1999 1272915272
## 11 China        2000     213766
## 12 China        2000 1280428583</code></pre>
<p>To create <code>type</code> we have to however, add an extra step to the above example-</p>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="#cb1057-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table3 <span class="sc">%&gt;%</span> </span>
<span id="cb1057-2"><a href="#cb1057-2" tabindex="-1"></a>  <span class="fu">separate_rows</span>(</span>
<span id="cb1057-3"><a href="#cb1057-3" tabindex="-1"></a>    rate,</span>
<span id="cb1057-4"><a href="#cb1057-4" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>,</span>
<span id="cb1057-5"><a href="#cb1057-5" tabindex="-1"></a>    <span class="at">convert =</span> <span class="cn">TRUE</span></span>
<span id="cb1057-6"><a href="#cb1057-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1057-7"><a href="#cb1057-7" tabindex="-1"></a>  <span class="fu">group_by</span>(country, year) <span class="sc">%&gt;%</span> </span>
<span id="cb1057-8"><a href="#cb1057-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;pop&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
## # Groups:   country, year [6]
##    country      year       rate type 
##    &lt;chr&gt;       &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;
##  1 Afghanistan  1999        745 cases
##  2 Afghanistan  1999   19987071 pop  
##  3 Afghanistan  2000       2666 cases
##  4 Afghanistan  2000   20595360 pop  
##  5 Brazil       1999      37737 cases
##  6 Brazil       1999  172006362 pop  
##  7 Brazil       2000      80488 cases
##  8 Brazil       2000  174504898 pop  
##  9 China        1999     212258 cases
## 10 China        1999 1272915272 pop  
## 11 China        2000     213766 cases
## 12 China        2000 1280428583 pop</code></pre>
</div>
</div>
<div id="expand-table-to-handle-missing-rowsvalues" class="section level2" number="16.6">
<h2><span class="header-section-number">16.6</span> Expand table to handle missing rows/values</h2>
<p>Sometimes, when we deal with missing data, we require to handle implicit missing values as well. Either we have to turn these values into explicit missing values or we have to fill appropriate values. In such cases, two functions namely <code>complete</code> and <code>fill</code> both from same package are extremely useful. Let’s learn these as well.</p>
<div id="turn-implicit-missing-values-to-explicit-using-complete" class="section level3 unnumbered">
<h3 class="unnumbered">Turn implicit missing values to explicit using <code>complete()</code></h3>
<p>As th name suggests, this function is used to turn implicit missing values (invisible rows) to explicit missing values (visible rows with <code>NA</code>).</p>
<p>As an example, let’s suppose fuel prices are revised randomly. Say, after revision on <code>1 January 2020</code> prices revise on <code>20 January 2020</code>. So we will have only 2 rows in data for say <code>Janaury 2020</code>. Thus, there are 29 implicit missing values in the data.</p>
<p>The syntax is</p>
<pre><code>complete(data, 
         ..., 
         fill = list(), 
         explicit = TRUE)</code></pre>
<p>Where -</p>
<ul>
<li><code>data</code> is as usual argument to provide data frame</li>
<li><code>...</code> are meant to provide column names to be completed</li>
<li><code>fill</code> provides a list to supply a single value which can be provided instead of <code>NA</code> for missing combinations.</li>
</ul>
<p>In the example mentioned above we can proceed as</p>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1060-1"><a href="#cb1060-1" tabindex="-1"></a><span class="co"># First create a sample data</span></span>
<span id="cb1060-2"><a href="#cb1060-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1060-3"><a href="#cb1060-3" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-20&quot;</span>)),</span>
<span id="cb1060-4"><a href="#cb1060-4" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="fl">75.12</span>, <span class="fl">78.32</span>)</span>
<span id="cb1060-5"><a href="#cb1060-5" tabindex="-1"></a>)</span>
<span id="cb1060-6"><a href="#cb1060-6" tabindex="-1"></a>df </span></code></pre></div>
<pre><code>##         date price
## 1 2020-01-01 75.12
## 2 2020-01-20 78.32</code></pre>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="#cb1062-1" tabindex="-1"></a><span class="co"># Use tidyr::complete to see explicit missing values</span></span>
<span id="cb1062-2"><a href="#cb1062-2" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb1062-3"><a href="#cb1062-3" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-31&quot;</span>), <span class="at">by =</span> <span class="st">&quot;day&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 31 × 2
##    date       price
##    &lt;date&gt;     &lt;dbl&gt;
##  1 2020-01-01  75.1
##  2 2020-01-02  NA  
##  3 2020-01-03  NA  
##  4 2020-01-04  NA  
##  5 2020-01-05  NA  
##  6 2020-01-06  NA  
##  7 2020-01-07  NA  
##  8 2020-01-08  NA  
##  9 2020-01-09  NA  
## 10 2020-01-10  NA  
## # ℹ 21 more rows</code></pre>
<p>Though the above example created dates as per the criteria given, <code>complete</code> function can find all unique combinations in the set of columns provided and return complete set of observations. See this example</p>
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1064-1"><a href="#cb1064-1" tabindex="-1"></a><span class="co">#Let&#39;s create a sample data</span></span>
<span id="cb1064-2"><a href="#cb1064-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1064-3"><a href="#cb1064-3" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1064-4"><a href="#cb1064-4" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2021</span>),</span>
<span id="cb1064-5"><a href="#cb1064-5" tabindex="-1"></a>  <span class="at">qtr =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb1064-6"><a href="#cb1064-6" tabindex="-1"></a>  <span class="at">sales =</span> <span class="fu">runif</span>(<span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">200</span>)</span>
<span id="cb1064-7"><a href="#cb1064-7" tabindex="-1"></a>)</span>
<span id="cb1064-8"><a href="#cb1064-8" tabindex="-1"></a>df2</span></code></pre></div>
<pre><code>##   year qtr    sales
## 1 2020   1 128.7578
## 2 2020   3 178.8305
## 3 2020   4 140.8977
## 4 2021   2 188.3017
## 5 2021   3 194.0467</code></pre>
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1066-1"><a href="#cb1066-1" tabindex="-1"></a><span class="co"># use complete to find all combination</span></span>
<span id="cb1066-2"><a href="#cb1066-2" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span> </span>
<span id="cb1066-3"><a href="#cb1066-3" tabindex="-1"></a>  <span class="fu">complete</span>(year, qtr, <span class="co"># cols provided</span></span>
<span id="cb1066-4"><a href="#cb1066-4" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">sales =</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##    year   qtr sales
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  2020     1  129.
## 2  2020     2    0 
## 3  2020     3  179.
## 4  2020     4  141.
## 5  2021     1    0 
## 6  2021     2  188.
## 7  2021     3  194.
## 8  2021     4    0</code></pre>
<p><strong>Note:</strong> If <code>fill</code> argument would not have been used, the value of sales in missing columns would have been <code>NA</code> instead of provided value.</p>
</div>
<div id="fill-missing-values-based-on-criteria-fill" class="section level3 unnumbered">
<h3 class="unnumbered">Fill missing values based on criteria <code>fill()</code></h3>
<p>This function helps in filling the missing values using previous or next entry. Think of a paper sheet where many cells in a table have been filled as <code>"-do-"</code>. Syntax is -</p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1068-1"><a href="#cb1068-1" tabindex="-1"></a><span class="fu">fill</span>(data, <span class="co"># used to provide data</span></span>
<span id="cb1068-2"><a href="#cb1068-2" tabindex="-1"></a>     ..., <span class="co"># provide columns to be filled</span></span>
<span id="cb1068-3"><a href="#cb1068-3" tabindex="-1"></a>     <span class="at">.direction =</span> <span class="fu">c</span>(<span class="st">&quot;down&quot;</span>, <span class="st">&quot;up&quot;</span>, <span class="st">&quot;downup&quot;</span>, <span class="st">&quot;updown&quot;</span>))</span></code></pre></div>
<p>The arguments are pretty simple. Most of the time <code>"down"</code> method is used. As an example we could see the example of fuel prices mentioned above.</p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1069-1"><a href="#cb1069-1" tabindex="-1"></a>fill_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb1069-2"><a href="#cb1069-2" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-31&quot;</span>), <span class="at">by =</span> <span class="st">&quot;day&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1069-3"><a href="#cb1069-3" tabindex="-1"></a>  <span class="fu">fill</span>(price, <span class="at">.direction =</span> <span class="st">&quot;down&quot;</span>)</span>
<span id="cb1069-4"><a href="#cb1069-4" tabindex="-1"></a></span>
<span id="cb1069-5"><a href="#cb1069-5" tabindex="-1"></a><span class="fu">head</span>(fill_df)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   date       price
##   &lt;date&gt;     &lt;dbl&gt;
## 1 2020-01-01  75.1
## 2 2020-01-02  75.1
## 3 2020-01-03  75.1
## 4 2020-01-04  75.1
## 5 2020-01-05  75.1
## 6 2020-01-06  75.1</code></pre>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1071-1"><a href="#cb1071-1" tabindex="-1"></a><span class="fu">tail</span>(fill_df)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   date       price
##   &lt;date&gt;     &lt;dbl&gt;
## 1 2020-01-26  78.3
## 2 2020-01-27  78.3
## 3 2020-01-28  78.3
## 4 2020-01-29  78.3
## 5 2020-01-30  78.3
## 6 2020-01-31  78.3</code></pre>
<!--chapter:end:11-tidyr.Rmd-->
</div>
</div>
</div>
<div id="generating-descriptive-statistics" class="section level1" number="17">
<h1><span class="header-section-number">17</span> Generating Descriptive statistics</h1>
<p>Exploratory Data Analysis or often abbreviated as EDA, is mostly the first and foremost step before carrying out any data analytics task, is used to analyze and investigate data sets and summarize their main characteristics, often employing data visualization methods. EDA is primarily used to see what data can reveal beyond the formal modeling or hypothesis testing task and provides a provides a better understanding of data set variables and the relationships between them. It can also help determine if the statistical techniques you are considering for data analysis are appropriate. Originally developed by American mathematician John Tukey in the 1960s, EDA techniques continue to be a widely used method in the data discovery process today.</p>
<div id="using-base-r" class="section level2" number="17.1">
<h2><span class="header-section-number">17.1</span> Using base R</h2>
<p>Base R provides us with two functions used ato ascertain structure and summary statistics of a data frame. First is <code>str</code> short for <strong>structure</strong> (and not to be confused with <strong>str</strong>ing) which as its full name suggests gives us structure of the data. Its usage is simple</p>
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1073-1"><a href="#cb1073-1" tabindex="-1"></a><span class="fu">str</span>(iris)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  5 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>As can be seen it gives us number of variables (columns) as well as observations (rows) available in the given data. It thereafter presents us names of all the columns/variables in the data along with their types. That’s not all. It also prints few first values in all of the columns. For <code>factor</code> columns it also gives us available levels in those factor variables.</p>
<p>Another function from base R is <code>summary</code> which can be used to generate some summary statistics from the given data frame. Let’s see what we can get from this function.</p>
<div class="sourceCode" id="cb1075"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1075-1"><a href="#cb1075-1" tabindex="-1"></a><span class="fu">summary</span>(iris)</span></code></pre></div>
<pre><code>##   Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   
##  Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100  
##  1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300  
##  Median :5.800   Median :3.000   Median :4.350   Median :1.300  
##  Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199  
##  3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800  
##  Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500  
##        Species  
##  setosa    :50  
##  versicolor:50  
##  virginica :50  
##                 
##                 
## </code></pre>
<p>We can see that it nicely gives us five-point summary for all <code>numeric</code> variables and count of all values present in <code>factor</code> variables. Apart from the five point summary i.e. (1) minimum, (2) 1st quartile, (3) Median, (4) third quartile and (5) maximum; we also get mean (arithmetic) of all numeric variables.</p>
<p>Before moving forward, we can discuss again <code>table()</code> function here which is used to genrate counts of factor/character variable(s) in base R.</p>
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1077-1"><a href="#cb1077-1" tabindex="-1"></a><span class="fu">with</span>(iris, <span class="fu">table</span>(Species))</span></code></pre></div>
<pre><code>## Species
##     setosa versicolor  virginica 
##         50         50         50</code></pre>
</div>
<div id="dplyr-functions" class="section level2" number="17.2">
<h2><span class="header-section-number">17.2</span> Dplyr functions</h2>
<p>For calculating other statistics we can use <code>dplyr::summarise</code> in combination with <code>across</code>. For Example to calculate <code>mean</code>, <code>sd</code>, <code>variance</code> for all numeric variables of say <code>iris</code> data, we can do-</p>
<div class="sourceCode" id="cb1079"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1079-1"><a href="#cb1079-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1079-2"><a href="#cb1079-2" tabindex="-1"></a>iris <span class="sc">%&gt;%</span></span>
<span id="cb1079-3"><a href="#cb1079-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb1079-4"><a href="#cb1079-4" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="fu">list</span>(</span>
<span id="cb1079-5"><a href="#cb1079-5" tabindex="-1"></a>                     <span class="at">Mean =</span> <span class="sc">~</span> <span class="fu">mean</span>(.),</span>
<span id="cb1079-6"><a href="#cb1079-6" tabindex="-1"></a>                     <span class="at">SD =</span> <span class="sc">~</span> <span class="fu">sd</span>(.),</span>
<span id="cb1079-7"><a href="#cb1079-7" tabindex="-1"></a>                     <span class="at">Var =</span> <span class="sc">~</span> <span class="fu">var</span>(.)</span>
<span id="cb1079-8"><a href="#cb1079-8" tabindex="-1"></a>                   )))</span></code></pre></div>
<pre><code>##   Sepal.Length_Mean Sepal.Length_SD Sepal.Length_Var Sepal.Width_Mean
## 1          5.843333       0.8280661        0.6856935         3.057333
##   Sepal.Width_SD Sepal.Width_Var Petal.Length_Mean Petal.Length_SD
## 1      0.4358663       0.1899794             3.758        1.765298
##   Petal.Length_Var Petal.Width_Mean Petal.Width_SD Petal.Width_Var
## 1         3.116278         1.199333      0.7622377       0.5810063</code></pre>
<p>Before trying to understand the output let’s learn to use <code>dplyr::across</code>. Actually <code>across</code> is used inside dplyr verbs mostly with <code>mutate</code> or <code>summarise</code> through which we can mutate/summarise multiple variables (columns) simultaneously. So, at least two arguments are needed; first variable names which can be provided through a type checking variable, str detecting function, etc.; and second argument either a function name or a list of functions together. So in above example we have summarised all numeric columns (see first argument is a function <code>is.numeric</code> which only operates on column names) and second argument is a list of three functions in lambda style notation. In our example we are having 4 numeric columns and three aggregating functions, so 12 columns we are getting in output.</p>
<p>We can further reshape/transform the data using <code>tidyr::pivot_longer</code>. See</p>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1081-1"><a href="#cb1081-1" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1081-2"><a href="#cb1081-2" tabindex="-1"></a>iris <span class="sc">%&gt;%</span></span>
<span id="cb1081-3"><a href="#cb1081-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb1081-4"><a href="#cb1081-4" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="fu">list</span>(</span>
<span id="cb1081-5"><a href="#cb1081-5" tabindex="-1"></a>                     <span class="at">Mean =</span> <span class="sc">~</span> <span class="fu">mean</span>(.),</span>
<span id="cb1081-6"><a href="#cb1081-6" tabindex="-1"></a>                     <span class="at">SD =</span> <span class="sc">~</span> <span class="fu">sd</span>(.),</span>
<span id="cb1081-7"><a href="#cb1081-7" tabindex="-1"></a>                     <span class="at">Var =</span> <span class="sc">~</span> <span class="fu">var</span>(.)</span>
<span id="cb1081-8"><a href="#cb1081-8" tabindex="-1"></a>                   ))) <span class="sc">%&gt;%</span></span>
<span id="cb1081-9"><a href="#cb1081-9" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1081-10"><a href="#cb1081-10" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1081-11"><a href="#cb1081-11" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;Function&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   Function Sepal.Length Sepal.Width Petal.Length Petal.Width
##   &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
## 1 Mean            5.84        3.06          3.76       1.20 
## 2 SD              0.828       0.436         1.77       0.762
## 3 Var             0.686       0.190         3.12       0.581</code></pre>
<div class="sourceCode" id="cb1083"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1083-1"><a href="#cb1083-1" tabindex="-1"></a>iris <span class="sc">%&gt;%</span></span>
<span id="cb1083-2"><a href="#cb1083-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb1083-3"><a href="#cb1083-3" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="fu">list</span>(</span>
<span id="cb1083-4"><a href="#cb1083-4" tabindex="-1"></a>                     <span class="at">Mean =</span> <span class="sc">~</span> <span class="fu">mean</span>(.),</span>
<span id="cb1083-5"><a href="#cb1083-5" tabindex="-1"></a>                     <span class="at">SD =</span> <span class="sc">~</span> <span class="fu">sd</span>(.),</span>
<span id="cb1083-6"><a href="#cb1083-6" tabindex="-1"></a>                     <span class="at">Var =</span> <span class="sc">~</span> <span class="fu">var</span>(.)</span>
<span id="cb1083-7"><a href="#cb1083-7" tabindex="-1"></a>                   ))) <span class="sc">%&gt;%</span></span>
<span id="cb1083-8"><a href="#cb1083-8" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1083-9"><a href="#cb1083-9" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1083-10"><a href="#cb1083-10" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;Variable&quot;</span>, <span class="st">&quot;.value&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 4 × 4
##   Variable      Mean    SD   Var
##   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Sepal.Length  5.84 0.828 0.686
## 2 Sepal.Width   3.06 0.436 0.190
## 3 Petal.Length  3.76 1.77  3.12 
## 4 Petal.Width   1.20 0.762 0.581</code></pre>
<p>Let us also discuss one more data summary statistics function of <code>dplyr</code> that is <code>glimpse</code>. It is basically a pipe friendly version of <code>str()</code>. See</p>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1085-1"><a href="#cb1085-1" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> </span>
<span id="cb1085-2"><a href="#cb1085-2" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 150
## Columns: 5
## $ Sepal.Length &lt;dbl&gt; 5.1, 4.9, 4.7, 4.6, 5.0, 5.4, 4.6, 5.0, 4.4, 4.9, 5.4, 4.…
## $ Sepal.Width  &lt;dbl&gt; 3.5, 3.0, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3.7, 3.…
## $ Petal.Length &lt;dbl&gt; 1.4, 1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1.5, 1.…
## $ Petal.Width  &lt;dbl&gt; 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0.2, 0.…
## $ Species      &lt;fct&gt; setosa, setosa, setosa, setosa, setosa, setosa, setosa, s…</code></pre>
<p>To calculate counts of factor variable (as generated by <code>table</code> in base R), we can use <code>dplyr::count</code> a pipe friendly function.</p>
<div class="sourceCode" id="cb1087"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1087-1"><a href="#cb1087-1" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> </span>
<span id="cb1087-2"><a href="#cb1087-2" tabindex="-1"></a>  <span class="fu">count</span>(Species)</span></code></pre></div>
<pre><code>##      Species  n
## 1     setosa 50
## 2 versicolor 50
## 3  virginica 50</code></pre>
<p>We can generate counts of multiple combinations of variables</p>
<div class="sourceCode" id="cb1089"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1089-1"><a href="#cb1089-1" tabindex="-1"></a>ggplot2<span class="sc">::</span>diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb1089-2"><a href="#cb1089-2" tabindex="-1"></a>  <span class="fu">count</span>(cut, color, <span class="at">name =</span> <span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 35 × 3
##    cut   color count
##    &lt;ord&gt; &lt;ord&gt; &lt;int&gt;
##  1 Fair  D       163
##  2 Fair  E       224
##  3 Fair  F       312
##  4 Fair  G       314
##  5 Fair  H       303
##  6 Fair  I       175
##  7 Fair  J       119
##  8 Good  D       662
##  9 Good  E       933
## 10 Good  F       909
## # ℹ 25 more rows</code></pre>
</div>
<div id="using-psych" class="section level2" number="17.3">
<h2><span class="header-section-number">17.3</span> Using <code>psych</code></h2>
<p>There are indeed some beautiful packages in R, which creates beautiful EDA summaries for us without much ado. Package <code>psych</code> is one of these.</p>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="#cb1091-1" tabindex="-1"></a><span class="fu">library</span>(psych)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;psych&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:ggplot2&#39;:
## 
##     %+%, alpha</code></pre>
<div class="sourceCode" id="cb1094"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1094-1"><a href="#cb1094-1" tabindex="-1"></a><span class="fu">describe</span>(USArrests)</span></code></pre></div>
<pre><code>##          vars  n   mean    sd median trimmed    mad  min   max range  skew
## Murder      1 50   7.79  4.36   7.25    7.53   5.41  0.8  17.4  16.6  0.37
## Assault     2 50 170.76 83.34 159.00  168.48 110.45 45.0 337.0 292.0  0.22
## UrbanPop    3 50  65.54 14.47  66.00   65.88  17.79 32.0  91.0  59.0 -0.21
## Rape        4 50  21.23  9.37  20.10   20.36   8.60  7.3  46.0  38.7  0.75
##          kurtosis    se
## Murder      -0.95  0.62
## Assault     -1.15 11.79
## UrbanPop    -0.87  2.05
## Rape         0.08  1.32</code></pre>
<p>Note that output is in <code>data.frame</code> format ready to use. Another function in <code>psych</code> is <code>describeBy</code> which creates grouped summaries.</p>
<div class="sourceCode" id="cb1096"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1096-1"><a href="#cb1096-1" tabindex="-1"></a><span class="fu">describeBy</span>(ggplot2<span class="sc">::</span>diamonds, <span class="at">group =</span> <span class="st">&quot;cut&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Descriptive statistics by group 
## cut: 1
##         vars    n    mean      sd  median trimmed     mad    min      max
## carat      1 1610    1.05    0.52    1.00    0.98    0.43   0.22     5.01
## cut        2 1610    1.00    0.00    1.00    1.00    0.00   1.00     1.00
## color      3 1610    3.85    1.71    4.00    3.85    1.48   1.00     7.00
## clarity    4 1610    3.02    1.45    3.00    2.93    1.48   1.00     8.00
## depth      5 1610   64.04    3.64   65.00   64.48    1.33  43.00    79.00
## table      6 1610   59.05    3.95   58.00   58.64    2.97  49.00    95.00
## price      7 1610 4358.76 3560.39 3282.00 3695.65 2183.13 337.00 18574.00
## x          8 1610    6.25    0.96    6.18    6.21    0.81   0.00    10.74
## y          9 1610    6.18    0.96    6.10    6.14    0.79   0.00    10.54
## z         10 1610    3.98    0.65    3.97    3.95    0.52   0.00     6.98
##            range  skew kurtosis    se
## carat       4.79  1.68     5.31  0.01
## cut         0.00   NaN      NaN  0.00
## color       6.00  0.06    -0.86  0.04
## clarity     7.00  0.68     0.14  0.04
## depth      36.00 -1.17     2.20  0.09
## table      46.00  1.34     4.83  0.10
## price   18237.00  1.78     3.07 88.73
## x          10.74  0.36     1.58  0.02
## y          10.54  0.36     1.53  0.02
## z           6.98  0.34     1.43  0.02
## ------------------------------------------------------------ 
## cut: 2
##         vars    n    mean      sd  median trimmed     mad    min      max
## carat      1 4906    0.85    0.45    0.82    0.80    0.43   0.23     3.01
## cut        2 4906    2.00    0.00    2.00    2.00    0.00   2.00     2.00
## color      3 4906    3.57    1.76    3.00    3.51    1.48   1.00     7.00
## clarity    4 4906    3.60    1.47    3.00    3.44    1.48   1.00     8.00
## depth      5 4906   62.37    2.17   63.40   62.70    0.74  54.30    67.00
## table      6 4906   58.69    2.85   58.00   58.57    2.97  51.00    66.00
## price      7 4906 3928.86 3681.59 3050.50 3251.51 2853.26 327.00 18788.00
## x          8 4906    5.84    1.06    5.98    5.80    1.10   0.00     9.44
## y          9 4906    5.85    1.05    5.99    5.82    1.08   0.00     9.38
## z         10 4906    3.64    0.65    3.70    3.62    0.68   0.00     5.79
##            range  skew kurtosis    se
## carat       2.78  1.03     1.22  0.01
## cut         0.00   NaN      NaN  0.00
## color       6.00  0.25    -0.93  0.03
## clarity     7.00  0.81     0.29  0.02
## depth      12.70 -1.20     0.17  0.03
## table      15.00  0.31    -0.64  0.04
## price   18461.00  1.72     3.04 52.56
## x           9.44  0.15    -0.15  0.02
## y           9.38  0.14    -0.17  0.02
## z           5.79  0.09     0.12  0.01
## ------------------------------------------------------------ 
## cut: 3
##         vars     n    mean      sd  median trimmed     mad   min      max
## carat      1 12082    0.81    0.46    0.71    0.75    0.46   0.2     4.00
## cut        2 12082    3.00    0.00    3.00    3.00    0.00   3.0     3.00
## color      3 12082    3.57    1.72    3.00    3.51    1.48   1.0     7.00
## clarity    4 12082    4.00    1.59    4.00    3.87    1.48   1.0     8.00
## depth      5 12082   61.82    1.38   62.10   61.95    1.48  56.8    64.90
## table      6 12082   57.96    2.12   58.00   57.88    1.48  44.0    66.00
## price      7 12082 3981.76 3935.86 2648.00 3243.22 2855.49 336.0 18818.00
## x          8 12082    5.74    1.10    5.74    5.69    1.25   0.0    10.01
## y          9 12082    5.77    1.10    5.77    5.72    1.25   0.0     9.94
## z         10 12082    3.56    0.73    3.56    3.53    0.76   0.0    31.80
##            range  skew kurtosis    se
## carat       3.80  0.99     0.89  0.00
## cut         0.00   NaN      NaN  0.00
## color       6.00  0.25    -0.89  0.02
## clarity     7.00  0.57    -0.43  0.01
## depth       8.10 -0.71    -0.30  0.01
## table      22.00  0.28     0.04  0.02
## price   18482.00  1.60     2.24 35.81
## x          10.01  0.23    -0.65  0.01
## y           9.94  0.23    -0.66  0.01
## z          31.80  4.96   183.94  0.01
## ------------------------------------------------------------ 
## cut: 4
##         vars     n    mean      sd  median trimmed     mad   min      max
## carat      1 13791    0.89    0.52    0.86    0.83    0.56   0.2     4.01
## cut        2 13791    4.00    0.00    4.00    4.00    0.00   4.0     4.00
## color      3 13791    3.70    1.71    4.00    3.67    1.48   1.0     7.00
## clarity    4 13791    3.74    1.50    4.00    3.60    1.48   1.0     8.00
## depth      5 13791   61.26    1.16   61.40   61.36    1.19  58.0    63.00
## table      6 13791   58.75    1.48   59.00   58.77    1.48  51.0    62.00
## price      7 13791 4584.26 4349.20 3185.00 3822.23 3371.43 326.0 18823.00
## x          8 13791    5.97    1.19    6.11    5.92    1.42   0.0    10.14
## y          9 13791    5.94    1.26    6.06    5.89    1.41   0.0    58.90
## z         10 13791    3.65    0.73    3.72    3.62    0.86   0.0     8.06
##            range  skew kurtosis    se
## carat       3.81  0.86     0.43  0.00
## cut         0.00   NaN      NaN  0.00
## color       6.00  0.12    -0.88  0.01
## clarity     7.00  0.69     0.06  0.01
## depth       5.00 -0.61    -0.37  0.01
## table      11.00 -0.37     1.33  0.01
## price   18497.00  1.33     1.07 37.03
## x          10.14  0.17    -0.85  0.01
## y          58.90  5.53   225.05  0.01
## z           8.06  0.11    -0.44  0.01
## ------------------------------------------------------------ 
## cut: 5
##         vars     n    mean      sd  median trimmed     mad   min      max
## carat      1 21551    0.70    0.43    0.54    0.64    0.33   0.2     3.50
## cut        2 21551    5.00    0.00    5.00    5.00    0.00   5.0     5.00
## color      3 21551    3.53    1.66    4.00    3.48    1.48   1.0     7.00
## clarity    4 21551    4.46    1.71    4.00    4.39    1.48   1.0     8.00
## depth      5 21551   61.71    0.72   61.80   61.76    0.59  43.0    66.70
## table      6 21551   55.95    1.25   56.00   55.97    1.48  43.0    63.00
## price      7 21551 3457.54 3808.40 1810.00 2656.14 1630.86 326.0 18806.00
## x          8 21551    5.51    1.06    5.25    5.41    1.19   0.0     9.65
## y          9 21551    5.52    1.07    5.26    5.42    1.19   0.0    31.80
## z         10 21551    3.40    0.66    3.23    3.34    0.73   0.0     6.03
##            range  skew kurtosis    se
## carat       3.30  1.34     1.63  0.00
## cut         0.00   NaN      NaN  0.00
## color       6.00  0.19    -0.82  0.01
## clarity     7.00  0.36    -0.71  0.01
## depth      23.70 -1.44    22.33  0.00
## table      20.00  0.20     1.70  0.01
## price   18480.00  1.84     2.98 25.94
## x           9.65  0.66    -0.42  0.01
## y          31.80  1.30    15.99  0.01
## z           6.03  0.65    -0.36  0.00</code></pre>
<p>There is one more function <code>describeData</code> is this package which also results in first as well as last four (default) values.</p>
<div class="sourceCode" id="cb1098"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1098-1"><a href="#cb1098-1" tabindex="-1"></a><span class="fu">describeData</span>(ggplot2<span class="sc">::</span>diamonds)</span></code></pre></div>
<pre><code>## n.obs =  53940 of which  53940   are complete cases.   Number of variables =  10  of which all are numeric  TRUE  
##          variable # n.obs type    H1      H2   H3      H4   T1        T2
## carat*            1 53940    4  0.23    0.21 0.23    0.29 0.72      0.70
## cut*              2 53940    4 Ideal Premium Good Premium Good Very Good
## color*            3 53940    4     E       E    E       I    D         D
## clarity*          4 53940    4   SI2     SI1  VS1     VS2  SI1       SI1
## depth*            5 53940    4  61.5    59.8 56.9    62.4 63.1      62.8
## table*            6 53940    4    55      61   65      58   55        60
## price*            7 53940    4   326     326  327     334 2757      2757
## x*                8 53940    4  3.95    3.89 4.05    4.20 5.69      5.66
## y*                9 53940    4  3.98    3.84 4.07    4.23 5.75      5.68
## z*               10 53940    4  2.43    2.31 2.31    2.63 3.61      3.56
##               T3    T4
## carat*      0.86  0.75
## cut*     Premium Ideal
## color*         H     D
## clarity*     SI2   SI2
## depth*      61.0  62.2
## table*        58    55
## price*      2757  2757
## x*          6.15  5.83
## y*          6.12  5.87
## z*          3.74  3.64</code></pre>
</div>
<div id="using-skimr" class="section level2" number="17.4">
<h2><span class="header-section-number">17.4</span> Using <code>skimr</code></h2>
<p>Package <code>skimr</code> generates beautiful data EDA summary reports which can be customised as per one’s taste. Full descriptions of this package may be seen <a href="https://cran.r-project.org/web/packages/skimr/vignettes/skimr.html">here</a>. For basic purposes we can use function <code>skim</code> from this package to get data EDA summary reports.</p>
<pre><code>library(skimr)
skim(iris)</code></pre>
<p><img src="images/skmi1.png" width="50%" /></p>
</div>
<div id="viewing-relationships-between-different-variables" class="section level2" number="17.5">
<h2><span class="header-section-number">17.5</span> Viewing relationships between different variables</h2>
<p>We can use package <code>PerformanceAnalytics</code> to generate and view relationships between different variables in the data. For this purpose function <code>PerformanceAnalytics::chart.Correlation()</code> may be used as shown below.</p>
<div class="sourceCode" id="cb1101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1101-1"><a href="#cb1101-1" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(PerformanceAnalytics))</span>
<span id="cb1101-2"><a href="#cb1101-2" tabindex="-1"></a></span>
<span id="cb1101-3"><a href="#cb1101-3" tabindex="-1"></a>USArrests <span class="sc">%&gt;%</span> </span>
<span id="cb1101-4"><a href="#cb1101-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-5"><a href="#cb1101-5" tabindex="-1"></a>  PerformanceAnalytics<span class="sc">::</span><span class="fu">chart.Correlation</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/unnamed-chunk-338-1.png" alt="Viewing relationships with PerformanceAnalytics" width="672" />
<p class="caption">
(#fig:unnamed-chunk-338)Viewing relationships with PerformanceAnalytics
</p>
</div>
<p>As can be seen that it generates visualization of a Correlation Matrix of the numeric variables in the given data.</p>
<p>There is one more package <code>GGally</code> which also creates beautiful charts for viewing relationships. There are two functions in this package which are particularly useful.</p>
<ol style="list-style-type: decimal">
<li><p>The <code>ggpairs()</code> function of the GGally package allows to build a great scatterplot matrix. Scatterplots of each pair of numeric variable are drawn on the left part of the figure. Pearson correlation is displayed on the right. Variable distribution is available on the diagonal.</p></li>
<li><p>The <code>ggcorr()</code> function allows to visualize the correlation of each pair of variable as a square. Note that the method argument allows to pick the correlation type you desire.</p></li>
</ol>
<p>See the following example-</p>
<div class="sourceCode" id="cb1102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1102-1"><a href="#cb1102-1" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(GGally))</span>
<span id="cb1102-2"><a href="#cb1102-2" tabindex="-1"></a>USArrests <span class="sc">%&gt;%</span> </span>
<span id="cb1102-3"><a href="#cb1102-3" tabindex="-1"></a>  <span class="fu">select_if</span>(is.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb1102-4"><a href="#cb1102-4" tabindex="-1"></a>  <span class="fu">ggcorr</span>(<span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1102-5"><a href="#cb1102-5" tabindex="-1"></a></span>
<span id="cb1102-6"><a href="#cb1102-6" tabindex="-1"></a>USArrests <span class="sc">%&gt;%</span> </span>
<span id="cb1102-7"><a href="#cb1102-7" tabindex="-1"></a>  <span class="fu">select_if</span>(is.numeric) <span class="sc">%&gt;%</span></span>
<span id="cb1102-8"><a href="#cb1102-8" tabindex="-1"></a>  <span class="fu">ggpairs</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/two-corr-1.png" alt="Scatterplot Matrix (Left) and Correlation plot (Right) produced in GGally" width="50%" /><img src="DauR_files/figure-html/two-corr-2.png" alt="Scatterplot Matrix (Left) and Correlation plot (Right) produced in GGally" width="50%" />
<p class="caption">
(#fig:two-corr)Scatterplot Matrix (Left) and Correlation plot (Right) produced in GGally
</p>
</div>
<!--chapter:end:12-1Desc.Rmd-->
</div>
</div>
<div id="part-iii-probability-and-sampling-in-r" class="section level1 unnumbered">
<h1 class="unnumbered">Part-III: Probability and Sampling in R</h1>
</div>
<div id="probability-in-r" class="section level1" number="18">
<h1><span class="header-section-number">18</span> Probability in R</h1>
<p>We will keep short here. Instead of learning all the concepts of probability, we will see how to calculate probability, densities, quantiles for nearly any type of distribution. R’s powerhorse has four types of functions for each of the distributions associated called <code>pqdr</code> functions. Actually all these are prefixes. Consider a probability function <span class="math inline">\(P(X=x) = p\)</span> for a variable <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> be the associated probability.</p>
<table>
<colgroup>
<col width="54%" />
<col width="16%" />
<col width="10%" />
<col width="9%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th>Distribution</th>
<th>P</th>
<th>Q</th>
<th>D</th>
<th>R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Beta</td>
<td>pbeta</td>
<td>qbeta</td>
<td>dbeta</td>
<td>rbeta</td>
</tr>
<tr class="even">
<td>Binomial</td>
<td>pbinom</td>
<td>qbinom</td>
<td>dbinom</td>
<td>rbinom</td>
</tr>
<tr class="odd">
<td>Cauchy</td>
<td>pcauchy</td>
<td>qcauchy</td>
<td>dcauchy</td>
<td>rcauchy</td>
</tr>
<tr class="even">
<td>Chi-Square</td>
<td>pchisq</td>
<td>qchisq</td>
<td>dchisq</td>
<td>rchisq</td>
</tr>
<tr class="odd">
<td>Exponential</td>
<td>pexp</td>
<td>qexp</td>
<td>dexp</td>
<td>rexp</td>
</tr>
<tr class="even">
<td>F</td>
<td>pf</td>
<td>qf</td>
<td>df</td>
<td>rf</td>
</tr>
<tr class="odd">
<td>Gamma</td>
<td>pgamma</td>
<td>qgamma</td>
<td>dgamma</td>
<td>rgamma</td>
</tr>
<tr class="even">
<td>Geometric</td>
<td>pgeom</td>
<td>qgeom</td>
<td>dgeom</td>
<td>rgeom</td>
</tr>
<tr class="odd">
<td>Hypergeometric</td>
<td>phyper</td>
<td>qhyper</td>
<td>dhyper</td>
<td>rhyper</td>
</tr>
<tr class="even">
<td>Logistic</td>
<td>plogis</td>
<td>qlogis</td>
<td>dlogis</td>
<td>rlogis</td>
</tr>
<tr class="odd">
<td>Log Normal</td>
<td>plnorm</td>
<td>qlnorm</td>
<td>dlnorm</td>
<td>rlnorm</td>
</tr>
<tr class="even">
<td>Negative Binomial</td>
<td>pnbinom</td>
<td>qnbinom</td>
<td>dnbinom</td>
<td>rnbinom</td>
</tr>
<tr class="odd">
<td>Normal</td>
<td>pnorm</td>
<td>qnorm</td>
<td>dnorm</td>
<td>rnorm</td>
</tr>
<tr class="even">
<td>Poisson</td>
<td>ppois</td>
<td>qpois</td>
<td>dpois</td>
<td>rpois</td>
</tr>
<tr class="odd">
<td>Student t</td>
<td>pt</td>
<td>qt</td>
<td>dt</td>
<td>rt</td>
</tr>
<tr class="even">
<td>Studentized Range</td>
<td>ptukey</td>
<td>qtukey</td>
<td>dtukey</td>
<td>rtukey</td>
</tr>
<tr class="odd">
<td>Uniform</td>
<td>punif</td>
<td>qunif</td>
<td>dunif</td>
<td>runif</td>
</tr>
<tr class="even">
<td>Weibull</td>
<td>pweibull</td>
<td>qweibull</td>
<td>dweibull</td>
<td>rweibull</td>
</tr>
<tr class="odd">
<td>Wilcoxon Rank Sum Statistic</td>
<td>pwilcox</td>
<td>qwilcox</td>
<td>dwilcox</td>
<td>rwilcox</td>
</tr>
<tr class="even">
<td>Wilcoxon Signed Rank Statistic</td>
<td>psignrank</td>
<td>qsignrank</td>
<td>dsignrank</td>
<td>rsignrank</td>
</tr>
</tbody>
</table>
<p>All these functions are vectorised. Let us explore these one by one.</p>
<div id="p-set-of-functions" class="section level2" number="18.1">
<h2><span class="header-section-number">18.1</span> <code>p*()</code> set of functions</h2>
<p>These set of functions give the cumulative <strong>p</strong>robability distribution of that probability function.</p>
<p>Example-1. What is the probability of a number being less than or equal to <code>25</code> in <code>Normal</code> distribution with <code>mean = 50</code> and <code>sd = 10</code>.</p>
<div class="sourceCode" id="cb1103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1103-1"><a href="#cb1103-1" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="dv">25</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 0.006209665</code></pre>
<p>On the contrary, the probability of a number being greater than or equal to 25 in the above distribution is-</p>
<div class="sourceCode" id="cb1105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1105-1"><a href="#cb1105-1" tabindex="-1"></a><span class="co"># Either deduct probability from 1 </span></span>
<span id="cb1105-2"><a href="#cb1105-2" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="dv">25</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 0.9937903</code></pre>
<div class="sourceCode" id="cb1107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1107-1"><a href="#cb1107-1" tabindex="-1"></a><span class="co"># Or provide FALSE to lower.tail argument</span></span>
<span id="cb1107-2"><a href="#cb1107-2" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="dv">25</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] 0.9937903</code></pre>
<p>Example-2: What is the probability of one or more heads out of two tosses of a fair coin (binomial distribution with <code>p = 0.5</code>).</p>
<div class="sourceCode" id="cb1109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1109-1"><a href="#cb1109-1" tabindex="-1"></a><span class="fu">pbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">p =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 0.75</code></pre>
</div>
<div id="q-set-of-functions" class="section level2" number="18.2">
<h2><span class="header-section-number">18.2</span> <code>q*()</code> set of functions</h2>
<p>These set of functions, give <strong>q</strong>uantile which is the inverse of cumulative probability function. So if <span class="math inline">\(f\)</span> is cdf (cumulative distribution function) of a given probability distribution then <span class="math inline">\(F\)</span> the quantile is inverse of <code>f</code> i.e. <span class="math inline">\(F = f^{-1}\)</span>. These are related by</p>
<p><span class="math display">\[\begin{equation}
p = f(x)
(\#eq:s1)
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
x = F(x) = f^{-1}(x)
(\#eq:s2)
\end{equation}\]</span></p>
<p>Example- In the above same normal distribution (<code>mean = 50</code> and <code>sd = 10</code>) What is number below which 90% of population will be distributed.</p>
<div class="sourceCode" id="cb1111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1111-1"><a href="#cb1111-1" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fl">0.9</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 62.81552</code></pre>
<p>Similar to <code>cdf</code> here we may use <code>lower.tail</code> argument to find the number above which a population percent is distributed.</p>
<div class="sourceCode" id="cb1113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1113-1"><a href="#cb1113-1" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fl">0.9</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] 37.18448</code></pre>
</div>
<div id="d-set-of-functions" class="section level2" number="18.3">
<h2><span class="header-section-number">18.3</span> <code>d*()</code> set of functions</h2>
<p>We saw that <code>p</code> group denotes <code>cdf</code>, <code>q</code> group denotes <code>inverse cdf</code>, but <code>d</code> group actually denotes probability <strong>d</strong>ensity function of a given distribution. Simply stating, this returns the height of probability distribution function for a given x value.</p>
<p>So what is expected probability of drawing exactly 2 heads out of two tosses of a single fair coin (i.e. from a binomial distribution with probability <code>p = 0.5</code>).</p>
<div class="sourceCode" id="cb1115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1115-1"><a href="#cb1115-1" tabindex="-1"></a><span class="fu">dbinom</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="at">prob =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 0.25</code></pre>
</div>
<div id="r-set-of-functions" class="section level2" number="18.4">
<h2><span class="header-section-number">18.4</span> <code>r*()</code> set of functions</h2>
<p>These set of functions are used to generate <strong>r</strong>andom numbers from a Statistical distribution. So to generate <code>10</code> random numbers from Normal distribution with <code>mean = 50</code> and <code>sd = 10</code>, we can use <code>rnorm</code>.</p>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="#cb1117-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 33.10444 62.39496 48.91034 48.82758 51.83083 62.80555 32.72729 66.90184
##  [9] 55.03812 75.28337</code></pre>
<p>We can actually check this using histogram.</p>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="#cb1119-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb1119-2"><a href="#cb1119-2" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">50</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="dv">50</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/unnamed-chunk-346-1.png" alt="Histogram of Random numbers generated out of Normal distribution" width="75%" />
<p class="caption">
(#fig:unnamed-chunk-346)Histogram of Random numbers generated out of Normal distribution
</p>
</div>
<!--chapter:end:12-2stats.Rmd-->
</div>
</div>
<div id="random-sampling-in-r" class="section level1" number="19">
<h1><span class="header-section-number">19</span> Random sampling in R</h1>
<p>International Standard On Auditing - 530 defines<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a> audit sampling as <em>the application of audit procedures to less than 100% of items within a population of audit relevance such that all sampling units have a chance of selection in order to provide the auditor with a reasonable basis on which to draw conclusions about the entire population.</em> Statistical sampling is further defines as <em>an approach to sampling having two characteristics - random selection of samples, and the use of probability theory to evaluate sample results, including measurement of sampling risk.</em></p>
<p>Appendix 4 of ISA 53 further prescribes different statistical methods of sample selection. We will discuss here each type of sampling methodology used to sample records for audit.</p>
<p><strong>Prerequisites</strong></p>
<p>Load <code>tidyverse</code></p>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1120-1"><a href="#cb1120-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="simple-random-sampling-with-and-without-replacement" class="section level2" number="19.1">
<h2><span class="header-section-number">19.1</span> Simple Random Sampling (With and without replacement)</h2>
<p>In this method, records are selected completely at random, by generating random numbers e.g. using random number tables, etc. Refer figure @ref(fig:simple) for illustration. We can replicate the method of random number generation in R. Even the method of random number generation can be reproducible, by fixing the random number seed. Mainly two functions will be used here <code>sample()</code> and <code>set.seed()</code> already discussed in section @ref(prob). Since <code>sample()</code> function takes a vector as input and gives vector as output again, we can make use of <code>dplyr::slice_sample()</code> function, discussed in section @ref(prob), which operates on data frames instead.</p>
<div class="figure" style="text-align: center">
<img src="images/simple.png" alt="Illustration of Simple Random Sampling" width="99%" />
<p class="caption">
(#fig:simple)Illustration of Simple Random Sampling
</p>
</div>
<p>Let’s see this sampling on <code>iris</code> data. Suppose we have to select a sample of <code>n=12</code> records, without replacement-</p>
<pre><code>dat &lt;- iris # input data
# set the seed
set.seed(123)
# sample n records
dat %&gt;% 
  slice_sample(n = 12, replace = FALSE)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Sepal.Length</th>
<th align="right">Sepal.Width</th>
<th align="right">Petal.Length</th>
<th align="right">Petal.Width</th>
<th align="left">Species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4.3</td>
<td align="right">3.0</td>
<td align="right">1.1</td>
<td align="right">0.1</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">5.0</td>
<td align="right">3.3</td>
<td align="right">1.4</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">7.7</td>
<td align="right">3.8</td>
<td align="right">6.7</td>
<td align="right">2.2</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">4.4</td>
<td align="right">3.2</td>
<td align="right">1.3</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">5.9</td>
<td align="right">3.0</td>
<td align="right">5.1</td>
<td align="right">1.8</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.5</td>
<td align="right">3.0</td>
<td align="right">5.2</td>
<td align="right">2.0</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.5</td>
<td align="right">2.5</td>
<td align="right">4.0</td>
<td align="right">1.3</td>
<td align="left">versicolor</td>
</tr>
<tr class="even">
<td align="right">5.5</td>
<td align="right">2.6</td>
<td align="right">4.4</td>
<td align="right">1.2</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">5.8</td>
<td align="right">2.7</td>
<td align="right">5.1</td>
<td align="right">1.9</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.1</td>
<td align="right">3.0</td>
<td align="right">4.6</td>
<td align="right">1.4</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">6.3</td>
<td align="right">3.4</td>
<td align="right">5.6</td>
<td align="right">2.4</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">5.1</td>
<td align="right">2.5</td>
<td align="right">3.0</td>
<td align="right">1.1</td>
<td align="left">versicolor</td>
</tr>
</tbody>
</table>
<p>The syntax is simple. In the first step we have fixed the random number seed for reproducibility. Using <code>slice_sample()</code> we have selected <code>n=12</code> records without replacement (<code>replace = FALSE</code>).</p>
<blockquote>
<p>If sample size is based on some proportion, we have to use <code>prop = .10</code> (say 10%) instead of <code>n</code> argument. Moreover, if sampling is with replacement, we have to use <code>replace = TRUE</code>.</p>
</blockquote>
</div>
<div id="srs" class="section level2" number="19.2">
<h2><span class="header-section-number">19.2</span> Systematic random sampling</h2>
<p>ISA 530 defines this sampling approach as <em>‘Systematic selection, in which the number of sampling units in the population is divided by the sample size to give a sampling interval, for example 50, and having determined a starting point within the first 50, each 50th sampling unit thereafter is selected. Although the starting point may be determined haphazardly, the sample is more likely to be truly random if it is determined by use of a computerized random number generator or random number tables. When using systematic selection, the auditor would need to determine that sampling units within the population are not structured in such a way that the sampling interval corresponds with a particular pattern in the population.’</em> Refer figure @ref(fig:systematic) for illustration.</p>
<div class="figure" style="text-align: center">
<img src="images/systematic.png" alt="Illustration of Systematic Random Sampling" width="99%" />
<p class="caption">
(#fig:systematic)Illustration of Systematic Random Sampling
</p>
</div>
<p>We can replicate this approach again following two steps-</p>
<p><strong>Step-1:</strong> Select <code>n</code> as the sample size. Then generate a maximum starting point say <code>s</code> by dividing number of rows in the data by <code>n</code>. Thereafter we have to choose a starting point from <code>1:s</code>. We can use sample function here. Let’s say this starting number is <code>s1</code>. Then we have to generate an arithmetic sequence, say <code>rand_seq</code> starting from <code>s1</code> and increasing every <code>s</code> steps thereafter with total <code>n</code> terms.</p>
<p><strong>Step-2:</strong> In the next step we will shuffle the data by using <code>slice_sample</code> and select a sample using function <code>filter</code>.</p>
<p>The methodology is replicated as</p>
<pre><code>set.seed(123)
n &lt;- 15 # sample size
s &lt;- floor(nrow(dat)/n)
s1 &lt;- sample(1:s, 1, replace = FALSE)
rand_seq &lt;- seq(s1, by = s, length.out = n)
dat %&gt;% 
  slice_sample(prop = 1) %&gt;% 
  filter(row_number() %in% rand_seq)
  </code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Sepal.Length</th>
<th align="right">Sepal.Width</th>
<th align="right">Petal.Length</th>
<th align="right">Petal.Width</th>
<th align="left">Species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">7.7</td>
<td align="right">3.8</td>
<td align="right">6.7</td>
<td align="right">2.2</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.1</td>
<td align="right">2.8</td>
<td align="right">4.0</td>
<td align="right">1.3</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">7.6</td>
<td align="right">3.0</td>
<td align="right">6.6</td>
<td align="right">2.1</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">7.2</td>
<td align="right">3.2</td>
<td align="right">6.0</td>
<td align="right">1.8</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">7.2</td>
<td align="right">3.0</td>
<td align="right">5.8</td>
<td align="right">1.6</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.3</td>
<td align="right">2.7</td>
<td align="right">4.9</td>
<td align="right">1.8</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">4.8</td>
<td align="right">3.1</td>
<td align="right">1.6</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">6.4</td>
<td align="right">2.8</td>
<td align="right">5.6</td>
<td align="right">2.1</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.6</td>
<td align="right">3.0</td>
<td align="right">4.5</td>
<td align="right">1.5</td>
<td align="left">versicolor</td>
</tr>
<tr class="even">
<td align="right">4.9</td>
<td align="right">2.5</td>
<td align="right">4.5</td>
<td align="right">1.7</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.9</td>
<td align="right">3.2</td>
<td align="right">4.8</td>
<td align="right">1.8</td>
<td align="left">versicolor</td>
</tr>
<tr class="even">
<td align="right">6.3</td>
<td align="right">3.3</td>
<td align="right">6.0</td>
<td align="right">2.5</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.4</td>
<td align="right">3.7</td>
<td align="right">1.5</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">6.7</td>
<td align="right">3.1</td>
<td align="right">4.4</td>
<td align="right">1.4</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">5.2</td>
<td align="right">3.5</td>
<td align="right">1.5</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
</tbody>
</table>
</div>
<div id="probability-proportionate-to-size-with-or-without-replacement-a.k.a-monetary-unit-sampling" class="section level2" number="19.3">
<h2><span class="header-section-number">19.3</span> Probability Proportionate to size (with or without replacement) a.k.a monetary unit sampling</h2>
<p>This sampling approach is defined in ISA-530 as <em>“a type of value-weighted selection in which sample size, selection and evaluation results in a conclusion in monetary amounts.”</em></p>
<p>Our methodology is not much difference from methodology adopted in section @ref(srs) except that we will make use of <code>weight_by =</code> argument now.</p>
<p>Let’s use <code>state.x77</code> data that comes with base R. Since the data is in matrix format, let’s first convert it data frame using <code>as.data.frame()</code> first.</p>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="#cb1123-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(state.x77)</span></code></pre></div>
<p>Other steps are simple.</p>
<pre><code>set.seed(123)
dat %&gt;% 
  slice_sample(n=12, weight_by = Population)</code></pre>
<table>
<colgroup>
<col width="17%" />
<col width="13%" />
<col width="8%" />
<col width="13%" />
<col width="11%" />
<col width="8%" />
<col width="10%" />
<col width="7%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Population</th>
<th align="right">Income</th>
<th align="right">Illiteracy</th>
<th align="right">Life Exp</th>
<th align="right">Murder</th>
<th align="right">HS Grad</th>
<th align="right">Frost</th>
<th align="right">Area</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Pennsylvania</td>
<td align="right">11860</td>
<td align="right">4449</td>
<td align="right">1.0</td>
<td align="right">70.43</td>
<td align="right">6.1</td>
<td align="right">50.2</td>
<td align="right">126</td>
<td align="right">44966</td>
</tr>
<tr class="even">
<td align="left">Kentucky</td>
<td align="right">3387</td>
<td align="right">3712</td>
<td align="right">1.6</td>
<td align="right">70.10</td>
<td align="right">10.6</td>
<td align="right">38.5</td>
<td align="right">95</td>
<td align="right">39650</td>
</tr>
<tr class="odd">
<td align="left">Michigan</td>
<td align="right">9111</td>
<td align="right">4751</td>
<td align="right">0.9</td>
<td align="right">70.63</td>
<td align="right">11.1</td>
<td align="right">52.8</td>
<td align="right">125</td>
<td align="right">56817</td>
</tr>
<tr class="even">
<td align="left">Oregon</td>
<td align="right">2284</td>
<td align="right">4660</td>
<td align="right">0.6</td>
<td align="right">72.13</td>
<td align="right">4.2</td>
<td align="right">60.0</td>
<td align="right">44</td>
<td align="right">96184</td>
</tr>
<tr class="odd">
<td align="left">Utah</td>
<td align="right">1203</td>
<td align="right">4022</td>
<td align="right">0.6</td>
<td align="right">72.90</td>
<td align="right">4.5</td>
<td align="right">67.3</td>
<td align="right">137</td>
<td align="right">82096</td>
</tr>
<tr class="even">
<td align="left">California</td>
<td align="right">21198</td>
<td align="right">5114</td>
<td align="right">1.1</td>
<td align="right">71.71</td>
<td align="right">10.3</td>
<td align="right">62.6</td>
<td align="right">20</td>
<td align="right">156361</td>
</tr>
<tr class="odd">
<td align="left">Virginia</td>
<td align="right">4981</td>
<td align="right">4701</td>
<td align="right">1.4</td>
<td align="right">70.08</td>
<td align="right">9.5</td>
<td align="right">47.8</td>
<td align="right">85</td>
<td align="right">39780</td>
</tr>
<tr class="even">
<td align="left">Arizona</td>
<td align="right">2212</td>
<td align="right">4530</td>
<td align="right">1.8</td>
<td align="right">70.55</td>
<td align="right">7.8</td>
<td align="right">58.1</td>
<td align="right">15</td>
<td align="right">113417</td>
</tr>
<tr class="odd">
<td align="left">Georgia</td>
<td align="right">4931</td>
<td align="right">4091</td>
<td align="right">2.0</td>
<td align="right">68.54</td>
<td align="right">13.9</td>
<td align="right">40.6</td>
<td align="right">60</td>
<td align="right">58073</td>
</tr>
<tr class="even">
<td align="left">Massachusetts</td>
<td align="right">5814</td>
<td align="right">4755</td>
<td align="right">1.1</td>
<td align="right">71.83</td>
<td align="right">3.3</td>
<td align="right">58.5</td>
<td align="right">103</td>
<td align="right">7826</td>
</tr>
<tr class="odd">
<td align="left">Hawaii</td>
<td align="right">868</td>
<td align="right">4963</td>
<td align="right">1.9</td>
<td align="right">73.60</td>
<td align="right">6.2</td>
<td align="right">61.9</td>
<td align="right">0</td>
<td align="right">6425</td>
</tr>
<tr class="even">
<td align="left">New Jersey</td>
<td align="right">7333</td>
<td align="right">5237</td>
<td align="right">1.1</td>
<td align="right">70.93</td>
<td align="right">5.2</td>
<td align="right">52.5</td>
<td align="right">115</td>
<td align="right">7521</td>
</tr>
</tbody>
</table>
</div>
<div id="stratified-random-sampling" class="section level2" number="19.4">
<h2><span class="header-section-number">19.4</span> Stratified random sampling</h2>
<p>Stratification is defined in ISA-530 as <em>the process of dividing a population into sub-populations, each of which is a group of sampling units which have similar characteristics (often monetary value).</em> Thus, stratified random sampling may imply any of the afore-mentioned sampling techniques applied to individual strata instead of whole population. Refer figure @ref(fig:strata) for illustration.</p>
<div class="figure" style="text-align: center">
<img src="images/stratified.png" alt="Illustration of Stratified Random Sampling" width="99%" />
<p class="caption">
(#fig:strata)Illustration of Stratified Random Sampling
</p>
</div>
<p>The function <code>dplyr::group_by()</code> will be used here for stratification. Thereafter we can proceed for sampling described as above.</p>
<p>Example Data: - Let’s include region in <code>state.x77</code> data using <code>dplyr::bind_cols</code>.</p>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="#cb1125-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb1125-2"><a href="#cb1125-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(state.x77),</span>
<span id="cb1125-3"><a href="#cb1125-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(state.region)</span>
<span id="cb1125-4"><a href="#cb1125-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Let’s see first 6 rows of this data</p>
<table>
<colgroup>
<col width="12%" />
<col width="12%" />
<col width="7%" />
<col width="12%" />
<col width="10%" />
<col width="7%" />
<col width="8%" />
<col width="6%" />
<col width="7%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Population</th>
<th align="right">Income</th>
<th align="right">Illiteracy</th>
<th align="right">Life Exp</th>
<th align="right">Murder</th>
<th align="right">HS Grad</th>
<th align="right">Frost</th>
<th align="right">Area</th>
<th align="left">state.region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">3615</td>
<td align="right">3624</td>
<td align="right">2.1</td>
<td align="right">69.05</td>
<td align="right">15.1</td>
<td align="right">41.3</td>
<td align="right">20</td>
<td align="right">50708</td>
<td align="left">South</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="right">365</td>
<td align="right">6315</td>
<td align="right">1.5</td>
<td align="right">69.31</td>
<td align="right">11.3</td>
<td align="right">66.7</td>
<td align="right">152</td>
<td align="right">566432</td>
<td align="left">West</td>
</tr>
<tr class="odd">
<td align="left">Arizona</td>
<td align="right">2212</td>
<td align="right">4530</td>
<td align="right">1.8</td>
<td align="right">70.55</td>
<td align="right">7.8</td>
<td align="right">58.1</td>
<td align="right">15</td>
<td align="right">113417</td>
<td align="left">West</td>
</tr>
<tr class="even">
<td align="left">Arkansas</td>
<td align="right">2110</td>
<td align="right">3378</td>
<td align="right">1.9</td>
<td align="right">70.66</td>
<td align="right">10.1</td>
<td align="right">39.9</td>
<td align="right">65</td>
<td align="right">51945</td>
<td align="left">South</td>
</tr>
<tr class="odd">
<td align="left">California</td>
<td align="right">21198</td>
<td align="right">5114</td>
<td align="right">1.1</td>
<td align="right">71.71</td>
<td align="right">10.3</td>
<td align="right">62.6</td>
<td align="right">20</td>
<td align="right">156361</td>
<td align="left">West</td>
</tr>
<tr class="even">
<td align="left">Colorado</td>
<td align="right">2541</td>
<td align="right">4884</td>
<td align="right">0.7</td>
<td align="right">72.06</td>
<td align="right">6.8</td>
<td align="right">63.9</td>
<td align="right">166</td>
<td align="right">103766</td>
<td align="left">West</td>
</tr>
</tbody>
</table>
<p>We can check a summary of number of States per region</p>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1126-1"><a href="#cb1126-1" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb1126-2"><a href="#cb1126-2" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&#39;State&#39;</span>) <span class="sc">%&gt;%</span> <span class="co"># this step will not be </span></span>
<span id="cb1126-3"><a href="#cb1126-3" tabindex="-1"></a>                                  <span class="co"># used in databases without row names</span></span>
<span id="cb1126-4"><a href="#cb1126-4" tabindex="-1"></a>  <span class="fu">group_by</span>(state.region) <span class="sc">%&gt;%</span> </span>
<span id="cb1126-5"><a href="#cb1126-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">states =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   state.region  states
##   &lt;fct&gt;          &lt;int&gt;
## 1 Northeast          9
## 2 South             16
## 3 North Central     12
## 4 West              13</code></pre>
<p><strong>Case-1:</strong> When the sample size is constant for all strata. Say <code>2</code> records per region.</p>
<pre><code>set.seed(123)
n &lt;- 2
dat %&gt;% 
  tibble::rownames_to_column(&#39;State&#39;) %&gt;% # this step will not be used in databases without row names
  group_by(state.region) %&gt;% 
  slice_sample(n=n) %&gt;% 
  ungroup()</code></pre>
<table>
<colgroup>
<col width="15%" />
<col width="11%" />
<col width="7%" />
<col width="11%" />
<col width="9%" />
<col width="7%" />
<col width="8%" />
<col width="6%" />
<col width="6%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">State</th>
<th align="right">Population</th>
<th align="right">Income</th>
<th align="right">Illiteracy</th>
<th align="right">Life Exp</th>
<th align="right">Murder</th>
<th align="right">HS Grad</th>
<th align="right">Frost</th>
<th align="right">Area</th>
<th align="left">state.region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Massachusetts</td>
<td align="right">5814</td>
<td align="right">4755</td>
<td align="right">1.1</td>
<td align="right">71.83</td>
<td align="right">3.3</td>
<td align="right">58.5</td>
<td align="right">103</td>
<td align="right">7826</td>
<td align="left">Northeast</td>
</tr>
<tr class="even">
<td align="left">New York</td>
<td align="right">18076</td>
<td align="right">4903</td>
<td align="right">1.4</td>
<td align="right">70.55</td>
<td align="right">10.9</td>
<td align="right">52.7</td>
<td align="right">82</td>
<td align="right">47831</td>
<td align="left">Northeast</td>
</tr>
<tr class="odd">
<td align="left">Delaware</td>
<td align="right">579</td>
<td align="right">4809</td>
<td align="right">0.9</td>
<td align="right">70.06</td>
<td align="right">6.2</td>
<td align="right">54.6</td>
<td align="right">103</td>
<td align="right">1982</td>
<td align="left">South</td>
</tr>
<tr class="even">
<td align="left">North Carolina</td>
<td align="right">5441</td>
<td align="right">3875</td>
<td align="right">1.8</td>
<td align="right">69.21</td>
<td align="right">11.1</td>
<td align="right">38.5</td>
<td align="right">80</td>
<td align="right">48798</td>
<td align="left">South</td>
</tr>
<tr class="odd">
<td align="left">Indiana</td>
<td align="right">5313</td>
<td align="right">4458</td>
<td align="right">0.7</td>
<td align="right">70.88</td>
<td align="right">7.1</td>
<td align="right">52.9</td>
<td align="right">122</td>
<td align="right">36097</td>
<td align="left">North Central</td>
</tr>
<tr class="even">
<td align="left">Minnesota</td>
<td align="right">3921</td>
<td align="right">4675</td>
<td align="right">0.6</td>
<td align="right">72.96</td>
<td align="right">2.3</td>
<td align="right">57.6</td>
<td align="right">160</td>
<td align="right">79289</td>
<td align="left">North Central</td>
</tr>
<tr class="odd">
<td align="left">Utah</td>
<td align="right">1203</td>
<td align="right">4022</td>
<td align="right">0.6</td>
<td align="right">72.90</td>
<td align="right">4.5</td>
<td align="right">67.3</td>
<td align="right">137</td>
<td align="right">82096</td>
<td align="left">West</td>
</tr>
<tr class="even">
<td align="left">Hawaii</td>
<td align="right">868</td>
<td align="right">4963</td>
<td align="right">1.9</td>
<td align="right">73.60</td>
<td align="right">6.2</td>
<td align="right">61.9</td>
<td align="right">0</td>
<td align="right">6425</td>
<td align="left">West</td>
</tr>
</tbody>
</table>
<p><strong>Case-2:</strong> When the sample size or proportion is different among strata.
This time let us assume that column for <em>stratum</em> is not directly available in the data.<br />
- Say, 20% of States having Population upto <code>1000</code>;
- 30% of States having population greater than <code>1000</code> but upto <code>5000</code> and finally;
- 50% of states having population more than <code>5000</code> have to be sampled.</p>
<p>In this scenario, our strategy would be use <code>purrr::map2_dfr()</code> function after splitting the data with <code>group_split()</code> function.</p>
<p>Syntax would be</p>
<pre><code># define proportions
props &lt;- c(0.2, 0.3, 0.5)

# set seed
set.seed(123)

# take data
dat %&gt;% 
  # reduntant step where data has no column names
  tibble::rownames_to_column(&#39;State&#39;) %&gt;%
  # create column according to stratums
  mutate(stratum = cut(Population, c(0, 1000, 5000, max(Population)),
                      labels = c(&quot;Low&quot;, &quot;Mid&quot;, &quot;High&quot;))) %&gt;% 
  # split data into groups
  group_split(stratum) %&gt;% 
  # sample in each group
  map2_dfr(props,
           .f = function(d, w) slice_sample(d, prop = w))</code></pre>
<p>We may check the sample selected across each stratum</p>
<table>
<thead>
<tr class="header">
<th align="left">stratum</th>
<th align="right">Total</th>
<th align="right">Selected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Low</td>
<td align="right">12</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Mid</td>
<td align="right">26</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">High</td>
<td align="right">12</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
</div>
<div id="cluster-sampling" class="section level2" number="19.5">
<h2><span class="header-section-number">19.5</span> Cluster sampling</h2>
<p>ISA 530 does not explicitly define cluster sampling. Actually this sampling is sampling of strata and we can apply above mentioned techniques easily to sample clusters. E.g. in the sample data above, we can sample say, 2 clusters (or regions).</p>
<p>Thus, our strategy would be first to sample groups from unique available values and thereafter filter all the records.</p>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="#cb1130-1" tabindex="-1"></a><span class="co"># set the seed</span></span>
<span id="cb1130-2"><a href="#cb1130-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1130-3"><a href="#cb1130-3" tabindex="-1"></a><span class="co"># sample clusters</span></span>
<span id="cb1130-4"><a href="#cb1130-4" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">sample</span>(</span>
<span id="cb1130-5"><a href="#cb1130-5" tabindex="-1"></a>  <span class="fu">unique</span>(dat<span class="sc">$</span>state.region),</span>
<span id="cb1130-6"><a href="#cb1130-6" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb1130-7"><a href="#cb1130-7" tabindex="-1"></a>)</span>
<span id="cb1130-8"><a href="#cb1130-8" tabindex="-1"></a><span class="co"># filter all records in above clusters</span></span>
<span id="cb1130-9"><a href="#cb1130-9" tabindex="-1"></a>clust_samp <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb1130-10"><a href="#cb1130-10" tabindex="-1"></a>  <span class="fu">filter</span>(state.region <span class="sc">%in%</span> clusters)</span>
<span id="cb1130-11"><a href="#cb1130-11" tabindex="-1"></a><span class="co"># check number of records</span></span>
<span id="cb1130-12"><a href="#cb1130-12" tabindex="-1"></a>clust_samp<span class="sc">$</span>state.region <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## .
##     Northeast         South North Central          West 
##             9             0            12             0</code></pre>
<!--chapter:end:12-3Samp.Rmd-->
</div>
</div>
<div id="part-iv-machine-learning-in-r" class="section level1 unnumbered">
<h1 class="unnumbered">Part-IV: Machine Learning in R</h1>
</div>
<div id="linear-regression" class="section level1" number="20">
<h1><span class="header-section-number">20</span> Linear Regression</h1>
<p>Regression models are a class of statistical models that let us explore the relationship between a response variable and one or more explanatory variables. If such a relationship exists and is detected, we can make predictions about the value of the response variable given some explanatory variables. As an example, if a relationship between number of employees in an office and its monthly expenses on salary is established, we can predict the monthly expenses incurred by that office on salary if we know the number of employees. That lets us do thought of experiments like asking how much the a new company had to pay say 10 employees on salary expenses monthly.</p>
<p>Explanatory variables are sometimes also referred to as <em>regressors</em> or <em>independent</em> or <em>predictor</em> variables whereas response variable is also called as <em>dependent</em> or <em>outcome</em> variable. When the response variable is numeric and the relationship is linear, the regression is called as linear regression. Of course, there are certain other assumptions, which we will discuss later on in the chapter.</p>
<div id="basic-concepts" class="section level2" number="20.1">
<h2><span class="header-section-number">20.1</span> Basic concepts</h2>
<p>Before we start creating regression models, it’s always a good practice to visualize the data. It will help us ascertaining the nature of relationship between the predictors and response variable, if any. To visualize the relationship between two numeric variables, we can use a scatter plot. See the two examples in figure @ref(fig:concept). In the first example (plot) we can see a near perfect linear relationship between GNP and Population of the countries, whereas a moderate but negative relationship between two variables is seen in second example.</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/concept-1.png" alt="Linear Regression - Intuition" width="47%" height="45%" /><img src="DauR_files/figure-html/concept-2.png" alt="Linear Regression - Intuition" width="47%" height="45%" />
<p class="caption">
(#fig:concept)Linear Regression - Intuition
</p>
</div>
<p>Linear regression is a perfect model to predict outcome or response variable when it has linear relationship with explanatory variables. In that case our predicted values will lie on the assumed line (in linear relationship) ideally. Maths behind estimating or predicting outcomes is thus, finding the following algebraic equation @ref(eq:lr1).</p>
<p><span class="math display">\[\begin{equation}
y = mx + c
(\#eq:lr1)
\end{equation}\]</span></p>
<p>Where -</p>
<ul>
<li><code>m</code> is the slope of the line (in linear relationship)</li>
<li><code>c</code> is the intercept of Y-axis. (value of <span class="math inline">\(y\)</span> when <span class="math inline">\(x\)</span> is <code>0</code> )</li>
</ul>
<p>Interpreting this equation in real world is like estimating the coefficients i.e. both <span class="math inline">\(m\)</span> and <span class="math inline">\(c\)</span> in above equation. The goal of our exercise will thus be to estimate the best values of <span class="math inline">\(m\)</span> and <span class="math inline">\(c\)</span>. These two parameters, <span class="math inline">\(m\)</span> and <span class="math inline">\(c\)</span> are sometimes also referred to as <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_0\)</span> respectively. Those familiar with mathematics behind fitting the equation of a line (in two dimensional space), may know that we require only two variables (data points i.e. <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> value pairs) values to find these parameters. So it means, that if we have a fair amount of data points available (which will in rarest of circumstances be collinear i.e. lying on one same line), we can actually get many such regression lines. Our goal is thus, to find best of these lines. But, how?</p>
<p>To answer this question, let us also understand that the values of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> pairs in actual practice, don’t lie on the regression line because these points will rarely be collinear (See plots in Figure @ref(fig:concept) and note that none of the data point actually lie on the line). So for each data point of response variable, there is an actual value and one fitted value (the one falling on the regression line). The difference between these values is called <em>error term</em> or <em>residual</em>. Technically these are not errors but random noise that the model is not able to explain. Mathematically, if <span class="math inline">\(\hat{y}\)</span> is fitted value, <span class="math inline">\(y\)</span> is actual value, the difference also called error (of prediction) term say <span class="math inline">\(\epsilon\)</span> can be denoted as -</p>
<p><span class="math display">\[\begin{equation}
\epsilon = y - \hat{y}
(\#eq:lr2)
\end{equation}\]</span></p>
<p>OR, we can say that</p>
<p><span class="math display">\[\begin{equation}
y = \beta_0 + \beta_1x + \epsilon
(\#eq:lr3)
\end{equation}\]</span></p>
<p>Now, one method to find best fit regression line is to minimize the error terms. Theoretically, it means to capture pattern/relationship between data points as much as possible so that what’s left behind is true random noise. One way could be to minimise the mean of these error terms. But these error terms can be both positive or negative. See figure @ref(fig:errors). So to ensure that these are not cancelled out while taking mean, we can minimise either the mean of their absolute values or their squares. Most commonly accepted method is to take mean of squares and minimise it. One of the benefit of adopting it over another, is that while squaring errors or residuals, large residuals get higher weight than lower residuals. That’s why this linear regression technique is also sometimes referred to as <strong>Ordinary Least Squares</strong> or <strong>OLS</strong> regression.</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/errors-1.png" alt="Residuals - Intuition and Concept" width="672" height="35%" />
<p class="caption">
(#fig:errors)Residuals - Intuition and Concept
</p>
</div>
</div>
<div id="simple-linear-regression-in-r" class="section level2" number="20.2">
<h2><span class="header-section-number">20.2</span> Simple Linear Regression in R</h2>
<p>Don’t worry, in R we do not have to do this minimisation job ourselves. In fact, base R has a fantastic function <code>lm</code> which can fit a best regression line, for a given set of variables, for us. The syntax is simple.</p>
<pre><code>lm(formula, data, ...)</code></pre>
<p>where -</p>
<ul>
<li><code>formula</code> an object of class “formula” (or one that can be coerced to that class): a symbolic description of the model to be fitted. For our example above, we can write <code>y ~ x</code></li>
<li><code>data</code> an optional data frame.</li>
</ul>
<p>It actually returns a special object, which can be printed directly like other R objects. However, it is best printed with the <code>summary</code> function. Firstly we will see an example of simple linear regression which is a linear regression with only one independent variable.</p>
<p>Example-1: <strong>Problem Statement:</strong> <code>iris</code> which is a famous (Fisher’s or Anderson’s) data set, loaded by default in R, gives the measurements in centimeters of the variables sepal length (<code>Sepal.Length</code>) and width (<code>Sepal.Width</code>) and petal length (<code>Petal.Length</code>) and width (<code>Petal.Width</code>), respectively, for 50 flowers from each of 3 species (<code>Species</code>) of iris. The species are Iris <code>setosa</code>, <code>versicolor</code>, and <code>virginica</code>. Let us try to establish a relationship between <code>Sepal.Length</code> and <code>Sepal.Width</code> variables of <code>setosa</code> Species i.e. iris` data-set, (first 50 records only).</p>
<p>As already stated above, it is always a good practice to visualize the data, if possible. So let’s make a scatter-plot, as seen in Figure @ref(fig:ex1plot).</p>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="#cb1133-1" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> </span>
<span id="cb1133-2"><a href="#cb1133-2" tabindex="-1"></a>  <span class="co"># Extract First 50 records</span></span>
<span id="cb1133-3"><a href="#cb1133-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1133-4"><a href="#cb1133-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, Sepal.Width)) <span class="sc">+</span></span>
<span id="cb1133-5"><a href="#cb1133-5" tabindex="-1"></a>  <span class="co"># Scatter plot</span></span>
<span id="cb1133-6"><a href="#cb1133-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1133-7"><a href="#cb1133-7" tabindex="-1"></a>  <span class="co"># adding a trend line without error bands</span></span>
<span id="cb1133-8"><a href="#cb1133-8" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">formula =</span> <span class="st">&quot;y~x&quot;</span>) <span class="sc">+</span></span>
<span id="cb1133-9"><a href="#cb1133-9" tabindex="-1"></a>  <span class="co"># Theme Black and White</span></span>
<span id="cb1133-10"><a href="#cb1133-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/ex1plot-1.png" alt="Relationship between sepal widths and lengths in setosa species" width="672" height="30%" />
<p class="caption">
(#fig:ex1plot)Relationship between sepal widths and lengths in setosa species
</p>
</div>
<p>The relationship seem fairly linear (Figure @ref(fig:ex1plot)), so let’s build the model.</p>
<div class="sourceCode" id="cb1134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1134-1"><a href="#cb1134-1" tabindex="-1"></a>lin_reg1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> Sepal.Width <span class="sc">~</span> Sepal.Length, <span class="at">data =</span> iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,])</span>
<span id="cb1134-2"><a href="#cb1134-2" tabindex="-1"></a></span>
<span id="cb1134-3"><a href="#cb1134-3" tabindex="-1"></a><span class="co"># Let us print the object directly</span></span>
<span id="cb1134-4"><a href="#cb1134-4" tabindex="-1"></a>lin_reg1</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sepal.Width ~ Sepal.Length, data = iris[1:50, ])
## 
## Coefficients:
##  (Intercept)  Sepal.Length  
##      -0.5694        0.7985</code></pre>
<div class="sourceCode" id="cb1136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1136-1"><a href="#cb1136-1" tabindex="-1"></a><span class="co"># Try printing it with summary()</span></span>
<span id="cb1136-2"><a href="#cb1136-2" tabindex="-1"></a><span class="fu">summary</span>(lin_reg1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sepal.Width ~ Sepal.Length, data = iris[1:50, ])
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.72394 -0.18273 -0.00306  0.15738  0.51709 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -0.5694     0.5217  -1.091    0.281    
## Sepal.Length   0.7985     0.1040   7.681 6.71e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2565 on 48 degrees of freedom
## Multiple R-squared:  0.5514, Adjusted R-squared:  0.542 
## F-statistic: 58.99 on 1 and 48 DF,  p-value: 6.71e-10</code></pre>
<p>Observing the outputs above, we can notice that simply printing the object returns coefficients whereas printing with <code>summary</code> gives us a lot of other information. But how to interpret this information? Before proceeding to interpret the output, let us understand a few more concepts which are essential here. These concepts are basically some assumptions, which we have made while finding the best fit line or in other words estimating the parameters statistically.</p>
</div>
<div id="assumptions-of-linear-regression" class="section level2" number="20.3">
<h2><span class="header-section-number">20.3</span> Assumptions of Linear Regression</h2>
<p>Linear regression makes several assumptions about the data, such as :</p>
<ul>
<li><em>Linearity of the data</em>. The relationship between the predictor (<span class="math inline">\(x\)</span>) and the outcome (<span class="math inline">\(y\)</span>) is assumed to be linear. Obviously, the relationship should be linear. If we would try to fit non-linear relationship through linear regression our results wouldn’t be correct. Also when we use multiple predictors, as we will see shortly, we make another assumption that the model is additive in nature besides being linear. Refer figure @ref(fig:linearity). It is clear that if we try to establish a linear relationship (red line) when it is actually cubic (green dashed line) our model will give erroneous results.</li>
</ul>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/linearity-1.png" alt="Is the relationship linear?" width="50%" />
<p class="caption">
(#fig:linearity)Is the relationship linear?
</p>
</div>
<ul>
<li><p><em>Normality of residuals</em>. The residuals are assumed to be normally distributed. Actually, this assumption is followed by the assumption that our dependent variable is normally distributed and not concentrated anywhere. Thus, if dependent variable is normally distributed, and if we have been able to capture the relationship available, then what has been left must be true noise and it should be normally distributed with a mean of <span class="math inline">\(0\)</span>.</p></li>
<li><p><em>Homogeneity of residuals variance</em>. The residuals are assumed to have a constant variance, statistically known as homoscedasticity. It shows that residuals that are left out of regression model are true noise and not related to fitted values, which in that case would have meant that the model was insufficient to capture the actual relationship. Heteroscedasticity (the violation of homoskedasticity) is present when the size of the error term differs across values of an independent variable. This can be best understood by plots in Figures @ref(fig:homod) where residuals in left plot indicate equal variance and thus homoskedasticity whereas in the right plot heteroskedasticity is indicated clearly.</p></li>
</ul>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/homod-1.png" alt="Homoskedasticity (left) Vs. Heteroskedasticity (right)
Sample data created by author for demonstration only" width="47%" /><img src="DauR_files/figure-html/homod-2.png" alt="Homoskedasticity (left) Vs. Heteroskedasticity (right)
Sample data created by author for demonstration only" width="47%" />
<p class="caption">
(#fig:homod)Homoskedasticity (left) Vs. Heteroskedasticity (right)
Sample data created by author for demonstration only
</p>
</div>
<ul>
<li><em>Independence</em> of residuals error terms. This assumption is also followed by original assumption that our dependent variable is independent in itself and any <span class="math inline">\(y\)</span> value is not dependent upon another set of <span class="math inline">\(y\)</span> values. In our example, we can understand it like that Sepal width of one sample is not affecting width of another.</li>
</ul>
</div>
<div id="interpreting-the-output-of-lm" class="section level2" number="20.4">
<h2><span class="header-section-number">20.4</span> Interpreting the output of <code>lm</code></h2>
<p>Let us discuss each of the component or section of <code>lm</code> output, hereinafter referred to as model.</p>
<div id="call" class="section level3" number="20.4.1">
<h3><span class="header-section-number">20.4.1</span> <code>call</code></h3>
<p>The <code>call</code> section shows us the formula that we have used to fit the regression model. So <code>Sepal.Width</code> is our dependent or response variable, <code>Sepal.Length</code> is predictor or independent variable. These variables refer to our data-set which is, first 50 rows of <code>iris</code> or <code>iris[1:50,]</code>.</p>
</div>
<div id="residuals" class="section level3" number="20.4.2">
<h3><span class="header-section-number">20.4.2</span> <code>Residuals</code></h3>
<p>This depicts the quantile or five point summary of error terms or the residuals, which also as discussed, are the difference between the actual values and the predicted values. We can generate these same values by taking the actual values of <span class="math inline">\(y\)</span> variable and subtracting these from its predicted values of the model.</p>
<div class="sourceCode" id="cb1138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1138-1"><a href="#cb1138-1" tabindex="-1"></a><span class="fu">summary</span>(iris<span class="sc">$</span>Sepal.Width[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>] <span class="sc">-</span> lin_reg1<span class="sc">$</span>fitted.values)</span></code></pre></div>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## -0.723945 -0.182730 -0.003062  0.000000  0.157380  0.517085</code></pre>
<p>Ideally, the median of error values/residuals should be centered around <code>0</code> thus telling us that these are somewhat symmetrical and our model is predicting fairly at both positive/higher and negative/lower side. Any skewness will thus show that errors are not normally distributed and our model may be biased towards that side.</p>
In our example, we can observe a slight left-skewed distribution of error terms which indicates that our model is not doing that well for higher sepal lengths as it is doing for lower ones. This can also be seen in Figure @ref(fig:ex1hist) i.e. histogram of residuals.
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/ex1hist-1.png" alt="Histogram of Resuduals" width="672" />
<p class="caption">
(#fig:ex1hist)Histogram of Resuduals
</p>
</div>
</div>
<div id="coefficients" class="section level3" number="20.4.3">
<h3><span class="header-section-number">20.4.3</span> <code>Coefficients</code></h3>
<p>Remember that these were our goals of the exercise. Here coefficients will be written as coefficient for that predictor and an intercept term, i.e. our <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_0\)</span> respectively. We can easily interpret that positive coefficients means positive relation and negative coefficient means value of outcome variable will decrease as corresponding independent variable increase. So, in our example, we can deduce that -</p>
<ul>
<li>for <code>0</code> sepal length, the sepal width will be <code>-0.5694</code> (Though mathematically only as physically having <code>0</code> and negative width and lengths are not possible).</li>
<li>for every unit i.e. <code>1</code> i.e. unit increase in sepal length, width increases by <code>0.7985</code></li>
</ul>
<p>Thus our regression line equation is -</p>
<p><span class="math display">\[\begin{equation}
Sepal.Width = -0.5694 + 0.7985 * Sepal.Length
(\#eq:lr4)
\end{equation}\]</span></p>
<p><strong>Now one thing to note here that, since we are adopting OLS approach to find out the (estimated) equation of best line, the coefficients we have arrived at, are only the estimated values of mean of these coefficients. Actually, we started (behind the scenes) with a null hypothesis that there is no linear relationship or, in other words, that the coefficients are zero. Alternate hypothesis, in this case, as you may have guessed by now, was that these coefficients are not zero. The coefficients may follow a statistical/ probabilistic distribution and thus, we may infer only its estimated (mean) value.</strong></p>
<p><strong>We can see the confidence intervals of each of the coefficient using function <code>confint</code>. By default, the 95% confidence intervals may be generated. See the following.</strong></p>
<div class="sourceCode" id="cb1140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1140-1"><a href="#cb1140-1" tabindex="-1"></a><span class="fu">confint</span>(lin_reg1)</span></code></pre></div>
<pre><code>##                   2.5 %    97.5 %
## (Intercept)  -1.6184048 0.4795395
## Sepal.Length  0.5894925 1.0075641</code></pre>
<p>Now, these estimated distribution must also have some standard error, a probability statistic and a p-value.</p>
<ul>
<li>The <em>standard error</em> of the coefficient is an estimate of the standard deviation of the coefficient. It tells us how much uncertainty there is with our coefficient. We can build confidence intervals of coefficients using this statistic, as shown above.</li>
<li>The t-statistic is simply the estimated coefficient divided by the standard error. By now you may have understood that we are applying student’s t-distribution while estimating the parameters.</li>
<li>Finally <code>p value</code> i.e. <strong>Pr(&gt;|t|)</strong> gives us the probability value and tells us how significant is our coefficient value.</li>
</ul>
</div>
<div id="signif.-codes" class="section level3" number="20.4.4">
<h3><span class="header-section-number">20.4.4</span> <code>Signif. codes</code></h3>
<p>These are nothing but code legends which are simply telling us how significant out p-value may be for each case. Notice three asterisks in from of coefficient estimate of <code>Sepal.Length</code> which indicate that coefficient is extremely significant and we can reject null hypothesis that <span class="math inline">\(\beta_1\)</span> is <span class="math inline">\(0\)</span>.</p>
<p>These codes give us a quick way to visually see which coefficients are significant to the model.</p>
</div>
<div id="residual-standard-error" class="section level3" number="20.4.5">
<h3><span class="header-section-number">20.4.5</span> <code>Residual standard error</code></h3>
<p>The residual standard error is a measure, and one of the metrics, telling us how well the model fits the data. This is actually the standard deviation of all error terms with the difference that instead of taking <code>n</code> terms we are taking <code>degrees of freedom</code>.</p>
<p><span class="math display">\[\begin{equation}
RSE = \sqrt{\frac{1}{(n-2)} \sum_{i=1}^n (y_i - \hat{y_i})^2}
(\#eq:lr5)
\end{equation}\]</span></p>
<p>Obviously <span class="math inline">\(df\)</span> is <span class="math inline">\(n-2\)</span>, as there is one regressor and one intercept. We can verify equation @ref(eq:lr5) by calculation.</p>
<div class="sourceCode" id="cb1142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1142-1"><a href="#cb1142-1" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">sum</span>((iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="st">&quot;Sepal.Width&quot;</span>] <span class="sc">-</span> lin_reg1<span class="sc">$</span>fitted.values)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">48</span>)</span></code></pre></div>
<pre><code>## [1] 0.2565263</code></pre>
</div>
<div id="r-squared-both-multiple-and-adjusted" class="section level3" number="20.4.6">
<h3><span class="header-section-number">20.4.6</span> <code>R-Squared</code> both Multiple and Adjusted</h3>
<p><em>Multiple R-Squared</em> is also called the coefficient of determination. Often this is the most cited measurement of how well the model is fitting to the data. It tells us what percentage of the variation within our dependent variable that the independent variable is explaining through the model. By looking at output we can say that about 55% of variation is explained through the model. We will discuss it in detail, in the next section.</p>
<p><em>Adjusted R squared</em> on the other hand, shows us what percentage of the variation within our dependent variable that all predictors are explaining. Thus, it is helpful when there are multiple regressors i.e. in Multiple Linear Regression. The difference between these two metrics might be subtle where we adjust for the variance attributed by adding multiple variables.</p>
</div>
<div id="f-statistic-and-p-value" class="section level3" number="20.4.7">
<h3><span class="header-section-number">20.4.7</span> <code>F-Statistic</code> and <code>p-value</code></h3>
<p>So why a p-value again? Is there a hypothesis again? Yes, When running a regression model, a hypothesis test is being run on the global model, that there is no relationship between the dependent variable and the independent variable(s). The alternative hypothesis is that there is a relationship. In other words, alternate hypothesis means at least one coefficient of regression is non-zero. This hypothesis is tested on F-statistic and hence the two values. <code>p-value</code> in our example is very small which lead us to reject the null hypothesis and conclude that there is strong evidence that a relationship does exist between <code>Sepal.Length</code> and <code>Sepal.Width</code>.</p>
<p>The reason for this test is based on the fact that if we run multiple hypothesis tests on our coefficients, it is likely that a variable is included which isn’t actually significant.</p>
</div>
</div>
<div id="model-evaluation-metrics" class="section level2" number="20.5">
<h2><span class="header-section-number">20.5</span> Model Evaluation Metrics</h2>
<p>To evaluate the model’s performance and accuracy, evaluation metrics are needed. There are several types of metrics which are used to evaluate the performance of model we have built. We will discuss a few of them here -</p>
<div id="mae---mean-absolute-error" class="section level3" number="20.5.1">
<h3><span class="header-section-number">20.5.1</span> MAE - Mean Absolute Error</h3>
<p>As the name suggests it is mean of absolute values of errors or residuals. The formula thus, can be written as equation @ref(eq:lr6).</p>
<p><span class="math display">\[\begin{equation}
{MAE} = \frac{1}{N}\sum_{i = 1}^{N}{\lvert}{y_i - \hat{y_i}}{\rvert}
(\#eq:lr6)
\end{equation}\]</span></p>
<p>Clearly, it is average value of residuals and a larger value denotes lesser accurate model. In isolation, the MAE is not very useful, however, to compare performance of several models while fitting a best regression model, obviously we can use this metric to choose a better model.</p>
<p>Moreover, once we extract <code>$residuals</code> out of the model, calculating the metric is easy. In our example-</p>
<div class="sourceCode" id="cb1144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1144-1"><a href="#cb1144-1" tabindex="-1"></a><span class="co"># Mean Absolute Error</span></span>
<span id="cb1144-2"><a href="#cb1144-2" tabindex="-1"></a>lin_reg1<span class="sc">$</span>residuals <span class="sc">|&gt;</span> <span class="fu">abs</span>() <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] 0.199243</code></pre>
</div>
<div id="mse---mean-square-error-and-rmse---root-mean-square-error" class="section level3" number="20.5.2">
<h3><span class="header-section-number">20.5.2</span> MSE - Mean Square Error and RMSE - Root Mean Square Error</h3>
<p>Again as the name suggests, the mean of square of all residuals is mean square error or MSE. The formula may be written as in equation @ref(eq:lr7).</p>
<p><span class="math display">\[\begin{equation}
{MSE} = \frac{1}{N}\sum_{i = 1}^{N}({y_i - \hat{y_i}})^2
(\#eq:lr7)
\end{equation}\]</span></p>
<p>MSE penalizes the higher residuals by squaring them. It may be thus thought as weighted average where more and more weight is allocated as the residual value rises. Similar, to MAE, we can use this metric to choose a better model out of the several validating models.</p>
<p>Interestingly, by definition it is also cost function in regression, as while finding parameters, we are actually minimising MSE only. Similar to MAE, calculating this require no special skills.</p>
<div class="sourceCode" id="cb1146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1146-1"><a href="#cb1146-1" tabindex="-1"></a><span class="co"># Mean Square Error</span></span>
<span id="cb1146-2"><a href="#cb1146-2" tabindex="-1"></a>lin_reg1<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span> <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] 0.0631735</code></pre>
<p>RMSE or root mean square error is square root of MSE.</p>
<p><span class="math display">\[\begin{equation}
{RMSE} = \sqrt{\frac{1}{N}\sum_{i = 1}^{N}({y_i - \hat{y_i}})^2}
(\#eq:lr8)
\end{equation}\]</span></p>
<p>In our Example-</p>
<div class="sourceCode" id="cb1148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1148-1"><a href="#cb1148-1" tabindex="-1"></a><span class="co"># Root Mean Square Error</span></span>
<span id="cb1148-2"><a href="#cb1148-2" tabindex="-1"></a>lin_reg1<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span> <span class="sc">|&gt;</span> <span class="fu">mean</span>() <span class="sc">|&gt;</span> <span class="fu">sqrt</span>()</span></code></pre></div>
<pre><code>## [1] 0.2513434</code></pre>
</div>
<div id="mape---mean-absolute-percentage-error" class="section level3" number="20.5.3">
<h3><span class="header-section-number">20.5.3</span> MAPE - Mean Absolute Percentage Error</h3>
<p>This metric instead of taking residual value in isolation, takes residual value as percentage of actual values. The formula is thus,</p>
<p><span class="math display">\[\begin{equation}
{MAPE} = \frac{1}{N}\sum_{i = 1}^{N}{\lvert}\frac{({y_i - \hat{y_i}})}{y_i}\cdot{100}\%{\rvert}
(\#eq:lr9)
\end{equation}\]</span></p>
<p>Clearly, MAPE is independent of the scale of the variables since its error estimates are in terms of percentage. In our example, we can calculate MAPE-</p>
<div class="sourceCode" id="cb1150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1150-1"><a href="#cb1150-1" tabindex="-1"></a><span class="co"># Mean Absolute Percentage Error</span></span>
<span id="cb1150-2"><a href="#cb1150-2" tabindex="-1"></a>{lin_reg1<span class="sc">$</span>residuals<span class="sc">/</span>iris<span class="sc">$</span>Sepal.Width[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>]} <span class="sc">%&gt;%</span> </span>
<span id="cb1150-3"><a href="#cb1150-3" tabindex="-1"></a>  {<span class="fu">abs</span>(.)<span class="sc">*</span><span class="dv">100</span>} <span class="sc">%&gt;%</span> </span>
<span id="cb1150-4"><a href="#cb1150-4" tabindex="-1"></a>  <span class="fu">mean</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb1150-5"><a href="#cb1150-5" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">&quot;MAPE is %1.2f%%&quot;</span>, .)</span></code></pre></div>
<pre><code>## [1] &quot;MAPE is 5.95%&quot;</code></pre>
</div>
<div id="r---squared-and-adjusted-r-squared" class="section level3" number="20.5.4">
<h3><span class="header-section-number">20.5.4</span> R - Squared and adjusted R-squared</h3>
<p>As already discussed, it is coefficient of determination or goodness of fit of regression. The can be written as equation @ref(eq:lr10).</p>
<p><span class="math display">\[\begin{equation}
R^2 = 1 - \frac{\sum_{i=1}^{N}(y_i - \hat{y_i})^2}{\sum_{i=1}^{N}(y_i - \bar{y_i})^2}
(\#eq:lr10)
\end{equation}\]</span></p>
<p>The numerator in the fraction above, is also called as <span class="math inline">\(SSE\)</span> or Sum of Squares of Errors; and denominator is also called as <span class="math inline">\(TSS\)</span> or Total Sum of Squares. Actually the ratio (or fraction in above formula) i.e. <span class="math inline">\(\frac{SSE}{TSS}\)</span> denotes ratio of variance in errors to the variance (about mean) in the actual values. Thus <span class="math inline">\(R^2\)</span> actually denotes how much variance is explained by the model; and clearly as the variance errors or <span class="math inline">\(SSE\)</span> minimises and approaches <span class="math inline">\(0\)</span>, <span class="math inline">\(R^2\)</span> increases and approaches <span class="math inline">\(1\)</span> i.e. a perfect model.</p>
<p>We can easily verify the formula from the results obtained.</p>
<div class="sourceCode" id="cb1152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1152-1"><a href="#cb1152-1" tabindex="-1"></a><span class="do">## Sum of Squares of Errors</span></span>
<span id="cb1152-2"><a href="#cb1152-2" tabindex="-1"></a>y_bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="st">&quot;Sepal.Width&quot;</span>])</span>
<span id="cb1152-3"><a href="#cb1152-3" tabindex="-1"></a>(SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>(lin_reg1<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 3.158675</code></pre>
<div class="sourceCode" id="cb1154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1154-1"><a href="#cb1154-1" tabindex="-1"></a>(TSS <span class="ot">&lt;-</span> <span class="fu">sum</span>((iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,<span class="st">&quot;Sepal.Width&quot;</span>] <span class="sc">-</span> y_bar)<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 7.0408</code></pre>
<div class="sourceCode" id="cb1156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1156-1"><a href="#cb1156-1" tabindex="-1"></a>(r_sq <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> SSE<span class="sc">/</span>TSS)</span></code></pre></div>
<pre><code>## [1] 0.5513756</code></pre>
<p>Now, we can think of this <span class="math inline">\(R^2\)</span> in one more way, as it is simply the square of the correlation between the actual and predicted values. We can verify once again</p>
<div class="sourceCode" id="cb1158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1158-1"><a href="#cb1158-1" tabindex="-1"></a>(<span class="fu">cor</span>(iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="st">&#39;Sepal.Width&#39;</span>], lin_reg1<span class="sc">$</span>fitted.values))<span class="sc">^</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 0.5513756</code></pre>
<p>Usually, when we keep on adding independent variables to our regression model <span class="math inline">\(R^2\)</span> increases and it can easily incorporate over-fitting in itself. For this reason, sometimes adjusted r squared is used, which penalizes R squared for the number of predictors used in the model.</p>
<p><span class="math display">\[\begin{equation}
{Adjusted}\;{ R^2} = 1 - \frac{(1-R^2)(N - 1)}{(N - p - 1)}
(\#eq:lr11)
\end{equation}\]</span></p>
<p>where <span class="math inline">\(p\)</span> is the number of predictors included in model. The <code>summary</code> function returns both these metrics. We can verify the calculation-</p>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1160-1"><a href="#cb1160-1" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> ((<span class="dv">1</span><span class="sc">-</span>r_sq)<span class="sc">*</span>(<span class="dv">50-1</span>)<span class="sc">/</span>(<span class="dv">50-1-1</span>))</span></code></pre></div>
<pre><code>## [1] 0.5420292</code></pre>
</div>
</div>
<div id="plotting-the-results-and-their-interpretion" class="section level2" number="20.6">
<h2><span class="header-section-number">20.6</span> Plotting the results and their interpretion</h2>
<p>The output of <code>lm</code> can be plotted with <code>plot</code> command to see six diagnostics plots, one by one, which can be chosen using <code>which</code> argument. These six plots are -</p>
<ul>
<li>Residuals Vs. Fitted Values</li>
<li>Normal Q-Q</li>
<li>Scale-Location</li>
<li>Cook’s distance</li>
<li>Residuals vs. leverage</li>
<li>Cook’s distance vs. leverage</li>
</ul>
<p>Let us see these, for the example above.</p>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1162-1"><a href="#cb1162-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb1162-2"><a href="#cb1162-2" tabindex="-1"></a><span class="fu">plot</span>(lin_reg1, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">sub.caption =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/plots1-1.png" alt="First two diagnostic plots" width="672" height="40%" />
<p class="caption">
(#fig:plots1)First two diagnostic plots
</p>
</div>
<ol style="list-style-type: decimal">
<li><strong>Residuals Vs. Fitted Values</strong>: This plot is used to determine if the residuals exhibit non-linear patterns. If the red line across the center of the plot is roughly horizontal then we can assume that the residuals follow a linear pattern. In our example we can see that the red line deviates from a perfect horizontal line but not severely. We would likely declare that the residuals follow a roughly linear pattern and that a linear regression model is appropriate for this data-set. This plot is useful to check first assumption of linear regression i.e. linearity of the data.</li>
<li><strong>Normal Q-Q</strong>: This plot is used to determine if the residuals of the regression model are normally distributed, which was our another assumption. If the points in this plot fall roughly along a straight diagonal line, then we can assume the residuals are normally distributed.</li>
</ol>
<p>Moreover, notice that the extreme outlier values impacting our modelling will be labeled. We can see that values from rows, 23, 33 and 42 are labeled.</p>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1163-1"><a href="#cb1163-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb1163-2"><a href="#cb1163-2" tabindex="-1"></a><span class="fu">plot</span>(lin_reg1, <span class="at">which =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">sub.caption =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/plots2-1.png" alt="Next two diagnostic plots" width="672" height="40%" />
<p class="caption">
(#fig:plots2)Next two diagnostic plots
</p>
</div>
<ol start="3" style="list-style-type: decimal">
<li><strong>Scale-Location</strong>: This plot is used to check the assumption of equal variance, i.e. “homoskedasticity” among the residuals in our regression model. If the red line is roughly horizontal across the plot, then the assumption of equal variance is likely met.</li>
<li><strong>Cook’s Distance</strong>: An influential value is a value, which inclusion or exclusion can alter the results of the regression analysis. Such a value is associated with a large residual. Not all outliers (or extreme data points) are influential in linear regression analysis. A metric called Cook’s distance, is used to determine the influence of a value. This metric defines influence as a combination of leverage and residual size.</li>
</ol>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1164-1"><a href="#cb1164-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb1164-2"><a href="#cb1164-2" tabindex="-1"></a><span class="fu">plot</span>(lin_reg1, <span class="at">which =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">sub.caption =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/plots3-1.png" alt="Last two diagnostic plots" width="672" height="40%" />
<p class="caption">
(#fig:plots3)Last two diagnostic plots
</p>
</div>
<ol start="5" style="list-style-type: decimal">
<li><strong>Residuals vs. leverage</strong>: This plot is used to identify influential observations. If any points in this plot fall outside of Cook’s distance (the dashed lines) then it is an influential observation. Actually, a data point has high leverage, if it has extreme predictor x values.</li>
<li><strong>Sixth plot i.e. Cooks distance vs. leverage</strong> is also used to identify extreme values that may be impacting our model.</li>
</ol>
<p>Though the base R’s command <code>plot</code> can generate all the plots, we may make use of library <code>performance</code> to generate all the relevant diagnostic plots beautifully and with small interpretation. See</p>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1165-1"><a href="#cb1165-1" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb1165-2"><a href="#cb1165-2" tabindex="-1"></a><span class="fu">check_model</span>(lin_reg1)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/perf-1.png" alt="Output from package-performance" width="672" />
<p class="caption">
(#fig:perf)Output from package-performance
</p>
</div>
<p>The warning is obvious, we cannot have <code>multi-collinearity</code> problem as there is only one regressor. Actually multi-collinearity is about another assumption, we would have made in case there were more than one independent variables. This assumption would have been that the independent variables are not mutually collinear. We will see detailed explanation in case of multiple linear regression in the subsequent section.</p>
</div>
<div id="using-lm-for-predictions" class="section level2" number="20.7">
<h2><span class="header-section-number">20.7</span> Using <code>lm</code> for predictions</h2>
<p>The output of <code>lm</code> is actually a list which contains much more information than we saw above. See which info is contained here -</p>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1166-1"><a href="#cb1166-1" tabindex="-1"></a><span class="fu">names</span>(lin_reg1) <span class="sc">|&gt;</span></span>
<span id="cb1166-2"><a href="#cb1166-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb1166-3"><a href="#cb1166-3" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="st">&#39;Objects&#39;</span>)</span></code></pre></div>
<pre><code>##          Objects
## 1   coefficients
## 2      residuals
## 3        effects
## 4           rank
## 5  fitted.values
## 6         assign
## 7             qr
## 8    df.residual
## 9        xlevels
## 10          call
## 11         terms
## 12         model</code></pre>
<p>We may extract any of the as per requirement. E.g.</p>
<div class="sourceCode" id="cb1168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1168-1"><a href="#cb1168-1" tabindex="-1"></a>lin_reg1<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##  (Intercept) Sepal.Length 
##   -0.5694327    0.7985283</code></pre>
<p>There is a package <code>broom</code> which uses <code>tidy</code> fundamentals to returns all the useful information by a single function <code>augment</code>.</p>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1170-1"><a href="#cb1170-1" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1170-2"><a href="#cb1170-2" tabindex="-1"></a><span class="fu">augment</span>(lin_reg1)</span></code></pre></div>
<pre><code>## # A tibble: 50 × 8
##    Sepal.Width Sepal.Length .fitted   .resid   .hat .sigma    .cooksd .std.resid
##          &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1         3.5          5.1    3.50 -0.00306 0.0215  0.259 0.00000160    -0.0121
##  2         3            4.9    3.34 -0.343   0.0218  0.254 0.0205        -1.35  
##  3         3.2          4.7    3.18  0.0163  0.0354  0.259 0.0000772      0.0649
##  4         3.1          4.6    3.10 -0.00380 0.0471  0.259 0.00000568    -0.0152
##  5         3.6          5      3.42  0.177   0.0200  0.258 0.00495        0.696 
##  6         3.9          5.4    3.74  0.157   0.0455  0.258 0.00940        0.628 
##  7         3.4          4.6    3.10  0.296   0.0471  0.255 0.0346         1.18  
##  8         3.4          5      3.42 -0.0232  0.0200  0.259 0.0000853     -0.0914
##  9         2.9          4.4    2.94 -0.0441  0.0803  0.259 0.00140       -0.179 
## 10         3.1          4.9    3.34 -0.243   0.0218  0.257 0.0103        -0.959 
## # ℹ 40 more rows</code></pre>
<p>Let’s also visualise the predicted values vis-a-vis actual values/residuals in Figure @ref(fig:predvsact).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/predvsact-1.png" alt="Predicted Vs. Actual Values (Left) and Residuals (Right)" width="48%" /><img src="DauR_files/figure-html/predvsact-2.png" alt="Predicted Vs. Actual Values (Left) and Residuals (Right)" width="48%" />
<p class="caption">
(#fig:predvsact)Predicted Vs. Actual Values (Left) and Residuals (Right)
</p>
</div>
<p>So if we have predict output from a new data, just ensure that data is in exactly same format as of regressor and we can use <code>predict</code> from base R directly. See this example.</p>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1172-1"><a href="#cb1172-1" tabindex="-1"></a>new_vals <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1172-2"><a href="#cb1172-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb1172-3"><a href="#cb1172-3" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="st">&#39;Sepal.Length&#39;</span>)</span>
<span id="cb1172-4"><a href="#cb1172-4" tabindex="-1"></a><span class="fu">predict</span>(lin_reg1, new_vals)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 3.416249 3.552228 2.691731 5.185508 2.801470 3.523949 4.037588 2.183525 
##        9       10 
## 4.190880 3.667629</code></pre>
</div>
<div id="multiple-linear-regression" class="section level2" number="20.8">
<h2><span class="header-section-number">20.8</span> Multiple Linear Regression</h2>
<p>As the name suggests, multiple linear regression is the model where multiple independent variables may have linear relationship with dependent variable. In this case, the regression equation will be -</p>
<p><span class="math display">\[\begin{equation}
y = \beta_0 + \beta_1x_1 + \beta_2x_2 + \beta_3x_3 + ... + \epsilon
(\#eq:lr12)
\end{equation}\]</span></p>
<p>where <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span>, <span class="math inline">\(x_3\)</span> …, <span class="math inline">\(x_n\)</span> will be <span class="math inline">\(n\)</span> independent variables and <span class="math inline">\(y\)</span> will be dependent variable as usual.</p>
<p>It may be clear that this equation represents an equation of a plane if there are two regressors. If there are <span class="math inline">\(n\)</span> regressors, the equation will represent equation of a hyperplane of <span class="math inline">\(n-1\)</span> dimensions. However, visualizing the variables and relation between them can be a bit tricky if there are multiple variables. We may decide about the type of the visualization will suit the requirement in that case.</p>
<p>Now, as already stated, there is an additional assumption, <strong>that all the independent variables are mutually independent too i.e. do not have multi-collinearity between them.</strong> Let’s build an example model again. We have to just add the predictors (independent variables) using the <code>+</code> operator in the formula <code>call</code>.</p>
<p><strong>Problem Statement:</strong> Example-2. Let’s try to establish the relationship between cars’ mileage (<code>mpg</code> variable in <code>mtcars</code> data-set) with engine displacement <code>disp</code>, horse power <code>hp</code> and weight <code>wt</code>. First of all let’s visualise the individual relationships between the variables through three plots as in Figure @ref(fig:ex2vis).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/ex2vis-1.png" alt="Relationship between regressors and outcome variables" width="31%" /><img src="DauR_files/figure-html/ex2vis-2.png" alt="Relationship between regressors and outcome variables" width="31%" /><img src="DauR_files/figure-html/ex2vis-3.png" alt="Relationship between regressors and outcome variables" width="31%" />
<p class="caption">
(#fig:ex2vis)Relationship between regressors and outcome variables
</p>
</div>
<p>Let’s also visualise the correlation between all these variables. See Figure @ref(fig:ex2vis2).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/ex2vis2-1.png" alt="Correlation between the variables in Example-2" width="672" />
<p class="caption">
(#fig:ex2vis2)Correlation between the variables in Example-2
</p>
</div>
<p>Now let’s build the model.</p>
<div class="sourceCode" id="cb1174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1174-1"><a href="#cb1174-1" tabindex="-1"></a>data <span class="ot">&lt;-</span> mtcars[, <span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;disp&quot;</span>, <span class="st">&quot;hp&quot;</span>, <span class="st">&quot;wt&quot;</span>)]</span>
<span id="cb1174-2"><a href="#cb1174-2" tabindex="-1"></a>lin_reg2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> ., </span>
<span id="cb1174-3"><a href="#cb1174-3" tabindex="-1"></a>               <span class="at">data =</span> data)</span>
<span id="cb1174-4"><a href="#cb1174-4" tabindex="-1"></a><span class="fu">summary</span>(lin_reg2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mpg ~ ., data = data)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -3.891 -1.640 -0.172  1.061  5.861 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 37.105505   2.110815  17.579  &lt; 2e-16 ***
## disp        -0.000937   0.010350  -0.091  0.92851    
## hp          -0.031157   0.011436  -2.724  0.01097 *  
## wt          -3.800891   1.066191  -3.565  0.00133 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.639 on 28 degrees of freedom
## Multiple R-squared:  0.8268, Adjusted R-squared:  0.8083 
## F-statistic: 44.57 on 3 and 28 DF,  p-value: 8.65e-11</code></pre>
<p>In formula call, please note that I have used <code>.</code> instead of naming all the variables. In fact <code>.</code> is a shorthand style of mentioning that all the variables except that mentioned as y variable will be our independent variables/predictors. In results, there is one coefficient for slope for each predictors and one intercept term in the output. The output equation can be written as equation @ref(eq:lr13).</p>
<p><span class="math display">\[\begin{equation}
{mpg} = -0.000937\cdot{disp} - 0.031157\cdot{hp} - 3.800891\cdot{wt} + 37.105505
(\#eq:lr13)
\end{equation}\]</span></p>
<p><strong>Interpretation:</strong> Notice that all slopes are in negative meaning that mileage drops by increase in each of weight, displacement and horsepower. Interpreting the equation would be on similar lines. We can now say that <em>keeping other variables constant</em>, the effect of change (increase) of 1 unit in <code>disp</code> will result in decrease of mileage by 0.000937 miles per gallon. Keeping other variables constant is important here. Of course, by above equation we may deduce that if other factors change, the effect on response variable would be different.</p>
<p><strong>Results:</strong> Analysing results, we may notice that our model is explains 83% of variance in data. Of course, adjusted r-squared is lower which means that adding extra variables may have increased the r-squared. Global p-value is highly significant which means that at least of the coefficients is non-zero. Of course, the least significant coefficient is that of <code>disp</code> which we can remove and re-run the model to check the parameters again.</p>
</div>
<div id="including-categorical-or-factor-variables-in-lm" class="section level2" number="20.9">
<h2><span class="header-section-number">20.9</span> Including categorical or factor variables in <code>lm</code></h2>
<p>By now we have seen that linear regression is useful for predicting numerical output and through the examples we have seen that our regressors were numerical too. But what if there’s an input variable which is categorical or nominal?</p>
<p>In such case, we will have to ensure that categorical variable is of type <code>factor</code> before proceeding to build a model.</p>
<p><strong>Problem Statement:</strong> Example-3. Let’s try to predict <span class="math inline">\({Sepal.Width}\)</span> from <span class="math inline">\({Species}\)</span> in the iris data-set. This time we will take complete data-set. Since, we know that <code>Species</code> is already of factor type we need not convert it into one. Before moving on let’s visualize the relation between the two variables using ggplot2. Box-plots are best suited here.</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/fact1-1.png" alt="Species Vs. Sepal Width" width="672" height="30%" />
<p class="caption">
(#fig:fact1)Species Vs. Sepal Width
</p>
</div>
<p>Now let’s build the model.</p>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1176-1"><a href="#cb1176-1" tabindex="-1"></a>lm_fact <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sepal.Width <span class="sc">~</span> Species, <span class="at">data =</span> iris)</span>
<span id="cb1176-2"><a href="#cb1176-2" tabindex="-1"></a><span class="fu">summary</span>(lm_fact)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sepal.Width ~ Species, data = iris)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -1.128 -0.228  0.026  0.226  0.972 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        3.42800    0.04804  71.359  &lt; 2e-16 ***
## Speciesversicolor -0.65800    0.06794  -9.685  &lt; 2e-16 ***
## Speciesvirginica  -0.45400    0.06794  -6.683 4.54e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3397 on 147 degrees of freedom
## Multiple R-squared:  0.4008, Adjusted R-squared:  0.3926 
## F-statistic: 49.16 on 2 and 147 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>In results we now got one intercept and two slopes for single regressor <code>Species</code>. So what happened now?</p>
<p><strong>Interpretation:</strong> Actually, factor data type requirement for categorical regressor was due to the fact that this factor variable is encoded as dummy variable for each of the category available in it. Dummy variable is numeric and we can now run linear regression as earlier. The first category available in it will be baseline level. Since there were three levels included in <code>Species</code> it has been encoded into two dummy variables. To see what happened behind the scenes, we may use <code>contrasts</code> function.</p>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1178-1"><a href="#cb1178-1" tabindex="-1"></a><span class="fu">contrasts</span>(iris<span class="sc">$</span>Species)</span></code></pre></div>
<pre><code>##            versicolor virginica
## setosa              0         0
## versicolor          1         0
## virginica           0         1</code></pre>
<p><code>model.matrix</code></p>
<p>It is clear that when <code>versicolor</code> is <code>1</code> the other variable is <code>0</code> and vice versa. Obviously when both are <code>0</code> it means that <code>Species</code> is <code>setosa</code> and that’s why no separate slope for that is present in output. Now we can write our regression line equation as @ref(eq:lr14)</p>
<p><span class="math display">\[\begin{equation}
{Sepal.Width} = 3.428 + (-0.658)\cdot{Speciesversicolor} + (-0.454)\cdot{Speciesvirginica}
(\#eq:lr14)
\end{equation}\]</span></p>
<p>Interpreting above equation is now easy. For each <code>versicolor</code> the <code>Sepal.Width</code> may be <code>3.428 - 0.658</code> or 2.77. Obviously when two dummy variables are zero, the Sepal.Width would be equal to intercept; and thus, we can conclude that intercept is nothing but prediction for base-line level. In fact we can subtract a <code>1</code> to obtain these interpreted results.</p>
<div class="sourceCode" id="cb1180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1180-1"><a href="#cb1180-1" tabindex="-1"></a>lm_fact <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sepal.Width <span class="sc">~</span> Species <span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> iris)</span>
<span id="cb1180-2"><a href="#cb1180-2" tabindex="-1"></a><span class="fu">summary</span>(lm_fact)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Sepal.Width ~ Species - 1, data = iris)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -1.128 -0.228  0.026  0.226  0.972 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## Speciessetosa      3.42800    0.04804   71.36   &lt;2e-16 ***
## Speciesversicolor  2.77000    0.04804   57.66   &lt;2e-16 ***
## Speciesvirginica   2.97400    0.04804   61.91   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3397 on 147 degrees of freedom
## Multiple R-squared:  0.9881, Adjusted R-squared:  0.9879 
## F-statistic:  4083 on 3 and 147 DF,  p-value: &lt; 2.2e-16</code></pre>
<p><strong>Notice that other two coefficients have now been adjusted automatically.</strong></p>
<p><strong>Results:</strong> Observing the figure @ref(fig:fact1), we may notice that the coefficients are nothing but mean Sepal Widths for each Species, which is obvious and logical too. Those, who are interested in seeing equation (without intercept) can also make one, as in equation @ref(eq:lr15).</p>
<p><span class="math display">\[\begin{equation}
{Sepal.Width} = 3.428\cdot{Speciessetosa} + (2.77)\cdot{Speciesversicolor} + (2.974)\cdot{Speciesvirginica}
(\#eq:lr15)
\end{equation}\]</span></p>
<p>Since, these coefficients are not slopes in true sense, we will refer these as intercepts, in next examples/sections.</p>
<div id="parallel-slopes-regression" class="section level3" number="20.9.1">
<h3><span class="header-section-number">20.9.1</span> Parallel slopes regression</h3>
<p>To understand how categorical response variable acts, when there are other numerical variables in regression model, let us build a model step by step.</p>
<p><strong>Problem statement:</strong> Example-4. We are taking <code>mpg</code> data-set included by default with <code>ggplot2</code> package. This data-set shows <em>Fuel economy data from 1999 to 2008 for 38 popular models of cars</em>. Let us predict highway mileage <code>hwy</code> from engine displacement <code>displ</code> and year of the model <code>year</code>. Let us visualize the variables. From Figure @ref(fig:ex4vis) it is clear that highway mileage is linearly associated with displacement.</p>
<div class="sourceCode" id="cb1182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1182-1"><a href="#cb1182-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(hwy, displ)) <span class="sc">+</span></span>
<span id="cb1182-2"><a href="#cb1182-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1182-3"><a href="#cb1182-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">formula =</span> <span class="st">&quot;y ~ x&quot;</span>) <span class="sc">+</span></span>
<span id="cb1182-4"><a href="#cb1182-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb1182-5"><a href="#cb1182-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/ex4vis-1.png" alt="Highway Mileage Vs. Displacement over cars manufactured in 1998 Vs. 2008" width="672" height="35%" />
<p class="caption">
(#fig:ex4vis)Highway Mileage Vs. Displacement over cars manufactured in 1998 Vs. 2008
</p>
</div>
<p><strong>Step-1:</strong> Let us first include a single numerical variable <code>displ</code> to predict highway mileage <code>hwy</code>; and examine the coefficients.</p>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1183-1"><a href="#cb1183-1" tabindex="-1"></a>par_slop1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> displ, <span class="at">data =</span> mpg)</span>
<span id="cb1183-2"><a href="#cb1183-2" tabindex="-1"></a><span class="fu">coef</span>(par_slop1)</span></code></pre></div>
<pre><code>## (Intercept)       displ 
##   35.697651   -3.530589</code></pre>
<p>We got one intercept and one slope coefficient. We can even see related visualisation in figure @ref(fig:parrslop) (left).</p>
<p><strong>Step-2:</strong> Now let us try to predict mileage on the basis of <code>year</code> of manufacture only. So as already stated, we have to convert it into factor. We can do that directly in the formula. <em>Also note that we are subtracting <span class="math inline">\(1\)</span> from the response variables, which actually replaces intercept with the baseline level explicitly.</em> Now see the coefficients-</p>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1185-1"><a href="#cb1185-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1185-2"><a href="#cb1185-2" tabindex="-1"></a>par_slop2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> <span class="fu">factor</span>(year) <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> mpg)</span>
<span id="cb1185-3"><a href="#cb1185-3" tabindex="-1"></a><span class="fu">coef</span>(par_slop2)</span></code></pre></div>
<pre><code>## factor(year)1999 factor(year)2008 
##         23.42735         23.45299</code></pre>
<p>Notice that we got intercept for each of the category available in factor variable. By seeing plot in Figure @ref(fig:parrslop)-(Right) that these intercepts are nothing but means for each category.</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/parrslop-1.png" alt="Mileage vs. Displacement (Left) and Year (right)" width="47%" /><img src="DauR_files/figure-html/parrslop-2.png" alt="Mileage vs. Displacement (Left) and Year (right)" width="47%" />
<p class="caption">
(#fig:parrslop)Mileage vs. Displacement (Left) and Year (right)
</p>
</div>
<p><strong>Step-3:</strong> Now we will build the complete model by including both variables together; and examine the coefficients.</p>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1187-1"><a href="#cb1187-1" tabindex="-1"></a>par_slop <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> displ <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> mpg)</span>
<span id="cb1187-2"><a href="#cb1187-2" tabindex="-1"></a><span class="fu">coef</span>(par_slop)</span></code></pre></div>
<pre><code>##            displ factor(year)1999 factor(year)2008 
##        -3.610986        35.275706        36.677842</code></pre>
<p>We can see one slope coefficient for numerical variable and two different intercepts for each of the Years. Try visualising these. In fact there are two different parallel lines (same slope). Refer figure @ref(fig:parrslop2).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/parrslop2-1.png" alt="Parallel Slopes" width="95%" height="35%" />
<p class="caption">
(#fig:parrslop2)Parallel Slopes
</p>
</div>
<p>This is also evident, if we write out the equation @ref(eq:lr16).</p>
<p><span class="math display">\[\begin{equation}
{hwy} = -3.610986\cdot{displ} + 35.275706\cdot{year1999} + 36.677842\cdot{year2008}
(\#eq:lr16)
\end{equation}\]</span></p>
<p>Either one of the dummy variables will be 0 and another 1, so that variable with <code>1</code> will act as intercept term, but the slope term will remain same. In other words, whatever be the year, the mileage will vary with displacement at the same rate. This is in actual circumstances, rare. Rate of change of response variable will change as per factor variables (regressor) change their values. So how to incorporate these changes in our model? The answer is <code>interaction</code> which has been discussed in next section.</p>
</div>
<div id="extending-multiple-linear-regression-by-including-interactions" class="section level3" number="20.9.2">
<h3><span class="header-section-number">20.9.2</span> Extending multiple linear regression by including <code>interactions</code></h3>
<p>The parallel slopes model, we saw in previous section enforced a common slope for each category. That’s not always the best option.</p>
<p><strong>Problem Statement:</strong> In same example-4 (earlier section) we can introduce <code>interaction</code> between two predictors using special operator OR shorthand notation <code>:</code> in formula call. See the following example-</p>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1189-1"><a href="#cb1189-1" tabindex="-1"></a>new_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(hwy <span class="sc">~</span> displ <span class="sc">+</span> <span class="fu">factor</span>(year) <span class="sc">+</span> displ<span class="sc">:</span><span class="fu">factor</span>(year) <span class="sc">-</span><span class="dv">1</span> , <span class="at">data =</span> mpg)</span>
<span id="cb1189-2"><a href="#cb1189-2" tabindex="-1"></a><span class="fu">coef</span>(new_model)</span></code></pre></div>
<pre><code>##                  displ       factor(year)1999       factor(year)2008 
##              -3.768406              35.792231              36.136730 
## displ:factor(year)2008 
##               0.305168</code></pre>
<p>Now notice an extra coefficient, though small which is change in slope when moving from baseline category to category of year- 2008. This, in fact represents that the model has a different slope for each category; refer Figure @ref(fig:parrslop3).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/parrslop3-1.png" alt="Changing Slopes with interaction" width="95%" height="35%" />
<p class="caption">
(#fig:parrslop3)Changing Slopes with interaction
</p>
</div>
<p>Interpreting these models are now, not that difficult as it seem earlier. Let’s generate summary first.</p>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1191-1"><a href="#cb1191-1" tabindex="-1"></a><span class="fu">summary</span>(new_model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = hwy ~ displ + factor(year) + displ:factor(year) - 
##     1, data = mpg)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.8595 -2.4360 -0.2103  1.6037 15.3677 
## 
## Coefficients:
##                        Estimate Std. Error t value Pr(&gt;|t|)    
## displ                   -3.7684     0.2788 -13.517   &lt;2e-16 ***
## factor(year)1999        35.7922     0.9794  36.546   &lt;2e-16 ***
## factor(year)2008        36.1367     1.0492  34.442   &lt;2e-16 ***
## displ:factor(year)2008   0.3052     0.3882   0.786    0.433    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.784 on 230 degrees of freedom
## Multiple R-squared:  0.9759, Adjusted R-squared:  0.9755 
## F-statistic:  2332 on 4 and 230 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>We may write our equation now (equation @ref(eq:lr17).</p>
<p><span class="math display">\[\begin{equation}
{hwy} = -3.7684\cdot{displ} + 35.7922\cdot{year1999} + 36.1367\cdot{year2008} + 0.3052\cdot{displ}\cdot{year2008}
(\#eq:lr17)
\end{equation}\]</span></p>
<p>Clearly, when year is 2008, the slope for <code>displ</code> changes by <code>0.3052</code>.</p>
<p>We can add as many interactions as we would like to, using the shorthand <code>:</code>; however, when there are many interactions we may make use of another shorthand operator <code>*</code>. So <code>x*z</code> would mean <code>x + z + x:z</code> and <code>x*z*w</code> would mean <code>x + z + w + x:z + x:w + z:w</code>. This obviously wouldn’t make any difference but would save us a lot of typing.</p>
</div>
</div>
<div id="multi-collinearity-and-variance-inflation-factor-vif" class="section level2" number="20.10">
<h2><span class="header-section-number">20.10</span> Multi-collinearity and Variance Inflation Factor (VIF)</h2>
<p>Multi-collinearity indicates a strong linear relationship among the predictor variables. This can create challenges in the regression analysis because it becomes difficult to determine the individual effects of each independent variable on the dependent variable accurately. Multi-collinearity can lead to unstable and unreliable coefficient estimates, making it harder to interpret the results and draw meaningful conclusions from the model. It is essential to detect and address multi-collinearity to ensure the validity and robustness of regression models.</p>
<p>But why it poses a problem in regression analysis. Actually, multi-collinearity means that one independent variable can be predicted from another and it in turn means that independent variables are no longer independent.</p>
<p>Multi-collinearity can be detected using many different methods. One of the method can be to use correlation plots, which is explained in next section. Another method is to use Variance Inflation Factor or VIF. VIF determines the strength of the correlation between the independent variables. It is predicted by taking a variable and regressing it against every other variable. In other words, VIF score of an independent variable represents how well the variable is explained by other independent variables.</p>
<p><span class="math display">\[\begin{equation}
{VIF} = \frac{1}{1-R^2}
(\#eq:lr18)
\end{equation}\]</span></p>
<p>So the closer <span class="math inline">\(R^2\)</span> value to <span class="math inline">\(1\)</span> the higher the <span class="math inline">\({VIF}\)</span>.</p>
<ul>
<li><span class="math inline">\(VIF\)</span> starts at <span class="math inline">\(1\)</span> and has no upper limit</li>
<li><span class="math inline">\({VIF} = 1\)</span> means there is no correlation between the independent variable and the other variables</li>
<li><span class="math inline">\({VIF}\)</span> exceeding <span class="math inline">\(5\)</span> indicates high multi-collinearity between that independent variable and others.</li>
</ul>
<p>Again in R, we do not have to manually calculate <span class="math inline">\({VIF}\)</span> for each variable. Using <code>vif()</code> function, of library <code>car</code> we can calculate this. Let’s use it on another model built on <code>mtcars</code> data where <code>mpg</code> variable is predicted using all other variables. For all other variables, instead of using names, we will use another shorthand operator <code>.</code>.</p>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1193-1"><a href="#cb1193-1" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> . , <span class="at">data =</span> mtcars)</span>
<span id="cb1193-2"><a href="#cb1193-2" tabindex="-1"></a><span class="fu">library</span>(car)</span></code></pre></div>
<pre><code>## Loading required package: carData</code></pre>
<pre><code>## 
## Attaching package: &#39;car&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:psych&#39;:
## 
##     logit</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     recode</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     some</code></pre>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1199-1"><a href="#cb1199-1" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(mod)</span></code></pre></div>
<pre><code>##       cyl      disp        hp      drat        wt      qsec        vs        am 
## 15.373833 21.620241  9.832037  3.374620 15.164887  7.527958  4.965873  4.648487 
##      gear      carb 
##  5.357452  7.908747</code></pre>
<p>We may notice high collinearity among some of these predictors as also indicated in above output.</p>
</div>
<div id="one-complete-example" class="section level2" number="20.11">
<h2><span class="header-section-number">20.11</span> One Complete Example</h2>
<p><strong>Problem Statement:</strong> Example-5. The data pertains to inter-country Life-Cycle Savings 1960-1970. Under the life-cycle savings hypothesis as developed by <em>Franco Modigliani</em>, the savings ratio (aggregate personal saving divided by disposable income) <code>sr</code> is explained by per-capita disposable income <code>dpi</code>, the percentage rate of change in per-capita disposable income <code>ddpi</code>, and two demographic variables: the percentage of population less than 15 years old <code>pop15</code> and the percentage of the population over 75 years old <code>pop75</code>. The data are averaged over the decade 1960–1970 to remove the business cycle or other short-term fluctuations.</p>
<p>Let’s try linear regression on <code>LifeCycleSavings</code> data.</p>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1201-1"><a href="#cb1201-1" tabindex="-1"></a><span class="co"># Visualise first 6 rows</span></span>
<span id="cb1201-2"><a href="#cb1201-2" tabindex="-1"></a><span class="fu">head</span>(LifeCycleSavings)</span></code></pre></div>
<pre><code>##              sr pop15 pop75     dpi ddpi
## Australia 11.43 29.35  2.87 2329.68 2.87
## Austria   12.07 23.32  4.41 1507.99 3.93
## Belgium   13.17 23.80  4.43 2108.47 3.82
## Bolivia    5.75 41.89  1.67  189.13 0.22
## Brazil    12.88 42.19  0.83  728.47 4.56
## Canada     8.79 31.72  2.85 2982.88 2.43</code></pre>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1203-1"><a href="#cb1203-1" tabindex="-1"></a><span class="co"># Build a model</span></span>
<span id="cb1203-2"><a href="#cb1203-2" tabindex="-1"></a>ex1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sr <span class="sc">~</span> . , <span class="at">data =</span> LifeCycleSavings)</span></code></pre></div>
<p>In <code>call</code> formula above, notice the shorthand <code>.</code> operator which here means all variable other than y variable are treated as input variables. See its output-</p>
<div class="sourceCode" id="cb1204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1204-1"><a href="#cb1204-1" tabindex="-1"></a><span class="fu">summary</span>(ex1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sr ~ ., data = LifeCycleSavings)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -8.2422 -2.6857 -0.2488  2.4280  9.7509 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 28.5660865  7.3545161   3.884 0.000334 ***
## pop15       -0.4611931  0.1446422  -3.189 0.002603 ** 
## pop75       -1.6914977  1.0835989  -1.561 0.125530    
## dpi         -0.0003369  0.0009311  -0.362 0.719173    
## ddpi         0.4096949  0.1961971   2.088 0.042471 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.803 on 45 degrees of freedom
## Multiple R-squared:  0.3385, Adjusted R-squared:  0.2797 
## F-statistic: 5.756 on 4 and 45 DF,  p-value: 0.0007904</code></pre>
<p>Multiple R squared is about 34% which means nearly 34% variability is explained by linear model. Let us see some diagnostics plots (figure @ref(fig:perf2))</p>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1206-1"><a href="#cb1206-1" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(ex1)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/perf2-1.png" alt="Diagnostic Plots" width="672" />
<p class="caption">
(#fig:perf2)Diagnostic Plots
</p>
</div>
<p>We may notice some multi-collinearity, between two population variables. See figures and @ref(fig:perf2) and @ref(fig:multi2).</p>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1207-1"><a href="#cb1207-1" tabindex="-1"></a>LifeCycleSavings <span class="sc">%&gt;%</span> </span>
<span id="cb1207-2"><a href="#cb1207-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(pop15, pop75)) <span class="sc">+</span></span>
<span id="cb1207-3"><a href="#cb1207-3" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb1207-4"><a href="#cb1207-4" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">formula =</span> <span class="st">&#39;y~x&#39;</span>) <span class="sc">+</span></span>
<span id="cb1207-5"><a href="#cb1207-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/multi2-1.png" alt="Are x and y correlated?" width="672" height="30%" />
<p class="caption">
(#fig:multi2)Are x and y correlated?
</p>
</div>
<p>This can also be verified by corrplots in figure @ref(fig:corrp).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/corrp-1.png" alt="Correlation Plots" width="672" height="45%" />
<p class="caption">
(#fig:corrp)Correlation Plots
</p>
</div>
<p>Let us see the VIF among the predictors.</p>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1208-1"><a href="#cb1208-1" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(ex1)</span></code></pre></div>
<pre><code>##    pop15    pop75      dpi     ddpi 
## 5.937661 6.629105 2.884369 1.074309</code></pre>
<p>Thus, the model should be tuned better by removing this multi-collinear variable. Let us try to remove <code>pop75</code> and re-run the model.</p>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1210-1"><a href="#cb1210-1" tabindex="-1"></a>ex2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sr <span class="sc">~</span> pop15 <span class="sc">+</span> dpi <span class="sc">+</span> ddpi, <span class="at">data =</span> LifeCycleSavings)</span>
<span id="cb1210-2"><a href="#cb1210-2" tabindex="-1"></a><span class="fu">summary</span>(ex2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sr ~ pop15 + dpi + ddpi, data = LifeCycleSavings)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.6889 -2.8813  0.0296  1.7989 10.4330 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 19.2771687  4.3888974   4.392 6.53e-05 ***
## pop15       -0.2883861  0.0945354  -3.051  0.00378 ** 
## dpi         -0.0008704  0.0008795  -0.990  0.32755    
## ddpi         0.3929355  0.1989390   1.975  0.05427 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.862 on 46 degrees of freedom
## Multiple R-squared:  0.3026, Adjusted R-squared:  0.2572 
## F-statistic: 6.654 on 3 and 46 DF,  p-value: 0.0007941</code></pre>
<p>Notice that multiple R-squared has now reduced to 30%. Let us try to remove the variable <code>dpi</code> the coefficient of which is not that significant.</p>
<div class="sourceCode" id="cb1212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1212-1"><a href="#cb1212-1" tabindex="-1"></a>ex3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(sr <span class="sc">~</span> pop15 <span class="sc">+</span> ddpi, <span class="at">data =</span> LifeCycleSavings)</span>
<span id="cb1212-2"><a href="#cb1212-2" tabindex="-1"></a><span class="fu">summary</span>(ex3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = sr ~ pop15 + ddpi, data = LifeCycleSavings)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.5831 -2.8632  0.0453  2.2273 10.4753 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 15.59958    2.33439   6.682 2.48e-08 ***
## pop15       -0.21638    0.06033  -3.586 0.000796 ***
## ddpi         0.44283    0.19240   2.302 0.025837 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.861 on 47 degrees of freedom
## Multiple R-squared:  0.2878, Adjusted R-squared:  0.2575 
## F-statistic: 9.496 on 2 and 47 DF,  p-value: 0.0003438</code></pre>
<p>Multiple R squared increased slightly i.e. now reached around 29%. Let us try to visualise the relationship through a scatter plot.</p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1214-1"><a href="#cb1214-1" tabindex="-1"></a>LifeCycleSavings <span class="sc">%&gt;%</span> </span>
<span id="cb1214-2"><a href="#cb1214-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(pop15, sr)) <span class="sc">+</span></span>
<span id="cb1214-3"><a href="#cb1214-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1214-4"><a href="#cb1214-4" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">formula =</span> <span class="st">&#39;y ~ x&#39;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1214-5"><a href="#cb1214-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/unnamed-chunk-374-1.png" alt="Ascertaining linear relationship" width="672" height="30%" />
<p class="caption">
(#fig:unnamed-chunk-374)Ascertaining linear relationship
</p>
</div>
<p>Clearly the relationship between the predictor and response variable is not that strong and hence the results.</p>
</div>
<div id="simpsons-paradox" class="section level2" number="20.12">
<h2><span class="header-section-number">20.12</span> Simpson’s paradox</h2>
<p>Edward Hugh Simpson, a statistician and former cryptanalyst at Bletchley Park, described this statistical phenomenon in a paper in 1951. It is classic example how regressions, without including necessary terms, can be misleading. At its core, the paradox arises when a trend that appears in different subgroups of data is either <em>reversed</em> or <em>disappears</em> when the subgroups are combined. This seemingly counter-intuitive occurrence can lead to misleading conclusions and thus underscores the importance of careful analysis and interpretation of data.</p>
<p><strong>Problem Statement:</strong> Example-6. Here is data of <code>palmerpenguins</code> where let’s try to establish relationship between penguins bills’ depth and lengths i.e. <code>bill_depth_mm</code> and <code>bill_length_mm</code>. See the plot in fig @ref(fig:ex3).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/ex3-1.png" alt="Regression having variable hidden (left) and exposed (right)" width="47%" /><img src="DauR_files/figure-html/ex3-2.png" alt="Regression having variable hidden (left) and exposed (right)" width="47%" />
<p class="caption">
(#fig:ex3)Regression having variable hidden (left) and exposed (right)
</p>
</div>
<p>In plot (left) a negative relationship is seen, but when the lurking variable is exposed (right), we can see a positive relationship for each of the species . Thus, species is a significant confounding variable to assess linear relationship here. Thus before finalizing the model, we have to be sure that we are not missing any important variable. To avoid incorrect results due to underlying Simpson’s Paradox, we must ensure to:</p>
<p><strong>Identify Confounding Variables:</strong> Be vigilant in identifying potential confounding variables that could affect the relationship between the variables under study.</p>
<p><strong>Consider All Levels:</strong> Analyze data at different levels, including subgroup and aggregate levels, to gain a comprehensive understanding of the relationship.</p>
<p><strong>Utilise Statistical Techniques:</strong> such as regression analysis or propensity score matching, to control for confounding variables and obtain more accurate insights.</p>
<p><strong>Transparent Reporting:</strong> Clearly report the methodology, assumptions, and limitations of the analysis to ensure that others can critically evaluate the findings.</p>
<p>Simpson’s Paradox, thus, serves as a powerful reminder that data analysis is an intricate process that requires careful consideration of underlying factors.</p>
</div>
<div id="conclusion-and-final-thoughts" class="section level2" number="20.13">
<h2><span class="header-section-number">20.13</span> Conclusion and Final thoughts</h2>
<p>In above sections, we learned techniques of regression analysis, which is a powerful and useful tool in data analytics while auditing. We may use regression analysis, inter alia, for -</p>
<p><strong>Detection of Anomalies and Outliers:</strong> Regression analysis can help auditors in identifying anomalies, outliers, or unexpected patterns in financial data. Unusual relationships between variables can signal potential errors, fraud, or irregularities that require further investigation.</p>
<p><strong>Risk Assessment:</strong> By analyzing the relationships between various financial or operational variables, regression analysis can assist auditors in assessing the level of risk associated with different aspects of an organization’s operations. This helps auditors prioritize their efforts and allocate resources effectively.</p>
<p><strong>Control Testing:</strong> Regression analysis can aid us in testing the effectiveness of internal controls within an organization. By examining the relationship between control variables and outcomes, auditors can assess whether controls are functioning as intended. We can also use regression analysis to compare an organization’s financial performance against industry benchmarks or similar companies. Deviations from expected relationships can highlight areas that warrant closer examination.</p>
<hr />
<!--chapter:end:12-4Reg.Rmd-->
</div>
</div>
<div id="principal-component-analysis-in-r" class="section level1" number="21">
<h1><span class="header-section-number">21</span> Principal Component Analysis in R</h1>
<p><em>The content is under development</em></p>
<!--chapter:end:12-5PCA.Rmd-->
</div>
<div id="clustering-in-r-using-kmeans-algorithm" class="section level1" number="22">
<h1><span class="header-section-number">22</span> Clustering in R (Using Kmeans algorithm)</h1>
<p><em>The content is under development</em></p>
<!--chapter:end:12-6KMeans.Rmd-->
</div>
<div id="association-rule-mining-in-r-apriori" class="section level1" number="23">
<h1><span class="header-section-number">23</span> Association Rule Mining in R (Apriori)</h1>
<p><em>The content is under development</em></p>
<!--chapter:end:12-7Apriori.Rmd-->
</div>
<div id="part-v-time-series" class="section level1 unnumbered">
<h1 class="unnumbered">Part-V: Time Series</h1>
</div>
<div id="lubridate" class="section level1" number="24">
<h1><span class="header-section-number">24</span> Date and Time calculations</h1>
<div id="base-r-classes-to-deal-with-date-and-time-variables" class="section level2" number="24.1">
<h2><span class="header-section-number">24.1</span> Base R classes to deal with date and time variables</h2>
<p>There may hardly be any data analytics activity, wherein we do not have to deal with temporal information and thus need to manipulate dates and date-time objects/variables. To deal with these variable types, R has four core data types/classes,</p>
<ul>
<li><code>Date</code> To deal with date objects (note: <code>D</code> in UPPER case)</li>
<li><code>POSIXct</code> To deal with times</li>
<li><code>POSIXlt</code> To deal with times (for difference between these two refer section @ref(timm).)</li>
<li><code>difftime</code> To deal with time-spans</li>
</ul>
<div id="dates" class="section level3" number="24.1.1">
<h3><span class="header-section-number">24.1.1</span> Dates</h3>
<p><code>Date</code> objects can be created from <code>string/character</code> type objects (we will just see that date objects can be created from numeric objects too), using base R’s function <code>as.Date()</code> which accepts a character vector and a format to parse the date from the given string of characters. E.g.</p>
<div class="sourceCode" id="cb1215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1215-1"><a href="#cb1215-1" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;2000-12-12&quot;</span>) <span class="co"># default format</span></span></code></pre></div>
<pre><code>## [1] &quot;2000-12-12&quot;</code></pre>
<div class="sourceCode" id="cb1217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1217-1"><a href="#cb1217-1" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;12-12-2000&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%d-%m-%Y&quot;</span>) <span class="co"># custom format</span></span></code></pre></div>
<pre><code>## [1] &quot;2000-12-12&quot;</code></pre>
<p>In the above example, we can see that a custom format has been given to parse the character string into the date type object. We can check the <code>class</code> of the object created.</p>
<div class="sourceCode" id="cb1219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1219-1"><a href="#cb1219-1" tabindex="-1"></a>a_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;20-12-2022&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%d-%m-%Y&quot;</span>)</span>
<span id="cb1219-2"><a href="#cb1219-2" tabindex="-1"></a><span class="fu">class</span>(a_date)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p>The format used in the above function accepts special codes, which can be seen by running <code>?strptime</code> in your R console. A ready reference for most used codes is however, given in table @ref(tab:lubri001) in section @ref(strpp). The date objects in R, are actually based on numeric classes which actually store the number of days since an epoch. Check the following code-</p>
<div class="sourceCode" id="cb1221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1221-1"><a href="#cb1221-1" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">Sys.Date</span>())</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<div class="sourceCode" id="cb1223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1223-1"><a href="#cb1223-1" tabindex="-1"></a><span class="fu">typeof</span>(<span class="fu">Sys.Date</span>())</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb1225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1225-1"><a href="#cb1225-1" tabindex="-1"></a><span class="fu">unclass</span>(<span class="fu">Sys.Date</span>())</span></code></pre></div>
<pre><code>## [1] 20056</code></pre>
<p>So, in R versions 4.3.0 and later, it also accepts a number to convert into a date using the number of days elapsed since epoch. So,</p>
<div class="sourceCode" id="cb1227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1227-1"><a href="#cb1227-1" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1970-01-02&quot;</code></pre>
<p>Here date since one day of default origin date 1970-01-01 has been returned. However, default <code>origin</code> can be changed using the argument <code>origin</code>. Example,</p>
<div class="sourceCode" id="cb1229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1229-1"><a href="#cb1229-1" tabindex="-1"></a><span class="co"># One day since launch of R version 1.0</span></span>
<span id="cb1229-2"><a href="#cb1229-2" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="dv">1</span>, <span class="at">origin =</span> <span class="st">&quot;2000-02-29&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2000-03-01&quot;</code></pre>
</div>
<div id="timm" class="section level3" number="24.1.2">
<h3><span class="header-section-number">24.1.2</span> Times</h3>
<p>Now, to create date-time objects we can use either of <code>POSIXct</code> and <code>POSIXlt</code> classes, i.e. by using <code>as.POSIXct()</code> and/or <code>as.POSIXlt()</code> functions, as shown below.</p>
<div class="sourceCode" id="cb1231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1231-1"><a href="#cb1231-1" tabindex="-1"></a><span class="fu">as.POSIXct</span>(<span class="st">&quot;1990/2/17 12:20:05&quot;</span>) <span class="co"># default format</span></span></code></pre></div>
<pre><code>## [1] &quot;1990-02-17 12:20:05 IST&quot;</code></pre>
<div class="sourceCode" id="cb1233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1233-1"><a href="#cb1233-1" tabindex="-1"></a><span class="fu">as.POSIXct</span>(<span class="st">&quot;17-2-1990 15:30:00&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%d-%m-%Y %H:%M:%S&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1990-02-17 15:30:00 IST&quot;</code></pre>
<div class="sourceCode" id="cb1235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1235-1"><a href="#cb1235-1" tabindex="-1"></a><span class="fu">as.POSIXlt</span>(<span class="st">&quot;17-2-1990 15:30:00&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%d-%m-%Y %H:%M:%S&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1990-02-17 15:30:00 IST&quot;</code></pre>
<p>As regards, the difference between these two classes, <code>POSIXct</code> stores <em>seconds</em> since UNIX epoch (and other information), and <code>POSIXlt</code>, which stores a list of <em>day</em>, <em>month</em>, <em>year</em>, <em>hour</em>, <em>minute</em>, <em>second</em>, etc., which can be understood from the following codes.</p>
<blockquote>
<p><code>ct</code> in <code>POSIXct</code> stands for calendar time whereas, <code>lt</code> in <code>POSIXlt</code> stands for local time, explaining the conceptual difference.</p>
</blockquote>
<div class="sourceCode" id="cb1237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1237-1"><a href="#cb1237-1" tabindex="-1"></a>time_ct <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;17-2-1990 15:30:00&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%d-%m-%Y %H:%M:%S&quot;</span>)</span>
<span id="cb1237-2"><a href="#cb1237-2" tabindex="-1"></a><span class="fu">class</span>(time_ct)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<div class="sourceCode" id="cb1239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1239-1"><a href="#cb1239-1" tabindex="-1"></a><span class="fu">unclass</span>(time_ct)</span></code></pre></div>
<pre><code>## [1] 635248800
## attr(,&quot;tzone&quot;)
## [1] &quot;&quot;</code></pre>
<div class="sourceCode" id="cb1241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1241-1"><a href="#cb1241-1" tabindex="-1"></a><span class="do">## POSIXlt</span></span>
<span id="cb1241-2"><a href="#cb1241-2" tabindex="-1"></a><span class="co"># Convert above object into POSIXlt type</span></span>
<span id="cb1241-3"><a href="#cb1241-3" tabindex="-1"></a>time_lt <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(time_ct)</span>
<span id="cb1241-4"><a href="#cb1241-4" tabindex="-1"></a><span class="co"># Let us print</span></span>
<span id="cb1241-5"><a href="#cb1241-5" tabindex="-1"></a>time_lt</span></code></pre></div>
<pre><code>## [1] &quot;1990-02-17 15:30:00 IST&quot;</code></pre>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1243-1"><a href="#cb1243-1" tabindex="-1"></a><span class="fu">class</span>(time_lt)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXlt&quot; &quot;POSIXt&quot;</code></pre>
<div class="sourceCode" id="cb1245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1245-1"><a href="#cb1245-1" tabindex="-1"></a><span class="fu">unclass</span>(time_lt)</span></code></pre></div>
<pre><code>## $sec
## [1] 0
## 
## $min
## [1] 30
## 
## $hour
## [1] 15
## 
## $mday
## [1] 17
## 
## $mon
## [1] 1
## 
## $year
## [1] 90
## 
## $wday
## [1] 6
## 
## $yday
## [1] 47
## 
## $isdst
## [1] 0
## 
## $zone
## [1] &quot;IST&quot;
## 
## $gmtoff
## [1] 19800
## 
## attr(,&quot;tzone&quot;)
## [1] &quot;&quot;      &quot;IST&quot;   &quot;+0630&quot;
## attr(,&quot;balanced&quot;)
## [1] TRUE</code></pre>
<p>Similar to <code>as.Date()</code>, <code>as.POSIXct()</code> also accepts a number and converts it into a date-time object using that much number of seconds since epoch.</p>
<div class="sourceCode" id="cb1247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1247-1"><a href="#cb1247-1" tabindex="-1"></a><span class="fu">as.POSIXct</span>(<span class="dv">60</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1970-01-01 05:31:00 IST&quot;</code></pre>
</div>
<div id="times-without-dates" class="section level3" number="24.1.3">
<h3><span class="header-section-number">24.1.3</span> Times (without dates)</h3>
<p>In base R, we do not have specific class to deal with time objects. However, there is a package <code>hms</code> part of <code>tidyverse</code> which can be used to create time objects to perform required calculations.</p>
<div class="sourceCode" id="cb1249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1249-1"><a href="#cb1249-1" tabindex="-1"></a>hms<span class="sc">::</span><span class="fu">as_hms</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## 00:00:10</code></pre>
</div>
<div id="diffftime" class="section level3" number="24.1.4">
<h3><span class="header-section-number">24.1.4</span> Timespan</h3>
<p>In base R, besides above date/date-time object classes, there is a special class which creates time difference between two given temporal objects in specified units. The class is <code>difftime</code>.</p>
<div class="sourceCode" id="cb1251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1251-1"><a href="#cb1251-1" tabindex="-1"></a>(freedom_age <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1947-08-15&quot;</span>))</span></code></pre></div>
<pre><code>## Time difference of 28231 days</code></pre>
<div class="sourceCode" id="cb1253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1253-1"><a href="#cb1253-1" tabindex="-1"></a><span class="fu">class</span>(freedom_age)</span></code></pre></div>
<pre><code>## [1] &quot;difftime&quot;</code></pre>
<div class="sourceCode" id="cb1255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1255-1"><a href="#cb1255-1" tabindex="-1"></a><span class="fu">unclass</span>(freedom_age)</span></code></pre></div>
<pre><code>## [1] 28231
## attr(,&quot;units&quot;)
## [1] &quot;days&quot;</code></pre>
<p>Function <code>difftime</code> can create difftime objects, as per specific requirement due to presence of an argument <code>units</code> which can take values from one of <code>“auto”</code>, <code>“secs”</code>, <code>“mins”</code>, <code>“hours”</code>, <code>“days”</code>, <code>“weeks”</code>.</p>
<div class="sourceCode" id="cb1257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1257-1"><a href="#cb1257-1" tabindex="-1"></a><span class="fu">difftime</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2020-02-29&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2019-02-28&quot;</span>), <span class="at">units =</span> <span class="st">&quot;weeks&quot;</span>)</span></code></pre></div>
<pre><code>## Time difference of 52.28571 weeks</code></pre>
<p>We can also create a difftime object by coercion.</p>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1259-1"><a href="#cb1259-1" tabindex="-1"></a>a_difftime <span class="ot">&lt;-</span> <span class="fu">as.difftime</span>(<span class="dv">15</span>, <span class="at">units =</span> <span class="st">&quot;days&quot;</span>)</span>
<span id="cb1259-2"><a href="#cb1259-2" tabindex="-1"></a>a_difftime</span></code></pre></div>
<pre><code>## Time difference of 15 days</code></pre>
<div class="sourceCode" id="cb1261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1261-1"><a href="#cb1261-1" tabindex="-1"></a><span class="fu">class</span>(a_difftime)</span></code></pre></div>
<pre><code>## [1] &quot;difftime&quot;</code></pre>
</div>
<div id="time-zones" class="section level3" number="24.1.5">
<h3><span class="header-section-number">24.1.5</span> Time zones</h3>
<p>Run the function <code>Sys.timezone()</code> in your console to check the current timezone. Function <code>OlsonNames()</code> will however, display the known location for time-zones.</p>
<div class="sourceCode" id="cb1263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1263-1"><a href="#cb1263-1" tabindex="-1"></a><span class="fu">Sys.timezone</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Asia/Calcutta&quot;</code></pre>
<div class="sourceCode" id="cb1265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1265-1"><a href="#cb1265-1" tabindex="-1"></a><span class="fu">OlsonNames</span>()[<span class="fu">c</span>(<span class="dv">253</span>, <span class="dv">284</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;Asia/Calcutta&quot; &quot;Asia/Kolkata&quot;</code></pre>
<p>So, we may use <code>tz</code> argument of <code>as.POSIXlt()</code> and <code>as.POSIXct()</code> functions to coerce the numeric or other class variables to dates and/or times.</p>
<div class="sourceCode" id="cb1267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1267-1"><a href="#cb1267-1" tabindex="-1"></a><span class="fu">as.POSIXct</span>(<span class="dv">1</span>, <span class="at">tz =</span> <span class="st">&quot;GMT&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1970-01-01 00:00:01 GMT&quot;</code></pre>
</div>
<div id="coercion" class="section level3" number="24.1.6">
<h3><span class="header-section-number">24.1.6</span> Coercion</h3>
<p>In earlier sections we have already seen coercing functions useful to coerce the objects from one class to another.</p>
<ul>
<li><code>as.Date()</code></li>
<li><code>as.POSIXct()</code></li>
<li><code>as.POSIXlt()</code></li>
<li><code>as.difftime()</code></li>
</ul>
</div>
<div id="extracting-parts-from-datestimes" class="section level3" number="24.1.7">
<h3><span class="header-section-number">24.1.7</span> Extracting parts from dates/times</h3>
<p>Base R provides us some useful function to extract relevant part of objects of dates/times classes.</p>
<ul>
<li><code>weekdays(x, abbreviate = FALSE)</code> to extract the weekday name. (Output is in character vector)</li>
<li><code>months(x, abbreviate = FALSE)</code> to extract the month name. (Output is in character vector)</li>
<li><code>quarters(x)</code> to extract the quarter. Output is in character vector.</li>
<li><code>julian(x)</code> to extract the days elapsed since origin. Output is in numeric vector.</li>
</ul>
<p>Examples-</p>
<div class="sourceCode" id="cb1269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1269-1"><a href="#cb1269-1" tabindex="-1"></a>dates_vec <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="dv">15001</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb1269-2"><a href="#cb1269-2" tabindex="-1"></a><span class="fu">weekdays</span>(dates_vec)</span></code></pre></div>
<pre><code>## [1] &quot;Friday&quot;    &quot;Saturday&quot;  &quot;Sunday&quot;    &quot;Monday&quot;    &quot;Tuesday&quot;   &quot;Wednesday&quot;
## [7] &quot;Thursday&quot;</code></pre>
<div class="sourceCode" id="cb1271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1271-1"><a href="#cb1271-1" tabindex="-1"></a><span class="fu">months</span>(dates_vec)</span></code></pre></div>
<pre><code>## [1] &quot;January&quot;  &quot;January&quot;  &quot;January&quot;  &quot;January&quot;  &quot;February&quot; &quot;February&quot; &quot;February&quot;</code></pre>
<div class="sourceCode" id="cb1273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1273-1"><a href="#cb1273-1" tabindex="-1"></a><span class="fu">quarters</span>(dates_vec)</span></code></pre></div>
<pre><code>## [1] &quot;Q1&quot; &quot;Q1&quot; &quot;Q1&quot; &quot;Q1&quot; &quot;Q1&quot; &quot;Q1&quot; &quot;Q1&quot;</code></pre>
<div class="sourceCode" id="cb1275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1275-1"><a href="#cb1275-1" tabindex="-1"></a><span class="fu">julian</span>(dates_vec)</span></code></pre></div>
<pre><code>## [1] 15002 15003 15004 15005 15006 15007 15008
## attr(,&quot;origin&quot;)
## [1] &quot;1970-01-01&quot;</code></pre>
</div>
<div id="other-useful-related-functions" class="section level3" number="24.1.8">
<h3><span class="header-section-number">24.1.8</span> Other useful related functions</h3>
<p>There are certain other useful functions to the related classes which are useful in data analytics.</p>
<ol style="list-style-type: decimal">
<li><code>seq.Date(from, to, by, length.out = NULL, along.with = NULL, ...)</code> where-</li>
</ol>
<ul>
<li><code>from</code> and <code>to</code> are start and end dates respectively</li>
<li><code>by</code> is increment of sequence which can accept either of these
<ul>
<li>a number to be taken in days,</li>
<li>an object of class <code>difftime</code></li>
<li>a character string, containing one of “day”, “week”, “month”, “quarter” or “year”. This can optionally be preceded by a (positive or negative) integer and a space, or followed by “s”.</li>
</ul></li>
<li><code>length.out</code> is optional argument accepting an integer, for desired length of the sequence.</li>
<li><code>along.with</code> take the length from the length of this argument.</li>
</ul>
<p>Example-</p>
<div class="sourceCode" id="cb1277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1277-1"><a href="#cb1277-1" tabindex="-1"></a><span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2000/1/1&quot;</span>), <span class="at">by =</span> <span class="st">&quot;month&quot;</span>, <span class="at">length.out =</span> <span class="dv">12</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;2000-01-01&quot; &quot;2000-02-01&quot; &quot;2000-03-01&quot; &quot;2000-04-01&quot; &quot;2000-05-01&quot;
##  [6] &quot;2000-06-01&quot; &quot;2000-07-01&quot; &quot;2000-08-01&quot; &quot;2000-09-01&quot; &quot;2000-10-01&quot;
## [11] &quot;2000-11-01&quot; &quot;2000-12-01&quot;</code></pre>
</div>
<div id="strpp" class="section level3" number="24.1.9">
<h3><span class="header-section-number">24.1.9</span> <code>strptime</code> character codes</h3>
<p>A few format codes useful to parse date/date-time objects in R, are listed below for ready reference. To know more about these codes, readers can see the output of <code>?strptime()</code> in their console. Some useful codes have been reproduced in the table @ref(tab:lubri001) for ready reference.</p>
<table>
<caption>(#tab:lubri001) Conversion Specifications for Date/Date-time</caption>
<colgroup>
<col width="27%" />
<col width="72%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Format</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>%y</code> (or <code>%Y</code>)</td>
<td>Year without (or with) Century</td>
</tr>
<tr class="even">
<td align="center"><code>%m</code></td>
<td>Month as decimal number (01-12)</td>
</tr>
<tr class="odd">
<td align="center"><code>%B</code> (or <code>%b</code>)</td>
<td>Month name in full (or abbreviated) in current locale</td>
</tr>
<tr class="even">
<td align="center"><code>%d</code></td>
<td>Day of the month (01-31)</td>
</tr>
<tr class="odd">
<td align="center"><code>%H</code></td>
<td>Hours as decimal number (00-23)</td>
</tr>
<tr class="even">
<td align="center"><code>%I</code></td>
<td>Hours as decimal number, in 12 hour format (00-12)</td>
</tr>
<tr class="odd">
<td align="center"><code>%M</code></td>
<td>Minute as decimal number (00-59)</td>
</tr>
<tr class="even">
<td align="center"><code>%S</code></td>
<td>Second as integer (00-61) allowing up to two leap-seconds</td>
</tr>
<tr class="odd">
<td align="center"><code>%OS</code></td>
<td>Second(s) as decimal number</td>
</tr>
<tr class="even">
<td align="center"><code>%T</code></td>
<td>Equivalent to <code>%H:%M:%S</code></td>
</tr>
<tr class="odd">
<td align="center"><code>%p</code></td>
<td>AM/PM indicator in the locale.</td>
</tr>
<tr class="even">
<td align="center"><code>%A</code> (or <code>%a</code>)</td>
<td>Full (or abbreviated) week-day name, in current locale</td>
</tr>
<tr class="odd">
<td align="center"><code>%j</code></td>
<td>Day of year as decimal number (001–366): For input, 366 is only valid in a leap year.</td>
</tr>
<tr class="even">
<td align="center"><code>%u</code></td>
<td>Weekday as a decimal number (1–7, Monday is 1)</td>
</tr>
<tr class="odd">
<td align="center"><code>%w</code></td>
<td>Weekday as decimal number (0–6, Sunday is 0).</td>
</tr>
<tr class="even">
<td align="center"><code>%U</code></td>
<td>Week of the year as decimal number (00–53) using Sunday as the first day 1 of the week (and typically with the first Sunday of the year as day 1 of week 1). <strong>The US convention.</strong></td>
</tr>
<tr class="odd">
<td align="center"><code>%V</code></td>
<td>Week of the year as decimal number (01–53) as defined in ISO 8601. If the week (starting on Monday) containing 1 January has four or more days in the new year, then it is considered week 1. Otherwise, it is the last week of the previous year, and the next week is week 1.</td>
</tr>
<tr class="even">
<td align="center"><code>%W</code></td>
<td>Week of the year as decimal number (00–53) using Monday as the first day of week (and typically with the first Monday of the year as day 1 of week 1). <strong>The UK convention</strong>.</td>
</tr>
<tr class="odd">
<td align="center"><code>%z</code></td>
<td>Offset from UTC</td>
</tr>
<tr class="even">
<td align="center"><code>%Z</code></td>
<td>Time Zone name</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="using-lubridate-package-for-parsingcreating-dates" class="section level2" number="24.2">
<h2><span class="header-section-number">24.2</span> Using <code>lubridate</code> package for parsing/creating dates</h2>
<p>Package <code>lubridate</code> which is now part of core <code>tidyverse</code> is extremely helpful package while analysing temporal variables in data. Creating date/date-time objects and converting variables from numeric/character to these types is easier than in base R. Besides, it offers us some other temporal class objects to make our time-series analysis easier.</p>
<div id="datedate-time-objects-creation" class="section level3" number="24.2.1">
<h3><span class="header-section-number">24.2.1</span> Date/date-time objects creation</h3>
<p>Date and Date-time object classes in <code>lubridate</code> are defined similarly as in base R. So we can create a date (or date-time) using a number of days (or seconds) elapsed since epoch.</p>
<div class="sourceCode" id="cb1279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1279-1"><a href="#cb1279-1" tabindex="-1"></a><span class="fu">library</span>(lubridate, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1279-2"><a href="#cb1279-2" tabindex="-1"></a><span class="co"># Creation using numbers</span></span>
<span id="cb1279-3"><a href="#cb1279-3" tabindex="-1"></a><span class="fu">as_date</span>(<span class="dv">2392</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1976-07-20&quot;</code></pre>
<div class="sourceCode" id="cb1281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1281-1"><a href="#cb1281-1" tabindex="-1"></a><span class="fu">as_datetime</span>(<span class="dv">206668800</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1976-07-20 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1283-1"><a href="#cb1283-1" tabindex="-1"></a><span class="co"># Converting from one type to another</span></span>
<span id="cb1283-2"><a href="#cb1283-2" tabindex="-1"></a>(date_today <span class="ot">&lt;-</span> <span class="fu">as_date</span>(<span class="fu">now</span>()))</span></code></pre></div>
<pre><code>## [1] &quot;2024-11-29&quot;</code></pre>
<div class="sourceCode" id="cb1285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1285-1"><a href="#cb1285-1" tabindex="-1"></a><span class="co"># Check its class</span></span>
<span id="cb1285-2"><a href="#cb1285-2" tabindex="-1"></a><span class="fu">class</span>(date_today)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<div class="sourceCode" id="cb1287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1287-1"><a href="#cb1287-1" tabindex="-1"></a><span class="co"># Or see what&#39;s all in there</span></span>
<span id="cb1287-2"><a href="#cb1287-2" tabindex="-1"></a><span class="fu">unclass</span>(date_today)</span></code></pre></div>
<pre><code>## [1] 20056</code></pre>
</div>
<div id="parsing-datedate-time-objects-from-character" class="section level3" number="24.2.2">
<h3><span class="header-section-number">24.2.2</span> Parsing date/date-time objects from <code>character</code></h3>
<p>In <code>lubridate</code> parsing date/date-time objects from character strings is pretty easy as we have a number of functions useful to parse dates/date-times written in any specific locale/order irrespective of the delimiter used to separate different components of date/time therein. In these functions, the orders of the year (<code>y</code>), quarter (<code>q</code>), month (<code>m</code>) date (<code>d</code>) hour (<code>h</code>) minute (<code>m</code>) and second (<code>s</code>) are represented by their first characters. These are -</p>
<ul>
<li><code>ymd_hms</code>, <code>ymd_hm</code>, <code>ymd_h</code>, <code>ymd</code></li>
<li><code>dmy_hms</code>, <code>dmy_hm</code>, <code>dmy_h</code>, <code>dmy</code></li>
<li><code>mdy_hms</code>, <code>mdy_hm</code>, <code>mdy_h</code>, <code>mdy</code></li>
<li><code>ydm_hms</code>, <code>ydm_hm</code>, <code>ydm_h</code>, <code>ydm</code></li>
<li><code>myd</code>, <code>dym</code></li>
<li><code>yq</code>, <code>ym</code>, <code>my</code></li>
</ul>
<p>A few of the examples are -</p>
<div class="sourceCode" id="cb1289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1289-1"><a href="#cb1289-1" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;19760720&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1976-07-20&quot;</code></pre>
<div class="sourceCode" id="cb1291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1291-1"><a href="#cb1291-1" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">&quot;01.12.2004&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2004-12-01&quot;</code></pre>
<div class="sourceCode" id="cb1293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1293-1"><a href="#cb1293-1" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">&quot;15th of January, 2006&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2006-01-15&quot;</code></pre>
<div class="sourceCode" id="cb1295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1295-1"><a href="#cb1295-1" tabindex="-1"></a><span class="fu">mdy_hm</span>(<span class="st">&quot;August 15th, 1947 at 10:45 PM&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1947-08-15 22:45:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1297-1"><a href="#cb1297-1" tabindex="-1"></a><span class="fu">my</span>(<span class="st">&quot;04-2006&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2006-04-01&quot;</code></pre>
<div class="sourceCode" id="cb1299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1299-1"><a href="#cb1299-1" tabindex="-1"></a><span class="fu">yq</span>(<span class="st">&quot;2024: Quarter 4&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2024-10-01&quot;</code></pre>
<p>To parse date-time from a fraction of year passed, we can use <code>date_decimal()</code>. Example-</p>
<div class="sourceCode" id="cb1301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1301-1"><a href="#cb1301-1" tabindex="-1"></a><span class="fu">date_decimal</span>(<span class="fl">2024.162</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2024-02-29 07:00:28 UTC&quot;</code></pre>
</div>
<div id="parsing-datesdate-times-from-individual-conponents" class="section level3" number="24.2.3">
<h3><span class="header-section-number">24.2.3</span> Parsing dates/date-times from individual conponents</h3>
<p>For the scenario, where we have to create date/date-times we can make use of two functions <code>make_date</code> and <code>make_datetime</code>. Syntax is</p>
<pre><code>make_datetime(
  year = 1970L,
  month = 1L,
  day = 1L,
  hour = 0L,
  min = 0L,
  sec = 0,
  tz = &quot;UTC&quot;
)

make_date(year = 1970L, month = 1L, day = 1L)</code></pre>
<p>Example-</p>
<div class="sourceCode" id="cb1304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1304-1"><a href="#cb1304-1" tabindex="-1"></a><span class="fu">make_date</span>(<span class="at">year =</span> <span class="dv">1947</span>, <span class="at">month =</span> <span class="dv">8</span>, <span class="at">day =</span> <span class="dv">15</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1947-08-15&quot;</code></pre>
</div>
</div>
<div id="extracting-and-setting-datedate-time-components" class="section level2" number="24.3">
<h2><span class="header-section-number">24.3</span> Extracting and setting date/date-time components</h2>
<div id="extraction" class="section level3" number="24.3.1">
<h3><span class="header-section-number">24.3.1</span> Extraction</h3>
<p>We can extract the specific components from date/date-times using, intuitively named accessor functions, which are listed below. Note that in all of these functions the individual date components is in singular; as plural component functions will be used in different context, as we will discuss in Section @ref(perriod).</p>
<ul>
<li><code>year()</code> for Year; <code>isoyear()</code> for ISO 8601 Year</li>
<li><code>semester()</code> for Semester</li>
<li><code>quarter()</code> for Quarter</li>
<li><code>month()</code> for Month</li>
<li><code>week</code> for Week of the year, <code>isoweek()</code> for ISO 8601 Week</li>
<li><code>day</code> for Day of the month, <code>wday()</code> for Day of the week, <code>qday()</code> for Day of the quarter</li>
<li><code>hour()</code>, <code>minute()</code> and <code>second()</code> for Hour, Minute and Second respectively</li>
<li><code>tz()</code> for Time Zone</li>
</ul>
<p>See following examples.</p>
<div class="sourceCode" id="cb1306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1306-1"><a href="#cb1306-1" tabindex="-1"></a><span class="co"># Make an example date</span></span>
<span id="cb1306-2"><a href="#cb1306-2" tabindex="-1"></a>(a_time <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(<span class="dv">999999999</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2001-09-09 01:46:39 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1308-1"><a href="#cb1308-1" tabindex="-1"></a><span class="co"># Extract the DAY of the month</span></span>
<span id="cb1308-2"><a href="#cb1308-2" tabindex="-1"></a><span class="fu">day</span>(a_time)</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<div class="sourceCode" id="cb1310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1310-1"><a href="#cb1310-1" tabindex="-1"></a><span class="co"># Extract Weekday name in full</span></span>
<span id="cb1310-2"><a href="#cb1310-2" tabindex="-1"></a><span class="fu">wday</span>(a_time, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] Sunday
## 7 Levels: Sunday &lt; Monday &lt; Tuesday &lt; Wednesday &lt; Thursday &lt; ... &lt; Saturday</code></pre>
<div class="sourceCode" id="cb1312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1312-1"><a href="#cb1312-1" tabindex="-1"></a><span class="co"># Extract second component</span></span>
<span id="cb1312-2"><a href="#cb1312-2" tabindex="-1"></a><span class="fu">second</span>(a_time)</span></code></pre></div>
<pre><code>## [1] 39</code></pre>
<div class="sourceCode" id="cb1314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1314-1"><a href="#cb1314-1" tabindex="-1"></a><span class="co"># Extract Month name (abbreviated)</span></span>
<span id="cb1314-2"><a href="#cb1314-2" tabindex="-1"></a><span class="fu">month</span>(a_time, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] Sep
## 12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec</code></pre>
<div class="sourceCode" id="cb1316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1316-1"><a href="#cb1316-1" tabindex="-1"></a><span class="co"># Extract week number of the year</span></span>
<span id="cb1316-2"><a href="#cb1316-2" tabindex="-1"></a><span class="fu">week</span>(a_time)</span></code></pre></div>
<pre><code>## [1] 36</code></pre>
<p>Besides above functions, there are a few functions which are helpful in knowing certain characteristics of date/date-time variable. These functions return which logical vectors, are listed as -</p>
<ul>
<li><code>am(x)</code>, <code>pm(x)</code> to know whether the <code>x</code> is in AM or PM, respectively.</li>
<li><code>dst(x)</code> to know whether <code>x</code> is in Daylight savings.</li>
<li><code>leap_year(x)</code> to know whether <code>x</code> is a leap year.</li>
</ul>
<p>Examples-</p>
<div class="sourceCode" id="cb1318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1318-1"><a href="#cb1318-1" tabindex="-1"></a><span class="co"># Is our a_time AM?</span></span>
<span id="cb1318-2"><a href="#cb1318-2" tabindex="-1"></a><span class="fu">am</span>(a_time)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1320-1"><a href="#cb1320-1" tabindex="-1"></a><span class="co"># Is a_time falling in leap year?</span></span>
<span id="cb1320-2"><a href="#cb1320-2" tabindex="-1"></a><span class="fu">leap_year</span>(a_time)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb1322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1322-1"><a href="#cb1322-1" tabindex="-1"></a><span class="co"># Is it during DST?</span></span>
<span id="cb1322-2"><a href="#cb1322-2" tabindex="-1"></a><span class="fu">dst</span>(a_time)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="setting-components" class="section level3" number="24.3.2">
<h3><span class="header-section-number">24.3.2</span> Setting Components</h3>
<p>Just like we used accessor functions to extract the date-time components, we can use those functions to set specific component in date/date-time object/variable. See Example-</p>
<div class="sourceCode" id="cb1324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1324-1"><a href="#cb1324-1" tabindex="-1"></a><span class="co"># Initial variable</span></span>
<span id="cb1324-2"><a href="#cb1324-2" tabindex="-1"></a>a_time</span></code></pre></div>
<pre><code>## [1] &quot;2001-09-09 01:46:39 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1326-1"><a href="#cb1326-1" tabindex="-1"></a><span class="co"># Setting component - Year</span></span>
<span id="cb1326-2"><a href="#cb1326-2" tabindex="-1"></a><span class="fu">year</span>(a_time) <span class="ot">&lt;-</span> <span class="dv">2024</span></span>
<span id="cb1326-3"><a href="#cb1326-3" tabindex="-1"></a><span class="co"># Print modified variable</span></span>
<span id="cb1326-4"><a href="#cb1326-4" tabindex="-1"></a>a_time</span></code></pre></div>
<pre><code>## [1] &quot;2024-09-09 01:46:39 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1328-1"><a href="#cb1328-1" tabindex="-1"></a><span class="co"># Modify Time zone</span></span>
<span id="cb1328-2"><a href="#cb1328-2" tabindex="-1"></a><span class="fu">tz</span>(a_time) <span class="ot">&lt;-</span> <span class="st">&quot;Asia/Kolkata&quot;</span></span>
<span id="cb1328-3"><a href="#cb1328-3" tabindex="-1"></a><span class="co"># print modified variable</span></span>
<span id="cb1328-4"><a href="#cb1328-4" tabindex="-1"></a>a_time</span></code></pre></div>
<pre><code>## [1] &quot;2024-09-09 01:46:39 IST&quot;</code></pre>
<p>Finally, function <code>update</code> can also be used to return a date with the specified elements updated. Example-</p>
<div class="sourceCode" id="cb1330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1330-1"><a href="#cb1330-1" tabindex="-1"></a>EOD <span class="ot">&lt;-</span> <span class="fu">dmy</span>(<span class="st">&quot;31-01-2024&quot;</span>)</span>
<span id="cb1330-2"><a href="#cb1330-2" tabindex="-1"></a>EOD <span class="ot">&lt;-</span> <span class="fu">update</span>(EOD, <span class="at">year =</span> <span class="dv">2020</span>)</span>
<span id="cb1330-3"><a href="#cb1330-3" tabindex="-1"></a>EOD</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-31&quot;</code></pre>
<div class="sourceCode" id="cb1332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1332-1"><a href="#cb1332-1" tabindex="-1"></a><span class="co"># If values are too big, they will roll-over:</span></span>
<span id="cb1332-2"><a href="#cb1332-2" tabindex="-1"></a><span class="fu">update</span>(EOD, <span class="at">month =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-03-02&quot;</code></pre>
</div>
</div>
<div id="time-spans" class="section level2" number="24.4">
<h2><span class="header-section-number">24.4</span> Time spans</h2>
<p>When we subtract a date-time object from another in base R, we get a <code>difftime</code> object, as we have already seen in section @ref(diffftime).</p>
<p>We know that every time/date unit is not same in strict sense. Like leap years may have 366 days whereas others have 365 days. Now there is a concept of leap seconds too. Moreover, certain countries have daylight saving time and thus, every day is not of equal length there. In order to deal with specific and clear requirements on date calculations, there are three different classes in <code>lubridate</code>, as discussed next.</p>
<p>Lubridate has three classes, which may sound similar at first, but are different in their working. These are -</p>
<ul>
<li><code>period</code></li>
<li><code>duration</code></li>
<li><code>interval</code></li>
</ul>
<p>Let us discuss about each one separately.</p>
<div id="perriod" class="section level3" number="24.4.1">
<h3><span class="header-section-number">24.4.1</span> Periods</h3>
<p>The <code>period</code> objects track changes in clock times and ignore time line irregularities. So every time object is of standard length like our clocks.</p>
<p>Period objects can be created in <code>lubridate</code> using <strong>pluralized</strong> date component functions. Example-</p>
<div class="sourceCode" id="cb1334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1334-1"><a href="#cb1334-1" tabindex="-1"></a>(one_year <span class="ot">&lt;-</span> <span class="fu">years</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] &quot;1y 0m 0d 0H 0M 0S&quot;</code></pre>
<div class="sourceCode" id="cb1336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1336-1"><a href="#cb1336-1" tabindex="-1"></a><span class="fu">class</span>(one_year)</span></code></pre></div>
<pre><code>## [1] &quot;Period&quot;
## attr(,&quot;package&quot;)
## [1] &quot;lubridate&quot;</code></pre>
<div class="sourceCode" id="cb1338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1338-1"><a href="#cb1338-1" tabindex="-1"></a><span class="co"># Add one year PERIOD to get a leap year?</span></span>
<span id="cb1338-2"><a href="#cb1338-2" tabindex="-1"></a>a_date <span class="ot">&lt;-</span> <span class="fu">dmy</span>(<span class="st">&quot;01-03-2019&quot;</span>)</span>
<span id="cb1338-3"><a href="#cb1338-3" tabindex="-1"></a>a_date <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-03-01&quot;</code></pre>
</div>
<div id="durations" class="section level3" number="24.4.2">
<h3><span class="header-section-number">24.4.2</span> Durations</h3>
<p>Durations, on the other hand track changes in physical time, i.e. taking into account all the timeline adjusting irregularities. These duration objects can be created in lubridate, by adding <code>d</code> as prefix to all pluralized <code>period</code> objects.</p>
<div class="sourceCode" id="cb1340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1340-1"><a href="#cb1340-1" tabindex="-1"></a>(one_year_duration <span class="ot">&lt;-</span> <span class="fu">dyears</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] &quot;31557600s (~1 years)&quot;</code></pre>
<div class="sourceCode" id="cb1342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1342-1"><a href="#cb1342-1" tabindex="-1"></a><span class="fu">class</span>(one_year_duration)</span></code></pre></div>
<pre><code>## [1] &quot;Duration&quot;
## attr(,&quot;package&quot;)
## [1] &quot;lubridate&quot;</code></pre>
<div class="sourceCode" id="cb1344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1344-1"><a href="#cb1344-1" tabindex="-1"></a><span class="co"># Add one year DURATION to get a leap year date?</span></span>
<span id="cb1344-2"><a href="#cb1344-2" tabindex="-1"></a>a_date <span class="sc">+</span> <span class="fu">dyears</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-02-29 06:00:00 UTC&quot;</code></pre>
</div>
<div id="intervals" class="section level3" number="24.4.3">
<h3><span class="header-section-number">24.4.3</span> Intervals</h3>
<p>The objects of class <code>interval</code> represent <strong>specific</strong> interval on the timeline. In other words, these have a specific start and end date/datetimes. These can be created in lubridate using function <code>interval</code>, which has syntax like -</p>
<pre><code>interval(start = NULL, end = NULL, tzone = tz(start))</code></pre>
<p>This should be clear with the following examples.</p>
<div class="sourceCode" id="cb1347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1347-1"><a href="#cb1347-1" tabindex="-1"></a>(a_interval <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="fu">dmy</span>(<span class="st">&quot;15-08-1947&quot;</span>), <span class="fu">today</span>()))</span></code></pre></div>
<pre><code>## [1] 1947-08-15 UTC--2024-11-29 UTC</code></pre>
<div class="sourceCode" id="cb1349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1349-1"><a href="#cb1349-1" tabindex="-1"></a><span class="fu">class</span>(a_interval)</span></code></pre></div>
<pre><code>## [1] &quot;Interval&quot;
## attr(,&quot;package&quot;)
## [1] &quot;lubridate&quot;</code></pre>
<p>Intervals can also be created using special operator <code>%--%</code>. E.g.</p>
<div class="sourceCode" id="cb1351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1351-1"><a href="#cb1351-1" tabindex="-1"></a>(interval1 <span class="ot">&lt;-</span> <span class="fu">dmy</span>(<span class="st">&quot;15-08-1947&quot;</span>) <span class="sc">%--%</span> <span class="fu">dmy</span>(<span class="st">&quot;26-01-1950&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 1947-08-15 UTC--1950-01-26 UTC</code></pre>
</div>
</div>
<div id="performing-calculations-on-intervalsdates" class="section level2" number="24.5">
<h2><span class="header-section-number">24.5</span> Performing calculations on intervals/dates</h2>
<p>There are a few functions to make our life easier while performing data analysis on temporal fields. These are -</p>
<div id="within-operator" class="section level3" number="24.5.1">
<h3><span class="header-section-number">24.5.1</span> <code>%within%</code> operator</h3>
<p>Operator <code>a %within% b</code> checks whether interval/date-time <code>a</code> falls with interval <code>b</code>. Returns boolean value(s).</p>
<div class="sourceCode" id="cb1353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1353-1"><a href="#cb1353-1" tabindex="-1"></a>interval1 <span class="sc">%within%</span> a_interval</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="backward-intervals" class="section level3" number="24.5.2">
<h3><span class="header-section-number">24.5.2</span> Backward intervals</h3>
<p>Intervals in lubridate can be backwards too. E.g.</p>
<div class="sourceCode" id="cb1355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1355-1"><a href="#cb1355-1" tabindex="-1"></a>(back_interval <span class="ot">&lt;-</span> <span class="fu">dmy</span>(<span class="st">&quot;26-01-2024&quot;</span>) <span class="sc">%--%</span> <span class="fu">dmy</span>(<span class="st">&quot;15-01-2024&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 2024-01-26 UTC--2024-01-15 UTC</code></pre>
</div>
<div id="flipping-intervals" class="section level3" number="24.5.3">
<h3><span class="header-section-number">24.5.3</span> Flipping intervals</h3>
<p>Function <code>int_flip()</code> can flip the interval. E.g.</p>
<div class="sourceCode" id="cb1357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1357-1"><a href="#cb1357-1" tabindex="-1"></a><span class="fu">int_flip</span>(back_interval)</span></code></pre></div>
<pre><code>## [1] 2024-01-15 UTC--2024-01-26 UTC</code></pre>
</div>
<div id="checking-alignment-of-two-intervals" class="section level3" number="24.5.4">
<h3><span class="header-section-number">24.5.4</span> Checking alignment of two intervals</h3>
<p>Function <code>int_aligns</code> tests if two intervals share an endpoint. The direction of each interval is ignored. In other words, it actually tests whether the earliest or latest moments of each interval occur at the same time. E.g.</p>
<div class="sourceCode" id="cb1359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1359-1"><a href="#cb1359-1" tabindex="-1"></a>int1 <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="fu">ymd</span>(<span class="st">&quot;2001-01-01&quot;</span>), <span class="fu">ymd</span>(<span class="st">&quot;2002-01-01&quot;</span>))</span>
<span id="cb1359-2"><a href="#cb1359-2" tabindex="-1"></a>int2 <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="fu">ymd</span>(<span class="st">&quot;2001-06-01&quot;</span>), <span class="fu">ymd</span>(<span class="st">&quot;2002-01-01&quot;</span>))</span>
<span id="cb1359-3"><a href="#cb1359-3" tabindex="-1"></a>int3 <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="fu">ymd</span>(<span class="st">&quot;2003-01-01&quot;</span>), <span class="fu">ymd</span>(<span class="st">&quot;2004-01-01&quot;</span>))</span>
<span id="cb1359-4"><a href="#cb1359-4" tabindex="-1"></a></span>
<span id="cb1359-5"><a href="#cb1359-5" tabindex="-1"></a><span class="fu">int_aligns</span>(int1, int2)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1361-1"><a href="#cb1361-1" tabindex="-1"></a><span class="fu">int_aligns</span>(int1, int3)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="checking-overlap-in-two-intervals" class="section level3" number="24.5.5">
<h3><span class="header-section-number">24.5.5</span> Checking Overlap in two intervals</h3>
<p>Function <code>int_overlaps</code> can test if two intervals overlap each other.</p>
<div class="sourceCode" id="cb1363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1363-1"><a href="#cb1363-1" tabindex="-1"></a><span class="fu">int_overlaps</span>(int1, int2)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="length-of-the-interval" class="section level3" number="24.5.6">
<h3><span class="header-section-number">24.5.6</span> Length of the interval</h3>
<p>Function <code>int_length()</code> can calculate the length of interval and returns a <code>numeric</code> variable equal to the seconds in that interval. E.g.</p>
<div class="sourceCode" id="cb1365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1365-1"><a href="#cb1365-1" tabindex="-1"></a><span class="fu">int_length</span>(back_interval)</span></code></pre></div>
<pre><code>## [1] -950400</code></pre>
</div>
<div id="adding-months-without-exceeding-last-day-of-the-month." class="section level3" number="24.5.7">
<h3><span class="header-section-number">24.5.7</span> Adding Months without exceeding last day of the month.</h3>
<p>Operators <code>%m+%</code> and <code>%m-%</code> will add (or subtract) months to a date without exceeding the last day of the new month. E.g.</p>
<div class="sourceCode" id="cb1367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1367-1"><a href="#cb1367-1" tabindex="-1"></a>(leap <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">&quot;2012-02-29&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2012-02-29&quot;</code></pre>
<div class="sourceCode" id="cb1369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1369-1"><a href="#cb1369-1" tabindex="-1"></a>leap <span class="sc">%m+%</span> <span class="fu">years</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2013-02-28&quot;</code></pre>
<div class="sourceCode" id="cb1371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1371-1"><a href="#cb1371-1" tabindex="-1"></a>leap <span class="sc">%m+%</span> <span class="fu">years</span>(<span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2011-02-28&quot;</code></pre>
<div class="sourceCode" id="cb1373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1373-1"><a href="#cb1373-1" tabindex="-1"></a>leap <span class="sc">%m-%</span> <span class="fu">years</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2011-02-28&quot;</code></pre>
<p>Another Example-</p>
<div class="sourceCode" id="cb1375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1375-1"><a href="#cb1375-1" tabindex="-1"></a>jan <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2010-01-31 03:04:05&quot;</span>)</span>
<span id="cb1375-2"><a href="#cb1375-2" tabindex="-1"></a>jan <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="co"># Feb 31 and April 31 returned as NA</span></span></code></pre></div>
<pre><code>## [1] NA                        &quot;2010-03-31 03:04:05 UTC&quot;
## [3] NA</code></pre>
<div class="sourceCode" id="cb1377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1377-1"><a href="#cb1377-1" tabindex="-1"></a><span class="co"># NA &quot;2010-03-31 03:04:05 UTC&quot; NA</span></span>
<span id="cb1377-2"><a href="#cb1377-2" tabindex="-1"></a>jan <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="co"># No rollover</span></span></code></pre></div>
<pre><code>## [1] &quot;2010-02-28 03:04:05 UTC&quot; &quot;2010-03-31 03:04:05 UTC&quot;
## [3] &quot;2010-04-30 03:04:05 UTC&quot;</code></pre>
</div>
<div id="adding-with-rollback" class="section level3" number="24.5.8">
<h3><span class="header-section-number">24.5.8</span> Adding with Rollback</h3>
<p>One more function <code>add_with_rollback()</code> which performs similarly, but has more control due to specific syntax-</p>
<pre><code>add_with_rollback(e1, e2, roll_to_first = FALSE, preserve_hms = TRUE)</code></pre>
<p>Example-</p>
<div class="sourceCode" id="cb1380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1380-1"><a href="#cb1380-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2019-01-29 01:02:03&quot;</span>)</span>
<span id="cb1380-2"><a href="#cb1380-2" tabindex="-1"></a><span class="fu">add_with_rollback</span>(x, <span class="fu">months</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2019-02-28 01:02:03 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1382-1"><a href="#cb1382-1" tabindex="-1"></a><span class="fu">add_with_rollback</span>(x, <span class="fu">months</span>(<span class="dv">1</span>), <span class="at">preserve_hms =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2019-02-28 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1384-1"><a href="#cb1384-1" tabindex="-1"></a><span class="fu">add_with_rollback</span>(x, <span class="fu">months</span>(<span class="dv">1</span>), <span class="at">roll_to_first =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2019-03-01 01:02:03 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1386-1"><a href="#cb1386-1" tabindex="-1"></a><span class="fu">add_with_rollback</span>(x, <span class="fu">months</span>(<span class="dv">1</span>), <span class="at">roll_to_first =</span> <span class="cn">TRUE</span>, <span class="at">preserve_hms =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2019-03-01 UTC&quot;</code></pre>
</div>
<div id="coercing-one-time-span-unit-to-another" class="section level3" number="24.5.9">
<h3><span class="header-section-number">24.5.9</span> Coercing one time span unit to another</h3>
<p>Time-span objects in lubridate can be coerced from one to another using coercing functions,</p>
<ul>
<li><code>as.period(x, unit)</code></li>
<li><code>as.duration(x)</code></li>
<li><code>as.interval(x, start)</code></li>
<li><code>make_difftime(x)</code></li>
</ul>
<p>Examples-</p>
<div class="sourceCode" id="cb1388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1388-1"><a href="#cb1388-1" tabindex="-1"></a><span class="co"># With Period - clock time</span></span>
<span id="cb1388-2"><a href="#cb1388-2" tabindex="-1"></a>(per <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">31</span>))</span></code></pre></div>
<pre><code>## [1] &quot;31d 0H 0M 0S&quot;</code></pre>
<div class="sourceCode" id="cb1390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1390-1"><a href="#cb1390-1" tabindex="-1"></a>(int1 <span class="ot">&lt;-</span> <span class="fu">as.interval</span>(per, <span class="fu">dmy</span>(<span class="st">&quot;01022020&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] 2020-02-01 UTC--2020-03-03 UTC</code></pre>
<div class="sourceCode" id="cb1392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1392-1"><a href="#cb1392-1" tabindex="-1"></a><span class="co"># With Duration - physical time</span></span>
<span id="cb1392-2"><a href="#cb1392-2" tabindex="-1"></a>(dur <span class="ot">&lt;-</span> <span class="fu">ddays</span>(<span class="dv">31</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2678400s (~4.43 weeks)&quot;</code></pre>
<div class="sourceCode" id="cb1394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1394-1"><a href="#cb1394-1" tabindex="-1"></a>(int2 <span class="ot">&lt;-</span> <span class="fu">as.interval</span>(dur, <span class="fu">dmy</span>(<span class="st">&quot;01022020&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] 2020-02-01 UTC--2020-03-03 UTC</code></pre>
</div>
</div>
<div id="rounding-date-time-variables" class="section level2" number="24.6">
<h2><span class="header-section-number">24.6</span> Rounding date-time variables</h2>
<p>There are dedicated functions to round the dates as per specific requirements.</p>
<ul>
<li><code>floor_date()</code> takes a date-time object and rounds it down to the nearest boundary of the specified time unit.</li>
<li><code>ceiling_date()</code> takes a date-time object and rounds it up to the nearest boundary of the specified time unit.</li>
<li><code>round_date()</code> takes a date-time object and time unit, and rounds it to the nearest value of the specified time unit.</li>
</ul>
<p>Examples-</p>
<div class="sourceCode" id="cb1396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1396-1"><a href="#cb1396-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2009-08-03 12:01:59.23&quot;</span>)</span>
<span id="cb1396-2"><a href="#cb1396-2" tabindex="-1"></a><span class="fu">round_date</span>(x, <span class="st">&quot;month&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2009-08-01 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1398-1"><a href="#cb1398-1" tabindex="-1"></a><span class="fu">round_date</span>(x, <span class="st">&quot;week&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2009-08-02 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1400-1"><a href="#cb1400-1" tabindex="-1"></a><span class="fu">floor_date</span>(x, <span class="st">&quot;day&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2009-08-03 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1402-1"><a href="#cb1402-1" tabindex="-1"></a><span class="fu">ceiling_date</span>(x, <span class="st">&quot;month&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2009-09-01 UTC&quot;</code></pre>
<p>Three other functions helps rolling a date forward or backwards, as</p>
<ul>
<li><code>rollbackward()</code> changes a date to the last day of the previous month or to the first day of the month.</li>
<li><code>rollforward()</code> rolls to the last day of the current month or to the first day of the next month. Optionally, the new date can retain the same hour, minute, and second information.</li>
<li><code>rollback()</code> is a synonym for <code>rollbackward()</code>.</li>
</ul>
<p>See these examples-</p>
<div class="sourceCode" id="cb1404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1404-1"><a href="#cb1404-1" tabindex="-1"></a>date <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">&quot;2010-03-03 12:44:22&quot;</span>)</span>
<span id="cb1404-2"><a href="#cb1404-2" tabindex="-1"></a></span>
<span id="cb1404-3"><a href="#cb1404-3" tabindex="-1"></a><span class="fu">rollbackward</span>(date)</span></code></pre></div>
<pre><code>## [1] &quot;2010-02-28 12:44:22 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1406-1"><a href="#cb1406-1" tabindex="-1"></a><span class="fu">rollbackward</span>(date, <span class="at">roll_to_first =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-03-01 12:44:22 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1408-1"><a href="#cb1408-1" tabindex="-1"></a><span class="fu">rollbackward</span>(date, <span class="at">preserve_hms =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-02-28 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1410-1"><a href="#cb1410-1" tabindex="-1"></a><span class="fu">rollbackward</span>(date, <span class="at">roll_to_first =</span> <span class="cn">TRUE</span>, <span class="at">preserve_hms =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-03-01 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1412-1"><a href="#cb1412-1" tabindex="-1"></a><span class="fu">rollforward</span>(date)</span></code></pre></div>
<pre><code>## [1] &quot;2010-03-31 12:44:22 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1414-1"><a href="#cb1414-1" tabindex="-1"></a><span class="fu">rollforward</span>(date, <span class="at">roll_to_first =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2010-04-01 12:44:22 UTC&quot;</code></pre>
</div>
<div id="representing-date-and-date-times-in-cutomised-formats" class="section level2" number="24.7">
<h2><span class="header-section-number">24.7</span> Representing date and date-times in cutomised formats</h2>
<p>In all of the above sections, we saw that once R recognises a temporal object, it depicts that objects in a uniform format. See</p>
<div class="sourceCode" id="cb1416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1416-1"><a href="#cb1416-1" tabindex="-1"></a>(date1 <span class="ot">&lt;-</span> <span class="fu">dmy</span>(<span class="st">&quot;01-01-2020&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01&quot;</code></pre>
<div class="sourceCode" id="cb1418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1418-1"><a href="#cb1418-1" tabindex="-1"></a>(date2 <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">&quot;2020/01/01&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01&quot;</code></pre>
<div class="sourceCode" id="cb1420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1420-1"><a href="#cb1420-1" tabindex="-1"></a><span class="fu">as.character</span>(date1)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01&quot;</code></pre>
<p>In the output/console all dates print like a character/string. However, sometimes requirement is to have print dates in a specific customised format. In this scenario, function <code>strftime()</code> comes to our rescue which converts objects of classes “POSIXlt” and “POSIXct” representing calendar dates and times to specific character representation. Character codes can be used from the table @ref(tab:lubri001) in section @ref(strpp).</p>
<p>See following examples-</p>
<div class="sourceCode" id="cb1422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1422-1"><a href="#cb1422-1" tabindex="-1"></a><span class="fu">strftime</span>(<span class="fu">Sys.Date</span>(), <span class="at">format =</span> <span class="st">&quot;%d %B %Y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;29 November 2024&quot;</code></pre>
<p>In this context, let’s also discuss about a special date stamping function in <code>lubridate</code> which can format date/time outputs based on human friendly formats. Functions <code>stamp()</code>, <code>stamp_date</code> and <code>stamp_time()</code> will create a function from the given template, which can be applied to date/time objects to re-format them. Example-</p>
<div class="sourceCode" id="cb1424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1424-1"><a href="#cb1424-1" tabindex="-1"></a>eclipse_dates <span class="ot">&lt;-</span> <span class="fu">dmy</span>(<span class="fu">c</span>(<span class="st">&quot;11-7-2010&quot;</span>, <span class="st">&quot;13-11-2012&quot;</span>, <span class="st">&quot;3-11-2013&quot;</span>))</span>
<span id="cb1424-2"><a href="#cb1424-2" tabindex="-1"></a>eclipse_stamp <span class="ot">&lt;-</span> <span class="fu">stamp_date</span>(<span class="st">&quot;There was a solar eclipse on January 13th, 1999&quot;</span>)</span>
<span id="cb1424-3"><a href="#cb1424-3" tabindex="-1"></a><span class="fu">eclipse_stamp</span>(eclipse_dates)</span></code></pre></div>
<pre><code>## [1] &quot;There was a solar eclipse on July 11th, 2010&quot;    
## [2] &quot;There was a solar eclipse on November 13th, 2012&quot;
## [3] &quot;There was a solar eclipse on November 03th, 2013&quot;</code></pre>
</div>
<div id="dates-in-ggplot2-visualisations" class="section level2" number="24.8">
<h2><span class="header-section-number">24.8</span> Dates in GGPLOT2 visualisations</h2>
<p>Before concluding the chapter on date and time variables, it is important to learn the related functions to deal with impact of date and time formats on visualisations. Since we have already seen that, date and date-time variables are actually continuous variables with labels depicted in a specific formats, we have two <code>scale</code> functions in ggplot2 to deal with -</p>
<ul>
<li><code>scale_x_date()</code></li>
<li><code>scale_x_datetime()</code></li>
</ul>
<p>In these functions, we have <code>date_breaks</code> and <code>date_minor_breaks</code> arguments to position the breaks by date units. E.g. <code>date_breaks = "6 months"</code> will place major tick mark every six months.</p>
<p>Using another argument <code>date_labels</code> we can control the display of the labels in the plots. The values of the argument may be in <code>strptime</code> formats as we have already seen in @ref(tab:lubri001) above.</p>
<p>Example-</p>
<div class="sourceCode" id="cb1426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1426-1"><a href="#cb1426-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1426-2"><a href="#cb1426-2" tabindex="-1"></a></span>
<span id="cb1426-3"><a href="#cb1426-3" tabindex="-1"></a>economics <span class="sc">%&gt;%</span> </span>
<span id="cb1426-4"><a href="#cb1426-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, uempmed)) <span class="sc">+</span></span>
<span id="cb1426-5"><a href="#cb1426-5" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1426-6"><a href="#cb1426-6" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">&quot;%Y&quot;</span>, </span>
<span id="cb1426-7"><a href="#cb1426-7" tabindex="-1"></a>               <span class="at">date_breaks =</span> <span class="st">&quot;5 years&quot;</span>, </span>
<span id="cb1426-8"><a href="#cb1426-8" tabindex="-1"></a>               <span class="at">date_minor_breaks =</span> <span class="st">&quot;1 year&quot;</span>) <span class="sc">+</span></span>
<span id="cb1426-9"><a href="#cb1426-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/unnamed-chunk-417-1.png" alt="Use of Date Time Scale in ggplot2" width="672" />
<p class="caption">
(#fig:unnamed-chunk-417)Use of Date Time Scale in ggplot2
</p>
</div>
<hr />
<!--chapter:end:12-8Lubridate.Rmd-->
</div>
</div>
<div id="time-series-analysis" class="section level1" number="25">
<h1><span class="header-section-number">25</span> Time Series Analysis</h1>
<p>Time series analysis is an essential technique for forecasting and analyzing trends in data over time. It is commonly used in various fields like finance, economics, and engineering.</p>
<p>So a question arises, what is a time series? A time series is a sequence of data points collected over time, where the observations are recorded in chronological order. Time series analysis involves analyzing and modeling these data points to understand patterns, trends, and make predictions about future values. It is therefore used in predictive as well as descriptive analysis.</p>
<p>Time Series Analysis plays an important role in audit analytics as well. A few of the use cases can be-</p>
<ul>
<li><strong>Revenue Analysis:</strong> An auditor may analyze revenue data over time to identify irregularities or suspicious patterns that could indicate potential fraud or misstatement. By examining the revenue time series, the auditor can look for unexpected fluctuations, unusual growth or decline trends, or abnormal seasonality. Deviations from historical patterns or industry benchmarks may indicate fraudulent activities, such as revenue manipulation, fictitious transactions, or irregular recognition practices.</li>
<li><strong>Inventory Analysis:</strong> Auditors often analyze inventory data to assess the adequacy of inventory levels, identify potential inventory obsolescence or shrinkage, and evaluate the efficiency of inventory management. Time series analysis can be valuable in understanding inventory patterns and identifying potential risks or anomalies.</li>
</ul>
<p>There are several time series data which are loaded by default in R; a few of these are listed below. We will use these datasets to understand the various concepts related to time series analysis.</p>
<ul>
<li><code>AirPassengers</code> containing monthly airline passenger numbers from 1949-1960. See figure @ref(fig:tsex) (a)</li>
<li><code>Nile</code> contains flow of Nile river data. See figure @ref(fig:tsex) (b)</li>
<li><code>sunspots</code> containing monthly sunspot numbers from 1749-1983. See figure @ref(fig:tsex) (c)</li>
<li><code>JohnsonJohnson</code> which contains quarterly earnings per Johnson &amp; Johnson share. See figure @ref(fig:tsex) (d)</li>
</ul>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/tsex-1.png" alt="Few time series data sets in R" width="672" />
<p class="caption">
(#fig:tsex)Few time series data sets in R
</p>
</div>
<p>To analyse any time series, we have to understand its different components.</p>
<div id="components-of-time-series" class="section level2" number="25.1">
<h2><span class="header-section-number">25.1</span> Components of Time series</h2>
<p>A time series can be decomposed into several components:</p>
<ul>
<li><strong>Level:</strong> The baseline value or average of the series over time. It represents the long-term behavior of the series. This is basic component, and is always present in a time series object. E.g. In a straight horizontal line only level is there which is equal to the value of y intercept.</li>
<li><strong>Trend:</strong> The overall direction of the series. It indicates whether the series is increasing, decreasing, or staying relatively constant over time. E.g. A clear increasing trend can be seen in Johnson &amp; Johnson earnings, in Figure @ref(fig:tsex) (d).</li>
<li><strong>Seasonality:</strong> The repetitive and predictable patterns within the series that occur at regular intervals. Seasonality can be daily, weekly, monthly, quarterly, or yearly, etc. E.g. In figure @ref(fig:tsex) (d) we may see seasonal patterns in earnings of Johnson&amp;Johnson share.</li>
<li><strong>Errors (Residuals):</strong> The random fluctuations or noise in the series that cannot be explained by the level, trend, or seasonality. E.g. See figure @ref(fig:tsex) (c). The error component is an important aspect of time series analysis because it provides information about the uncertainty and variability of the data.</li>
</ul>
</div>
<div id="additive-or-multiplicative-components" class="section level2" number="25.2">
<h2><span class="header-section-number">25.2</span> Additive or multiplicative components</h2>
<p>In time series analysis, the trend, seasonal, and residual components can be modeled as either additive or multiplicative. The choice of the model depends on how the components combine to create the observed values of the series.</p>
<p>An <strong>additive model</strong> assumes that the components of the time series are added together to create the observed values. In other words, the value of the time series at any point in time is equal to the sum of the trend, seasonal, and residual components at that point in time. This is expressed mathematically as:</p>
<p><span class="math display">\[
y_t = T_t + S_t + e_t
\]</span></p>
<p>where <span class="math inline">\(y_t\)</span>, <span class="math inline">\(T_t\)</span>, <span class="math inline">\(S_t\)</span> and <span class="math inline">\(e_t\)</span> are the values of the series, trend component, seasonal component and residuals, respectively at time <span class="math inline">\(t\)</span>.</p>
<p>A <strong>multiplicative model</strong>, on the other hand, assumes that the components of the time series are multiplied together to create the observed values. In other words, the value of the time series at any point in time is equal to the product of the trend, seasonal, and residual components at that point in time. This is expressed mathematically as:</p>
<p><span class="math display">\[
y_t = T_t \times S_t \times e_t
\]</span></p>
<p>where <span class="math inline">\(y_t\)</span>, <span class="math inline">\(T_t\)</span>, <span class="math inline">\(S_t\)</span> and <span class="math inline">\(e_t\)</span> are defined as before. We can convert multiplicative time series into additive time series by taking <span class="math inline">\(log\)</span>. Note that seasonal component in <code>AirPassengers</code> time series depicted in @ref(fig:tsex) (a) is multiplicative. See Figure @ref(fig:logts).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/logts-1.png" alt="Transforming Time Series" width="49%" /><img src="DauR_files/figure-html/logts-2.png" alt="Transforming Time Series" width="49%" />
<p class="caption">
(#fig:logts)Transforming Time Series
</p>
</div>
<p>We will learn about decomposing time series components in next sections.</p>
<p><strong>Damped Trends:</strong> Gardner and Mckenzie, in 1985<span class="citation"><a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a></span> observed that most time series methods assume that any trend will continue unabated, regardless of the forecast lead time. They, based on empirical findings, suggested that forecast accuracy can be improved by either damping or ignoring altogether trends which have a low probability of persistence. We will learn about this concept, as well in next sections.</p>
</div>
<div id="practical-examples-in-r" class="section level2" number="25.3">
<h2><span class="header-section-number">25.3</span> Practical examples in R</h2>
<p>Before analysing time series, in R let’s see how time series objects are dealt in R.</p>
<div id="pre-requisites" class="section level3 unnumbered">
<h3 class="unnumbered">Pre-requisites</h3>
<p>Though most of the time we will be using base R, yet <code>forecast</code> is a fabulous package in R, developed by <strong>Rob Hyndman</strong>, which we will be using for predicting. Predicting values help us understand how well we have captured the hidden trends and patterns in any time series.</p>
<div class="sourceCode" id="cb1427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1427-1"><a href="#cb1427-1" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1427-2"><a href="#cb1427-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
</div>
<div id="creating-a-time-series-object-in-r" class="section level3" number="25.3.1">
<h3><span class="header-section-number">25.3.1</span> Creating a time series object in R</h3>
<p>R provides us a simple function <code>ts()</code> to convert a series of observations (basically a vector) into a specific time series object. The syntax is -</p>
<pre><code>ts(data, 
  start = 1, 
  end = numeric(length(data)), 
  frequency = 1, 
  ...)</code></pre>
<p>where:</p>
<ul>
<li><code>data</code>: a numeric vector or matrix containing the data for the time series</li>
<li><code>start</code>: the start time of the time series, represented as either a numeric or a Date or POSIXct object</li>
<li><code>end</code>: the end time of the time series, represented as either a numeric or a Date or POSIXct object</li>
<li><code>frequency</code>: the number of observations per unit time for the time series. For example, if the data is recorded monthly, the frequency would be 12</li>
<li><code>...</code>: additional arguments that can be passed to the function, such as <code>names</code>, <code>delim</code>, or <code>tsp</code> (time series start and end points)</li>
</ul>
<p>Example-1: Let’s create a time series.</p>
<div class="sourceCode" id="cb1429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1429-1"><a href="#cb1429-1" tabindex="-1"></a><span class="co"># Create a numeric vector representing monthly sales data for a year</span></span>
<span id="cb1429-2"><a href="#cb1429-2" tabindex="-1"></a>sales <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">25</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">45</span>, <span class="dv">50</span>, <span class="dv">55</span>, <span class="dv">60</span>, <span class="dv">65</span>, <span class="dv">70</span>)</span>
<span id="cb1429-3"><a href="#cb1429-3" tabindex="-1"></a></span>
<span id="cb1429-4"><a href="#cb1429-4" tabindex="-1"></a><span class="co"># Create a time series object with monthly frequency starting from January</span></span>
<span id="cb1429-5"><a href="#cb1429-5" tabindex="-1"></a>sales_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(sales, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">4</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb1429-6"><a href="#cb1429-6" tabindex="-1"></a></span>
<span id="cb1429-7"><a href="#cb1429-7" tabindex="-1"></a><span class="co"># Print the time series object</span></span>
<span id="cb1429-8"><a href="#cb1429-8" tabindex="-1"></a>sales_ts</span></code></pre></div>
<pre><code>##      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
## 2022              10  20  30  25  35  40  45  50  55
## 2023  60  65  70</code></pre>
<p>We can check its class.</p>
<div class="sourceCode" id="cb1431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1431-1"><a href="#cb1431-1" tabindex="-1"></a><span class="fu">class</span>(sales_ts)</span></code></pre></div>
<pre><code>## [1] &quot;ts&quot;</code></pre>
<p>Let’s also check <code>Nile</code>, which is already available in base R.</p>
<div class="sourceCode" id="cb1433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1433-1"><a href="#cb1433-1" tabindex="-1"></a>Nile</span></code></pre></div>
<pre><code>## Time Series:
## Start = 1871 
## End = 1970 
## Frequency = 1 
##   [1] 1120 1160  963 1210 1160 1160  813 1230 1370 1140  995  935 1110  994 1020
##  [16]  960 1180  799  958 1140 1100 1210 1150 1250 1260 1220 1030 1100  774  840
##  [31]  874  694  940  833  701  916  692 1020 1050  969  831  726  456  824  702
##  [46] 1120 1100  832  764  821  768  845  864  862  698  845  744  796 1040  759
##  [61]  781  865  845  944  984  897  822 1010  771  676  649  846  812  742  801
##  [76] 1040  860  874  848  890  744  749  838 1050  918  986  797  923  975  815
##  [91] 1020  906  901 1170  912  746  919  718  714  740</code></pre>
</div>
<div id="plotting-time-series-objects" class="section level3" number="25.3.2">
<h3><span class="header-section-number">25.3.2</span> Plotting Time Series Objects</h3>
<p>To plot <code>ts</code> object we can simply use <code>plot()</code> command or alternatively we can use <code>ggplot2</code> as well.</p>
<div class="sourceCode" id="cb1435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1435-1"><a href="#cb1435-1" tabindex="-1"></a><span class="co"># Plotting in base R</span></span>
<span id="cb1435-2"><a href="#cb1435-2" tabindex="-1"></a><span class="fu">plot</span>(sales_ts, <span class="at">main =</span> <span class="st">&quot;Sales during FY 2022-23</span><span class="sc">\n</span><span class="st">Dummy Data by author&quot;</span>)</span>
<span id="cb1435-3"><a href="#cb1435-3" tabindex="-1"></a></span>
<span id="cb1435-4"><a href="#cb1435-4" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">autoplot</span>(AirPassengers) <span class="sc">+</span></span>
<span id="cb1435-5"><a href="#cb1435-5" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="st">&#39;Logrithmic values&#39;</span>) <span class="sc">+</span></span>
<span id="cb1435-6"><a href="#cb1435-6" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;AirPassengers converted to additive&#39;</span>) <span class="sc">+</span></span>
<span id="cb1435-7"><a href="#cb1435-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/tsex2-1.png" alt="Example of time series plotting in R; Base R (Left) and ggplot2 (Right)" width="48%" /><img src="DauR_files/figure-html/tsex2-2.png" alt="Example of time series plotting in R; Base R (Left) and ggplot2 (Right)" width="48%" />
<p class="caption">
(#fig:tsex2)Example of time series plotting in R; Base R (Left) and ggplot2 (Right)
</p>
</div>
<p><em>Note: Library <code>forecast</code> in R also provides us a function <code>autoplot()</code> which plots a time series object, similar to plot(), but the plot returned here is a <code>ggplot2</code> object which can be modified/fine-tuned using <code>ggplot2</code> functions.</em></p>
</div>
</div>
<div id="time-series-modelling-and-forecasting" class="section level2" number="25.4">
<h2><span class="header-section-number">25.4</span> Time series modelling and forecasting</h2>
<p>As we have already discussed, forecasting future plays an important part of time series analysis; an important prerequisite is to model our data. In fact, the forecasting/modelling techniques can be broadly classified into two categories, data based techniques and model-based techniques.</p>
<div id="data-based-techniques" class="section level3 unnumbered">
<h3 class="unnumbered">Data-based techniques</h3>
<p>Data-based techniques, also known as statistical or empirical techniques, focus on analyzing the patterns and characteristics of the observed time series data directly. These techniques do not explicitly assume a specific underlying model structure. Instead, they rely on statistical properties and patterns present in the data. Examples of data-based techniques include:</p>
</div>
<div id="naive-method" class="section level3" number="25.4.1">
<h3><span class="header-section-number">25.4.1</span> Naive method</h3>
<p>This method assumes that the future value will be the same as the last observed value. This is the simplest and most basic forecasting method and hence named <em>naive</em>. The formula for the naive method is:</p>
<p><span class="math display">\[
\text{Naive method: }\hat{Y}_{T+1} = Y_T
\]</span></p>
<p>Here, <span class="math inline">\(\hat{Y}_{T+1}\)</span> is the forecast value for the next time period and <span class="math inline">\(Y_T\)</span> is the last observed value i.e. for a series of <span class="math inline">\(T\)</span> observations. Thus, predicting future values using naive method require no special skill.</p>
<p><strong>Problem Statement-1:</strong> Let’s predict say 5, future values of Nile flow data. In <code>forecast</code> there is a function <code>naive</code> which will do the job, once we give the value of parameter <code>h</code> which is short for forecasting <strong>h</strong>orizon. In Figure @ref(fig:naive), we can see forecast values, in red, which are exactly same as previous/last value.</p>
<div class="sourceCode" id="cb1436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1436-1"><a href="#cb1436-1" tabindex="-1"></a>forecast<span class="sc">::</span><span class="fu">naive</span>(Nile, <span class="at">h =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1436-2"><a href="#cb1436-2" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb1436-3"><a href="#cb1436-3" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1436-4"><a href="#cb1436-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Nile flow - forecast by Naive method&quot;</span>,</span>
<span id="cb1436-5"><a href="#cb1436-5" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/naive-1.png" alt="Naive forecasting" width="98%" />
<p class="caption">
(#fig:naive)Naive forecasting
</p>
</div>
<p>If we aren’t interested in visualising confidence values (by default 80% and 95% confidence values are shown in bands), we can tune parameter <code>level</code> accordingly.</p>
</div>
<div id="moving-averages" class="section level3" number="25.4.2">
<h3><span class="header-section-number">25.4.2</span> Moving averages</h3>
<p>In this technique, the forecast value is computed as the average of the most recent observations within a sliding window of fixed length, say <span class="math inline">\(n\)</span>.. It is a technique to smooth out a time series by averaging neighboring values. It helps in reducing noise and revealing underlying trends.</p>
<p>The formula for the moving average method is:</p>
<p><span class="math display">\[
\hat{Y}_{t+1} = \frac{1}{n}(Y_t + Y_{t-1} + ... + Y_{t-n+1})
\]</span></p>
<p>Here, <span class="math inline">\(\hat{Y}_{t+1}\)</span> is the forecast value for the next time period and <span class="math inline">\(Y_t\)</span>, <span class="math inline">\(Y_{t-1}\)</span>, …, <span class="math inline">\(Y_{t-n+1}\)</span> are the past <span class="math inline">\(n\)</span> observations.</p>
<p>Smoothing through moving average can either be <strong>centre-weighted</strong> or <strong>tailed-weighted</strong>. In former, <span class="math inline">\(k\)</span> i.e. <code>order</code> of the moving average, should be an odd number because each data point is replaced with the mean of that observation and <span class="math inline">\((k-1)/2\)</span> observations before and <span class="math inline">\((k-1)/2\)</span> observations after it. Smoothed time series <code>Nile</code> for different <code>k</code> can be seen in Figure @ref(fig:ma).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/ma-1.png" alt="Simple Moving Averages" width="672" />
<p class="caption">
(#fig:ma)Simple Moving Averages
</p>
</div>
<p><strong>Problem Statement-2:</strong> Let’s try to visualise moving average trend in Nile data. We will use <code>ma</code> function from <code>forecast</code> for this. In left side Figure of @ref(fig:ma1) we have a smoother (with k = 7) time series and 10 forecast values using last value of moving average.</p>
<p>We can also use <code>rollmean</code> function from <code>zoo</code> library, which is another package to analyse time series objects. Refer right-side figure in @ref(fig:ma1). In this example, we have used <code>wineind</code> data/time series which shows <em>Australian total wine sales by wine makers in bottles &lt;= 1 litre. Jan 1980 – Aug 1994.</em> One of the advantage using this method, is that we can see both original and smoothed time series.</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/ma1-1.png" alt="Simple Moving averages" width="48%" /><img src="DauR_files/figure-html/ma1-2.png" alt="Simple Moving averages" width="48%" />
<p class="caption">
(#fig:ma1)Simple Moving averages
</p>
</div>
</div>
<div id="exponential-smoothing" class="section level3" number="25.4.3">
<h3><span class="header-section-number">25.4.3</span> Exponential smoothing</h3>
<p>Exponential smoothing techniques update forecasts based on weighted averages of past observations, giving more weight to recent observations. Examples include simple exponential smoothing, Holt’s method, and Holt-Winters’ method.</p>
<p>As the name suggests simple exponential smoothing or SES is simplest of these. <strong>Simple exponential smoothing (SES)</strong> is actually a moving weighted average where recent observations are given more weights while calculating averages. <em>This method is suitable for forecasting data with no clear trend or seasonal pattern.</em></p>
<p><span class="math display">\[
\hat{y}_{T+1} = \alpha{y_T} + \alpha(1- \alpha){y_{T-1}} + \alpha(1 - \alpha)^2{y_{T-2}} + ...
\]</span></p>
<p>The value of <span class="math inline">\(\alpha\)</span>, the smoothing parameter, in above equation should follow <span class="math inline">\(0 \le \alpha \le 1\)</span>. Clearly different values of <span class="math inline">\(\alpha\)</span> will give different smoothing and we will have to adopt most suitable one, one such example with <span class="math inline">\(\alpha = 0.1\)</span> is shown in the Figure @ref(fig:ses1) (Left).</p>
<p>Holt extended SES by introducing trend component and thus a new smoothing parameter for trend <span class="math inline">\(\beta\)</span>. The method is also named after him as <strong>Holt’s Linear Method</strong> of exponential smoothing. Now there are are two equations, mathematically.</p>
<p><span class="math display">\[
\begin{aligned}
\hat{y}_{t+h|t} &amp;= l_t + hb_t \\
l_t &amp;= \alpha y_t + (1-\alpha)(l_{t-1} + b_{t-1}) \\
b_t &amp;= \beta(l_t - l_{t-1}) + (1-\beta)b_{t-1}
\end{aligned}
\]</span></p>
<p><span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> (again <span class="math inline">\(0 \le \beta \le 1\)</span>) in above equations are smoothing parameters for level and trend components, respectively; and <span class="math inline">\(h\)</span> is forecast horizon. Also, <span class="math inline">\(y_t\)</span> is the actual value, <span class="math inline">\(l_t\)</span> is the level (or intercept), <span class="math inline">\(b_t\)</span> is the trend (or slope) of the time series at time <span class="math inline">\(t\)</span>. Refer @ref(fig:ses1) (Right).</p>
<p>To apply <em>SES</em>, in R, we can use function <code>ses</code> and for applying <em>Holt’s</em> smoothing, we can use <code>holt</code>; both from <code>forecast</code> library. Example usages are as follows.</p>
<div class="sourceCode" id="cb1437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1437-1"><a href="#cb1437-1" tabindex="-1"></a>lynxses <span class="ot">&lt;-</span> <span class="fu">ses</span>(lynx, <span class="at">h=</span> <span class="dv">10</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>)</span>
<span id="cb1437-2"><a href="#cb1437-2" tabindex="-1"></a>holtfit <span class="ot">&lt;-</span> <span class="fu">holt</span>(airmiles, <span class="at">h =</span> <span class="dv">10</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">beta =</span> <span class="fl">0.1</span>)</span>
<span id="cb1437-3"><a href="#cb1437-3" tabindex="-1"></a></span>
<span id="cb1437-4"><a href="#cb1437-4" tabindex="-1"></a><span class="fu">autoplot</span>(lynxses) <span class="sc">+</span></span>
<span id="cb1437-5"><a href="#cb1437-5" tabindex="-1"></a>  <span class="fu">autolayer</span>(lynxses<span class="sc">$</span>fitted) <span class="sc">+</span></span>
<span id="cb1437-6"><a href="#cb1437-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">&#39;SES with alpha = 0.1 : Lynx data&#39;</span>) <span class="sc">+</span></span>
<span id="cb1437-7"><a href="#cb1437-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1437-8"><a href="#cb1437-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb1437-9"><a href="#cb1437-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1437-10"><a href="#cb1437-10" tabindex="-1"></a></span>
<span id="cb1437-11"><a href="#cb1437-11" tabindex="-1"></a><span class="fu">autoplot</span>(holtfit) <span class="sc">+</span></span>
<span id="cb1437-12"><a href="#cb1437-12" tabindex="-1"></a>  <span class="fu">autolayer</span>(holtfit<span class="sc">$</span>fitted) <span class="sc">+</span></span>
<span id="cb1437-13"><a href="#cb1437-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">&quot;Holt&#39;s Linear Trend method with beta = 0.1 : AirMiles data&quot;</span>) <span class="sc">+</span></span>
<span id="cb1437-14"><a href="#cb1437-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1437-15"><a href="#cb1437-15" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb1437-16"><a href="#cb1437-16" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/ses1-1.png" alt="Simple Exponential Smoothing (Left) Vs. Holt's Linear Method (Right)" width="49%" /><img src="DauR_files/figure-html/ses1-2.png" alt="Simple Exponential Smoothing (Left) Vs. Holt's Linear Method (Right)" width="49%" />
<p class="caption">
(#fig:ses1)Simple Exponential Smoothing (Left) Vs. Holt’s Linear Method (Right)
</p>
</div>
<p>As we have discussed earlier, damped trends work better many times. So based on Mckenzie and gardner work, an additional dampening paramater <span class="math inline">\(\phi\)</span> was introduced. The equations were modified as -
<span class="math display">\[
\begin{aligned}
\hat{y}_{t+h|t} &amp;= l_t + (\phi + \phi^2 + ... + \phi^h)b_t \\
l_t &amp;= \alpha y_t + (1-\alpha)(l_{t-1} + \phi b_{t-1}) \\
b_t &amp;= \beta(l_t - l_{t-1}) + (1-\beta)\phi b_{t-1}
\end{aligned}
\]</span></p>
<p>Clearly, if <span class="math inline">\(\phi = 1\)</span>, the above equations are equivalent to Holt’s Linear Method. <span class="math inline">\(\phi\)</span> for values <span class="math inline">\(0 &lt; \phi &lt; 1\)</span>, dampens the trend, as shown in figure @ref(fig:hl2) (Left). A comparison of both can be seen in the Figure @ref(fig:hl2) (Right).</p>
<p>To extend holt’s linear method with <em>damped trends</em> in R, we can set parameter <code>damped = TRUE</code> in <code>holt</code> function discussed above. Example code can be seen below.</p>
<div class="sourceCode" id="cb1438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1438-1"><a href="#cb1438-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1438-2"><a href="#cb1438-2" tabindex="-1"></a></span>
<span id="cb1438-3"><a href="#cb1438-3" tabindex="-1"></a>holtfit <span class="ot">&lt;-</span> <span class="fu">holt</span>(airmiles, <span class="at">h =</span> <span class="dv">10</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">beta =</span> <span class="fl">0.1</span>, <span class="at">damped =</span> <span class="cn">TRUE</span>, <span class="at">phi =</span> <span class="fl">0.8</span>)</span>
<span id="cb1438-4"><a href="#cb1438-4" tabindex="-1"></a><span class="fu">autoplot</span>(holtfit) <span class="sc">+</span></span>
<span id="cb1438-5"><a href="#cb1438-5" tabindex="-1"></a>  <span class="fu">autolayer</span>(holtfit<span class="sc">$</span>fitted) <span class="sc">+</span></span>
<span id="cb1438-6"><a href="#cb1438-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">&#39;Damped Trend Forecast with phi=0.8&#39;</span>) <span class="sc">+</span></span>
<span id="cb1438-7"><a href="#cb1438-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1438-8"><a href="#cb1438-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb1438-9"><a href="#cb1438-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1438-10"><a href="#cb1438-10" tabindex="-1"></a></span>
<span id="cb1438-11"><a href="#cb1438-11" tabindex="-1"></a></span>
<span id="cb1438-12"><a href="#cb1438-12" tabindex="-1"></a>holtfit <span class="ot">&lt;-</span> <span class="fu">holt</span>(airmiles,</span>
<span id="cb1438-13"><a href="#cb1438-13" tabindex="-1"></a>                <span class="at">h =</span> <span class="dv">10</span>,</span>
<span id="cb1438-14"><a href="#cb1438-14" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb1438-15"><a href="#cb1438-15" tabindex="-1"></a>                <span class="at">beta =</span> <span class="fl">0.1</span>)</span>
<span id="cb1438-16"><a href="#cb1438-16" tabindex="-1"></a></span>
<span id="cb1438-17"><a href="#cb1438-17" tabindex="-1"></a>holtfit2 <span class="ot">&lt;-</span> <span class="fu">holt</span>(</span>
<span id="cb1438-18"><a href="#cb1438-18" tabindex="-1"></a>  airmiles,</span>
<span id="cb1438-19"><a href="#cb1438-19" tabindex="-1"></a>  <span class="at">h =</span> <span class="dv">10</span>,</span>
<span id="cb1438-20"><a href="#cb1438-20" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb1438-21"><a href="#cb1438-21" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fl">0.1</span>,</span>
<span id="cb1438-22"><a href="#cb1438-22" tabindex="-1"></a>  <span class="at">damped =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1438-23"><a href="#cb1438-23" tabindex="-1"></a>  <span class="at">phi =</span> <span class="fl">0.8</span></span>
<span id="cb1438-24"><a href="#cb1438-24" tabindex="-1"></a>)</span>
<span id="cb1438-25"><a href="#cb1438-25" tabindex="-1"></a></span>
<span id="cb1438-26"><a href="#cb1438-26" tabindex="-1"></a><span class="fu">autoplot</span>(airmiles)<span class="sc">+</span></span>
<span id="cb1438-27"><a href="#cb1438-27" tabindex="-1"></a>  <span class="fu">autolayer</span>(holtfit, <span class="at">series=</span><span class="st">&quot;Holt&#39;s method&quot;</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1438-28"><a href="#cb1438-28" tabindex="-1"></a>  <span class="fu">autolayer</span>(holtfit2, <span class="at">series=</span><span class="st">&quot;Holt&#39;s method with damped trend&quot;</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb1438-29"><a href="#cb1438-29" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggtitle</span>(<span class="st">&quot;Holt&#39;s method&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="sc">+</span></span>
<span id="cb1438-30"><a href="#cb1438-30" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Revenue passenger miles&quot;</span>) <span class="sc">+</span></span>
<span id="cb1438-31"><a href="#cb1438-31" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="fu">guide_legend</span>(<span class="at">title=</span><span class="st">&quot;Method&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1438-32"><a href="#cb1438-32" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1438-33"><a href="#cb1438-33" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/hl2-1.png" alt="Linear methos Vs. Damped trends" width="49%" /><img src="DauR_files/figure-html/hl2-2.png" alt="Linear methos Vs. Damped trends" width="49%" />
<p class="caption">
(#fig:hl2)Linear methos Vs. Damped trends
</p>
</div>
<p>Now to incorporate <code>seasonality</code> (with say <span class="math inline">\(m\)</span> periods) along with trend and level, Holt and Winters suggested to incorporate additional parameter <span class="math inline">\(\gamma\)</span> in above equations.</p>
<p><span class="math display">\[
\text{Holt-Winters method:}
\]</span>
<span class="math display">\[
\begin{aligned}
\hat{y}_{t+h|t} &amp;= l_t + hb_t + s_{t+m-(m-1 \bmod m)} \\
l_t &amp;= \alpha(y_t - s_{t-m}) + (1-\alpha)(l_{t-1} + b_{t-1}) \\
b_t &amp;= \beta(l_t - l_{t-1}) + (1-\beta)b_{t-1} \\
s_t &amp;= \gamma(y_t - l_{t-1} - b_{t-1}) + (1-\gamma)s_{t-m}
\end{aligned}
\]</span></p>
<p>An example can be seen in figure @ref(fig:hw1). To apply <em>Holt-Winters</em> method in R, we can use <code>hw</code> function with desired values of parameters. An example code may be as follows, where we have tried to extend <code>AirPassengers</code> time series with this method with both <code>additive</code> and <code>multiplicative</code> trends.</p>
<div class="sourceCode" id="cb1439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1439-1"><a href="#cb1439-1" tabindex="-1"></a>hw1 <span class="ot">&lt;-</span> <span class="fu">hw</span>(AirPassengers, <span class="at">seasonal =</span> <span class="st">&quot;additive&quot;</span>)</span>
<span id="cb1439-2"><a href="#cb1439-2" tabindex="-1"></a>hw2 <span class="ot">&lt;-</span> <span class="fu">hw</span>(AirPassengers, <span class="at">seasonal =</span> <span class="st">&quot;multiplicative&quot;</span>)</span>
<span id="cb1439-3"><a href="#cb1439-3" tabindex="-1"></a></span>
<span id="cb1439-4"><a href="#cb1439-4" tabindex="-1"></a></span>
<span id="cb1439-5"><a href="#cb1439-5" tabindex="-1"></a><span class="fu">autoplot</span>(hw1) <span class="sc">+</span></span>
<span id="cb1439-6"><a href="#cb1439-6" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Additive Model&quot;</span>)</span>
<span id="cb1439-7"><a href="#cb1439-7" tabindex="-1"></a></span>
<span id="cb1439-8"><a href="#cb1439-8" tabindex="-1"></a><span class="fu">autoplot</span>(hw2) <span class="sc">+</span></span>
<span id="cb1439-9"><a href="#cb1439-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Multiplicative Method&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/hw1-1.png" alt="Holt-Winter's Method of Forecasting" width="48%" /><img src="DauR_files/figure-html/hw1-2.png" alt="Holt-Winter's Method of Forecasting" width="48%" />
<p class="caption">
(#fig:hw1)Holt-Winter’s Method of Forecasting
</p>
</div>
</div>
<div id="seasonal-decomposition-methods" class="section level3 unnumbered">
<h3 class="unnumbered">Seasonal decomposition methods</h3>
<p>Seasonal decomposition techniques decompose a time series into its different components, such as trend, seasonality, and noise. This allows for a better understanding of the individual components and their impact on the overall series. There are several methods to decompose a time series into its different components. We will however, discuss two of these.</p>
</div>
<div id="classical-seasonal-decomposition" class="section level3" number="25.4.4">
<h3><span class="header-section-number">25.4.4</span> Classical seasonal decomposition</h3>
<p>First of these methods is <strong>classical decomposition method</strong> which decomposes a time series into its trend, seasonal, and residual components. It assumes that the seasonal component repeats identically from year to year, and the trend component changes linearly over time. The steps involved in the classical decomposition method are as follows:</p>
<ul>
<li><strong>Trend Component:</strong> The trend component is estimated using a moving average or regression method.</li>
<li><strong>Seasonal Component:</strong> The seasonal component is estimated by averaging the values across the same seasonal periods in different years.</li>
<li><strong>Residual Component:</strong> The residual component is obtained by subtracting the trend and seasonal components from the original time series.</li>
</ul>
<p><strong>Problem Statement:</strong> Let’s try to decompose a time series say <code>AirPassengers</code> to see its components. To decompose a time series in R, we will use function <code>decompose</code> as shown in the following code. Decomposing time series in R gives us four different plots each for (i) Observed i.e. original values, (ii) trend, (iii) seasonality and (iv) random noise available.</p>
<p>Case-1: Additive decomposition</p>
<div class="sourceCode" id="cb1440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1440-1"><a href="#cb1440-1" tabindex="-1"></a>decomposed_air_passengers <span class="ot">&lt;-</span> <span class="fu">decompose</span>(AirPassengers)</span>
<span id="cb1440-2"><a href="#cb1440-2" tabindex="-1"></a><span class="fu">summary</span>(decomposed_air_passengers)</span></code></pre></div>
<pre><code>##          Length Class  Mode     
## x        144    ts     numeric  
## seasonal 144    ts     numeric  
## trend    144    ts     numeric  
## random   144    ts     numeric  
## figure    12    -none- numeric  
## type       1    -none- character</code></pre>
<p>Case-2: Multiplicative decomposition. In this case we can use argument <code>type</code>.</p>
<div class="sourceCode" id="cb1442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1442-1"><a href="#cb1442-1" tabindex="-1"></a>decomposed_air_passengers2 <span class="ot">&lt;-</span> <span class="fu">decompose</span>(AirPassengers, <span class="at">type =</span> <span class="st">&quot;multiplicative&quot;</span>)</span>
<span id="cb1442-2"><a href="#cb1442-2" tabindex="-1"></a><span class="fu">summary</span>(decomposed_air_passengers2)</span></code></pre></div>
<pre><code>##          Length Class  Mode     
## x        144    ts     numeric  
## seasonal 144    ts     numeric  
## trend    144    ts     numeric  
## random   144    ts     numeric  
## figure    12    -none- numeric  
## type       1    -none- character</code></pre>
<p>A plot of decomposed <code>AirPassengers</code>, using classical approach is shown in Figure @ref(fig:stl1).</p>
<div class="sourceCode" id="cb1444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1444-1"><a href="#cb1444-1" tabindex="-1"></a>AirPassengers <span class="sc">|&gt;</span></span>
<span id="cb1444-2"><a href="#cb1444-2" tabindex="-1"></a>  <span class="fu">decompose</span>() <span class="sc">|&gt;</span></span>
<span id="cb1444-3"><a href="#cb1444-3" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/stl1-1.png" alt="Seasonal Decomposition Techniques" width="672" />
<p class="caption">
(#fig:stl1)Seasonal Decomposition Techniques
</p>
</div>
</div>
<div id="seasonal-and-trend-decomposition-using-loess." class="section level3" number="25.4.5">
<h3><span class="header-section-number">25.4.5</span> Seasonal and Trend decomposition using Loess<a href="#fn32" class="footnote-ref" id="fnref32"><sup>32</sup></a>.</h3>
<p>STL (Seasonal and Trend decomposition using Loess) is a robust and flexible method for decomposing a time series into its trend, seasonal, and residual components. It uses local regression (Loess) to estimate the trend and seasonal components. The STL algorithm is as follows:</p>
<ul>
<li>Seasonal Component: The seasonal component is estimated using Loess, which fits a smooth curve to the seasonal patterns.</li>
<li>Trend Component: The trend component is estimated by removing the estimated seasonal component from the original time series.</li>
<li>Residual Component: The residual component is obtained by subtracting the estimated trend and seasonal components from the original time series.</li>
</ul>
<p>To decompose time series in R, using STL, we will use function <code>stl</code> as shown below. A plot of STL decomposed <code>AirPassengers</code> is shown in figure @ref(fig:stl2).</p>
<div class="sourceCode" id="cb1445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1445-1"><a href="#cb1445-1" tabindex="-1"></a><span class="fu">stl</span>(AirPassengers, <span class="at">s.window =</span> <span class="st">&quot;periodic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1445-2"><a href="#cb1445-2" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/stl2-1.png" alt="STL Decomposition" width="672" />
<p class="caption">
(#fig:stl2)STL Decomposition
</p>
</div>
</div>
<div id="model-based-techniques" class="section level3 unnumbered">
<h3 class="unnumbered">Model-based techniques</h3>
<p>Model-based techniques involve fitting a specific mathematical or statistical model to the observed time series data. These techniques assume a particular structure for the data and estimate model parameters based on that. Model-based techniques typically require more assumptions but can provide a more detailed understanding of the underlying dynamics. Examples of model-based techniques include:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Autoregressive Integrated Moving Average (ARIMA)</strong>: ARIMA models capture the linear dependencies between lagged observations and differences of the time series. They are commonly used for modeling stationary time series.</p></li>
<li><p><strong>Seasonal ARIMA (SARIMA)</strong>: SARIMA models extend the ARIMA framework to incorporate seasonality in the data. They are suitable for time series exhibiting both trend and seasonality.</p></li>
</ol>
<p>In future version of the book, we will discuss these methods.</p>
</div>
</div>
<div id="plotting-different-elements-of-time-series" class="section level2" number="25.5">
<h2><span class="header-section-number">25.5</span> Plotting different elements of time series</h2>
<p>In R, we can use functions such as -</p>
<ul>
<li><code>ggseasonplot()</code>: to create a seasonal plot</li>
<li><code>ggsubseriesplot()</code>: to create mini plots for each season and show seasonal means</li>
<li><code>gglagplot()</code>: Plot the time series against lags of itself</li>
<li><code>ggAcf()</code>: Plot the autocorrelation function (ACF)</li>
</ul>
<p>Example-1:</p>
<div class="sourceCode" id="cb1446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1446-1"><a href="#cb1446-1" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, </span>
<span id="cb1446-2"><a href="#cb1446-2" tabindex="-1"></a>                                           <span class="at">vjust =</span> <span class="fl">0.5</span>, </span>
<span id="cb1446-3"><a href="#cb1446-3" tabindex="-1"></a>                                           <span class="at">hjust=</span><span class="dv">1</span>)))</span>
<span id="cb1446-4"><a href="#cb1446-4" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1446-5"><a href="#cb1446-5" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggseasonplot</span>(AirPassengers) <span class="sc">+</span></span>
<span id="cb1446-6"><a href="#cb1446-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb1446-7"><a href="#cb1446-7" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggsubseriesplot</span>(AirPassengers) <span class="sc">+</span></span>
<span id="cb1446-8"><a href="#cb1446-8" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Sub-Series Plot&#39;</span>) <span class="sc">+</span></span>
<span id="cb1446-9"><a href="#cb1446-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb1446-10"><a href="#cb1446-10" tabindex="-1"></a>(g1 <span class="sc">/</span> g2)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/unnamed-chunk-424-1.png" alt="Seasonalilty" width="672" />
<p class="caption">
(#fig:unnamed-chunk-424)Seasonalilty
</p>
</div>
<p>Example-2: Lag Plot of <code>AirPassengers</code> may be seen at Figure @ref(fig:lagp). In the figure notice that plot at lag=12 suggest that series has seasonality with 12 periods.</p>
<div class="sourceCode" id="cb1447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1447-1"><a href="#cb1447-1" tabindex="-1"></a><span class="fu">gglagplot</span>(AirPassengers) <span class="sc">+</span></span>
<span id="cb1447-2"><a href="#cb1447-2" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Lag Plots&#39;</span>) <span class="sc">+</span></span>
<span id="cb1447-3"><a href="#cb1447-3" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1447-4"><a href="#cb1447-4" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb1447-5"><a href="#cb1447-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1447-6"><a href="#cb1447-6" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/lagp-1.png" alt="Seasonalilty through Lagplots" width="672" />
<p class="caption">
(#fig:lagp)Seasonalilty through Lagplots
</p>
</div>
<hr />
<!--chapter:end:12-9ts.Rmd-->
</div>
</div>
<div id="part-vi-network-analytics" class="section level1 unnumbered">
<h1 class="unnumbered">Part VI: Network Analytics</h1>
</div>
<div id="network-analyticsgraph-theory-in-r" class="section level1" number="26">
<h1><span class="header-section-number">26</span> Network Analytics/Graph theory in R</h1>
<p><strong>The content is under development/Finalisation.</strong></p>
<p>Network analysis has emerged as a pivotal tool in the realm of audit analytics, offering auditors a powerful method to uncover intricate relationships and patterns within vast datasets. Leveraging the rich ecosystem of packages in R, auditors can construct, visualize, and analyze networks with ease, enabling them to detect anomalies, identify key players, and assess the robustness of interconnected systems. From detecting fraud to optimizing supply chains, the application of network analysis in auditing not only enhances risk assessment but also empowers auditors to make data-driven decisions with greater precision and confidence. So let’s dive in.</p>
<div id="an-introduction-to-graph-theory" class="section level2" number="26.1">
<h2><span class="header-section-number">26.1</span> An introduction to Graph theory</h2>
<p>Network analysis applies concepts of graph theory, which is branch of mathematics, to analyze and interpret complex systems, such as social networks, transportation networks, and biological networks, to uncover patterns, structures, and dynamics within these systems. Graph theory focuses on the properties and characteristics of graphs, such as paths, cycles, connectivity, and graph coloring.</p>
<div id="definition-of-a-graph" class="section level3" number="26.1.1">
<h3><span class="header-section-number">26.1.1</span> Definition of a graph</h3>
By definition, a graph is a mathematical structure consisting of a set of vertices (or nodes or actors) and a set of edges (or connections or links) that establish relationships between these vertices. Mathematically a graph <span class="math inline">\(G = (V, E)\)</span> consists of a set <span class="math inline">\(V\)</span> of vertices/nodes and a set <span class="math inline">\(E\)</span> of edges/links, as illustrated in @ref(fig:gra1). A vertex <span class="math inline">\(V\)</span> may represent real-world objects such as persons, computers, products, etc. An edge <span class="math inline">\(E\)</span>, on the other hand may represent the <em>relationship</em> between the nodes, it connects, such as friendship between those persons, or physical connection between the computers, etc.
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra1-1.png" alt="An Example Graph" width="100%" />
<p class="caption">
(#fig:gra1)An Example Graph
</p>
</div>
</div>
<div id="types-of-graph" class="section level3 unnumbered">
<h3 class="unnumbered">Types of graph</h3>
<p>Example graph shown in figure @ref(fig:gra1) is basically an <strong>Undirected Graph</strong>, where the edges between the nodes aren’t directed. E.g. A connection between two computers. On the other hand, if the edge(s) between the nodes is following a direction or specific order, then the graph is known as <strong>Directed Graph</strong>. Example on twitter (now X) an user may follow other users without being followed by them in turn, as shown in figure @ref(fig:gra2).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra2-1.png" alt="An Example Directed Graph" width="100%" height="33%" />
<p class="caption">
(#fig:gra2)An Example Directed Graph
</p>
</div>
<p>Moreover, sometimes an edge may be connected with itself. In this case, the edge is called as <strong>self-edge</strong> and such graphs (allowing vertices to join themselves) are called as <strong>Pseudographs</strong>. As real-world example of pseudographs think of transactions between different firms. A firm should usually transact with other firms but sometimes it may transact within its own account maintained separately for a specific purpose. Example in figure @ref(fig:gra3) (left) node <code>E</code> is connected with itself.</p>
<p>Further sometimes there may be more than one edge connecting same pair of nodes (in same order). Such edges are called as <strong>multi-edges</strong>; e.g. in figure @ref(fig:gra3) (right) there are two edges connecting from <code>B</code> to <code>E</code>. In real-world example we can think of multiple flights operating between same pair of airports by different carriers.</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra3-1.png" alt="Examples of Self Edge and Multi Edge" width="48%" height="33%" /><img src="DauR_files/figure-html/gra3-2.png" alt="Examples of Self Edge and Multi Edge" width="48%" height="33%" />
<p class="caption">
(#fig:gra3)Examples of Self Edge and Multi Edge
</p>
</div>
<p><strong>Complete Graphs</strong> are graphs where all pairs of vertices are connected by an edge. Example complete graphs are shown in the figure @ref(fig:gra4). While in real-world instances of complete graphs may be rare, it maybe possible that a few of the nodes/vertices in a bigger graph show complete mutual relationship. In other words, the graph of those vertices if taken as a sub-graph is complete, then that complete subgraph is called as <strong>clique</strong>. As an example think of a subgraph consisting of nodes <code>B, D, E and G</code> in graph shown in @ref(fig:gra1) is a clique.</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra4-1.png" alt="Examples of Complete Graphs" width="49%" height="31%" /><img src="DauR_files/figure-html/gra4-2.png" alt="Examples of Complete Graphs" width="49%" height="31%" />
<p class="caption">
(#fig:gra4)Examples of Complete Graphs
</p>
</div>
<p>Before moving on, let us learn about two more specific types of graph. One is known as <strong>Bipartite Graphs</strong>. These are actually graphs having two mutually disjoint set of vertices with condition that no pair within the same set is connected. E.g. graph in figure @ref(fig:gra5) (Left) is a bipartite graph. We can think of two departments where edges represent correspondence between officials between the two departments. Actually the idea can be extended to form k-partite graphs having <code>k</code> such disjoint sets.</p>
<p>Another category is <strong>Trees</strong>, representing hierarchical relationships among entities/individuals. In a tree, vertices are connected through edges or links, making it a type of graph. For a graph to qualify as a tree, there must be precisely one path between any pair of vertices when considered undirected. The bipartite graph illustrated in the example figure @ref(fig:gra5) (on the left) can also be interpreted as a tree because it meets this criterion. Refer figure @ref(fig:gra5) (Right) wherein the same graph has been redrawn as a tree.</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra5-1.png" alt="Bipartite and Tree Graph example" width="49%" height="40%" /><img src="DauR_files/figure-html/gra5-2.png" alt="Bipartite and Tree Graph example" width="49%" height="40%" />
<p class="caption">
(#fig:gra5)Bipartite and Tree Graph example
</p>
</div>
</div>
<div id="vertex-and-edge-attributes" class="section level3" number="26.1.2">
<h3><span class="header-section-number">26.1.2</span> Vertex and Edge attributes</h3>
<p>Recall that a Graph basically consists of two sets <span class="math inline">\((V, E)\)</span> wherein <span class="math inline">\(V\)</span> is a set of <code>vertices</code> and <span class="math inline">\(E\)</span> is set of <code>edges</code>. In their simplest form, these sets can be conceived as lists, but both can be enriched by incorporating additional attributes. E.g. if a graph consists of airports and flights operating between them, the set <span class="math inline">\(V\)</span> representing airports could include attributes such as, (i) names, (ii) types whether domestic or international, (iii) geographical coordinates, (iv) State/Country in which located, etc. and so on. Similarly, the set of edges <span class="math inline">\(E\)</span> could encompass additional details like (i) the count of flights operating between two airports, (ii) the airlines servicing those flights, (iii) the aerial distance between airports, and so on. An example may be seen in figure @ref(fig:gra6).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra6-1.png" alt="Examples of Vertex and Edge properties" width="98%" height="32%" />
<p class="caption">
(#fig:gra6)Examples of Vertex and Edge properties
</p>
</div>
</div>
</div>
<div id="practical-approach-for-creating-graphs-in-r" class="section level2" number="26.2">
<h2><span class="header-section-number">26.2</span> Practical approach for creating graphs in R</h2>
<div id="packages-to-use" class="section level3" number="26.2.1">
<h3><span class="header-section-number">26.2.1</span> Packages to use</h3>
<p>One of the best packages for creating and analysing graphs in R is <code>igraph</code>. Package <code>igraph</code> was originally developed by <strong>Gábor Csárdi</strong> and <strong>Tamás Nepusz</strong>, and is written in the C programming language in order to achieve good performance.
Let’s load it.</p>
<pre><code>library(igraph)</code></pre>
<p>Apart from <code>igraph</code> which in itself is a complete package for network analysis, we will also be using <code>visNetwork</code> and <code>ggraph</code> packages. Former is used to create interactive network charts and latter is used to create <code>ggplot2</code> compatible plots so that these can be customised further in familiar environment.</p>
<p>Let’s now proceed to learn creating graph objects in R. Actually graph objects can be created in many ways, out of which we will learn three methods. These methods will serve our purpose most of the time.</p>
</div>
<div id="creating-a-graph-from-data-frame" class="section level3" number="26.2.2">
<h3><span class="header-section-number">26.2.2</span> Creating a graph from data frame</h3>
<p>When working with data analysis, data frames are often our primary tool. Consequently, the most common and practical approach to creating graphs in igraph involves utilizing data.frame objects. Essentially, the <code>data.frame</code> objects we use to generate graphs should consist of at least two columns, where each row represents an edge within the intended graph. The first column is interpreted as the <code>'from'</code> node, while the second column is considered the <code>'to'</code> node, regardless of their respective column names. To achieve this, we employ the <code>graph_from_data_frame()</code> function from the <code>igraph</code> library. Its syntax is as follows:</p>
<pre><code>graph_from_data_frame(
  d =         ,  # data.frame
  directed = TRUE,
  vertices = NULL # optional data.frame of vertices
)</code></pre>
<p>Example-1: Let’s construct a graph object from a data frame containing four edges.</p>
<div class="sourceCode" id="cb1450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1450-1"><a href="#cb1450-1" tabindex="-1"></a><span class="co"># Example data frame of edges</span></span>
<span id="cb1450-2"><a href="#cb1450-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1450-3"><a href="#cb1450-3" tabindex="-1"></a>  <span class="at">from =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb1450-4"><a href="#cb1450-4" tabindex="-1"></a>  <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">4</span>)</span>
<span id="cb1450-5"><a href="#cb1450-5" tabindex="-1"></a>)</span>
<span id="cb1450-6"><a href="#cb1450-6" tabindex="-1"></a><span class="co"># Creating graph object</span></span>
<span id="cb1450-7"><a href="#cb1450-7" tabindex="-1"></a>gr1 <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(df)</span>
<span id="cb1450-8"><a href="#cb1450-8" tabindex="-1"></a><span class="co"># Let&#39;s print it</span></span>
<span id="cb1450-9"><a href="#cb1450-9" tabindex="-1"></a>gr1</span></code></pre></div>
<pre><code>## IGRAPH 58dab5f DN-- 5 4 -- 
## + attr: name (v/c)
## + edges from 58dab5f (vertex names):
## [1] 1-&gt;2 1-&gt;3 3-&gt;5 3-&gt;4</code></pre>
<p>Here, we observe that a graph object named <code>gr1</code> has been successfully generated and printed in the console, providing us with pertinent information about it.</p>
<ul>
<li>The first line always begins with <code>IGRAPH</code>, followed by seven characters, which represent the initial characters of a unique graph ID. Interested users can employ the <code>graph_id()</code> function to retrieve the full ID if needed.</li>
<li>Subsequently, a four-letter character string is displayed. In this example, two are <code>UN</code>, followed by two blanks or <code>--</code>. These characters signify the following:
<ul>
<li>The first letter distinguishes between directed (<code>D</code>) and undirected (<code>U</code>) graphs.</li>
<li>The second letter, <code>N</code>, denotes named graphs, i.e., graphs with the name vertex attribute set.</li>
<li>The third letter, <code>W</code>, indicates weighted graphs, i.e., graphs with the weight edge attribute set.</li>
<li>The fourth letter, <code>B</code>, signifies bipartite graphs, i.e., graphs with the type vertex attribute set.</li>
</ul></li>
<li>Following this is the count of vertices and edges, separated by two dashes.</li>
<li>Starting from the second line, the graph’s attributes are listed, separated by commas. Each attribute’s type – graph (<code>g</code>), vertex (<code>v</code>), or edge (<code>e</code>) – and data type – character (<code>c</code>), numeric (<code>n</code>), logical (<code>l</code>), or other (<code>x</code>) – are specified.</li>
<li>In the last line a few of the edges are printed.</li>
</ul>
<p>Readers may notice that all four edges from our df have been imported into the gr1 graph and are displayed accordingly.</p>
<p>Now <code>directed</code> argument by default is <code>TRUE</code> so by default the graph created is <code>directed</code> as also confirmed by first alphabet <code>D</code> in the four character string. So let’s check how an undirected graph is created and printed.</p>
<div class="sourceCode" id="cb1452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1452-1"><a href="#cb1452-1" tabindex="-1"></a><span class="co"># Creating graph object</span></span>
<span id="cb1452-2"><a href="#cb1452-2" tabindex="-1"></a>gr2 <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(df, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1452-3"><a href="#cb1452-3" tabindex="-1"></a><span class="co"># Let&#39;s print it</span></span>
<span id="cb1452-4"><a href="#cb1452-4" tabindex="-1"></a>gr2</span></code></pre></div>
<pre><code>## IGRAPH 58ded5e UN-- 5 4 -- 
## + attr: name (v/c)
## + edges from 58ded5e (vertex names):
## [1] 1--2 1--3 3--5 3--4</code></pre>
<p>All good. First letter is now <code>U</code> representing undirected graph. Readers may also notice another change while printing the edges that these are now printed without any arrow mark. Here we created another graph object just to show how the <code>directed</code> argument is used. However, any existing <strong><code>directed</code> graph can be converted to an <code>undirected</code> graph</strong> using function <code>as.directed()</code>. Check-</p>
<div class="sourceCode" id="cb1454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1454-1"><a href="#cb1454-1" tabindex="-1"></a><span class="fu">as.undirected</span>(gr1)</span></code></pre></div>
<pre><code>## IGRAPH 58e2766 UN-- 5 4 -- 
## + attr: name (v/c)
## + edges from 58e2766 (vertex names):
## [1] 1--3 1--2 3--5 3--4</code></pre>
<p>Now what about the last argument <code>vertices =</code> in the function <code>graph_from_data_frame</code>? In most of the cases, the <code>d</code> argument having data of edges may be sufficient, yet sometimes a graph may contain isolates (isolated nodes not connected with any other edge). So to include those vertices, we may use <code>vertices</code> argument. Additionally to include any of the vertex property in the graph being created, we may use that as an additional columns in the data frame. Similar to this analogy, all additional columns in our edges dataset (after first two columns) will be used to set edge properties.</p>
<p>Example-2: Let’s add an isolated edge <code>"6"</code> in our graph.</p>
<div class="sourceCode" id="cb1456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1456-1"><a href="#cb1456-1" tabindex="-1"></a>df_v <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1456-2"><a href="#cb1456-2" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb1456-3"><a href="#cb1456-3" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Ram&quot;</span>, <span class="st">&quot;Shyam&quot;</span>, <span class="st">&quot;Alex&quot;</span>, <span class="st">&quot;Bob&quot;</span>, <span class="st">&quot;Charlie&quot;</span>, <span class="st">&quot;Kumar&quot;</span>)</span>
<span id="cb1456-4"><a href="#cb1456-4" tabindex="-1"></a>)</span>
<span id="cb1456-5"><a href="#cb1456-5" tabindex="-1"></a><span class="co"># Creating graph object</span></span>
<span id="cb1456-6"><a href="#cb1456-6" tabindex="-1"></a>gr3 <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(df, <span class="at">directed =</span> <span class="cn">FALSE</span>, <span class="at">vertices =</span> df_v)</span>
<span id="cb1456-7"><a href="#cb1456-7" tabindex="-1"></a><span class="co"># Let&#39;s print it</span></span>
<span id="cb1456-8"><a href="#cb1456-8" tabindex="-1"></a>gr3</span></code></pre></div>
<pre><code>## IGRAPH 58e6464 UN-- 6 4 -- 
## + attr: name (v/c)
## + edges from 58e6464 (vertex names):
## [1] Ram --Shyam   Ram --Alex    Alex--Charlie Alex--Bob</code></pre>
<p>Notice the change in number of edges now. Also notice that the edges printed with different names due to presence of column named <code>name</code> in vertices data frame.</p>
<p>Readers may try to add additional columns in edge dataset/data frame and create respective graph objects.</p>
</div>
<div id="creating-a-graph-from-edge-list" class="section level3" number="26.2.3">
<h3><span class="header-section-number">26.2.3</span> Creating a graph from Edge list</h3>
<p>Creating graphs from edge-lists is nearly the same approach as creating graphs from data frames. Only difference is absence of <code>vertices</code> argument here. The syntax is</p>
<pre><code>graph_from_edgelist(el, directed = TRUE)</code></pre>
<p>Here <code>el</code> should be a two column matrix, character or numeric, representing edges; and thus that’s another difference here.</p>
<div class="sourceCode" id="cb1459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1459-1"><a href="#cb1459-1" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1459-2"><a href="#cb1459-2" tabindex="-1"></a>  <span class="at">origin =</span> <span class="fu">c</span>(<span class="st">&quot;Ram&quot;</span>, <span class="st">&quot;Ram&quot;</span>, <span class="st">&quot;Alex&quot;</span>, <span class="st">&quot;Alex&quot;</span>), </span>
<span id="cb1459-3"><a href="#cb1459-3" tabindex="-1"></a>  <span class="at">dest =</span> <span class="fu">c</span>(<span class="st">&quot;Shyam&quot;</span>, <span class="st">&quot;Alex&quot;</span>, <span class="st">&quot;Charlie&quot;</span>, <span class="st">&quot;Bob&quot;</span>)</span>
<span id="cb1459-4"><a href="#cb1459-4" tabindex="-1"></a>)</span>
<span id="cb1459-5"><a href="#cb1459-5" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(edges)</span>
<span id="cb1459-6"><a href="#cb1459-6" tabindex="-1"></a><span class="co"># Now let&#39;s create a graph</span></span>
<span id="cb1459-7"><a href="#cb1459-7" tabindex="-1"></a>gr4 <span class="ot">&lt;-</span> <span class="fu">graph_from_edgelist</span>(edges, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1459-8"><a href="#cb1459-8" tabindex="-1"></a><span class="co"># And print it</span></span>
<span id="cb1459-9"><a href="#cb1459-9" tabindex="-1"></a>gr4</span></code></pre></div>
<pre><code>## IGRAPH 58ea4da UN-- 5 4 -- 
## + attr: name (v/c)
## + edges from 58ea4da (vertex names):
## [1] Ram --Shyam   Ram --Alex    Alex--Charlie Alex--Bob</code></pre>
<p>Fine enough. We have successfully created an undirected graph with <code>5</code> nodes and <code>4</code> edges.</p>
</div>
<div id="creating-a-graph-from-adjacency-matrix" class="section level3" number="26.2.4">
<h3><span class="header-section-number">26.2.4</span> Creating a graph from adjacency matrix</h3>
<p>But what exactly is an adjacency matrix? It’s a square matrix sized <span class="math inline">\(n \times n\)</span>, where both the rows and columns are indexed by <span class="math inline">\(n\)</span> vertices. The <span class="math inline">\((i, j)\)</span>-th entry of this matrix holds significance:</p>
<ul>
<li>In a graph devoid of any edge attribute such as <code>weight</code>, a value of <code>1</code> signifies the existence of an edge from vertex <span class="math inline">\(v_{i}\)</span> to <span class="math inline">\(v_j\)</span>. Conversely, a value of <code>0</code> indicates the absence of an edge between those two vertices.</li>
<li>However, in graphs equipped with edge attributes like <code>weight</code>, the corresponding numerical value represents the weight of the edge from vertex <span class="math inline">\(v_{i}\)</span> to <span class="math inline">\(v_j\)</span>.</li>
</ul>
<p>Example: Let’s try to create graph as shown in @ref(fig:gra6) through corresponding adjacency matrix. First, without weights.</p>
<div class="sourceCode" id="cb1461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1461-1"><a href="#cb1461-1" tabindex="-1"></a><span class="co"># Let&#39;s create the matrix</span></span>
<span id="cb1461-2"><a href="#cb1461-2" tabindex="-1"></a>adj_mat <span class="ot">&lt;-</span> <span class="fu">structure</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">4</span><span class="dt">L</span>, </span>
<span id="cb1461-3"><a href="#cb1461-3" tabindex="-1"></a><span class="dv">4</span><span class="dt">L</span>), <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;DEL&quot;</span>, <span class="st">&quot;BNG&quot;</span>, <span class="st">&quot;BOM&quot;</span>, <span class="st">&quot;PNQ&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;DEL&quot;</span>, </span>
<span id="cb1461-4"><a href="#cb1461-4" tabindex="-1"></a><span class="st">&quot;BNG&quot;</span>, <span class="st">&quot;BOM&quot;</span>, <span class="st">&quot;PNQ&quot;</span>)))</span>
<span id="cb1461-5"><a href="#cb1461-5" tabindex="-1"></a>adj_mat</span></code></pre></div>
<pre><code>##     DEL BNG BOM PNQ
## DEL   0   1   1   1
## BNG   1   0   1   0
## BOM   1   1   0   1
## PNQ   1   0   1   0</code></pre>
<div class="sourceCode" id="cb1463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1463-1"><a href="#cb1463-1" tabindex="-1"></a><span class="co"># Let&#39;s create the graph</span></span>
<span id="cb1463-2"><a href="#cb1463-2" tabindex="-1"></a>gr5 <span class="ot">&lt;-</span> <span class="fu">graph_from_adjacency_matrix</span>(adj_mat)</span>
<span id="cb1463-3"><a href="#cb1463-3" tabindex="-1"></a><span class="co"># Let&#39;s print it</span></span>
<span id="cb1463-4"><a href="#cb1463-4" tabindex="-1"></a>gr5</span></code></pre></div>
<pre><code>## IGRAPH 58eeb5e DN-- 4 10 -- 
## + attr: name (v/c)
## + edges from 58eeb5e (vertex names):
##  [1] DEL-&gt;BNG DEL-&gt;BOM DEL-&gt;PNQ BNG-&gt;DEL BNG-&gt;BOM BOM-&gt;DEL BOM-&gt;BNG BOM-&gt;PNQ
##  [9] PNQ-&gt;DEL PNQ-&gt;BOM</code></pre>
<p>So far so good. Directed graph (default) has been created with edges between airports both to and from separately. Now let us try to create weighted graph for the same data where weights will now be the distance between those airports.</p>
<div class="sourceCode" id="cb1465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1465-1"><a href="#cb1465-1" tabindex="-1"></a><span class="co"># Let&#39;s create the matrix</span></span>
<span id="cb1465-2"><a href="#cb1465-2" tabindex="-1"></a>adj_mat2 <span class="ot">&lt;-</span> <span class="fu">structure</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1750</span>, <span class="dv">1150</span>, <span class="dv">1200</span>, <span class="dv">1750</span>, <span class="dv">0</span>, <span class="dv">850</span>, <span class="dv">0</span>, <span class="dv">1150</span>, <span class="dv">850</span>, </span>
<span id="cb1465-3"><a href="#cb1465-3" tabindex="-1"></a><span class="dv">0</span>, <span class="dv">120</span>, <span class="dv">1200</span>, <span class="dv">0</span>, <span class="dv">120</span>, <span class="dv">0</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">4</span><span class="dt">L</span>, <span class="dv">4</span><span class="dt">L</span>), <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;DEL&quot;</span>, </span>
<span id="cb1465-4"><a href="#cb1465-4" tabindex="-1"></a><span class="st">&quot;BNG&quot;</span>, <span class="st">&quot;BOM&quot;</span>, <span class="st">&quot;PNQ&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;DEL&quot;</span>, <span class="st">&quot;BNG&quot;</span>, <span class="st">&quot;BOM&quot;</span>, <span class="st">&quot;PNQ&quot;</span>)))</span>
<span id="cb1465-5"><a href="#cb1465-5" tabindex="-1"></a>adj_mat2</span></code></pre></div>
<pre><code>##      DEL  BNG  BOM  PNQ
## DEL    0 1750 1150 1200
## BNG 1750    0  850    0
## BOM 1150  850    0  120
## PNQ 1200    0  120    0</code></pre>
<div class="sourceCode" id="cb1467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1467-1"><a href="#cb1467-1" tabindex="-1"></a><span class="co"># Let&#39;s create the graph</span></span>
<span id="cb1467-2"><a href="#cb1467-2" tabindex="-1"></a>gr6 <span class="ot">&lt;-</span> <span class="fu">graph_from_adjacency_matrix</span>(adj_mat2, <span class="at">weighted =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1467-3"><a href="#cb1467-3" tabindex="-1"></a><span class="co"># Let&#39;s print it</span></span>
<span id="cb1467-4"><a href="#cb1467-4" tabindex="-1"></a>gr6</span></code></pre></div>
<pre><code>## IGRAPH 58f3055 DNW- 4 10 -- 
## + attr: name (v/c), weight (e/n)
## + edges from 58f3055 (vertex names):
##  [1] DEL-&gt;BNG DEL-&gt;BOM DEL-&gt;PNQ BNG-&gt;DEL BNG-&gt;BOM BOM-&gt;DEL BOM-&gt;BNG BOM-&gt;PNQ
##  [9] PNQ-&gt;DEL PNQ-&gt;BOM</code></pre>
<p>This time notice that edge property named <code>weight</code> with <code>numeric</code> type has been added to the graph.</p>
</div>
<div id="getting-data-back-from-graph-objects" class="section level3" number="26.2.5">
<h3><span class="header-section-number">26.2.5</span> Getting data back from graph objects</h3>
<p>Once the graph objects have been created getting the data back both in <code>data.frame</code> or adjacency <code>matrix</code> is pretty easy. For this we can use either of <code>igraph</code> functions <code>as_data_frame()</code> or <code>as_adjacency_matrix()</code>. Let check both these functions.</p>
<ol style="list-style-type: decimal">
<li><code>as_data_frame()</code> : Since package <code>tibble</code>’s earlier versions also had a same named function, it is safe to use <code>igraph::as_data_frame()</code> to avoid conflict and bug in the code. It takes a igraph object and outputs a <code>data.frame</code>. For example let’s get the data back from <code>gr6</code> object created in above code. Since the <code>gr6</code> was created from an adjacency matrix it will be amusing to see if the function is working correctly.</li>
</ol>
<div class="sourceCode" id="cb1469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1469-1"><a href="#cb1469-1" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">as_data_frame</span>(gr6)</span></code></pre></div>
<pre><code>##    from  to weight
## 1   DEL BNG   1750
## 2   DEL BOM   1150
## 3   DEL PNQ   1200
## 4   BNG DEL   1750
## 5   BNG BOM    850
## 6   BOM DEL   1150
## 7   BOM BNG    850
## 8   BOM PNQ    120
## 9   PNQ DEL   1200
## 10  PNQ BOM    120</code></pre>
<p>From the output above, it is clear that the function worked correctly. Since the graph was <code>directed</code> the edges have been created from both sides. So let’s also check the function’s output in case of undirected graph.</p>
<div class="sourceCode" id="cb1471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1471-1"><a href="#cb1471-1" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">as_data_frame</span>(<span class="fu">as.undirected</span>(gr6))</span></code></pre></div>
<pre><code>##   from  to weight
## 1  DEL BNG   3500
## 2  DEL BOM   2300
## 3  BNG BOM   1700
## 4  DEL PNQ   2400
## 5  BOM PNQ    240</code></pre>
<p>Absolutely fine. But notice that weights of the edges has been combined while converting directed graph to an undirected graph. That also can be tackled of while using <code>as.undirected()</code> by tweaking the argument <code>edge.attr.comb</code> which basically takes a function to combine the separate edge attributes. So,</p>
<div class="sourceCode" id="cb1473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1473-1"><a href="#cb1473-1" tabindex="-1"></a><span class="fu">as.undirected</span>(gr6, <span class="at">edge.attr.comb =</span> <span class="fu">list</span>(<span class="at">weight =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb1473-2"><a href="#cb1473-2" tabindex="-1"></a>  igraph<span class="sc">::</span><span class="fu">as_data_frame</span>()</span></code></pre></div>
<pre><code>##   from  to weight
## 1  DEL BNG   1750
## 2  DEL BOM   1150
## 3  BNG BOM    850
## 4  DEL PNQ   1200
## 5  BOM PNQ    120</code></pre>
<p>It will not be out of place to mention here that this function has an additional argument <code>what</code>, in case requirement is to export <code>"vertex"</code> and/or <code>"edges"</code> data. If the argument is set to <code>"both"</code> the two data-sets will be returned in a list.</p>
<div class="sourceCode" id="cb1475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1475-1"><a href="#cb1475-1" tabindex="-1"></a><span class="co"># Vertices data only</span></span>
<span id="cb1475-2"><a href="#cb1475-2" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">as_data_frame</span>(gr6, <span class="at">what =</span> <span class="st">&quot;vertices&quot;</span>)</span></code></pre></div>
<pre><code>##     name
## DEL  DEL
## BNG  BNG
## BOM  BOM
## PNQ  PNQ</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><code>as_adjacency_matrix()</code> : Similar to above function, her this function will take an igraph object and returns adjacency <code>matrix</code> here instead. So let’s check it also.</li>
</ol>
<div class="sourceCode" id="cb1477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1477-1"><a href="#cb1477-1" tabindex="-1"></a><span class="fu">as.undirected</span>(gr6, <span class="at">edge.attr.comb =</span> <span class="fu">list</span>(<span class="at">weight =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb1477-2"><a href="#cb1477-2" tabindex="-1"></a>  igraph<span class="sc">::</span><span class="fu">as_adjacency_matrix</span>()</span></code></pre></div>
<pre><code>## 4 x 4 sparse Matrix of class &quot;dgCMatrix&quot;
##     DEL BNG BOM PNQ
## DEL   .   1   1   1
## BNG   1   .   1   .
## BOM   1   1   .   1
## PNQ   1   .   1   .</code></pre>
<p>We may notice that adjacency matrix has been returned but without weights. So to map <code>weights</code> we may use its <code>attr</code> argument which by default is <code>NULL</code>.</p>
<div class="sourceCode" id="cb1479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1479-1"><a href="#cb1479-1" tabindex="-1"></a><span class="fu">as.undirected</span>(gr6, <span class="at">edge.attr.comb =</span> <span class="fu">list</span>(<span class="at">weight =</span> mean)) <span class="sc">%&gt;%</span></span>
<span id="cb1479-2"><a href="#cb1479-2" tabindex="-1"></a>  igraph<span class="sc">::</span><span class="fu">as_adjacency_matrix</span>(<span class="at">attr =</span> <span class="st">&quot;weight&quot;</span>)</span></code></pre></div>
<pre><code>## 4 x 4 sparse Matrix of class &quot;dgCMatrix&quot;
##      DEL  BNG  BOM  PNQ
## DEL    . 1750 1150 1200
## BNG 1750    .  850    .
## BOM 1150  850    .  120
## PNQ 1200    .  120    .</code></pre>
</div>
</div>
<div id="adding-vertex-andor-edge-attributes-to-an-existing-igraph-object" class="section level2" number="26.3">
<h2><span class="header-section-number">26.3</span> Adding vertex and/or edge attributes to an existing <code>igraph</code> object</h2>
<p>We’ve previously explored how vertex and edge properties can be incorporated into an <code>igraph</code> during its creation. However, there may be instances where the need arises to add vertex and/or edge properties to an <code>igraph</code> object after its creation or to an existing igraph object. Before delving into that, let’s first understand how we can retrieve existing edges, nodes, or their attributes from an existing <code>igraph</code>.</p>
<ol style="list-style-type: decimal">
<li>Getting vertices of an <code>igraph</code> using <code>V()</code></li>
</ol>
<div class="sourceCode" id="cb1481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1481-1"><a href="#cb1481-1" tabindex="-1"></a><span class="fu">V</span>(gr6)</span></code></pre></div>
<pre><code>## + 4/4 vertices, named, from 58f3055:
## [1] DEL BNG BOM PNQ</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Getting edges of an <code>igraph</code> using <code>E()</code></li>
</ol>
<div class="sourceCode" id="cb1483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1483-1"><a href="#cb1483-1" tabindex="-1"></a><span class="fu">E</span>(gr6)</span></code></pre></div>
<pre><code>## + 10/10 edges from 58f3055 (vertex names):
##  [1] DEL-&gt;BNG DEL-&gt;BOM DEL-&gt;PNQ BNG-&gt;DEL BNG-&gt;BOM BOM-&gt;DEL BOM-&gt;BNG BOM-&gt;PNQ
##  [9] PNQ-&gt;DEL PNQ-&gt;BOM</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Extracting edge or vertex attribute using <code>$</code></li>
</ol>
<div class="sourceCode" id="cb1485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1485-1"><a href="#cb1485-1" tabindex="-1"></a><span class="co"># Vertex Property &quot;name&quot;</span></span>
<span id="cb1485-2"><a href="#cb1485-2" tabindex="-1"></a><span class="fu">V</span>(gr6)<span class="sc">$</span>name</span></code></pre></div>
<pre><code>## [1] &quot;DEL&quot; &quot;BNG&quot; &quot;BOM&quot; &quot;PNQ&quot;</code></pre>
<div class="sourceCode" id="cb1487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1487-1"><a href="#cb1487-1" tabindex="-1"></a><span class="co"># Edge property &quot;weight&quot;</span></span>
<span id="cb1487-2"><a href="#cb1487-2" tabindex="-1"></a><span class="fu">E</span>(gr6)<span class="sc">$</span>weight</span></code></pre></div>
<pre><code>##  [1] 1750 1150 1200 1750  850 1150  850  120 1200  120</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Adding vertex or edge property similarly using <code>$</code></li>
</ol>
<div class="sourceCode" id="cb1489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1489-1"><a href="#cb1489-1" tabindex="-1"></a><span class="co"># adding vertex property say &quot;airport_name&quot;</span></span>
<span id="cb1489-2"><a href="#cb1489-2" tabindex="-1"></a><span class="fu">V</span>(gr6)<span class="sc">$</span>airport_name <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;New Delhi&quot;</span>, <span class="st">&quot;Bengaluru&quot;</span>, <span class="st">&quot;Mumbai&quot;</span>, <span class="st">&quot;Pune&quot;</span>)</span>
<span id="cb1489-3"><a href="#cb1489-3" tabindex="-1"></a><span class="co"># Single value will be replicated across all values</span></span>
<span id="cb1489-4"><a href="#cb1489-4" tabindex="-1"></a><span class="fu">V</span>(gr6)<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="st">&quot;India&quot;</span></span>
<span id="cb1489-5"><a href="#cb1489-5" tabindex="-1"></a></span>
<span id="cb1489-6"><a href="#cb1489-6" tabindex="-1"></a><span class="do">## Let&#39;s check it</span></span>
<span id="cb1489-7"><a href="#cb1489-7" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">as_data_frame</span>(gr6, <span class="at">what =</span> <span class="st">&quot;vertices&quot;</span>)</span></code></pre></div>
<pre><code>##     name airport_name country
## DEL  DEL    New Delhi   India
## BNG  BNG    Bengaluru   India
## BOM  BOM       Mumbai   India
## PNQ  PNQ         Pune   India</code></pre>
<p>Let’s also add some edge property too.</p>
<div class="sourceCode" id="cb1491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1491-1"><a href="#cb1491-1" tabindex="-1"></a><span class="co"># Adding edge property &quot;carrier&quot;</span></span>
<span id="cb1491-2"><a href="#cb1491-2" tabindex="-1"></a><span class="fu">E</span>(gr6)<span class="sc">$</span>carrier <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;Vistara&quot;</span>,<span class="dv">6</span>), <span class="fu">rep</span>(<span class="st">&quot;Indigo&quot;</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="st">&quot;Air India&quot;</span>, <span class="dv">2</span>))</span>
<span id="cb1491-3"><a href="#cb1491-3" tabindex="-1"></a><span class="co"># Adding another edge property on the basis of condition</span></span>
<span id="cb1491-4"><a href="#cb1491-4" tabindex="-1"></a><span class="fu">E</span>(gr6)<span class="sc">$</span>route <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb1491-5"><a href="#cb1491-5" tabindex="-1"></a>  <span class="fu">E</span>(gr6)<span class="sc">$</span>weight <span class="sc">&lt;=</span> <span class="dv">400</span> <span class="sc">~</span> <span class="st">&quot;Short&quot;</span>,</span>
<span id="cb1491-6"><a href="#cb1491-6" tabindex="-1"></a>  <span class="fu">E</span>(gr6)<span class="sc">$</span>weight <span class="sc">&lt;=</span> <span class="dv">1000</span> <span class="sc">~</span> <span class="st">&quot;Medium&quot;</span>,</span>
<span id="cb1491-7"><a href="#cb1491-7" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Long&quot;</span></span>
<span id="cb1491-8"><a href="#cb1491-8" tabindex="-1"></a>)</span>
<span id="cb1491-9"><a href="#cb1491-9" tabindex="-1"></a></span>
<span id="cb1491-10"><a href="#cb1491-10" tabindex="-1"></a><span class="do">## Let&#39;s check it</span></span>
<span id="cb1491-11"><a href="#cb1491-11" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">as_data_frame</span>(gr6)</span></code></pre></div>
<pre><code>##    from  to weight   carrier  route
## 1   DEL BNG   1750   Vistara   Long
## 2   DEL BOM   1150   Vistara   Long
## 3   DEL PNQ   1200   Vistara   Long
## 4   BNG DEL   1750   Vistara   Long
## 5   BNG BOM    850   Vistara Medium
## 6   BOM DEL   1150   Vistara   Long
## 7   BOM BNG    850    Indigo Medium
## 8   BOM PNQ    120    Indigo  Short
## 9   PNQ DEL   1200 Air India   Long
## 10  PNQ BOM    120 Air India  Short</code></pre>
</div>
<div id="visualising-graphs" class="section level2" number="26.4">
<h2><span class="header-section-number">26.4</span> Visualising graphs</h2>
<p>After covering graph definition and storage methods, let’s explore techniques for visualizing them. Visualization is crucial for conveying the essence of graphs and networks, with the arrangement and style playing significant roles in communication. Apart from factors related to visual appeal, layout becomes crucial. The relative positioning of vertices greatly impacts visualization effectiveness. This is evident from the comparison of two graphs in Figure @ref(fig:gra25), both representing the same graph depicted earlier in Figure @ref(fig:gra2).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra25-1.png" alt="Two layouts of a same graph" width="48%" height="34%" /><img src="DauR_files/figure-html/gra25-2.png" alt="Two layouts of a same graph" width="48%" height="34%" />
<p class="caption">
(#fig:gra25)Two layouts of a same graph
</p>
</div>
<p>Nowadays, there are many packages available in R to plot or visualise graph objects while analysing network data. Of these, we will learn two here, (i) one plotting with <code>igraph</code> only though the plots created will be static; and (ii) <code>visNetwork</code> which will be used to create interactive visualizations. Visualizing geographical networks have been discussed separately in an another Chapter.</p>
</div>
<div id="plotting-using-plot-in-igraph" class="section level2" number="26.5">
<h2><span class="header-section-number">26.5</span> Plotting using <code>plot()</code> in <code>igraph</code></h2>
<p>Plotting <code>igraph</code> objects in R is very simple. Just use <code>plot</code> command which basically uses <code>plot.igraph</code> method, and will plot any igraph object using default values to its other arguments. As we have already seen that layouts are important while plotting graph objects, we can set layout using argument <code>layout</code> in <code>plot</code>.</p>
<p>In the following example (Figure @ref(fig:gra26)), we can see two random layouts of same graph as we have seen in Figure @ref(fig:gra25).</p>
<div class="sourceCode" id="cb1493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1493-1"><a href="#cb1493-1" tabindex="-1"></a>my_gr <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">as_data_frame</span>(kite) <span class="sc">%&gt;%</span> </span>
<span id="cb1493-2"><a href="#cb1493-2" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1493-3"><a href="#cb1493-3" tabindex="-1"></a>  <span class="fu">graph_from_data_frame</span>()</span>
<span id="cb1493-4"><a href="#cb1493-4" tabindex="-1"></a></span>
<span id="cb1493-5"><a href="#cb1493-5" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb1493-6"><a href="#cb1493-6" tabindex="-1"></a><span class="fu">plot</span>(my_gr, <span class="at">vertex.size =</span> <span class="dv">25</span>, <span class="at">layout =</span> layout_randomly)</span>
<span id="cb1493-7"><a href="#cb1493-7" tabindex="-1"></a></span>
<span id="cb1493-8"><a href="#cb1493-8" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">54321</span>)</span>
<span id="cb1493-9"><a href="#cb1493-9" tabindex="-1"></a><span class="fu">plot</span>(my_gr, <span class="at">vertex.size =</span> <span class="dv">25</span>, <span class="at">layout =</span> layout_randomly)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra26-1.png" alt="Two Other layouts of a same graph" width="48%" height="34%" /><img src="DauR_files/figure-html/gra26-2.png" alt="Two Other layouts of a same graph" width="48%" height="34%" />
<p class="caption">
(#fig:gra26)Two Other layouts of a same graph
</p>
</div>
<p>In the above example, we have seen that same layout may generate different coordinates for plotting at each iteration. However, using specific random number seed, we can fix the random layout of graph for purpose of reproducibility.</p>
<p>Before moving on let’s create a famous network/graph of <code>Zachary karate club</code> and learn how to plot network graph effectively. The description available on Wikipedia for this network, I am reproducing here. <em>A social network of a karate club was studied by Wayne W. Zachary for a period of three years from 1970 to 1972.[2] The network captures 34 members of a karate club, documenting links between pairs of members who interacted outside the club. During the study a conflict arose between the administrator “John A” and instructor “Mr. Hi” (pseudonyms), which led to the split of the club into two. Half of the members formed a new club around Mr. Hi; members from the other part found a new instructor or gave up karate. Based on collected data Zachary correctly assigned all but one member of the club to the groups they actually joined after the split.</em></p>
<p>This graph object is available in package <code>igraphdata</code> from which we can load it.</p>
<div class="sourceCode" id="cb1494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1494-1"><a href="#cb1494-1" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb1494-2"><a href="#cb1494-2" tabindex="-1"></a><span class="fu">library</span>(igraphdata)</span>
<span id="cb1494-3"><a href="#cb1494-3" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;karate&quot;</span>)</span>
<span id="cb1494-4"><a href="#cb1494-4" tabindex="-1"></a>karate</span></code></pre></div>
<pre><code>## IGRAPH 4b458a1 UNW- 34 78 -- Zachary&#39;s karate club network
## + attr: name (g/c), Citation (g/c), Author (g/c), Faction (v/n), name
## | (v/c), label (v/c), color (v/n), weight (e/n)
## + edges from 4b458a1 (vertex names):
##  [1] Mr Hi  --Actor 2  Mr Hi  --Actor 3  Mr Hi  --Actor 4  Mr Hi  --Actor 5 
##  [5] Mr Hi  --Actor 6  Mr Hi  --Actor 7  Mr Hi  --Actor 8  Mr Hi  --Actor 9 
##  [9] Mr Hi  --Actor 11 Mr Hi  --Actor 12 Mr Hi  --Actor 13 Mr Hi  --Actor 14
## [13] Mr Hi  --Actor 18 Mr Hi  --Actor 20 Mr Hi  --Actor 22 Mr Hi  --Actor 32
## [17] Actor 2--Actor 3  Actor 2--Actor 4  Actor 2--Actor 8  Actor 2--Actor 14
## [21] Actor 2--Actor 18 Actor 2--Actor 20 Actor 2--Actor 22 Actor 2--Actor 31
## [25] Actor 3--Actor 4  Actor 3--Actor 8  Actor 3--Actor 9  Actor 3--Actor 10
## + ... omitted several edges</code></pre>
<div class="sourceCode" id="cb1496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1496-1"><a href="#cb1496-1" tabindex="-1"></a>karate_data <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">as_data_frame</span>(karate)</span>
<span id="cb1496-2"><a href="#cb1496-2" tabindex="-1"></a><span class="fu">head</span>(karate_data)</span></code></pre></div>
<pre><code>##    from      to weight
## 1 Mr Hi Actor 2      4
## 2 Mr Hi Actor 3      5
## 3 Mr Hi Actor 4      3
## 4 Mr Hi Actor 5      3
## 5 Mr Hi Actor 6      3
## 6 Mr Hi Actor 7      3</code></pre>
<div class="sourceCode" id="cb1498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1498-1"><a href="#cb1498-1" tabindex="-1"></a><span class="fu">plot</span>(karate, <span class="at">layout =</span> layout_nicely)</span></code></pre></div>
<p><img src="DauR_files/figure-html/gra27-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="layouts" class="section level3" number="26.5.1">
<h3><span class="header-section-number">26.5.1</span> Layouts</h3>
<p>Network layouts are algorithms that return coordinates for each node in a network. The igraph library offers several built-in layouts. Learning the algorithm behind these layouts is outside the scope of the chapter.</p>
<ul>
<li><code>layout_as_bipartite()</code> Minimize edge-crossings in a simple two-row (or column) layout for bipartite graphs.</li>
<li><code>layout_as_star()</code> A simple layout generator, that places one vertex in the center of a circle and the rest of the vertices equidistantly on the perimeter.</li>
<li><code>layout_as_tree()</code> The <strong>Reingold-Tilford</strong> graph layout algorithm having a tree-like layout, perfect for trees, acceptable for graphs with not too many cycles.</li>
<li><code>layout_in_circle()</code> Places vertices on a circle, in the order of their vertex ids.</li>
<li><code>layout_nicely()</code> This function tries to choose an appropriate graph layout algorithm for the graph, automatically, based on a simple algorithm.</li>
<li><code>layout_on_grid()</code> places vertices on a rectangular grid, in two or three dimensions</li>
<li><code>layout_on_sphere()</code> Places vertices on a sphere, approximately uniformly, in the order of their vertex ids.</li>
<li><code>layout_randomly()</code> This function uniformly randomly places the vertices of the graph in two or three dimensions.</li>
<li><code>layout_with_dh()</code> Places vertices of a graph on the plane, according to the simulated annealing algorithm by <strong>Davidson and Harel</strong>.</li>
<li><code>layout_with_fr()</code> Places vertices on the plane using the force-directed layout algorithm by <strong>Fruchterman and Reingold</strong>.</li>
<li><code>layout_with_gem()</code> Places vertices on the plane using the GEM force-directed layout algorithm.</li>
<li><code>layout_with_kk()</code> <strong>Kamada-Kawai</strong> layout algorithm which places the vertices on the plane, or in 3D space, based on a physical model of springs.</li>
<li><code>layout_with_sugiyama()</code> <strong>Sugiyama</strong> layout algorithm for layered directed acyclic graphs. The algorithm minimized edge crossings.</li>
</ul>
<p>Discussing each and every layout here will be out of the scope. Readers are advised to play with these different layouts to get a fair understanding of these layouts. However, we may see a few useful layouts as example on <code>karate</code> data.</p>
<ul>
<li>Circular layout: Figure @ref(fig:gra28) Left.</li>
<li>Fruchterman Reingold: Figure @ref(fig:gra28) Right.</li>
<li>Kamada Kawai: Figure @ref(fig:gra29) Left.</li>
<li>Sugiyama: Figure @ref(fig:gra29) Right.</li>
<li>Tree layouts (two representations): Figure @ref(fig:gra30).</li>
</ul>
<div class="sourceCode" id="cb1499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1499-1"><a href="#cb1499-1" tabindex="-1"></a><span class="fu">igraph_options</span>(<span class="at">vertex.size =</span> <span class="dv">18</span>)</span>
<span id="cb1499-2"><a href="#cb1499-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb1499-3"><a href="#cb1499-3" tabindex="-1"></a></span>
<span id="cb1499-4"><a href="#cb1499-4" tabindex="-1"></a><span class="fu">plot</span>(karate, <span class="at">layout =</span> layout_in_circle)</span>
<span id="cb1499-5"><a href="#cb1499-5" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Circular layout&quot;</span>)</span>
<span id="cb1499-6"><a href="#cb1499-6" tabindex="-1"></a></span>
<span id="cb1499-7"><a href="#cb1499-7" tabindex="-1"></a><span class="fu">plot</span>(karate, <span class="at">layout =</span> layout_with_fr)</span>
<span id="cb1499-8"><a href="#cb1499-8" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Fruchterman - Reingold&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra28-1.png" alt="Two layouts of Zachary Karate Club Network" width="48%" height="34%" />
<p class="caption">
(#fig:gra28)Two layouts of Zachary Karate Club Network
</p>
</div>
<div class="sourceCode" id="cb1500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1500-1"><a href="#cb1500-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb1500-2"><a href="#cb1500-2" tabindex="-1"></a></span>
<span id="cb1500-3"><a href="#cb1500-3" tabindex="-1"></a><span class="fu">plot</span>(karate, <span class="at">layout =</span> layout_with_kk)</span>
<span id="cb1500-4"><a href="#cb1500-4" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Kamada Kawai&quot;</span>)</span>
<span id="cb1500-5"><a href="#cb1500-5" tabindex="-1"></a></span>
<span id="cb1500-6"><a href="#cb1500-6" tabindex="-1"></a><span class="fu">plot</span>(karate, <span class="at">layout =</span> layout_with_sugiyama)</span>
<span id="cb1500-7"><a href="#cb1500-7" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Sugiyama&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra29-1.png" alt="Two Other layouts of Zachary Karate Club Network" width="48%" height="34%" />
<p class="caption">
(#fig:gra29)Two Other layouts of Zachary Karate Club Network
</p>
</div>
<div class="sourceCode" id="cb1501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1501-1"><a href="#cb1501-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb1501-2"><a href="#cb1501-2" tabindex="-1"></a></span>
<span id="cb1501-3"><a href="#cb1501-3" tabindex="-1"></a><span class="fu">plot</span>(karate, <span class="at">layout =</span> layout_as_tree)</span>
<span id="cb1501-4"><a href="#cb1501-4" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Default Tree layout&quot;</span>)</span>
<span id="cb1501-5"><a href="#cb1501-5" tabindex="-1"></a></span>
<span id="cb1501-6"><a href="#cb1501-6" tabindex="-1"></a><span class="fu">plot</span>(karate, <span class="at">layout =</span> <span class="fu">layout_as_tree</span>(karate, <span class="at">circular =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1501-7"><a href="#cb1501-7" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;circular Tree&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra30-1.png" alt="Two Tree layouts of Zachary Karate Club Network" width="48%" height="34%" />
<p class="caption">
(#fig:gra30)Two Tree layouts of Zachary Karate Club Network
</p>
</div>
</div>
<div id="displaying-vertexedge-properties" class="section level3" number="26.5.2">
<h3><span class="header-section-number">26.5.2</span> Displaying Vertex/Edge properties</h3>
<p>While the layouts may be important when displaying networks, additional information such as displaying vertex or edge properties such as their categories, etc. may also play an important role. Edge/Vertex properties can both be continuous and/or discrete and visualising those properties in a network shall be through usual properties like color, size, width, shape, etc. Out <code>karate</code> graph object is already colored, so readers may be wondering how the vertices are colored in the representation.</p>
<p>Actually vertices, in an igraph object can be colored using its property attribute <code>color</code>. Let’s retrieve it to understand.</p>
<div class="sourceCode" id="cb1502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1502-1"><a href="#cb1502-1" tabindex="-1"></a><span class="fu">V</span>(karate)<span class="sc">$</span>color</span></code></pre></div>
<pre><code>##  [1] 1 1 1 1 1 1 1 1 2 2 1 1 1 1 2 2 1 1 2 1 2 1 2 2 2 2 2 2 2 2 2 2 2 2</code></pre>
<p>We may see some discrete integer values are stored therein. Let’s reallocate these to specific colors as we want.</p>
<div class="sourceCode" id="cb1504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1504-1"><a href="#cb1504-1" tabindex="-1"></a><span class="fu">V</span>(karate)<span class="sc">$</span>color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;dodgerblue&quot;</span>)[<span class="fu">V</span>(karate)<span class="sc">$</span>color]</span>
<span id="cb1504-2"><a href="#cb1504-2" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">V</span>(karate)<span class="sc">$</span>color)</span></code></pre></div>
<pre><code>## [1] &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot; &quot;red&quot;</code></pre>
<div class="sourceCode" id="cb1506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1506-1"><a href="#cb1506-1" tabindex="-1"></a><span class="fu">plot</span>(karate, <span class="at">layout =</span> layout_nicely)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra32-1.png" alt="Vertex coloring in Network" width="98%" height="34%" />
<p class="caption">
(#fig:gra32)Vertex coloring in Network
</p>
</div>
<p>Similarly, we can use following attributes to display certain properties of vertices/edges in an igraph plot.</p>
<ul>
<li><strong>Vertex Properties</strong>
<ul>
<li><code>size</code> - Size of the vertex. Default is 15</li>
<li><code>color</code> - Fill color of the vertex</li>
<li><code>frame.color</code> - Border color of vertex</li>
<li><code>shape</code> - shape of vertex. Can allocate one of the following <code>c("circle", "square", "rectangle", "none")</code>.</li>
<li><code>label</code> - a character vector used to label the nodes</li>
<li><code>label.family</code> Font family of label. Default is <code>serif</code></li>
<li><code>label.font</code> Font of label. <code>1</code> means plain (default), <code>2</code>: bold, <code>3</code> italic, <code>4</code> bold italic <code>5</code> symbol</li>
<li><code>label.cex</code> font size of label</li>
</ul></li>
<li><strong>Edge properties</strong>
<ul>
<li><code>color</code> color of edge</li>
<li><code>width</code> edge width</li>
<li><code>lty</code> line type for edges (<code>0</code> or <code>"blank"</code>; <code>1</code> or <code>"solid"</code>; <code>2</code> or <code>"dashed"</code>; <code>3</code> or <code>"dotted"</code>; <code>4</code> or <code>"dotdash"</code>, <code>6</code> or <code>"twodash"</code>)</li>
<li><code>label</code> label of edges (<code>label.family</code>, <code>lable.font</code> and <code>label.cex</code> similarly for font family, font type and font size respectively)</li>
<li><code>curved</code>: Edge curvature; range is <code>0-1</code></li>
<li><code>arrow.size</code> Arrow size (default is 1) (for directed graphs)</li>
<li><code>arrow.width</code> arrow width, default is <code>1</code>.</li>
<li><code>arrow.mode</code>: arrow mode (<code>0</code> means no arrow; <code>1</code> back, <code>2</code> forward arrow, <code>3</code> both)</li>
</ul></li>
</ul>
<p>Apart from adding these properties to igraph object we can set these properties as arguments in the plot function, just by adding <code>edge.</code> or <code>vertex.</code> before the property/attribute name.</p>
<p>Let’s see some of these through the following example.</p>
<div class="sourceCode" id="cb1507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1507-1"><a href="#cb1507-1" tabindex="-1"></a><span class="co"># set reproducible layout</span></span>
<span id="cb1507-2"><a href="#cb1507-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1507-3"><a href="#cb1507-3" tabindex="-1"></a>l_s <span class="ot">&lt;-</span> <span class="fu">layout_nicely</span>(karate)</span>
<span id="cb1507-4"><a href="#cb1507-4" tabindex="-1"></a></span>
<span id="cb1507-5"><a href="#cb1507-5" tabindex="-1"></a><span class="co"># Add vertex labels</span></span>
<span id="cb1507-6"><a href="#cb1507-6" tabindex="-1"></a><span class="fu">V</span>(karate)<span class="sc">$</span>label <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="fu">V</span>(karate)<span class="sc">$</span>name, <span class="st">&quot;Actor &quot;</span>)</span>
<span id="cb1507-7"><a href="#cb1507-7" tabindex="-1"></a></span>
<span id="cb1507-8"><a href="#cb1507-8" tabindex="-1"></a><span class="co"># Change shapes of two prominent actors</span></span>
<span id="cb1507-9"><a href="#cb1507-9" tabindex="-1"></a><span class="fu">V</span>(karate)<span class="sc">$</span>shape <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">V</span>(karate)<span class="sc">$</span>name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Mr Hi&quot;</span>, <span class="st">&quot;John A&quot;</span>), <span class="st">&quot;rectangle&quot;</span>, <span class="st">&quot;circle&quot;</span>)</span>
<span id="cb1507-10"><a href="#cb1507-10" tabindex="-1"></a></span>
<span id="cb1507-11"><a href="#cb1507-11" tabindex="-1"></a><span class="co"># Change Edge width as per &quot;weight&quot;</span></span>
<span id="cb1507-12"><a href="#cb1507-12" tabindex="-1"></a><span class="fu">E</span>(karate)<span class="sc">$</span>width <span class="ot">&lt;-</span> <span class="fu">E</span>(karate)<span class="sc">$</span>weight</span>
<span id="cb1507-13"><a href="#cb1507-13" tabindex="-1"></a></span>
<span id="cb1507-14"><a href="#cb1507-14" tabindex="-1"></a><span class="fu">plot</span>(karate, <span class="at">layout =</span> l_s, <span class="at">edge.label.cex =</span> <span class="fl">0.7</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/gra33-1.png" alt="Edge and Vertex properties in Network" width="98%" />
<p class="caption">
(#fig:gra33)Edge and Vertex properties in Network
</p>
</div>
</div>
</div>
<div id="using-visnetwork-for-interactive-visualizations" class="section level2" number="26.6">
<h2><span class="header-section-number">26.6</span> Using <code>visNetwork</code> for interactive visualizations</h2>
</div>
<div id="subgraphs-adding-or-deleting-edgesvertices" class="section level2" number="26.7">
<h2><span class="header-section-number">26.7</span> Subgraphs, adding or deleting edges/vertices</h2>
</div>
<div id="describing-networkgraph-for-edges-and-nodes-therein" class="section level2" number="26.8">
<h2><span class="header-section-number">26.8</span> Describing network/graph for edges and nodes therein</h2>
</div>
</div>
<div id="applying-network-analysis-in-auditfraud-detection" class="section level1" number="27">
<h1><span class="header-section-number">27</span> Applying network analysis in audit/fraud detection</h1>
<div id="dup_net" class="section level2" number="27.1">
<h2><span class="header-section-number">27.1</span> Use case-1: Finding network of related entities/persons - Identity Theft</h2>
<p><strong>The Following Content is Under Development.</strong></p>
<p>Imagine a scenario when users may have multiple IDs such as mobile numbers, email ids, and say some other ID issued by a Government Department say Income Tax Department (e.g. PAN number in Indian Scenario). Using techniques mentioned in section @ref(dup), we may easily find out duplicate users, i.e. duplicates on the basis of one ID. Sometimes need arise where we have to find out network of all the duplicate users where they have changed one or two IDs but retained another. E.g. There may be a social sector scheme where any beneficiary is expected to be registered only once for getting that scheme benefits. Scheme audit(s) may require auditors to check duplicate beneficiaries using multiple IDs.</p>
<p>Understand this with the table @ref(tab:gra101).</p>
<table>
<caption>(#tab:gra101)Dummy Data</caption>
<thead>
<tr class="header">
<th align="right">ID</th>
<th align="left">Mobile</th>
<th align="left">Email</th>
<th align="left">PAN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">9111111111</td>
<td align="left"><a href="mailto:aaaa@gmail.com" class="email">aaaa@gmail.com</a></td>
<td align="left">PANNO0000A</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">9222222222</td>
<td align="left"><a href="mailto:bbbb@gmail.com" class="email">bbbb@gmail.com</a></td>
<td align="left">PANNO0000A</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">9333333333</td>
<td align="left"><a href="mailto:cccc@gmail.com" class="email">cccc@gmail.com</a></td>
<td align="left">PANNO1111B</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">9444444444</td>
<td align="left"><a href="mailto:dddd@gmail.com" class="email">dddd@gmail.com</a></td>
<td align="left">PANNO2222C</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">9111111111</td>
<td align="left"><a href="mailto:eeee@gmail.com" class="email">eeee@gmail.com</a></td>
<td align="left">PANNO3333D</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">9111111111</td>
<td align="left"><a href="mailto:ffff@gmail.com" class="email">ffff@gmail.com</a></td>
<td align="left">PANNO4444E</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">9555555555</td>
<td align="left"><a href="mailto:gggg@gmail.com" class="email">gggg@gmail.com</a></td>
<td align="left">PANNO5555F</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">9666666666</td>
<td align="left"><a href="mailto:hhhh@gmail.com" class="email">hhhh@gmail.com</a></td>
<td align="left">PANNO5555F</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="left">9333333333</td>
<td align="left"><a href="mailto:iiii@gmail.com" class="email">iiii@gmail.com</a></td>
<td align="left">PANNO6666G</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="left">9222222222</td>
<td align="left"><a href="mailto:bbbb@gmail.com" class="email">bbbb@gmail.com</a></td>
<td align="left">PANNO7777H</td>
</tr>
</tbody>
</table>
<p>It may be seen that out of ten persons, two with IDs 6 and 10 respectively share none of IDs out of Email, PAN and Telephone number. But if we see closely, ID-6 shares mobile number with ID-1 who in turn share PAN number with ID-2. ID-2 further shares both Email and Mobile number with ID-6 thus establishing a relation and a network between ID-6 and ID-10. This is clear in figure at @ref(fig:igraph11). <em>Note that we are not considering names while finding out duplicates.</em></p>
<div class="sourceCode" id="cb1508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1508-1"><a href="#cb1508-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;images/canvas.png&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/canvas.png" alt="Network diagram of connected entities" width="75%" />
<p class="caption">
(#fig:igraph11)Network diagram of connected entities
</p>
</div>
<p>We may find these duplicates using a branch of mathematics called <em>Graph Theory</em>.<a href="#fn33" class="footnote-ref" id="fnref33"><sup>33</sup></a> We won’t be discussing any core concepts of graph theory here. There are a few packages to work with graph theory concepts in R, and we will be using <code>igraph</code><span class="citation"><a href="#fn34" class="footnote-ref" id="fnref34"><sup>34</sup></a></span> for our analysis here. Let’s load the library.</p>
<div class="sourceCode" id="cb1509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1509-1"><a href="#cb1509-1" tabindex="-1"></a><span class="fu">library</span>(igraph)</span></code></pre></div>
<div class="sourceCode" id="cb1510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1510-1"><a href="#cb1510-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1510-2"><a href="#cb1510-2" tabindex="-1"></a>  <span class="at">MainID =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,</span>
<span id="cb1510-3"><a href="#cb1510-3" tabindex="-1"></a>  <span class="at">Name =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;E&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;G&quot;</span>, <span class="st">&quot;H&quot;</span>),</span>
<span id="cb1510-4"><a href="#cb1510-4" tabindex="-1"></a>  <span class="at">ID1 =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">17</span>),</span>
<span id="cb1510-5"><a href="#cb1510-5" tabindex="-1"></a>  <span class="at">ID2 =</span> <span class="fu">c</span>(<span class="st">&quot;1a&quot;</span>, <span class="st">&quot;1b&quot;</span>,<span class="st">&quot;1b&quot;</span>, <span class="st">&quot;2a&quot;</span>, <span class="st">&quot;2b&quot;</span>, <span class="st">&quot;2c&quot;</span>, <span class="st">&quot;2c&quot;</span>, <span class="st">&quot;2e&quot;</span>, <span class="st">&quot;3a&quot;</span>),</span>
<span id="cb1510-6"><a href="#cb1510-6" tabindex="-1"></a>  <span class="at">ID3 =</span> <span class="fu">c</span>(<span class="st">&quot;AB&quot;</span>, <span class="st">&quot;AB&quot;</span>, <span class="st">&quot;BC&quot;</span>, <span class="st">&quot;CD&quot;</span>, <span class="st">&quot;EF&quot;</span>, <span class="st">&quot;GH&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;JK&quot;</span>)</span>
<span id="cb1510-7"><a href="#cb1510-7" tabindex="-1"></a>)</span>
<span id="cb1510-8"><a href="#cb1510-8" tabindex="-1"></a><span class="co"># A preview of our sample data</span></span>
<span id="cb1510-9"><a href="#cb1510-9" tabindex="-1"></a>dat</span></code></pre></div>
<pre><code>##   MainID Name ID1 ID2 ID3
## 1      1    A  11  1a  AB
## 2      2    B  12  1b  AB
## 3      3    C  13  1b  BC
## 4      4    B  13  2a  CD
## 5      5    E  14  2b  EF
## 6      6    A  15  2c  GH
## 7      7    F  16  2c  HI
## 8      8    G  17  2e  HI
## 9      9    H  17  3a  JK</code></pre>
<p>Now the complete algorithm is as under-</p>
<div class="sourceCode" id="cb1512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1512-1"><a href="#cb1512-1" tabindex="-1"></a>id_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ID1&quot;</span>, <span class="st">&quot;ID2&quot;</span>, <span class="st">&quot;ID3&quot;</span>)</span>
<span id="cb1512-2"><a href="#cb1512-2" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb1512-3"><a href="#cb1512-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">all_of</span>(id_cols), as.character)) <span class="sc">%&gt;%</span> </span>
<span id="cb1512-4"><a href="#cb1512-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(id_cols), </span>
<span id="cb1512-5"><a href="#cb1512-5" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1512-6"><a href="#cb1512-6" tabindex="-1"></a>  <span class="fu">select</span>(MainID, value) <span class="sc">%&gt;%</span> </span>
<span id="cb1512-7"><a href="#cb1512-7" tabindex="-1"></a>  <span class="fu">graph_from_data_frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1512-8"><a href="#cb1512-8" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1512-9"><a href="#cb1512-9" tabindex="-1"></a>  <span class="fu">pluck</span>(membership) <span class="sc">%&gt;%</span></span>
<span id="cb1512-10"><a href="#cb1512-10" tabindex="-1"></a>  <span class="fu">stack</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1512-11"><a href="#cb1512-11" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&#39;UNIQUE_ID&#39;</span>, <span class="st">&#39;MainID&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1512-12"><a href="#cb1512-12" tabindex="-1"></a>  <span class="fu">right_join</span>(dat <span class="sc">%&gt;%</span> </span>
<span id="cb1512-13"><a href="#cb1512-13" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">MainID =</span> <span class="fu">as.factor</span>(MainID)), </span>
<span id="cb1512-14"><a href="#cb1512-14" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;MainID&#39;</span>))</span></code></pre></div>
<pre><code>##   UNIQUE_ID MainID Name ID1 ID2 ID3
## 1         1      1    A  11  1a  AB
## 2         1      2    B  12  1b  AB
## 3         1      3    C  13  1b  BC
## 4         1      4    B  13  2a  CD
## 5         2      5    E  14  2b  EF
## 6         3      6    A  15  2c  GH
## 7         3      7    F  16  2c  HI
## 8         3      8    G  17  2e  HI
## 9         3      9    H  17  3a  JK</code></pre>
<p>We may see that we have got unique ID of users based on all three IDs. Let us understand the algorithm used step by step.</p>
<p><strong>Step-1</strong>: First we have to ensure that all the ID columns (Store names of these columns in one vector say <code>id_cols</code>) must be of same type. Since we had a mix of character (Alphanumeric) and numeric IDs, using <code>dplyr::across</code> with <code>dplyr::mutate</code> we can convert all the three ID columns to character type. Readers may refer to section @ref(vectors) for type change, and section @ref(across) for changing data type of multiple columns simultaneously using <code>dplyr::across</code>.</p>
<p>Thus, first two lines of code above correspond to this step only.</p>
<pre><code>id_cols &lt;- c(&quot;ID1&quot;, &quot;ID2&quot;, &quot;ID3&quot;)
dat %&gt;%
  mutate(across(.cols = id_cols, as.character))</code></pre>
<p><strong>Step-2</strong>: Pivot all id columns to longer format so that all Ids are linked with one main ID. Now two things should be kept in mind. One that there should be a main_Id column in the data frame. If not create one using <code>dplyr::row_number()</code> before pivoting. Secondly, if there are <code>NA</code>s in any of the IDs these have to be removed while pivoting. Use argument <code>values_drop_na = TRUE</code> inside the <code>tidyr::pivot_longer</code>. Thus, this step will correspond to this line-</p>
<pre><code>pivot_longer(cols = all_of(id_cols), values_drop_na = TRUE)</code></pre>
<p>where - first argument data is invisibly passed through dplyr pipe i.e. <code>%&gt;%</code>. Upto this step, our data frame will look like -</p>
<pre><code>## # A tibble: 27 × 4
##    MainID Name  name  value
##     &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
##  1      1 A     ID1   11   
##  2      1 A     ID2   1a   
##  3      1 A     ID3   AB   
##  4      2 B     ID1   12   
##  5      2 B     ID2   1b   
##  6      2 B     ID3   AB   
##  7      3 C     ID1   13   
##  8      3 C     ID2   1b   
##  9      3 C     ID3   BC   
## 10      4 B     ID1   13   
## # ℹ 17 more rows</code></pre>
<p><strong>Step-3:</strong> Now we need only two columns, one is <code>mainID</code> and another is <code>value</code> which is created by pivoting all ID columns. We will use <code>select(MainID, value)</code> for that.</p>
<p><strong>Step-4:</strong> Thereafter we will create a graph object from this data (output after step-3), using <code>igraph</code> package. Interested readers may see how the graph object will look like, using <code>plot()</code> function. The output is shown in figure @ref(fig:igraph2). <strong>However, this step is entirely optional and it may also be kept in mind that graph output of large data will be highly cluttered and may not be comprehensible at all.</strong></p>
<div class="sourceCode" id="cb1517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1517-1"><a href="#cb1517-1" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb1517-2"><a href="#cb1517-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">all_of</span>(id_cols), as.character)) <span class="sc">%&gt;%</span> </span>
<span id="cb1517-3"><a href="#cb1517-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(id_cols), </span>
<span id="cb1517-4"><a href="#cb1517-4" tabindex="-1"></a>               <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1517-5"><a href="#cb1517-5" tabindex="-1"></a>  <span class="fu">select</span>(MainID, value) <span class="sc">%&gt;%</span> </span>
<span id="cb1517-6"><a href="#cb1517-6" tabindex="-1"></a>  <span class="fu">graph_from_data_frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1517-7"><a href="#cb1517-7" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/igraph2-1.png" alt="Plot of graph object" width="672" />
<p class="caption">
(#fig:igraph2)Plot of graph object
</p>
</div>
<p><strong>Step-5:</strong> This step will be a combination of three lines of codes which will number each ID based on connectivity of all components in the graph objects. Actually <code>components</code> will give us an object where <code>$membership</code> will give us <code>unique_ids</code> for each component in the graph.</p>
<pre><code>## $membership
##  1  2  3  4  5  6  7  8  9 11 1a AB 12 1b 13 BC 2a CD 14 2b EF 15 2c GH 16 HI 
##  1  1  1  1  2  3  3  3  3  1  1  1  1  1  1  1  1  1  2  2  2  3  3  3  3  3 
## 17 2e 3a JK 
##  3  3  3  3 
## 
## $csize
## [1] 13  4 13
## 
## $no
## [1] 3</code></pre>
<p>Next we have to <code>purrr::pluck</code>, <code>$membership</code> only from this object, which will return a named vector.</p>
<pre><code>##  1  2  3  4  5  6  7  8  9 11 1a AB 12 1b 13 BC 2a CD 14 2b EF 15 2c GH 16 HI 
##  1  1  1  1  2  3  3  3  3  1  1  1  1  1  1  1  1  1  2  2  2  3  3  3  3  3 
## 17 2e 3a JK 
##  3  3  3  3</code></pre>
<p>We can then <code>stack</code> this named vector into a data frame using <code>stack</code> and <code>set_names</code></p>
<pre><code>##    UNIQUE_ID MainID
## 1          1      1
## 2          1      2
## 3          1      3
## 4          1      4
## 5          2      5
## 6          3      6
## 7          3      7
## 8          3      8
## 9          3      9
## 10         1     11
## 11         1     1a
## 12         1     AB
## 13         1     12
## 14         1     1b
## 15         1     13
## 16         1     BC
## 17         1     2a
## 18         1     CD
## 19         2     14
## 20         2     2b
## 21         2     EF
## 22         3     15
## 23         3     2c
## 24         3     GH
## 25         3     16
## 26         3     HI
## 27         3     17
## 28         3     2e
## 29         3     3a
## 30         3     JK</code></pre>
<p>I suggest to purposefully name second column in the output data as <code>MainID</code> so that it can be joined with original data frame in the last step. <code>UNIQUE_ID</code> in this data will give us the new column which will allocate same ID to all possible duplicates in network of three IDs.</p>
<p><strong>Step-6:</strong> In the last step we have to join the data frame back to original data frame. Since the type of <code>MainID</code> is now factor type, we can convert type of this column in original data frame before <code>right_join</code> the same. Hence the final step, <code>right_join(dat %&gt;% mutate(MainID = as.factor(MainID)), by = c('MainID'))</code>.</p>
</div>
<div id="use-case-2-classification-using-graph-theory" class="section level2" number="27.2">
<h2><span class="header-section-number">27.2</span> Use case-2: Classification using graph theory</h2>
<p><em>The Content is Under Development.</em></p>
</div>
<div id="use-case-3-finding-circular-transactions" class="section level2" number="27.3">
<h2><span class="header-section-number">27.3</span> Use case-3: Finding circular transactions</h2>
<p><em>The Content is Under Development.</em></p>
<!--chapter:end:13-Network.Rmd-->
</div>
</div>
<div id="part-vii-text-analytics-in-r" class="section level1 unnumbered">
<h1 class="unnumbered">Part-VII: Text Analytics in R</h1>
</div>
<div id="string-manipulation-in-stringr" class="section level1" number="28">
<h1><span class="header-section-number">28</span> String manipulation in <code>stringr</code></h1>
<p>In earlier sections we have covered essential tools for data mining which help us in reading data, data cleaning, reshaping data as per our requirements, deriving insights and getting inferences from. However, analyzing text is a bit different as usually text data is unstructured. In data science projects, we often find data-sets with text in the form of strings. These strings often have important information, and we can get the most out of them by effectively working with and analyzing them. String manipulation techniques are essential for preparing data, creating features, text mining, and tasks in natural language processing (NLP).</p>
<p>In Chapter related to functions, we saw some functions from base R for string manipulation. However, <code>stringr</code> which is a part of tidyverse has a plethora of functions designed to make working with strings as easy as possible. We will learn a few of those in this chapter.</p>
<p>First of all, let’s load it. Readers may note that we will use a special function namely <code>str_view()</code> which is used to print the underlying representation of a string and to see how a pattern matches. In actual code this code may rarely be used.</p>
<div class="sourceCode" id="cb1521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1521-1"><a href="#cb1521-1" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code></pre></div>
<p>Let us also create a few example strings.</p>
<div class="sourceCode" id="cb1522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1522-1"><a href="#cb1522-1" tabindex="-1"></a>line1 <span class="ot">&lt;-</span> <span class="st">&quot;I&#39;m gonna make him an offer he can&#39;t refuse.&quot;</span></span>
<span id="cb1522-2"><a href="#cb1522-2" tabindex="-1"></a>line2 <span class="ot">&lt;-</span> <span class="st">&quot;Carpe diem.</span><span class="sc">\n</span><span class="st">Seize the day, boys.&quot;</span></span>
<span id="cb1522-3"><a href="#cb1522-3" tabindex="-1"></a>line3 <span class="ot">&lt;-</span> <span class="st">&quot;You&#39;ve got to ask yourself one question: </span><span class="sc">\&quot;</span><span class="st">Do I feel lucky?</span><span class="sc">\&quot;</span><span class="st">&quot;</span></span></code></pre></div>
<div id="printing-strings-the-way-we-want." class="section level2" number="28.1">
<h2><span class="header-section-number">28.1</span> Printing strings the way we want.</h2>
<p>Let us try printing above strings</p>
<div class="sourceCode" id="cb1523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1523-1"><a href="#cb1523-1" tabindex="-1"></a>ex_lines <span class="ot">&lt;-</span> <span class="fu">c</span>(line1, line2, line3)</span>
<span id="cb1523-2"><a href="#cb1523-2" tabindex="-1"></a><span class="fu">print</span>(ex_lines)</span></code></pre></div>
<pre><code>## [1] &quot;I&#39;m gonna make him an offer he can&#39;t refuse.&quot;                 
## [2] &quot;Carpe diem.\nSeize the day, boys.&quot;                            
## [3] &quot;You&#39;ve got to ask yourself one question: \&quot;Do I feel lucky?\&quot;&quot;</code></pre>
<p>Not pretty! In earlier chapter we learnt of the function <code>cat</code> which helps us printing the strings in a way we want i.e. avoiding escape characters and other unwanted things. So let’s use that.</p>
<div class="sourceCode" id="cb1525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1525-1"><a href="#cb1525-1" tabindex="-1"></a><span class="fu">cat</span>(line1, line2, line3)</span></code></pre></div>
<pre><code>## I&#39;m gonna make him an offer he can&#39;t refuse. Carpe diem.
## Seize the day, boys. You&#39;ve got to ask yourself one question: &quot;Do I feel lucky?&quot;</code></pre>
<p>Prettier! Still there’s a problem. Actually, <code>cat()</code> accepts a <code>sep</code> argument by which the lines/strings will be separated. So let’s use that.</p>
<div class="sourceCode" id="cb1527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1527-1"><a href="#cb1527-1" tabindex="-1"></a><span class="fu">cat</span>(line1, line2, line3, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## I&#39;m gonna make him an offer he can&#39;t refuse.
## Carpe diem.
## Seize the day, boys.
## You&#39;ve got to ask yourself one question: &quot;Do I feel lucky?&quot;</code></pre>
<p>Base R has another function <code>writeLines()</code> which has also been designed to print the <em>strings</em> in the way we usually want, as against <code>cat()</code> which is general purpose and designed for concatenating <em>objects</em> and printing them.</p>
<div class="sourceCode" id="cb1529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1529-1"><a href="#cb1529-1" tabindex="-1"></a><span class="fu">writeLines</span>(ex_lines)</span></code></pre></div>
<pre><code>## I&#39;m gonna make him an offer he can&#39;t refuse.
## Carpe diem.
## Seize the day, boys.
## You&#39;ve got to ask yourself one question: &quot;Do I feel lucky?&quot;</code></pre>
<div class="sourceCode" id="cb1531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1531-1"><a href="#cb1531-1" tabindex="-1"></a><span class="co"># Let&#39;s also print some Unicode and special characters.</span></span>
<span id="cb1531-2"><a href="#cb1531-2" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">&quot;\u0928\u092e\u0938\u094d\u0924\u0947 </span></span>
<span id="cb1531-3"><a href="#cb1531-3" tabindex="-1"></a><span class="st">         \u0926\u0941\u0928\u093f\u092f\u093e&quot;</span>)</span></code></pre></div>
<pre><code>## नमस्ते 
##          दुनिया</code></pre>
<div class="sourceCode" id="cb1533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1533-1"><a href="#cb1533-1" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">&quot;He owes me \U20b9 15 lakh.&quot;</span>)</span></code></pre></div>
<pre><code>## He owes me ₹ 15 lakh.</code></pre>
<p>In this reference, let’s also discuss a bit about <code>str_view</code> from <code>stringr</code> which has been designed to view the strings and matching, as we will see in next sub-sections.</p>
<div class="sourceCode" id="cb1535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1535-1"><a href="#cb1535-1" tabindex="-1"></a><span class="fu">str_view</span>(ex_lines)</span></code></pre></div>
<pre><code>## [1] │ I&#39;m gonna make him an offer he can&#39;t refuse.
## [2] │ Carpe diem.
##     │ Seize the day, boys.
## [3] │ You&#39;ve got to ask yourself one question: &quot;Do I feel lucky?&quot;</code></pre>
</div>
<div id="unicode" class="section level2" number="28.2">
<h2><span class="header-section-number">28.2</span> Unicode</h2>
<p>Unicode in R, precedes with<code>\U</code>. Some examples of <a href="https://en.wikipedia.org/wiki/Emoticons_(Unicode_block)">emoticons</a>.</p>
<div class="sourceCode" id="cb1537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1537-1"><a href="#cb1537-1" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">&quot;\U1f600&quot;</span>)</span></code></pre></div>
<pre><code>## 😀</code></pre>
<div class="sourceCode" id="cb1539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1539-1"><a href="#cb1539-1" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">&quot;\U1f634&quot;</span>)</span></code></pre></div>
<pre><code>## 😴</code></pre>
</div>
<div id="cleaning-whitespaces" class="section level2" number="28.3">
<h2><span class="header-section-number">28.3</span> Cleaning whitespaces</h2>
<p>We may often encounter text strings with extra whitespaces on either end of the strings which may make comparision of two strings difficult. Example</p>
<div class="sourceCode" id="cb1541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1541-1"><a href="#cb1541-1" tabindex="-1"></a><span class="st">&quot;anil goyal&quot;</span> <span class="sc">==</span> <span class="st">&quot;anil goyal &quot;</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>We may also encounter extra whitespaces in between two different words which ideally be separated with a single white-space. To deal with such situations and to remove all such extra white-spaces programatically, <code>stringr</code> provides us two functions -</p>
<ul>
<li><code>str_trim(string, side = c("both", "left", "right"))</code> to remove whitespaces from both or start or end of the string respectively (using <code>side</code> argument having <code>both</code> as default).</li>
<li><code>str_squish(string)</code> to remove all internal whitespaces with a single white-space.</li>
</ul>
<p>Examples-</p>
<div class="sourceCode" id="cb1543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1543-1"><a href="#cb1543-1" tabindex="-1"></a><span class="fu">str_squish</span>(<span class="st">&quot;anil     goyal &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;anil goyal&quot;</code></pre>
<div class="sourceCode" id="cb1545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1545-1"><a href="#cb1545-1" tabindex="-1"></a><span class="fu">str_trim</span>(<span class="st">&quot;anil    goyal  &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;anil    goyal&quot;</code></pre>
</div>
<div id="string-concatenation-with-str_c" class="section level2" number="28.4">
<h2><span class="header-section-number">28.4</span> String concatenation with <code>str_c()</code></h2>
<p>We have already seen two functions <code>paste</code> and <code>paste0</code> from base R in earlier chapter. However <code>stringr</code> package has a function <code>str_c</code> (<code>c</code> is short for concatenation) for similar purposes. But there a couple of differences.</p>
<ol style="list-style-type: decimal">
<li>The default <code>sep</code> is <code>""</code> here as opposed to <code>" "</code> in <code>paste()</code> and absence of <code>sep</code> argument in <code>paste0()</code> altogether.</li>
<li>Function <code>paste()</code> turns missing values into the string <code>“NA”</code>, whereas <code>str_c()</code> propagates missing values. That means combining any strings with a missing value will result in another missing value.</li>
</ol>
<div class="sourceCode" id="cb1547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1547-1"><a href="#cb1547-1" tabindex="-1"></a>company <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Microsoft&quot;</span>, <span class="st">&quot;Salesforce&quot;</span>, <span class="cn">NA</span>)</span>
<span id="cb1547-2"><a href="#cb1547-2" tabindex="-1"></a>product <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Excel&quot;</span>, <span class="st">&quot;Tableau&quot;</span>, <span class="st">&quot;R&quot;</span>)</span>
<span id="cb1547-3"><a href="#cb1547-3" tabindex="-1"></a><span class="fu">paste</span>(company, product)</span></code></pre></div>
<pre><code>## [1] &quot;Microsoft Excel&quot;    &quot;Salesforce Tableau&quot; &quot;NA R&quot;</code></pre>
<div class="sourceCode" id="cb1549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1549-1"><a href="#cb1549-1" tabindex="-1"></a><span class="fu">str_c</span>(company, product, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Microsoft Excel&quot;    &quot;Salesforce Tableau&quot; NA</code></pre>
<p>This also ensures returning same length output as of given vectors making it especially useful while working in <code>dplyr::mutate</code>. However, if we want to flatten the given vector of strings using some separator, we use <code>collapse</code> argument of <code>paste</code> or <code>paste0</code>. Stringr has a function <code>str_flatten()</code> designed specifically for this purpose, making it useful while working with <code>dplyr::summarise</code>. Not only that, it has an extra argument <code>last</code> which is extremely useful in flattening last piece of the vector.</p>
<div class="sourceCode" id="cb1551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1551-1"><a href="#cb1551-1" tabindex="-1"></a>fruits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;pineapple&quot;</span>)</span>
<span id="cb1551-2"><a href="#cb1551-2" tabindex="-1"></a></span>
<span id="cb1551-3"><a href="#cb1551-3" tabindex="-1"></a><span class="fu">str_flatten</span>(fruits, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;apple, banana, pineapple&quot;</code></pre>
<div class="sourceCode" id="cb1553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1553-1"><a href="#cb1553-1" tabindex="-1"></a><span class="fu">str_flatten</span>(fruits, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>, <span class="at">last =</span> <span class="st">&quot; and &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;apple, banana and pineapple&quot;</code></pre>
<p>There is a special variant <code>str_flatten_comma()</code> wherein “comma” is default <code>collapse</code> argument. So we have type a bit lesser in that case.</p>
<div class="sourceCode" id="cb1555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1555-1"><a href="#cb1555-1" tabindex="-1"></a><span class="fu">str_flatten_comma</span>(fruits)</span></code></pre></div>
<pre><code>## [1] &quot;apple, banana, pineapple&quot;</code></pre>
<p>In this context, we may also discuss one more function <code>str_glue</code> which provides us a powerful and elegant syntax for interpolating strings with <code>{}</code>. See the following example.</p>
<div class="sourceCode" id="cb1557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1557-1"><a href="#cb1557-1" tabindex="-1"></a><span class="co"># Note that output will be of same length as given variable/string vector.</span></span>
<span id="cb1557-2"><a href="#cb1557-2" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">&quot;I like {fruits}&quot;</span>)</span></code></pre></div>
<pre><code>## I like apple
## I like banana
## I like pineapple</code></pre>
<div class="sourceCode" id="cb1559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1559-1"><a href="#cb1559-1" tabindex="-1"></a>my_fruits <span class="ot">&lt;-</span> <span class="fu">str_flatten_comma</span>(fruits, <span class="at">last =</span> <span class="st">&quot; and &quot;</span>)</span>
<span id="cb1559-2"><a href="#cb1559-2" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">&quot;I like {my_fruits} in fruits.&quot;</span>)</span></code></pre></div>
<pre><code>## I like apple, banana and pineapple in fruits.</code></pre>
</div>
<div id="string-length-with-str_length" class="section level2" number="28.5">
<h2><span class="header-section-number">28.5</span> String length with <code>str_length()</code></h2>
<p>For counting number of characters in a string we use <code>nchar()</code> from base R. However, <code>str_length()</code> is designed for similar purpose.</p>
<div class="sourceCode" id="cb1561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1561-1"><a href="#cb1561-1" tabindex="-1"></a><span class="fu">str_length</span>(ex_lines)</span></code></pre></div>
<pre><code>## [1] 44 32 59</code></pre>
<p>However, it has been designed to handle factors in a better sense than <code>nchar()</code>.</p>
<div class="sourceCode" id="cb1563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1563-1"><a href="#cb1563-1" tabindex="-1"></a><span class="co"># nchar(unique(iris$Species))</span></span>
<span id="cb1563-2"><a href="#cb1563-2" tabindex="-1"></a><span class="co"># Returns an error</span></span>
<span id="cb1563-3"><a href="#cb1563-3" tabindex="-1"></a></span>
<span id="cb1563-4"><a href="#cb1563-4" tabindex="-1"></a><span class="co"># This will work</span></span>
<span id="cb1563-5"><a href="#cb1563-5" tabindex="-1"></a><span class="fu">str_length</span>(<span class="fu">unique</span>(iris<span class="sc">$</span>Species))</span></code></pre></div>
<pre><code>## [1]  6 10  9</code></pre>
</div>
<div id="string-extraction-with-str_sub" class="section level2" number="28.6">
<h2><span class="header-section-number">28.6</span> String extraction with <code>str_sub()</code></h2>
<p>Function <code>str_sub()</code> extracts parts of strings based on their location. It takes three arguments, first argument, string, is a vector of strings. Other arguments <code>start</code> and <code>end</code> specify the boundaries of the piece to extract in characters.</p>
<div class="sourceCode" id="cb1565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1565-1"><a href="#cb1565-1" tabindex="-1"></a><span class="co"># Extracting first two characters</span></span>
<span id="cb1565-2"><a href="#cb1565-2" tabindex="-1"></a><span class="fu">str_sub</span>(fruits, <span class="dv">1</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;ap&quot; &quot;ba&quot; &quot;pi&quot;</code></pre>
<p>If you are wondering that this works similarly than <code>substr</code> then it is worthwhile to mention here that unlike <code>substr</code> from base R, it can accept negative position integers wherein the counting will be done backwards.</p>
<div class="sourceCode" id="cb1567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1567-1"><a href="#cb1567-1" tabindex="-1"></a><span class="do">## Note the difference</span></span>
<span id="cb1567-2"><a href="#cb1567-2" tabindex="-1"></a><span class="fu">substr</span>(fruits, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&quot; &quot;&quot; &quot;&quot;</code></pre>
<div class="sourceCode" id="cb1569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1569-1"><a href="#cb1569-1" tabindex="-1"></a><span class="fu">str_sub</span>(fruits, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;le&quot; &quot;na&quot; &quot;le&quot;</code></pre>
<p>Not only that it won’t fail if string falls short for the given positions.</p>
<div class="sourceCode" id="cb1571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1571-1"><a href="#cb1571-1" tabindex="-1"></a><span class="fu">str_sub</span>(fruits, <span class="dv">5</span>, <span class="dv">6</span>)</span></code></pre></div>
<pre><code>## [1] &quot;e&quot;  &quot;na&quot; &quot;ap&quot;</code></pre>
<div class="sourceCode" id="cb1573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1573-1"><a href="#cb1573-1" tabindex="-1"></a><span class="fu">str_sub</span>(fruits, <span class="sc">-</span><span class="dv">6</span>, <span class="sc">-</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;a&quot;  &quot;ba&quot; &quot;ea&quot;</code></pre>
</div>
<div id="string-matching-based-on-regex-with-str_detect-str_subset-and-str_count" class="section level2" number="28.7">
<h2><span class="header-section-number">28.7</span> String matching based on regex with <code>str_detect()</code>, <code>str_subset()</code> and <code>str_count()</code></h2>
<p>Let’s search <code>"apple"</code> in all three <code>fruits</code> strings.</p>
<div class="sourceCode" id="cb1575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1575-1"><a href="#cb1575-1" tabindex="-1"></a><span class="fu">str_view</span>(fruits, <span class="st">&quot;apple&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ &lt;apple&gt;
## [2] │ banana
## [3] │ pine&lt;apple&gt;</code></pre>
<p>There are three functions in <code>stringr</code> to do the job.</p>
<ol style="list-style-type: decimal">
<li><code>str_detect()</code> works like <code>grepl</code> and returns a logical vector.</li>
<li><code>str_subset()</code> works like <code>grep</code> with <code>value = TRUE</code> argument.</li>
<li><code>str_count()</code> will return the count of matches in each of the element of given string.</li>
</ol>
<div class="sourceCode" id="cb1577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1577-1"><a href="#cb1577-1" tabindex="-1"></a><span class="fu">str_detect</span>(fruits, <span class="st">&quot;apple&quot;</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE</code></pre>
<div class="sourceCode" id="cb1579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1579-1"><a href="#cb1579-1" tabindex="-1"></a><span class="fu">str_subset</span>(fruits, <span class="st">&quot;apple&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;apple&quot;     &quot;pineapple&quot;</code></pre>
<div class="sourceCode" id="cb1581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1581-1"><a href="#cb1581-1" tabindex="-1"></a><span class="fu">str_count</span>(fruits, <span class="st">&quot;apple&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 1 0 1</code></pre>
<div class="sourceCode" id="cb1583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1583-1"><a href="#cb1583-1" tabindex="-1"></a><span class="co"># Let&#39;s count character &quot;a&quot; in each of `fruits`</span></span>
<span id="cb1583-2"><a href="#cb1583-2" tabindex="-1"></a><span class="fu">str_count</span>(fruits, <span class="st">&quot;a&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 1 3 1</code></pre>
</div>
<div id="changing-case-in-stringr" class="section level2" number="28.8">
<h2><span class="header-section-number">28.8</span> Changing case in stringr</h2>
<p>There are four functions in <code>stringr</code> to make our life easier while changing case of the given strings.</p>
<ol style="list-style-type: decimal">
<li><code>str_to_lower()</code> converts the string to lower case.</li>
<li><code>str_to_upper()</code> converts the string to UPPER CASE.</li>
<li><code>str_to_title()</code> make the given string in Title Case, wherein first alphabet of all characters is in upper case.</li>
<li><code>str_to_sentence()</code> convert to sentence case, where only the first letter of sentence is capitalized.</li>
</ol>
<p>Examples.</p>
<div class="sourceCode" id="cb1585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1585-1"><a href="#cb1585-1" tabindex="-1"></a><span class="co"># lower case</span></span>
<span id="cb1585-2"><a href="#cb1585-2" tabindex="-1"></a><span class="fu">str_view</span>(<span class="fu">str_to_lower</span>(ex_lines))</span></code></pre></div>
<pre><code>## [1] │ i&#39;m gonna make him an offer he can&#39;t refuse.
## [2] │ carpe diem.
##     │ seize the day, boys.
## [3] │ you&#39;ve got to ask yourself one question: &quot;do i feel lucky?&quot;</code></pre>
<div class="sourceCode" id="cb1587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1587-1"><a href="#cb1587-1" tabindex="-1"></a><span class="co"># UPPER CASE</span></span>
<span id="cb1587-2"><a href="#cb1587-2" tabindex="-1"></a><span class="fu">str_view</span>(<span class="fu">str_to_upper</span>(ex_lines))</span></code></pre></div>
<pre><code>## [1] │ I&#39;M GONNA MAKE HIM AN OFFER HE CAN&#39;T REFUSE.
## [2] │ CARPE DIEM.
##     │ SEIZE THE DAY, BOYS.
## [3] │ YOU&#39;VE GOT TO ASK YOURSELF ONE QUESTION: &quot;DO I FEEL LUCKY?&quot;</code></pre>
<div class="sourceCode" id="cb1589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1589-1"><a href="#cb1589-1" tabindex="-1"></a><span class="co"># Title Case</span></span>
<span id="cb1589-2"><a href="#cb1589-2" tabindex="-1"></a><span class="fu">str_view</span>(<span class="fu">str_to_title</span>(ex_lines))</span></code></pre></div>
<pre><code>## [1] │ I&#39;m Gonna Make Him An Offer He Can&#39;t Refuse.
## [2] │ Carpe Diem.
##     │ Seize The Day, Boys.
## [3] │ You&#39;ve Got To Ask Yourself One Question: &quot;Do I Feel Lucky?&quot;</code></pre>
<div class="sourceCode" id="cb1591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1591-1"><a href="#cb1591-1" tabindex="-1"></a><span class="co"># Sentence case</span></span>
<span id="cb1591-2"><a href="#cb1591-2" tabindex="-1"></a><span class="fu">str_view</span>(<span class="fu">str_to_sentence</span>(ex_lines))</span></code></pre></div>
<pre><code>## [1] │ I&#39;m gonna make him an offer he can&#39;t refuse.
## [2] │ Carpe diem.
##     │ Seize the day, boys.
## [3] │ You&#39;ve got to ask yourself one question: &quot;do i feel lucky?&quot;</code></pre>
</div>
<div id="controlling-matching-behaviour-with-modifier-functions-in-stringr" class="section level2" number="28.9">
<h2><span class="header-section-number">28.9</span> Controlling matching behaviour with modifier functions in stringr</h2>
<p>Usually ans specifically while working with English language text, we may require two type of modifier functions in detecting/extracting matches.</p>
<ol style="list-style-type: decimal">
<li>One is <code>fixed()</code>, which compares literal bytes. But this has an extra argument <code>ignore_case</code> which can be used to ignore/not ignore the cases while matching/extracting pattern from string vectors.</li>
<li>Second is <code>regex</code> which has several other arguments apart from <code>ignore_case</code>.</li>
</ol>
<p>See these examples.</p>
<div class="sourceCode" id="cb1593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1593-1"><a href="#cb1593-1" tabindex="-1"></a>ex_str <span class="ot">&lt;-</span> <span class="st">&quot;This is an example string.&quot;</span></span>
<span id="cb1593-2"><a href="#cb1593-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_str, <span class="st">&quot;t&quot;</span>)</span></code></pre></div>
<pre><code>## [1] │ This is an example s&lt;t&gt;ring.</code></pre>
<div class="sourceCode" id="cb1595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1595-1"><a href="#cb1595-1" tabindex="-1"></a><span class="fu">str_view</span>(ex_str, <span class="fu">fixed</span>(<span class="st">&quot;.&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ This is an example string&lt;.&gt;</code></pre>
<div class="sourceCode" id="cb1597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1597-1"><a href="#cb1597-1" tabindex="-1"></a><span class="fu">str_view</span>(ex_str, <span class="fu">regex</span>(<span class="st">&quot;.&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;T&gt;&lt;h&gt;&lt;i&gt;&lt;s&gt;&lt; &gt;&lt;i&gt;&lt;s&gt;&lt; &gt;&lt;a&gt;&lt;n&gt;&lt; &gt;&lt;e&gt;&lt;x&gt;&lt;a&gt;&lt;m&gt;&lt;p&gt;&lt;l&gt;&lt;e&gt;&lt; &gt;&lt;s&gt;&lt;t&gt;&lt;r&gt;&lt;i&gt;&lt;n&gt;&lt;g&gt;&lt;.&gt;</code></pre>
<div class="sourceCode" id="cb1599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1599-1"><a href="#cb1599-1" tabindex="-1"></a><span class="fu">str_view</span>(ex_str, <span class="fu">regex</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">b.{2}</span><span class="sc">\\</span><span class="st">b&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ This &lt;is&gt; &lt;an&gt; example string.</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>There is one more control function <code>boundary()</code> which matches boundary between strings. It has an argument <code>type</code> which accepts one of the values <code>c("character", "line_break", "sentence", "word")</code>.</li>
</ol>
<div class="sourceCode" id="cb1601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1601-1"><a href="#cb1601-1" tabindex="-1"></a><span class="fu">str_view</span>(ex_str, <span class="fu">boundary</span>(<span class="st">&quot;word&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;This&gt; &lt;is&gt; &lt;an&gt; &lt;example&gt; &lt;string&gt;.</code></pre>
<div class="sourceCode" id="cb1603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1603-1"><a href="#cb1603-1" tabindex="-1"></a><span class="fu">str_view</span>(ex_lines, <span class="fu">boundary</span>(<span class="st">&quot;sentence&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;I&#39;m gonna make him an offer he can&#39;t refuse.&gt;
## [2] │ &lt;Carpe diem.
##     │ &gt;&lt;Seize the day, boys.&gt;
## [3] │ &lt;You&#39;ve got to ask yourself one question: &quot;Do I feel lucky?&quot;&gt;</code></pre>
</div>
<div id="extracting-text-from-strings" class="section level2" number="28.10">
<h2><span class="header-section-number">28.10</span> Extracting text from strings</h2>
<p>In above parts, we learnt about the function <code>str_subset()</code> which returns the strings where the matching text/pattern is found. But what about the cases where we want those specific matching text/patterns to be returned. For such cases, stringr has <code>str_extract</code> and <code>str_extract_all()</code> in its powerhouse. It will be clear from the following example, wherein we will extract PAN numbers from the given text string(s).</p>
<div class="sourceCode" id="cb1605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1605-1"><a href="#cb1605-1" tabindex="-1"></a>ex_text <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;My PAN number is TEMPZ9999Z.&quot;</span>,</span>
<span id="cb1605-2"><a href="#cb1605-2" tabindex="-1"></a>             <span class="st">&quot;He has mentioned TEMP9999Z as his PAN number, incorrectly.&quot;</span>,</span>
<span id="cb1605-3"><a href="#cb1605-3" tabindex="-1"></a>             <span class="st">&quot;Is your PAN ABCTY1234D?&quot;</span>)</span>
<span id="cb1605-4"><a href="#cb1605-4" tabindex="-1"></a><span class="co"># Let&#39;s define simple regex for PAN</span></span>
<span id="cb1605-5"><a href="#cb1605-5" tabindex="-1"></a>pan <span class="ot">&lt;-</span> <span class="st">&quot;[A-Z]{5}[0-9]{4}[A-Z]&quot;</span></span>
<span id="cb1605-6"><a href="#cb1605-6" tabindex="-1"></a><span class="co"># str_subset will return strings which contain PAN numbers</span></span>
<span id="cb1605-7"><a href="#cb1605-7" tabindex="-1"></a><span class="fu">str_subset</span>(ex_text, <span class="at">pattern =</span> <span class="fu">regex</span>(pan))</span></code></pre></div>
<pre><code>## [1] &quot;My PAN number is TEMPZ9999Z.&quot; &quot;Is your PAN ABCTY1234D?&quot;</code></pre>
<div class="sourceCode" id="cb1607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1607-1"><a href="#cb1607-1" tabindex="-1"></a><span class="co"># str_extract will however, extract those.</span></span>
<span id="cb1607-2"><a href="#cb1607-2" tabindex="-1"></a><span class="fu">str_extract</span>(ex_text, <span class="at">pattern =</span> <span class="fu">regex</span>(pan))</span></code></pre></div>
<pre><code>## [1] &quot;TEMPZ9999Z&quot; NA           &quot;ABCTY1234D&quot;</code></pre>
<p>This function will return first of the match if found. Its variant <code>str_extract_all()</code> will return all the matches, as expected, in a list.</p>
<div class="sourceCode" id="cb1609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1609-1"><a href="#cb1609-1" tabindex="-1"></a>text_2 <span class="ot">&lt;-</span> <span class="fu">str_flatten</span>(ex_text, <span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1609-2"><a href="#cb1609-2" tabindex="-1"></a><span class="fu">str_extract</span>(text_2, <span class="fu">regex</span>(pan))</span></code></pre></div>
<pre><code>## [1] &quot;TEMPZ9999Z&quot;</code></pre>
<div class="sourceCode" id="cb1611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1611-1"><a href="#cb1611-1" tabindex="-1"></a><span class="fu">str_extract_all</span>(text_2, <span class="fu">regex</span>(pan))</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;TEMPZ9999Z&quot; &quot;ABCTY1234D&quot;</code></pre>
<p>This latter function has an additional argument to simplify the output in form of a matrix, if <code>TRUE</code>.</p>
<div class="sourceCode" id="cb1613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1613-1"><a href="#cb1613-1" tabindex="-1"></a><span class="fu">str_extract_all</span>(text_2, <span class="fu">regex</span>(pan), <span class="at">simplify =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##      [,1]         [,2]        
## [1,] &quot;TEMPZ9999Z&quot; &quot;ABCTY1234D&quot;</code></pre>
<p>So, if we have to find out how many PAN numbers are stored in <code>text_2</code> above.</p>
<div class="sourceCode" id="cb1615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1615-1"><a href="#cb1615-1" tabindex="-1"></a><span class="fu">str_count</span>(text_2, <span class="fu">regex</span>(pan))</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
</div>
<div id="splitting-strings" class="section level2" number="28.11">
<h2><span class="header-section-number">28.11</span> Splitting strings</h2>
<p>In its kitty, stringr has another powerful function <code>str_split()</code> which is used to split strings into meaningful fragments using a <code>pattern</code>. The output format, as expected would be a list.</p>
<p>Example-</p>
<div class="sourceCode" id="cb1617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1617-1"><a href="#cb1617-1" tabindex="-1"></a><span class="fu">str_split</span>(ex_text, <span class="fu">boundary</span>(<span class="st">&quot;word&quot;</span>))</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;My&quot;         &quot;PAN&quot;        &quot;number&quot;     &quot;is&quot;         &quot;TEMPZ9999Z&quot;
## 
## [[2]]
## [1] &quot;He&quot;          &quot;has&quot;         &quot;mentioned&quot;   &quot;TEMP9999Z&quot;   &quot;as&quot;         
## [6] &quot;his&quot;         &quot;PAN&quot;         &quot;number&quot;      &quot;incorrectly&quot;
## 
## [[3]]
## [1] &quot;Is&quot;         &quot;your&quot;       &quot;PAN&quot;        &quot;ABCTY1234D&quot;</code></pre>
<p>It has an argument <code>n</code> which is used to specify the maximum pieces to return. Default is <code>Inf</code>. Extra results will however be flattened.</p>
<div class="sourceCode" id="cb1619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1619-1"><a href="#cb1619-1" tabindex="-1"></a><span class="co"># Extract first two words from each string.</span></span>
<span id="cb1619-2"><a href="#cb1619-2" tabindex="-1"></a><span class="fu">str_split</span>(ex_text, <span class="fu">boundary</span>(<span class="st">&quot;word&quot;</span>), <span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;My&quot;                        &quot;PAN number is TEMPZ9999Z.&quot;
## 
## [[2]]
## [1] &quot;He&quot;                                                     
## [2] &quot;has mentioned TEMP9999Z as his PAN number, incorrectly.&quot;
## 
## [[3]]
## [1] &quot;Is&quot;                   &quot;your PAN ABCTY1234D?&quot;</code></pre>
<p>This function has three more variants. First is <code>str_split_fixed()</code> which splits each string in a character vector into a fixed number of pieces, returning a character matrix. Example -</p>
<div class="sourceCode" id="cb1621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1621-1"><a href="#cb1621-1" tabindex="-1"></a><span class="co"># Here value of `n` is required</span></span>
<span id="cb1621-2"><a href="#cb1621-2" tabindex="-1"></a><span class="fu">str_split_fixed</span>(ex_text, <span class="fu">boundary</span>(<span class="st">&quot;word&quot;</span>), <span class="at">n =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2]   [,3]                                                 
## [1,] &quot;My&quot; &quot;PAN&quot;  &quot;number is TEMPZ9999Z.&quot;                              
## [2,] &quot;He&quot; &quot;has&quot;  &quot;mentioned TEMP9999Z as his PAN number, incorrectly.&quot;
## [3,] &quot;Is&quot; &quot;your&quot; &quot;PAN ABCTY1234D?&quot;</code></pre>
<p>Another variant is <code>str_split_1()</code> which takes a single string and splits it into pieces, returning a single character vector.</p>
<div class="sourceCode" id="cb1623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1623-1"><a href="#cb1623-1" tabindex="-1"></a><span class="co"># Note that vector with one element should be passed.</span></span>
<span id="cb1623-2"><a href="#cb1623-2" tabindex="-1"></a><span class="fu">str_split_1</span>(ex_text[<span class="dv">1</span>], <span class="fu">boundary</span>(<span class="st">&quot;word&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;My&quot;         &quot;PAN&quot;        &quot;number&quot;     &quot;is&quot;         &quot;TEMPZ9999Z&quot;</code></pre>
<p>Last one is <code>str_split_i()</code> which splits each string in a character vector into pieces and extracts the <code>i</code>th value, returning a character vector.</p>
<div class="sourceCode" id="cb1625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1625-1"><a href="#cb1625-1" tabindex="-1"></a><span class="fu">str_split_i</span>(ex_text, <span class="fu">boundary</span>(<span class="st">&quot;word&quot;</span>), <span class="at">i =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;My&quot; &quot;He&quot; &quot;Is&quot;</code></pre>
</div>
<div id="replacing-values-with-str_replace-str_replace_all" class="section level2" number="28.12">
<h2><span class="header-section-number">28.12</span> Replacing values with <code>str_replace()</code>, <code>str_replace_all()</code></h2>
<p>So the matched text strings/values if required to be replaced with some other values, we can use <code>str_replace()</code> and/or <code>str_replace_all()</code>.</p>
<p>As expected these functions require additional argument <code>replacement</code>.</p>
<div class="sourceCode" id="cb1627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1627-1"><a href="#cb1627-1" tabindex="-1"></a><span class="co"># Example Task: mask all PAN numbers from `text_2`</span></span>
<span id="cb1627-2"><a href="#cb1627-2" tabindex="-1"></a><span class="co"># Let&#39;s view the string</span></span>
<span id="cb1627-3"><a href="#cb1627-3" tabindex="-1"></a><span class="fu">str_view</span>(text_2)</span></code></pre></div>
<pre><code>## [1] │ My PAN number is TEMPZ9999Z.
##     │ He has mentioned TEMP9999Z as his PAN number, incorrectly.
##     │ Is your PAN ABCTY1234D?</code></pre>
<div class="sourceCode" id="cb1629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1629-1"><a href="#cb1629-1" tabindex="-1"></a><span class="co"># Replace first match only</span></span>
<span id="cb1629-2"><a href="#cb1629-2" tabindex="-1"></a><span class="fu">str_replace</span>(text_2, <span class="fu">regex</span>(pan), <span class="at">replacement =</span> <span class="st">&quot;XXXXX0000X&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1629-3"><a href="#cb1629-3" tabindex="-1"></a>  <span class="fu">str_view</span>()</span></code></pre></div>
<pre><code>## [1] │ My PAN number is XXXXX0000X.
##     │ He has mentioned TEMP9999Z as his PAN number, incorrectly.
##     │ Is your PAN ABCTY1234D?</code></pre>
<div class="sourceCode" id="cb1631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1631-1"><a href="#cb1631-1" tabindex="-1"></a><span class="co"># Replace all matches</span></span>
<span id="cb1631-2"><a href="#cb1631-2" tabindex="-1"></a><span class="fu">str_replace_all</span>(text_2, <span class="fu">regex</span>(pan), <span class="at">replacement =</span> <span class="st">&quot;XXXXX0000X&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1631-3"><a href="#cb1631-3" tabindex="-1"></a>  <span class="fu">str_view</span>()</span></code></pre></div>
<pre><code>## [1] │ My PAN number is XXXXX0000X.
##     │ He has mentioned TEMP9999Z as his PAN number, incorrectly.
##     │ Is your PAN XXXXX0000X?</code></pre>
<p>For <code>replacement</code> of multiple matches, vectors of same length in both <code>pattern</code> and <code>replacement</code> can be provided. This may be understood from the following example.</p>
<div class="sourceCode" id="cb1633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1633-1"><a href="#cb1633-1" tabindex="-1"></a><span class="co"># Create a new string vector</span></span>
<span id="cb1633-2"><a href="#cb1633-2" tabindex="-1"></a>fruits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;one apple&quot;</span>,</span>
<span id="cb1633-3"><a href="#cb1633-3" tabindex="-1"></a>            <span class="st">&quot;two bananas&quot;</span>,</span>
<span id="cb1633-4"><a href="#cb1633-4" tabindex="-1"></a>            <span class="st">&quot;three pineapples&quot;</span>)</span>
<span id="cb1633-5"><a href="#cb1633-5" tabindex="-1"></a><span class="co"># See what&#39;s there in `fruits`</span></span>
<span id="cb1633-6"><a href="#cb1633-6" tabindex="-1"></a><span class="fu">str_view</span>(fruits)</span></code></pre></div>
<pre><code>## [1] │ one apple
## [2] │ two bananas
## [3] │ three pineapples</code></pre>
<div class="sourceCode" id="cb1635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1635-1"><a href="#cb1635-1" tabindex="-1"></a><span class="co"># Let&#39;s replace each number word to numeral</span></span>
<span id="cb1635-2"><a href="#cb1635-2" tabindex="-1"></a><span class="fu">str_replace_all</span>(</span>
<span id="cb1635-3"><a href="#cb1635-3" tabindex="-1"></a>  fruits,</span>
<span id="cb1635-4"><a href="#cb1635-4" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="fu">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>),</span>
<span id="cb1635-5"><a href="#cb1635-5" tabindex="-1"></a>  <span class="at">replacement =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)</span>
<span id="cb1635-6"><a href="#cb1635-6" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;1 apple&quot;      &quot;2 bananas&quot;    &quot;3 pineapples&quot;</code></pre>
<p>Alternatively, a named vector <code>(c(pattern1 = replacement1, ...))</code>, may be supplied to <code>pattern</code> argument, in order to perform multiple replacements in each element of string more effectively.</p>
<div class="sourceCode" id="cb1637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1637-1"><a href="#cb1637-1" tabindex="-1"></a><span class="fu">str_replace_all</span>(</span>
<span id="cb1637-2"><a href="#cb1637-2" tabindex="-1"></a>  fruits,</span>
<span id="cb1637-3"><a href="#cb1637-3" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="fu">c</span>(<span class="at">one =</span> <span class="st">&quot;1&quot;</span>, <span class="at">two =</span> <span class="st">&quot;2&quot;</span>, <span class="at">three =</span> <span class="st">&quot;3&quot;</span>)</span>
<span id="cb1637-4"><a href="#cb1637-4" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;1 apple&quot;      &quot;2 bananas&quot;    &quot;3 pineapples&quot;</code></pre>
<p>Note: In a named vector, names need not be quoted.</p>
<p>Back-references: References of the form <code>⁠\</code>1⁠<code>,</code>⁠\2⁠, etc will be replaced with the contents of the respective matched group (created by <code>⁠(</code>..)</p>
<div class="sourceCode" id="cb1639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1639-1"><a href="#cb1639-1" tabindex="-1"></a><span class="co"># If any consonant is repeated, make it single</span></span>
<span id="cb1639-2"><a href="#cb1639-2" tabindex="-1"></a><span class="fu">str_replace_all</span>(fruits, </span>
<span id="cb1639-3"><a href="#cb1639-3" tabindex="-1"></a>                <span class="at">pattern =</span> <span class="fu">regex</span>(<span class="st">&quot;([^aeiou])</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1639-4"><a href="#cb1639-4" tabindex="-1"></a>                <span class="at">replacement =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;one aple&quot;        &quot;two bananas&quot;     &quot;three pineaples&quot;</code></pre>
<p>In <code>replacement</code> argument of these functions, we may also supply a function, which will be called once for each match (from right to left) and its return value will be used to replace the match.</p>
<p>Another example.</p>
<div class="sourceCode" id="cb1641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1641-1"><a href="#cb1641-1" tabindex="-1"></a><span class="co"># Change case of all PAN numbers which are in lower case.</span></span>
<span id="cb1641-2"><a href="#cb1641-2" tabindex="-1"></a>text_3 <span class="ot">&lt;-</span> <span class="fu">str_to_lower</span>(text_2)</span>
<span id="cb1641-3"><a href="#cb1641-3" tabindex="-1"></a><span class="co"># Let&#39;s view the string</span></span>
<span id="cb1641-4"><a href="#cb1641-4" tabindex="-1"></a><span class="fu">str_view</span>(text_3)</span></code></pre></div>
<pre><code>## [1] │ my pan number is tempz9999z.
##     │ he has mentioned temp9999z as his pan number, incorrectly.
##     │ is your pan abcty1234d?</code></pre>
<div class="sourceCode" id="cb1643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1643-1"><a href="#cb1643-1" tabindex="-1"></a><span class="co"># Change case of all lower case PAN numbers</span></span>
<span id="cb1643-2"><a href="#cb1643-2" tabindex="-1"></a><span class="fu">str_replace_all</span>(text_3, </span>
<span id="cb1643-3"><a href="#cb1643-3" tabindex="-1"></a>                <span class="at">pattern =</span> <span class="fu">regex</span>(pan, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>), </span>
<span id="cb1643-4"><a href="#cb1643-4" tabindex="-1"></a>                <span class="at">replacement =</span> str_to_upper) <span class="sc">%&gt;%</span> </span>
<span id="cb1643-5"><a href="#cb1643-5" tabindex="-1"></a>  <span class="fu">str_view</span>()</span></code></pre></div>
<pre><code>## [1] │ my pan number is TEMPZ9999Z.
##     │ he has mentioned temp9999z as his pan number, incorrectly.
##     │ is your pan ABCTY1234D?</code></pre>
</div>
<div id="removing-textpattern-using-str_remove-and-str_remove_all" class="section level2" number="28.13">
<h2><span class="header-section-number">28.13</span> Removing text/pattern using <code>str_remove</code> and <code>str_remove_all</code></h2>
<p>Removing text or pattern from the strings is similar to replacing matches with empty text <code>""</code>. See example where we are removing numbers(digits) from a valid PAN number, if any, in the given text.</p>
<div class="sourceCode" id="cb1645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1645-1"><a href="#cb1645-1" tabindex="-1"></a><span class="fu">str_remove_all</span>(ex_text,</span>
<span id="cb1645-2"><a href="#cb1645-2" tabindex="-1"></a>               <span class="at">pattern =</span> <span class="fu">regex</span>(<span class="st">&quot;(?&lt;=[A-Z]{5})(</span><span class="sc">\\</span><span class="st">d{4})(?=[A-Z])&quot;</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1645-3"><a href="#cb1645-3" tabindex="-1"></a>  <span class="fu">str_view</span>()</span></code></pre></div>
<pre><code>## [1] │ My PAN number is TEMPZZ.
## [2] │ He has mentioned TEMP9999Z as his PAN number, incorrectly.
## [3] │ Is your PAN ABCTYD?</code></pre>
</div>
<div id="formatting-numbers-with-format-and-formatc" class="section level2" number="28.14">
<h2><span class="header-section-number">28.14</span> Formatting numbers with <code>format</code> and <code>formatC</code></h2>
<p>Sometimes numbers may be required to format in special types like preceding with currency symbol, thousand separator or scientific format to fixed format (or vice versa). In such case <code>format</code> function from base R comes handy. The <code>scientific</code> argument to <code>format()</code> controls whether the numbers are displayed in <em>fixed</em> (<code>scientific = FALSE</code>) or <em>scientific</em> (<code>scientific = TRUE</code>) format. When the representation is <code>scientific</code>, the <code>digits</code> argument is the number of digits before the exponent. Whereas, when the representation is <code>fixed</code>, <code>digits</code> controls the significant digits used for the smallest (in magnitude) number.</p>
<p>Each other number will be formatted to match the number of decimal places in the smallest number. This means the number of decimal places we get in our output depends on all the values we are formatting.</p>
<div class="sourceCode" id="cb1647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1647-1"><a href="#cb1647-1" tabindex="-1"></a><span class="co"># Some example numbers</span></span>
<span id="cb1647-2"><a href="#cb1647-2" tabindex="-1"></a>numbers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.00123</span>, <span class="dv">123</span>, <span class="fl">1.2356</span>)</span>
<span id="cb1647-3"><a href="#cb1647-3" tabindex="-1"></a><span class="co"># Scientific (default)</span></span>
<span id="cb1647-4"><a href="#cb1647-4" tabindex="-1"></a><span class="fu">format</span>(numbers, <span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1647-5"><a href="#cb1647-5" tabindex="-1"></a>  <span class="fu">writeLines</span>()</span></code></pre></div>
<pre><code>## 1e-03
## 1e+02
## 1e+00</code></pre>
<div class="sourceCode" id="cb1649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1649-1"><a href="#cb1649-1" tabindex="-1"></a><span class="co"># Fixed format</span></span>
<span id="cb1649-2"><a href="#cb1649-2" tabindex="-1"></a><span class="fu">format</span>(numbers, <span class="at">digits =</span> <span class="dv">1</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1649-3"><a href="#cb1649-3" tabindex="-1"></a>  <span class="fu">writeLines</span>()</span></code></pre></div>
<pre><code>##   0.001
## 123.000
##   1.236</code></pre>
<p>Explanation above: In above the smallest number is <code>0.00123</code> which is controlling the number of decimals in all other numbers. Significant digit in this number is <code>1</code> which require three decimal places.</p>
<p>We may also note in the above output that it is nicely aligned with decimal. To stop this behavior we may set <code>trim = TRUE</code> in above.</p>
<div class="sourceCode" id="cb1651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1651-1"><a href="#cb1651-1" tabindex="-1"></a><span class="fu">format</span>(numbers, </span>
<span id="cb1651-2"><a href="#cb1651-2" tabindex="-1"></a>       <span class="at">digits =</span> <span class="dv">1</span>, </span>
<span id="cb1651-3"><a href="#cb1651-3" tabindex="-1"></a>       <span class="at">scientific =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1651-4"><a href="#cb1651-4" tabindex="-1"></a>       <span class="at">trim =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1651-5"><a href="#cb1651-5" tabindex="-1"></a>  <span class="fu">writeLines</span>()</span></code></pre></div>
<pre><code>## 0.001
## 123.000
## 1.236</code></pre>
<p>The function <code>formatC()</code> provides an alternative way to format numbers based on <code>C</code> style syntax.</p>
<p>Rather than a <code>scientific</code> argument, <code>formatC()</code> has a <code>format</code> argument that takes a code representing the required format. The most useful are:</p>
<ul>
<li><code>"f"</code> for fixed format. In this case, <code>digits</code> is the number of digits after the decimal point. This is more predictable than <code>format()</code>, because the number of places after the decimal is fixed regardless of the values being formatted.</li>
<li><code>"e"</code> for scientific. Here, <code>digits</code> argument behaves like it does in <code>format()</code>; it specifies the number of significant digits.</li>
<li><code>"g"</code> for fixed unless scientific saves space.</li>
</ul>
<p>Function <code>formatC()</code> also formats numbers individually, which means you always get the same output regardless of other numbers in the vector.</p>
<div class="sourceCode" id="cb1653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1653-1"><a href="#cb1653-1" tabindex="-1"></a><span class="fu">formatC</span>(numbers,</span>
<span id="cb1653-2"><a href="#cb1653-2" tabindex="-1"></a>        <span class="at">format =</span> <span class="st">&quot;f&quot;</span>,</span>
<span id="cb1653-3"><a href="#cb1653-3" tabindex="-1"></a>        <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1653-4"><a href="#cb1653-4" tabindex="-1"></a>  <span class="fu">writeLines</span>()</span></code></pre></div>
<pre><code>## 0.00
## 123.00
## 1.24</code></pre>
<div class="sourceCode" id="cb1655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1655-1"><a href="#cb1655-1" tabindex="-1"></a><span class="fu">formatC</span>(numbers,</span>
<span id="cb1655-2"><a href="#cb1655-2" tabindex="-1"></a>        <span class="at">format =</span> <span class="st">&quot;g&quot;</span>,</span>
<span id="cb1655-3"><a href="#cb1655-3" tabindex="-1"></a>        <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1655-4"><a href="#cb1655-4" tabindex="-1"></a>  <span class="fu">writeLines</span>()</span></code></pre></div>
<pre><code>## 0.0012
## 1.2e+02
## 1.2</code></pre>
<p>Lastly there is one more package <code>scales</code> which also does pretty job of formatting numbers.</p>
<ol style="list-style-type: decimal">
<li><code>scales::percent()</code>: It forces decimal display of numbers (i.e. don’t use scientific notation)</li>
<li><code>scales::comma()</code> : It inserts a comma every three digit.</li>
<li><code>scales::dollar</code> : Used to format numbers with currency symbol.</li>
</ol>
<div class="sourceCode" id="cb1657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1657-1"><a href="#cb1657-1" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1657-2"><a href="#cb1657-2" tabindex="-1"></a><span class="co"># In per cent up to two digits after decimal</span></span>
<span id="cb1657-3"><a href="#cb1657-3" tabindex="-1"></a><span class="fu">percent</span>(<span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.1234</span>, <span class="fl">0.002</span>), <span class="at">accuracy =</span> <span class="fl">0.01</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1657-4"><a href="#cb1657-4" tabindex="-1"></a>  <span class="fu">writeLines</span>()</span></code></pre></div>
<pre><code>## 0.10%
## 12.34%
## 0.20%</code></pre>
<div class="sourceCode" id="cb1659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1659-1"><a href="#cb1659-1" tabindex="-1"></a><span class="co"># With thousand separator</span></span>
<span id="cb1659-2"><a href="#cb1659-2" tabindex="-1"></a><span class="fu">comma</span>(numbers<span class="sc">*</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1659-3"><a href="#cb1659-3" tabindex="-1"></a>  <span class="fu">writeLines</span>()</span></code></pre></div>
<pre><code>## 1
## 123,000
## 1,236</code></pre>
<div class="sourceCode" id="cb1661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1661-1"><a href="#cb1661-1" tabindex="-1"></a><span class="co"># With rupee symbol</span></span>
<span id="cb1661-2"><a href="#cb1661-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1661-3"><a href="#cb1661-3" tabindex="-1"></a><span class="fu">runif</span>(<span class="dv">3</span>, <span class="dv">1000</span>, <span class="dv">90000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1661-4"><a href="#cb1661-4" tabindex="-1"></a>  <span class="fu">dollar</span>(<span class="at">prefix =</span> <span class="st">&quot;\U20b9&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1661-5"><a href="#cb1661-5" tabindex="-1"></a>  <span class="fu">writeLines</span>()</span></code></pre></div>
<pre><code>## ₹26,594.40
## ₹71,159.16
## ₹37,398.95</code></pre>
</div>
<div id="padding-strings" class="section level2" number="28.15">
<h2><span class="header-section-number">28.15</span> Padding strings</h2>
<p>We dealt with removing extra white-spaces from the strings using <code>str_trim</code>. Sometimes requirements are on the contrary i.e. to add white-space or any other character to the left or right or both sides of the string (vector usually) so that its length can be made uniform. We may use <code>str_pad()</code> in such scenarios. Its syntax is -</p>
<pre><code>str_pad(
  string, 
  width,
  side = c(&quot;left&quot;, &quot;right&quot;, &quot;both&quot;),
  pad = &quot; &quot;,
  use_width = TRUE
)</code></pre>
<p>Example -</p>
<div class="sourceCode" id="cb1664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1664-1"><a href="#cb1664-1" tabindex="-1"></a><span class="fu">str_view</span>(</span>
<span id="cb1664-2"><a href="#cb1664-2" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">str_pad</span>(<span class="st">&quot;anil&quot;</span>, <span class="dv">30</span>, <span class="st">&quot;left&quot;</span>),</span>
<span id="cb1664-3"><a href="#cb1664-3" tabindex="-1"></a>  <span class="fu">str_pad</span>(<span class="st">&quot;anil&quot;</span>, <span class="dv">30</span>, <span class="st">&quot;right&quot;</span>),</span>
<span id="cb1664-4"><a href="#cb1664-4" tabindex="-1"></a>  <span class="fu">str_pad</span>(<span class="st">&quot;anil&quot;</span>, <span class="dv">30</span>, <span class="st">&quot;both&quot;</span>))</span>
<span id="cb1664-5"><a href="#cb1664-5" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] │                           anil
## [2] │ anil                          
## [3] │              anil</code></pre>
</div>
<div id="sorting-strings" class="section level2" number="28.16">
<h2><span class="header-section-number">28.16</span> Sorting strings</h2>
<p>To sort the strings, we have three powerful functions in the kitty of stringr.</p>
<ul>
<li><code>str_sort()</code> returns the sorted vector.</li>
<li><code>str_order()</code> returns an integer vector that returns the desired order when used for sub-setting, i.e. <code>x[str_order(x)]</code> is the same as <code>str_sort()</code></li>
<li><code>str_rank()</code> returns the ranks of the values, i.e. <code>arrange(df, str_rank(x))</code> is the same as <code>str_sort(df$x)</code></li>
</ul>
<p>Besides doing sorting for us, these functions have an argument <code>numeric</code> which if set to <code>TRUE</code> will sort digits numerically, instead of as strings. The following example will clarify the purpose.</p>
<div class="sourceCode" id="cb1666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1666-1"><a href="#cb1666-1" tabindex="-1"></a><span class="fu">str_view</span>(fruits)</span></code></pre></div>
<pre><code>## [1] │ one apple
## [2] │ two bananas
## [3] │ three pineapples</code></pre>
<div class="sourceCode" id="cb1668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1668-1"><a href="#cb1668-1" tabindex="-1"></a><span class="co"># Let&#39;s sort these alphabetically</span></span>
<span id="cb1668-2"><a href="#cb1668-2" tabindex="-1"></a><span class="fu">str_sort</span>(fruits)</span></code></pre></div>
<pre><code>## [1] &quot;one apple&quot;        &quot;three pineapples&quot; &quot;two bananas&quot;</code></pre>
<div class="sourceCode" id="cb1670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1670-1"><a href="#cb1670-1" tabindex="-1"></a><span class="co"># Let&#39;s find the alphabetic order</span></span>
<span id="cb1670-2"><a href="#cb1670-2" tabindex="-1"></a><span class="fu">str_order</span>(fruits)</span></code></pre></div>
<pre><code>## [1] 1 3 2</code></pre>
<div class="sourceCode" id="cb1672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1672-1"><a href="#cb1672-1" tabindex="-1"></a><span class="do">## Example-2</span></span>
<span id="cb1672-2"><a href="#cb1672-2" tabindex="-1"></a>ex_text <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;₹100&quot;</span>, <span class="st">&quot;₹200&quot;</span>, <span class="st">&quot;₹1000&quot;</span>, <span class="st">&quot;₹500&quot;</span>, <span class="st">&quot;₹5000&quot;</span>, <span class="st">&quot;₹10000&quot;</span>)</span>
<span id="cb1672-3"><a href="#cb1672-3" tabindex="-1"></a></span>
<span id="cb1672-4"><a href="#cb1672-4" tabindex="-1"></a><span class="co"># default sorting</span></span>
<span id="cb1672-5"><a href="#cb1672-5" tabindex="-1"></a><span class="fu">str_sort</span>(ex_text)</span></code></pre></div>
<pre><code>## [1] &quot;₹100&quot;   &quot;₹1000&quot;  &quot;₹10000&quot; &quot;₹200&quot;   &quot;₹500&quot;   &quot;₹5000&quot;</code></pre>
<div class="sourceCode" id="cb1674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1674-1"><a href="#cb1674-1" tabindex="-1"></a><span class="co"># Order</span></span>
<span id="cb1674-2"><a href="#cb1674-2" tabindex="-1"></a><span class="fu">str_order</span>(ex_text)</span></code></pre></div>
<pre><code>## [1] 1 3 6 2 4 5</code></pre>
<div class="sourceCode" id="cb1676"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1676-1"><a href="#cb1676-1" tabindex="-1"></a><span class="co"># Rank</span></span>
<span id="cb1676-2"><a href="#cb1676-2" tabindex="-1"></a><span class="fu">str_rank</span>(ex_text)</span></code></pre></div>
<pre><code>## [1] 1 4 2 5 6 3</code></pre>
<div class="sourceCode" id="cb1678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1678-1"><a href="#cb1678-1" tabindex="-1"></a><span class="co"># sorting based on numbers</span></span>
<span id="cb1678-2"><a href="#cb1678-2" tabindex="-1"></a><span class="fu">str_sort</span>(ex_text, <span class="at">numeric =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;₹100&quot;   &quot;₹200&quot;   &quot;₹500&quot;   &quot;₹1000&quot;  &quot;₹5000&quot;  &quot;₹10000&quot;</code></pre>
<hr />
<!--chapter:end:14-1Stringr.Rmd-->
</div>
</div>
<div id="regex---a-quick-introduction" class="section level1" number="29">
<h1><span class="header-section-number">29</span> Regex - A quick introduction</h1>
<p>A <strong>Regular Expression</strong>, or <strong>regex</strong> for short, is a powerful tool, which helps us writing code for pattern matching in texts. Regex, is a pattern that describes a set of strings. It is a sequence of characters that define a search pattern. It is used to search for and manipulate text. Regex can be used in many programming languages, including R.</p>
<p>Regex patterns are made up of a combination of regular characters and special characters. Regular characters include letters, digits, and punctuation marks. Special characters have a specific meaning in regex and are used to represent patterns of characters.</p>
<p>Regex patterns can be used for a variety of purposes, including:</p>
<ul>
<li>Searching for specific strings in text</li>
<li>Extracting specific parts of a string</li>
<li>Replacing parts of a string with other text</li>
<li>Validating input from users</li>
</ul>
<p>In R, we can use the <code>grep</code> and <code>gsub</code> functions to search for and manipulate text using regex.</p>
<div id="basic-regex---literal-characters" class="section level2" number="29.1">
<h2><span class="header-section-number">29.1</span> Basic Regex - Literal Characters</h2>
<p>Every <em>literal character</em>, in itself is a <code>regex</code> that matches itself. Thus, <code>a</code> matches third character in text <code>Charles</code>. These literal characters are case sensitive.</p>
<p>Example-1</p>
<div class="sourceCode" id="cb1680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1680-1"><a href="#cb1680-1" tabindex="-1"></a>ex_text <span class="ot">&lt;-</span> <span class="st">&quot;This is an example text&quot;</span></span>
<span id="cb1680-2"><a href="#cb1680-2" tabindex="-1"></a><span class="co"># Match literal `x`</span></span>
<span id="cb1680-3"><a href="#cb1680-3" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="st">&quot;x&quot;</span>)</span></code></pre></div>
<pre><code>## [1] │ This is an e&lt;x&gt;ample te&lt;x&gt;t</code></pre>
<div class="sourceCode" id="cb1682"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1682-1"><a href="#cb1682-1" tabindex="-1"></a><span class="co"># Match Upper case literal &quot;X&quot;</span></span>
<span id="cb1682-2"><a href="#cb1682-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="st">&quot;X&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ This is an example text</code></pre>
<div id="case-sensitivity" class="section level3" number="29.1.1">
<h3><span class="header-section-number">29.1.1</span> Case sensitivity</h3>
<p>As the literals are case_sensitive and we sometimes are not aware of exact case, to match case insensitive literals, we can make use of <code>stringr</code> function <code>regex</code> in this case, wherein an argument <code>ignore_case</code> (note snake case) is there. Actually, behind the scenes, all regex expressions in stringr are wrapped in this function with argument defaults as <code>FALSE</code>. Thus, the code in above example is actually equivalent to the following-</p>
<div class="sourceCode" id="cb1684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1684-1"><a href="#cb1684-1" tabindex="-1"></a><span class="co"># Match literal `x`</span></span>
<span id="cb1684-2"><a href="#cb1684-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="fu">regex</span>(<span class="st">&quot;x&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ This is an e&lt;x&gt;ample te&lt;x&gt;t</code></pre>
<div class="sourceCode" id="cb1686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1686-1"><a href="#cb1686-1" tabindex="-1"></a><span class="co"># Match Upper case literal &quot;X&quot;</span></span>
<span id="cb1686-2"><a href="#cb1686-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="fu">regex</span>(<span class="st">&quot;X&quot;</span>), <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ This is an example text</code></pre>
<p>Thus, to match case insensitive literals (or other regex expressions) we may make use of the argument <code>ignore_case</code> like this-</p>
<div class="sourceCode" id="cb1688"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1688-1"><a href="#cb1688-1" tabindex="-1"></a><span class="co"># Match literal `x`</span></span>
<span id="cb1688-2"><a href="#cb1688-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="fu">regex</span>(<span class="st">&quot;X&quot;</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## [1] │ This is an e&lt;x&gt;ample te&lt;x&gt;t</code></pre>
</div>
</div>
<div id="metacharacters" class="section level2" number="29.2">
<h2><span class="header-section-number">29.2</span> Metacharacters</h2>
<div id="character-sets" class="section level3" number="29.2.1">
<h3><span class="header-section-number">29.2.1</span> Character sets</h3>
<p>It is always not feasible to put every literal characters. We may also match literal characters from a given set of options. To <strong>match a group of characters</strong> we have to put all these in square brackets. So, <code>[abc]</code> matches either of <code>a</code>, <code>b</code>, or <code>c</code>.</p>
<p>Example-</p>
<div class="sourceCode" id="cb1690"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1690-1"><a href="#cb1690-1" tabindex="-1"></a>ex_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Apple&quot;</span>, <span class="st">&quot;Orange&quot;</span>, <span class="st">&quot;Myrrh&quot;</span>)</span>
<span id="cb1690-2"><a href="#cb1690-2" tabindex="-1"></a><span class="co"># matches a vowel</span></span>
<span id="cb1690-3"><a href="#cb1690-3" tabindex="-1"></a><span class="fu">str_view</span>(ex_vec, <span class="st">&quot;[aeiou]&quot;</span>)</span></code></pre></div>
<pre><code>## [1] │ Appl&lt;e&gt;
## [2] │ Or&lt;a&gt;ng&lt;e&gt;</code></pre>
<div class="sourceCode" id="cb1692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1692-1"><a href="#cb1692-1" tabindex="-1"></a><span class="co"># matches a vowel irrespective of case</span></span>
<span id="cb1692-2"><a href="#cb1692-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_vec, <span class="fu">regex</span>(<span class="st">&quot;[aeiou]&quot;</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;A&gt;ppl&lt;e&gt;
## [2] │ &lt;O&gt;r&lt;a&gt;ng&lt;e&gt;</code></pre>
<p>To <strong>match a range of characters/numbers</strong> we can separate these by hyphen in square brackets. So, <code>[a-n]</code> will match a character from range <code>[abcdefghijklmn]</code>.</p>
<p>Example-</p>
<div class="sourceCode" id="cb1694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1694-1"><a href="#cb1694-1" tabindex="-1"></a>ex_text <span class="ot">&lt;-</span> <span class="st">&quot;The quick brown fox jumps over the lazy dog&quot;</span></span>
<span id="cb1694-2"><a href="#cb1694-2" tabindex="-1"></a><span class="co"># Match a, b or c in lower case</span></span>
<span id="cb1694-3"><a href="#cb1694-3" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="fu">regex</span>(<span class="st">&quot;[a-c]&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ The qui&lt;c&gt;k &lt;b&gt;rown fox jumps over the l&lt;a&gt;zy dog</code></pre>
<p>Example-2</p>
<div class="sourceCode" id="cb1696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1696-1"><a href="#cb1696-1" tabindex="-1"></a>ex_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;gray&quot;</span>)</span>
<span id="cb1696-2"><a href="#cb1696-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_colors, <span class="st">&quot;gr[ae]y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] │ &lt;grey&gt;
## [3] │ &lt;gray&gt;</code></pre>
<p>We can also use <strong>pre-built character classes</strong> listed below.</p>
<ul>
<li><code>[:punct:]</code> punctuation.</li>
<li><code>[:alpha:]</code> letters.</li>
<li><code>[:lower:]</code> lowercase letters.</li>
<li><code>[:upper:]</code> uppercase letters.</li>
<li><code>[:digit:]</code> digits.</li>
<li><code>[:xdigit:]</code> hex digits.</li>
<li><code>[:alnum:]</code> letters and numbers.</li>
<li><code>[:cntrl:]</code> control characters.</li>
<li><code>[:graph:]</code> letters, numbers, and punctuation.</li>
<li><code>[:print:]</code> letters, numbers, punctuation, and white-space.</li>
<li><code>[:space:]</code> space characters (basically equivalent to <code>\\s</code>).</li>
<li><code>[:blank:]</code> space and tab.</li>
</ul>
<p>Example-</p>
<div class="sourceCode" id="cb1698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1698-1"><a href="#cb1698-1" tabindex="-1"></a>ex_vec2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;One apple&quot;</span>, <span class="st">&quot;2 Oranges&quot;</span>)</span>
<span id="cb1698-2"><a href="#cb1698-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_vec2, <span class="st">&quot;[:digit:]&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ One apple
## [2] │ &lt;2&gt; Oranges</code></pre>
</div>
<div id="non-printable-characters-meta-characters-short-hand-character-classes" class="section level3" number="29.2.2">
<h3><span class="header-section-number">29.2.2</span> Non-printable characters/ Meta characters (short-hand character classes)</h3>
<p>We can use special character sequences to put non-printable characters in our regular expression(s). E.g. <code>\t</code> matches a tab character. <strong>But since <code>\</code> is an escape character in R, we need to escape it too.</strong> So to match a tab character we have to put <code>\\t</code> in our regex sequence. Regex for that matches new line (line feed) is <code>\\n</code>. <code>Regex</code> for other meta characters is listed below-</p>
<ul>
<li><code>\\s</code> matches a white-space character. Moreover, its complement <code>\\S</code> matches any character except a white-space.</li>
<li><code>\\w</code> matches any alphanumeric character. Similarly, its complement is <code>\\W</code> which matches any character except alphanumeric characters.</li>
<li><code>\\d</code> matches any digit. Similarly, its complement is <code>\\D</code> which matches any character except digits.</li>
<li><code>\\b</code> matches any word boundary. Thus, <code>\\B</code> matches any character except a word boundary.</li>
<li><code>.</code> matches any character. To match a literal dot <code>.</code> we have to escape that; and thus <code>\\.</code> matches a dot character.</li>
</ul>
<p>See these examples-</p>
<div class="sourceCode" id="cb1700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1700-1"><a href="#cb1700-1" tabindex="-1"></a>ex_vec3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;One apple&quot;</span>, <span class="st">&quot;2 oranges &amp; 3 bananas.&quot;</span>)</span>
<span id="cb1700-2"><a href="#cb1700-2" tabindex="-1"></a><span class="co"># match word character</span></span>
<span id="cb1700-3"><a href="#cb1700-3" tabindex="-1"></a><span class="fu">str_view</span>(ex_vec3, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">w&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ &lt;O&gt;&lt;n&gt;&lt;e&gt; &lt;a&gt;&lt;p&gt;&lt;p&gt;&lt;l&gt;&lt;e&gt;
## [2] │ &lt;2&gt; &lt;o&gt;&lt;r&gt;&lt;a&gt;&lt;n&gt;&lt;g&gt;&lt;e&gt;&lt;s&gt; &amp; &lt;3&gt; &lt;b&gt;&lt;a&gt;&lt;n&gt;&lt;a&gt;&lt;n&gt;&lt;a&gt;&lt;s&gt;.</code></pre>
<div class="sourceCode" id="cb1702"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1702-1"><a href="#cb1702-1" tabindex="-1"></a><span class="co"># match any character followed by a dot character</span></span>
<span id="cb1702-2"><a href="#cb1702-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_vec3, <span class="st">&quot;.</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ One apple
## [2] │ 2 oranges &amp; 3 banana&lt;s.&gt;</code></pre>
<div class="sourceCode" id="cb1704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1704-1"><a href="#cb1704-1" tabindex="-1"></a><span class="co"># Note both character and dot will be matched</span></span></code></pre></div>
</div>
</div>
<div id="quantifiers" class="section level2" number="29.3">
<h2><span class="header-section-number">29.3</span> Quantifiers</h2>
<p>What if we want to match more than one literal/character through <code>regex</code>? Let’s say if we want to check whether the given string or string vector contain two consecutive vowels. One method may be to use character classes two times i.e. using <code>[aeiou][aeiou]</code>. But this method is against the principles of <strong>DRY</strong><a href="#fn35" class="footnote-ref" id="fnref35"><sup>35</sup></a> which is one of the common principle of programming. To solve these issues, we have quantifiers.</p>
<ul>
<li><code>+</code> <strong>1 or more</strong> occurrences</li>
<li><code>*</code> <strong>0 or more</strong></li>
<li><code>?</code> <strong>0 or 1</strong></li>
<li><code>{}</code> specified numbers
<ul>
<li><code>{n}</code> exactly n</li>
<li><code>{n,}</code> n or more</li>
<li><code>{n,m}</code> between n and m</li>
</ul></li>
</ul>
<p>Thus, we may match two consecutive vowels using <code>[aeiou]{2}</code>. See this example</p>
<div class="sourceCode" id="cb1705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1705-1"><a href="#cb1705-1" tabindex="-1"></a>ex_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Apple&quot;</span>, <span class="st">&quot;Banana&quot;</span>, <span class="st">&quot;pineapple&quot;</span>)</span>
<span id="cb1705-2"><a href="#cb1705-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_vec, <span class="st">&quot;[aeiou]{2}&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ Apple
## [2] │ Banana
## [3] │ pin&lt;ea&gt;pple</code></pre>
</div>
<div id="alternation" class="section level2" number="29.4">
<h2><span class="header-section-number">29.4</span> Alternation</h2>
<p>Alternation in regular expressions allows you to match one pattern or another, depending on which one appears first in the input string. The pipe symbol <code>|</code> is used to separate the alternative patterns.</p>
<div id="basic-alternation" class="section level5" number="29.4.0.0.1">
<h5><span class="header-section-number">29.4.0.0.1</span> Basic Alternation</h5>
<p>Let’s start with a basic example to illustrate how alternation works:</p>
<div class="sourceCode" id="cb1707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1707-1"><a href="#cb1707-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">&quot;I have an apple and a banana&quot;</span></span>
<span id="cb1707-2"><a href="#cb1707-2" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">&quot;apple|banana&quot;</span></span>
<span id="cb1707-3"><a href="#cb1707-3" tabindex="-1"></a></span>
<span id="cb1707-4"><a href="#cb1707-4" tabindex="-1"></a><span class="fu">str_extract</span>(string, pattern)</span></code></pre></div>
<pre><code>## [1] &quot;apple&quot;</code></pre>
</div>
<div id="order-of-precedence" class="section level5" number="29.4.0.0.2">
<h5><span class="header-section-number">29.4.0.0.2</span> Order of Precedence</h5>
<p>When using alternation, it’s important to keep in mind the order of precedence rules. In general, the first pattern that matches the input string will be selected, and subsequent patterns will not be considered. Here’s an example to illustrate this:</p>
<div class="sourceCode" id="cb1709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1709-1"><a href="#cb1709-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">&quot;I have a pineapple and an apple&quot;</span></span>
<span id="cb1709-2"><a href="#cb1709-2" tabindex="-1"></a><span class="fu">str_extract</span>(string, <span class="at">pattern =</span> <span class="st">&quot;apple|pineapple&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;pineapple&quot;</code></pre>
<p>In this example, we have a string <code>string</code> that contains the words “apple” and “pineapple”. We want to extract the first occurrence of either “apple” or “pineapple” from this text using a regular expression pattern that utilizes alternation. The pattern <code>apple|pineapple</code> means “match ‘apple’ OR ‘pineapple’”. However, since the input string contains “pineapple” before “apple”, the <code>str_extract()</code> function selects the first matching string “pineapple”.</p>
</div>
<div id="grouping-alternatives" class="section level5" number="29.4.0.0.3">
<h5><span class="header-section-number">29.4.0.0.3</span> Grouping Alternatives</h5>
<p>We can also use parentheses to group alternative patterns together. This can be useful for specifying more complex patterns. Example:</p>
<div class="sourceCode" id="cb1711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1711-1"><a href="#cb1711-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">&quot;Apple and pineapples are good for health&quot;</span></span>
<span id="cb1711-2"><a href="#cb1711-2" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">&quot;(apple|banana|cherry) (and|or) (pineapple|kiwi|mango)&quot;</span></span>
<span id="cb1711-3"><a href="#cb1711-3" tabindex="-1"></a></span>
<span id="cb1711-4"><a href="#cb1711-4" tabindex="-1"></a><span class="fu">str_view</span>(string, <span class="fu">regex</span>(pattern, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;Apple and pineapple&gt;s are good for health</code></pre>
<p>In above examples, we have used <code>stringr::regex()</code> to modify regex flag to ignore cases while matching.</p>
</div>
</div>
<div id="anchors" class="section level2" number="29.5">
<h2><span class="header-section-number">29.5</span> Anchors</h2>
<p>Anchors in regular expressions allow you to match patterns at specific positions within the input string. In R, you can use various anchors in your regular expressions to match the beginning, end, or specific positions within the input text.</p>
<div id="beginning-and-end-anchors" class="section level3" number="29.5.1">
<h3><span class="header-section-number">29.5.1</span> Beginning and End Anchors</h3>
<p>The beginning anchor <code>^</code> and end anchor <code>$</code> are used to match patterns at the beginning or end of the input string, respectively. Example</p>
<div class="sourceCode" id="cb1713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1713-1"><a href="#cb1713-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">&quot;The quick brown fox jumps over the lazy dog. The fox is brown.&quot;</span></span>
<span id="cb1713-2"><a href="#cb1713-2" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">&quot;^the&quot;</span></span>
<span id="cb1713-3"><a href="#cb1713-3" tabindex="-1"></a><span class="fu">str_view</span>(string, <span class="fu">regex</span>(pattern, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;The&gt; quick brown fox jumps over the lazy dog. The fox is brown.</code></pre>
<p>In the above example, we are matching word <code>the</code> which is at the beginning of a sentence only.</p>
</div>
<div id="word-boundary-anchors" class="section level3" number="29.5.2">
<h3><span class="header-section-number">29.5.2</span> Word Boundary Anchors</h3>
<p>The word boundary anchor <code>\\b</code> is used to match patterns at the beginning or end of a word within the input string. Example</p>
<div class="sourceCode" id="cb1715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1715-1"><a href="#cb1715-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">&#39;Apple and pineapple, both are good for health&#39;</span></span>
<span id="cb1715-2"><a href="#cb1715-2" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">&#39;</span><span class="sc">\\</span><span class="st">bapple</span><span class="sc">\\</span><span class="st">b&#39;</span></span>
<span id="cb1715-3"><a href="#cb1715-3" tabindex="-1"></a><span class="fu">str_view</span>(string, <span class="fu">regex</span>(pattern, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;Apple&gt; and pineapple, both are good for health</code></pre>
<p>In the above example, though <code>apple</code> string is contained in another word <code>pineapple</code> we are limiting our search for whole words only.</p>
</div>
</div>
<div id="capture-groups" class="section level2" number="29.6">
<h2><span class="header-section-number">29.6</span> Capture Groups</h2>
<p>A capture group is a way to group a part of a regular expression and capture it as a separate sub-string. This can be useful when you want to extract or replace a specific part of a string. In R, capture groups are denoted by parentheses <code>()</code>. Anything inside the parentheses is captured and can be referenced later in the regular expression or in the replacement string.</p>
<p>One use of capturing group is to refer back to it within a match with back reference: <code>\1</code> refers to the match contained in the first parenthesis, <code>\2</code> in the second parenthesis, and so on.</p>
<p>Example-1</p>
<div class="sourceCode" id="cb1717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1717-1"><a href="#cb1717-1" tabindex="-1"></a>my_fruits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;apple&#39;</span>, <span class="st">&#39;banana&#39;</span>, <span class="st">&#39;coconut&#39;</span>, <span class="st">&#39;berry&#39;</span>, <span class="st">&#39;cucumber&#39;</span>, <span class="st">&#39;date&#39;</span>)</span>
<span id="cb1717-2"><a href="#cb1717-2" tabindex="-1"></a><span class="co"># search for repeated alphabet</span></span>
<span id="cb1717-3"><a href="#cb1717-3" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">&#39;(.)</span><span class="sc">\\</span><span class="st">1&#39;</span></span>
<span id="cb1717-4"><a href="#cb1717-4" tabindex="-1"></a><span class="fu">str_view</span>(my_fruits, <span class="fu">regex</span>(pattern), <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ a&lt;pp&gt;le
## [2] │ banana
## [3] │ coconut
## [4] │ be&lt;rr&gt;y
## [5] │ cucumber
## [6] │ date</code></pre>
<p>Example-2</p>
<div class="sourceCode" id="cb1719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1719-1"><a href="#cb1719-1" tabindex="-1"></a><span class="co"># search for repeated pair of alphabets</span></span>
<span id="cb1719-2"><a href="#cb1719-2" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">&#39;(..)</span><span class="sc">\\</span><span class="st">1&#39;</span></span>
<span id="cb1719-3"><a href="#cb1719-3" tabindex="-1"></a><span class="fu">str_view</span>(my_fruits, <span class="fu">regex</span>(pattern), <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ apple
## [2] │ b&lt;anan&gt;a
## [3] │ &lt;coco&gt;nut
## [4] │ berry
## [5] │ &lt;cucu&gt;mber
## [6] │ date</code></pre>
<p>Another way to use capturing group is, when we want to replace the pattern with something else. It is better to understand this with the following example-</p>
<div class="sourceCode" id="cb1721"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1721-1"><a href="#cb1721-1" tabindex="-1"></a><span class="co"># We have names in last_name, first_name format</span></span>
<span id="cb1721-2"><a href="#cb1721-2" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Hanks, Tom&#39;</span>, <span class="st">&#39;Affleck, Ben&#39;</span>, <span class="st">&#39;Damon, Matt&#39;</span>)</span>
<span id="cb1721-3"><a href="#cb1721-3" tabindex="-1"></a><span class="fu">str_view</span>(names)</span></code></pre></div>
<pre><code>## [1] │ Hanks, Tom
## [2] │ Affleck, Ben
## [3] │ Damon, Matt</code></pre>
<div class="sourceCode" id="cb1723"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1723-1"><a href="#cb1723-1" tabindex="-1"></a><span class="co"># Using this regex, we can convert these to first_name last_name format</span></span>
<span id="cb1723-2"><a href="#cb1723-2" tabindex="-1"></a><span class="fu">str_replace_all</span>(names, <span class="st">&#39;(</span><span class="sc">\\</span><span class="st">w+),</span><span class="sc">\\</span><span class="st">s+(</span><span class="sc">\\</span><span class="st">w+)&#39;</span>, <span class="st">&#39;</span><span class="sc">\\</span><span class="st">2 </span><span class="sc">\\</span><span class="st">1&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Tom Hanks&quot;   &quot;Ben Affleck&quot; &quot;Matt Damon&quot;</code></pre>
</div>
<div id="lookarounds" class="section level2" number="29.7">
<h2><span class="header-section-number">29.7</span> Lookarounds</h2>
<p><strong>Look-ahead</strong> and <strong>look-behinds</strong> are zero-width assertions in regex. They are used to match a pattern only if it is followed or preceded by another pattern, respectively. The pattern in the look-ahead or look-behind is not included in the match.</p>
<div id="lookahead" class="section level3" number="29.7.1">
<h3><span class="header-section-number">29.7.1</span> Lookahead</h3>
<p>A look-ahead is used to match a pattern only if it is followed by another pattern. <em>Positive Lookaheads</em> are written as <code>(?=...)</code>, where <code>...</code> is the pattern that must follow the match.</p>
<p>For example, the regex pattern <code>hello(?= world)</code> matches “hello” only if it is followed by ” world”. It matches “hello world” but not “hello there world” or “hello”.</p>
<p>Example</p>
<div class="sourceCode" id="cb1725"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1725-1"><a href="#cb1725-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;hello world&quot;</span>, <span class="st">&quot;hello there world&quot;</span>, <span class="st">&quot;hello&quot;</span>)</span>
<span id="cb1725-2"><a href="#cb1725-2" tabindex="-1"></a><span class="fu">str_view</span>(string, <span class="st">&quot;hello(?= world)&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ &lt;hello&gt; world
## [2] │ hello there world
## [3] │ hello</code></pre>
<div class="sourceCode" id="cb1727"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1727-1"><a href="#cb1727-1" tabindex="-1"></a><span class="co"># Note that &quot;world&quot; is not included in the match</span></span></code></pre></div>
</div>
<div id="lookbehind" class="section level3" number="29.7.2">
<h3><span class="header-section-number">29.7.2</span> Lookbehind</h3>
<p>A look-behind is used to match a pattern only if it is preceded by another pattern. Look-behinds are written as <code>(?&lt;=...)</code>, where <code>...</code> is the pattern that must precede the match.</p>
<p>For example, the regex pattern <code>(?&lt;=hello )world</code> matches “world” only if it is preceded by “hello”. It matches “hello world” but not “world hello” or “hello there world”.</p>
<p>Example</p>
<div class="sourceCode" id="cb1728"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1728-1"><a href="#cb1728-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;hello world&quot;</span>, <span class="st">&quot;world hello&quot;</span>, <span class="st">&quot;hello there world&quot;</span>)</span>
<span id="cb1728-2"><a href="#cb1728-2" tabindex="-1"></a><span class="fu">str_view</span>(string, <span class="st">&quot;(?&lt;=hello )world&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ hello &lt;world&gt;
## [2] │ world hello
## [3] │ hello there world</code></pre>
</div>
<div id="negative-lookahead-and-lookbehinds" class="section level3" number="29.7.3">
<h3><span class="header-section-number">29.7.3</span> Negative Lookahead and Lookbehinds</h3>
<p>Negative look-ahead and negative look-behinds are used to match a pattern only if it is not followed or preceded by another pattern, respectively. Negative look-ahead and look-behinds are written as <code>(?!...)</code> and <code>(?&lt;!...)</code>, respectively.</p>
<p>For example, the regex pattern <code>hello(?! world)</code> matches “hello” only if it is not followed by ” world”. It matches “hello there” but not “hello world” or “hello world there”.</p>
<p>Example-</p>
<div class="sourceCode" id="cb1730"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1730-1"><a href="#cb1730-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;hello there&quot;</span>, <span class="st">&quot;hello world&quot;</span>, <span class="st">&quot;hello world there&quot;</span>)</span>
<span id="cb1730-2"><a href="#cb1730-2" tabindex="-1"></a><span class="fu">str_view</span>(string, <span class="st">&quot;hello(?! world)&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ &lt;hello&gt; there
## [2] │ hello world
## [3] │ hello world there</code></pre>
<p>And the regex pattern <code>(?&lt;!hello )world</code> matches “world” only if it is not preceded by “hello”. It matches “world hello” and “hello there world” but not “hello world”.</p>
<div class="sourceCode" id="cb1732"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1732-1"><a href="#cb1732-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;hello world&quot;</span>, <span class="st">&quot;world hello&quot;</span>, <span class="st">&quot;hello there world&quot;</span>)</span>
<span id="cb1732-2"><a href="#cb1732-2" tabindex="-1"></a><span class="fu">str_view</span>(string, <span class="st">&quot;(?&lt;!hello )world&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ hello world
## [2] │ &lt;world&gt; hello
## [3] │ hello there &lt;world&gt;</code></pre>
<p><em>While the difference between the look-ahead and look-behind may be subtle, yet these become clear when string/pattern replacement or extraction is required.</em></p>
<p>Examples-</p>
<div class="sourceCode" id="cb1734"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1734-1"><a href="#cb1734-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">&quot;I have 10 apples, 6 pineapples and 5 bananas&quot;</span></span>
<span id="cb1734-2"><a href="#cb1734-2" tabindex="-1"></a></span>
<span id="cb1734-3"><a href="#cb1734-3" tabindex="-1"></a><span class="co"># look-behind to match &quot;apples&quot; preceded by a digit and a space</span></span>
<span id="cb1734-4"><a href="#cb1734-4" tabindex="-1"></a>pattern1 <span class="ot">&lt;-</span> <span class="st">&quot;(?&lt;=</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">s)apples&quot;</span>  </span>
<span id="cb1734-5"><a href="#cb1734-5" tabindex="-1"></a></span>
<span id="cb1734-6"><a href="#cb1734-6" tabindex="-1"></a><span class="co"># look-ahead to match count of apples</span></span>
<span id="cb1734-7"><a href="#cb1734-7" tabindex="-1"></a>pattern2 <span class="ot">&lt;-</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">sapple)&quot;</span>  </span>
<span id="cb1734-8"><a href="#cb1734-8" tabindex="-1"></a></span>
<span id="cb1734-9"><a href="#cb1734-9" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> string, <span class="at">pattern =</span> pattern1, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ I have 10 &lt;apples&gt;, 6 pineapples and 5 bananas</code></pre>
<div class="sourceCode" id="cb1736"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1736-1"><a href="#cb1736-1" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> string, <span class="at">pattern =</span> pattern2, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ I have &lt;10&gt; apples, 6 pineapples and 5 bananas</code></pre>
</div>
</div>
<div id="comments" class="section level2" number="29.8">
<h2><span class="header-section-number">29.8</span> Comments</h2>
<div id="comments-within-regex" class="section level3" number="29.8.1">
<h3><span class="header-section-number">29.8.1</span> Comments within regex</h3>
<p>We can use the # character to add comments within a regex pattern. Any text following the <code>#</code> symbol on a line is ignored by the regex engine and treated as a comment. This can be useful for documenting your regex patterns or temporarily disabling parts of a pattern for testing or debugging. Example-</p>
<div class="sourceCode" id="cb1738"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1738-1"><a href="#cb1738-1" tabindex="-1"></a><span class="fu">str_view</span>(<span class="fu">c</span>(<span class="st">&quot;xyz&quot;</span>,<span class="st">&quot;abc&quot;</span>), <span class="st">&quot;x(?#this is a comment)&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ &lt;x&gt;yz
## [2] │ abc</code></pre>
</div>
<div id="verbose-mode-multi-line-comments" class="section level3" number="29.8.2">
<h3><span class="header-section-number">29.8.2</span> Verbose Mode (multi-line comments)</h3>
<p>In regular expressions, verbose mode is a feature that allows you to write more readable and maintainable regex patterns by adding comments and white-space without affecting their behavior. To enable verbose mode, we can use the <code>(?x)</code> or <code>(?verbose)</code> modifier at the beginning of your regex pattern.</p>
<p>Example - Using this regex we can extract words that contain a vowel at third place.</p>
<div class="sourceCode" id="cb1740"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1740-1"><a href="#cb1740-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">&quot;The quick brown fox jumps over the lazy dog&quot;</span></span>
<span id="cb1740-2"><a href="#cb1740-2" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">&quot;(?x)      # Enable verbose mode</span></span>
<span id="cb1740-3"><a href="#cb1740-3" tabindex="-1"></a><span class="st">            </span><span class="sc">\\</span><span class="st">b       # Match word boundary</span></span>
<span id="cb1740-4"><a href="#cb1740-4" tabindex="-1"></a><span class="st">            </span><span class="sc">\\</span><span class="st">w{2}    # matches first two alphabets</span></span>
<span id="cb1740-5"><a href="#cb1740-5" tabindex="-1"></a><span class="st">            [aeiou]   # Match a vowel</span></span>
<span id="cb1740-6"><a href="#cb1740-6" tabindex="-1"></a><span class="st">            </span><span class="sc">\\</span><span class="st">w*      # Match optional word characters</span></span>
<span id="cb1740-7"><a href="#cb1740-7" tabindex="-1"></a><span class="st">            </span><span class="sc">\\</span><span class="st">b       # Match word boundary&quot;</span></span>
<span id="cb1740-8"><a href="#cb1740-8" tabindex="-1"></a><span class="fu">str_view</span>(string, pattern, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ &lt;The&gt; &lt;quick&gt; &lt;brown&gt; fox jumps &lt;over&gt; &lt;the&gt; lazy dog</code></pre>
</div>
</div>
</div>
<div id="regex-in-human-readble-format-using-rebus" class="section level1" number="30">
<h1><span class="header-section-number">30</span> Regex in human readble format using <code>rebus</code></h1>
<p>Regular expressions, as explained in earlier chapter, are very powerful. However they are often difficult to interpret. There is a package called <code>rebus</code> in R, which allows us to build complex regular expressions from human readable expressions. So instead of writing <code>[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}</code> and later trying to decipher what this expression actually meant, we can use a more human-readble format -</p>
<pre><code>one_or_more(char_class(ASCII_ALNUM %R% &quot;._%+-&quot;)) %R%
  &quot;@&quot; %R%
  one_or_more(char_class(ASCII_ALNUM %R% &quot;.-&quot;)) %R%
  DOT %R%
  ascii_alpha(2, 4)</code></pre>
<p>Many of us could have by now correctly guessed that these both are regular expressions to detect email addresses from the given text strings. Rebus actually contains functions like <code>char_class()</code> or <code>one_or_more()</code> to make building regular expressions easier. So let’s dive in to learn the package.</p>
<p>First of all let’s load the library. Alongside let’s also load <code>stringr</code> so that we can use its function <code>str_view</code> to understand the examples. <strong>Readers may note here that this library <code>rebus</code> also contains a function <code>regex</code> which creates a conflict with <code>stringr::regex</code>. So to avoid that conflict we may use library <code>conflicted</code> here which may set our preferential library in case of conflicts.</strong></p>
<div class="sourceCode" id="cb1743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1743-1"><a href="#cb1743-1" tabindex="-1"></a><span class="fu">library</span>(rebus)</span>
<span id="cb1743-2"><a href="#cb1743-2" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1743-3"><a href="#cb1743-3" tabindex="-1"></a><span class="fu">library</span>(conflicted)</span>
<span id="cb1743-4"><a href="#cb1743-4" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">&quot;regex&quot;</span>, <span class="st">&quot;stringr&quot;</span>)</span>
<span id="cb1743-5"><a href="#cb1743-5" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(rebus<span class="sc">::</span>or)</span></code></pre></div>
<div id="operators-for-concatenation-and-alternation" class="section level2" number="30.1">
<h2><span class="header-section-number">30.1</span> Operators for concatenation and alternation</h2>
<p>For concatenating two regular expressions we may use either of the operators <code>%R%</code> or <code>%c%</code> which like a pipe operator concatenates LHS and RHS together as one regular expression.</p>
<p>For alternation we may use either the operator <code>%|%</code> or function <code>or()</code> from the package which separates two regular expressions through a pipe for alternation.
Example-1:</p>
<div class="sourceCode" id="cb1744"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1744-1"><a href="#cb1744-1" tabindex="-1"></a>my_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;gray&quot;</span>)</span>
<span id="cb1744-2"><a href="#cb1744-2" tabindex="-1"></a><span class="fu">str_view</span>(my_colors, <span class="st">&quot;gr&quot;</span> <span class="sc">%R%</span> <span class="fu">or</span>(<span class="st">&quot;a&quot;</span> , <span class="st">&quot;e&quot;</span>) <span class="sc">%R%</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<pre><code>## [2] │ &lt;grey&gt;
## [4] │ &lt;gray&gt;</code></pre>
<div class="sourceCode" id="cb1746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1746-1"><a href="#cb1746-1" tabindex="-1"></a><span class="co"># Note operator precedence</span></span>
<span id="cb1746-2"><a href="#cb1746-2" tabindex="-1"></a><span class="co"># This actually means either &quot;gra&quot; or &quot;ey&quot;</span></span>
<span id="cb1746-3"><a href="#cb1746-3" tabindex="-1"></a><span class="fu">str_view</span>(my_colors, <span class="st">&quot;gr&quot;</span> <span class="sc">%R%</span> <span class="st">&quot;a&quot;</span> <span class="sc">%|%</span> <span class="st">&quot;e&quot;</span> <span class="sc">%R%</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<pre><code>## [2] │ gr&lt;ey&gt;
## [4] │ &lt;gra&gt;y</code></pre>
</div>
<div id="literal-characters-specvial-characters-and-case-sensitivity" class="section level2" number="30.2">
<h2><span class="header-section-number">30.2</span> Literal Characters, specvial characters and case sensitivity</h2>
<p>The literal characters may, as we learnt earlier, may be given in the string as they mean. Literals are case sensitive too. So if we want a case insensitive match, there is a function <code>case_insensitive</code> here which will take care of the requirement.</p>
<p>Example-2:</p>
<div class="sourceCode" id="cb1748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1748-1"><a href="#cb1748-1" tabindex="-1"></a>ex_text <span class="ot">&lt;-</span> <span class="st">&quot;This is an example text.&quot;</span></span>
<span id="cb1748-2"><a href="#cb1748-2" tabindex="-1"></a><span class="co"># Match literal `x`</span></span>
<span id="cb1748-3"><a href="#cb1748-3" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="st">&quot;X&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ This is an example text.</code></pre>
<div class="sourceCode" id="cb1750"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1750-1"><a href="#cb1750-1" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="fu">case_insensitive</span>(<span class="st">&quot;X&quot;</span>), <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ This is an e&lt;x&gt;ample te&lt;x&gt;t.</code></pre>
<p>To match special characters which may have special meaning in regular expressions, we have constants here. In rebus, the constants are usually available in <code>UPPER CASE</code> and equivalent functions are available in <code>lower case</code>. The following special character constants are available -</p>
<div class="sourceCode" id="cb1752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1752-1"><a href="#cb1752-1" tabindex="-1"></a>BACKSLASH</span></code></pre></div>
<pre><code>## &lt;regex&gt; \\</code></pre>
<div class="sourceCode" id="cb1754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1754-1"><a href="#cb1754-1" tabindex="-1"></a>CARET</span></code></pre></div>
<pre><code>## &lt;regex&gt; \^</code></pre>
<div class="sourceCode" id="cb1756"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1756-1"><a href="#cb1756-1" tabindex="-1"></a>DOLLAR</span></code></pre></div>
<pre><code>## &lt;regex&gt; \$</code></pre>
<div class="sourceCode" id="cb1758"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1758-1"><a href="#cb1758-1" tabindex="-1"></a>DOT</span></code></pre></div>
<pre><code>## &lt;regex&gt; \.</code></pre>
<div class="sourceCode" id="cb1760"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1760-1"><a href="#cb1760-1" tabindex="-1"></a>PIPE</span></code></pre></div>
<pre><code>## &lt;regex&gt; \|</code></pre>
<div class="sourceCode" id="cb1762"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1762-1"><a href="#cb1762-1" tabindex="-1"></a>QUESTION</span></code></pre></div>
<pre><code>## &lt;regex&gt; \?</code></pre>
<div class="sourceCode" id="cb1764"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1764-1"><a href="#cb1764-1" tabindex="-1"></a>STAR</span></code></pre></div>
<pre><code>## &lt;regex&gt; \*</code></pre>
<div class="sourceCode" id="cb1766"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1766-1"><a href="#cb1766-1" tabindex="-1"></a>PLUS</span></code></pre></div>
<pre><code>## &lt;regex&gt; \+</code></pre>
<div class="sourceCode" id="cb1768"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1768-1"><a href="#cb1768-1" tabindex="-1"></a>OPEN_PAREN</span></code></pre></div>
<pre><code>## &lt;regex&gt; \(</code></pre>
<div class="sourceCode" id="cb1770"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1770-1"><a href="#cb1770-1" tabindex="-1"></a>CLOSE_PAREN</span></code></pre></div>
<pre><code>## &lt;regex&gt; \)</code></pre>
<div class="sourceCode" id="cb1772"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1772-1"><a href="#cb1772-1" tabindex="-1"></a>OPEN_BRACKET</span></code></pre></div>
<pre><code>## &lt;regex&gt; \[</code></pre>
<div class="sourceCode" id="cb1774"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1774-1"><a href="#cb1774-1" tabindex="-1"></a>CLOSE_BRACKET</span></code></pre></div>
<pre><code>## &lt;regex&gt; \]</code></pre>
<div class="sourceCode" id="cb1776"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1776-1"><a href="#cb1776-1" tabindex="-1"></a>OPEN_BRACE</span></code></pre></div>
<pre><code>## &lt;regex&gt; \{</code></pre>
<p>Example-3:</p>
<div class="sourceCode" id="cb1778"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1778-1"><a href="#cb1778-1" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, DOT)</span></code></pre></div>
<pre><code>## [1] │ This is an example text&lt;.&gt;</code></pre>
</div>
<div id="metacharacters-1" class="section level2" number="30.3">
<h2><span class="header-section-number">30.3</span> Metacharacters</h2>
<div id="character-classes" class="section level3" number="30.3.1">
<h3><span class="header-section-number">30.3.1</span> Character classes</h3>
<p>To group characters together in a class to match any of them, we may use function <code>char_class()</code> in rebus package. See example-4:</p>
<div class="sourceCode" id="cb1780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1780-1"><a href="#cb1780-1" tabindex="-1"></a>ex_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Apple&quot;</span>, <span class="st">&quot;Orange&quot;</span>, <span class="st">&quot;Myrrh&quot;</span>)</span>
<span id="cb1780-2"><a href="#cb1780-2" tabindex="-1"></a><span class="co"># matches a vowel</span></span>
<span id="cb1780-3"><a href="#cb1780-3" tabindex="-1"></a><span class="fu">str_view</span>(ex_vec, <span class="fu">char_class</span>(<span class="st">&quot;aeiou&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ Appl&lt;e&gt;
## [2] │ Or&lt;a&gt;ng&lt;e&gt;</code></pre>
<div class="sourceCode" id="cb1782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1782-1"><a href="#cb1782-1" tabindex="-1"></a><span class="co"># matches a vowel irrespective of case</span></span>
<span id="cb1782-2"><a href="#cb1782-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_vec, <span class="fu">case_insensitive</span>(<span class="fu">char_class</span>(<span class="st">&quot;aeiou&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] │ &lt;A&gt;ppl&lt;e&gt;
## [2] │ &lt;O&gt;r&lt;a&gt;ng&lt;e&gt;</code></pre>
<p>To <strong>match a range of characters/numbers</strong> we separate these by hyphen in square brackets (in normal regex building). So, <code>char_class("a-d")</code> will match a character from range <code>[abcd]</code>.</p>
<p>Example-5:</p>
<div class="sourceCode" id="cb1784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1784-1"><a href="#cb1784-1" tabindex="-1"></a>ex_text <span class="ot">&lt;-</span> <span class="st">&quot;The quick brown fox jumps over the lazy dog.&quot;</span></span>
<span id="cb1784-2"><a href="#cb1784-2" tabindex="-1"></a><span class="co"># Match a, b or c in lower case</span></span>
<span id="cb1784-3"><a href="#cb1784-3" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="fu">char_class</span>(<span class="st">&quot;a-d&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ The qui&lt;c&gt;k &lt;b&gt;rown fox jumps over the l&lt;a&gt;zy &lt;d&gt;og.</code></pre>
<p>For negated character classes we again have an intuitively named function <code>negated_char_class()</code> in R, which we can use as per our requirement.</p>
<p>Example-6:</p>
<div class="sourceCode" id="cb1786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1786-1"><a href="#cb1786-1" tabindex="-1"></a>ex_text <span class="ot">&lt;-</span> <span class="st">&quot;The quick brown fox jumps over the lazy dog.&quot;</span></span>
<span id="cb1786-2"><a href="#cb1786-2" tabindex="-1"></a><span class="co"># Match all text except vowels</span></span>
<span id="cb1786-3"><a href="#cb1786-3" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="fu">negated_char_class</span>(<span class="st">&quot;aeiou&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;T&gt;&lt;h&gt;e&lt; &gt;&lt;q&gt;ui&lt;c&gt;&lt;k&gt;&lt; &gt;&lt;b&gt;&lt;r&gt;o&lt;w&gt;&lt;n&gt;&lt; &gt;&lt;f&gt;o&lt;x&gt;&lt; &gt;&lt;j&gt;u&lt;m&gt;&lt;p&gt;&lt;s&gt;&lt; &gt;o&lt;v&gt;e&lt;r&gt;&lt; &gt;&lt;t&gt;&lt;h&gt;e&lt; &gt;&lt;l&gt;a&lt;z&gt;&lt;y&gt;&lt; &gt;&lt;d&gt;o&lt;g&gt;&lt;.&gt;</code></pre>
<div class="sourceCode" id="cb1788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1788-1"><a href="#cb1788-1" tabindex="-1"></a><span class="co"># Note that upper case and dot character have also been matched.</span></span></code></pre></div>
</div>
<div id="built-in-character-classes" class="section level3" number="30.3.2">
<h3><span class="header-section-number">30.3.2</span> Built-in Character classes</h3>
<p>We can also use <strong>pre-built character classes</strong> available in rebus, as listed below.</p>
<div class="sourceCode" id="cb1789"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1789-1"><a href="#cb1789-1" tabindex="-1"></a>ALPHA</span></code></pre></div>
<pre><code>## &lt;regex&gt; [:alpha:]</code></pre>
<div class="sourceCode" id="cb1791"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1791-1"><a href="#cb1791-1" tabindex="-1"></a>ALNUM</span></code></pre></div>
<pre><code>## &lt;regex&gt; [:alnum:]</code></pre>
<div class="sourceCode" id="cb1793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1793-1"><a href="#cb1793-1" tabindex="-1"></a>BLANK</span></code></pre></div>
<pre><code>## &lt;regex&gt; [:blank:]</code></pre>
<div class="sourceCode" id="cb1795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1795-1"><a href="#cb1795-1" tabindex="-1"></a>DIGIT</span></code></pre></div>
<pre><code>## &lt;regex&gt; [:digit:]</code></pre>
<div class="sourceCode" id="cb1797"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1797-1"><a href="#cb1797-1" tabindex="-1"></a>LOWER</span></code></pre></div>
<pre><code>## &lt;regex&gt; [:lower:]</code></pre>
<div class="sourceCode" id="cb1799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1799-1"><a href="#cb1799-1" tabindex="-1"></a>PRINT</span></code></pre></div>
<pre><code>## &lt;regex&gt; [:print:]</code></pre>
<div class="sourceCode" id="cb1801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1801-1"><a href="#cb1801-1" tabindex="-1"></a>PUNCT</span></code></pre></div>
<pre><code>## &lt;regex&gt; [:punct:]</code></pre>
<div class="sourceCode" id="cb1803"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1803-1"><a href="#cb1803-1" tabindex="-1"></a>SPACE</span></code></pre></div>
<pre><code>## &lt;regex&gt; [:space:]</code></pre>
<div class="sourceCode" id="cb1805"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1805-1"><a href="#cb1805-1" tabindex="-1"></a>UPPER</span></code></pre></div>
<pre><code>## &lt;regex&gt; [:upper:]</code></pre>
<div class="sourceCode" id="cb1807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1807-1"><a href="#cb1807-1" tabindex="-1"></a>HEX_DIGIT</span></code></pre></div>
<pre><code>## &lt;regex&gt; [:xdigit:]</code></pre>
<div class="sourceCode" id="cb1809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1809-1"><a href="#cb1809-1" tabindex="-1"></a>ANY_CHAR</span></code></pre></div>
<pre><code>## &lt;regex&gt; .</code></pre>
<div class="sourceCode" id="cb1811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1811-1"><a href="#cb1811-1" tabindex="-1"></a>GRAPHEME</span></code></pre></div>
<pre><code>## &lt;regex&gt; \X</code></pre>
<div class="sourceCode" id="cb1813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1813-1"><a href="#cb1813-1" tabindex="-1"></a>NEWLINE</span></code></pre></div>
<pre><code>## &lt;regex&gt; \R</code></pre>
<div class="sourceCode" id="cb1815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1815-1"><a href="#cb1815-1" tabindex="-1"></a>DGT</span></code></pre></div>
<pre><code>## &lt;regex&gt; \d</code></pre>
<div class="sourceCode" id="cb1817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1817-1"><a href="#cb1817-1" tabindex="-1"></a>WRD</span></code></pre></div>
<pre><code>## &lt;regex&gt; \w</code></pre>
<div class="sourceCode" id="cb1819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1819-1"><a href="#cb1819-1" tabindex="-1"></a>SPC</span></code></pre></div>
<pre><code>## &lt;regex&gt; \s</code></pre>
<div class="sourceCode" id="cb1821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1821-1"><a href="#cb1821-1" tabindex="-1"></a>NOT_DGT</span></code></pre></div>
<pre><code>## &lt;regex&gt; \D</code></pre>
<div class="sourceCode" id="cb1823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1823-1"><a href="#cb1823-1" tabindex="-1"></a>NOT_WRD</span></code></pre></div>
<pre><code>## &lt;regex&gt; \W</code></pre>
<div class="sourceCode" id="cb1825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1825-1"><a href="#cb1825-1" tabindex="-1"></a>NOT_SPC  <span class="co"># Equivalent to &quot;\\S&quot;</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; \S</code></pre>
<div class="sourceCode" id="cb1827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1827-1"><a href="#cb1827-1" tabindex="-1"></a>ASCII_DIGIT</span></code></pre></div>
<pre><code>## &lt;regex&gt; 0-9</code></pre>
<div class="sourceCode" id="cb1829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1829-1"><a href="#cb1829-1" tabindex="-1"></a>ASCII_LOWER</span></code></pre></div>
<pre><code>## &lt;regex&gt; a-z</code></pre>
<div class="sourceCode" id="cb1831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1831-1"><a href="#cb1831-1" tabindex="-1"></a>ASCII_UPPER</span></code></pre></div>
<pre><code>## &lt;regex&gt; A-Z</code></pre>
<div class="sourceCode" id="cb1833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1833-1"><a href="#cb1833-1" tabindex="-1"></a>ASCII_ALPHA</span></code></pre></div>
<pre><code>## &lt;regex&gt; a-zA-Z</code></pre>
<div class="sourceCode" id="cb1835"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1835-1"><a href="#cb1835-1" tabindex="-1"></a>ASCII_ALNUM</span></code></pre></div>
<pre><code>## &lt;regex&gt; a-zA-Z0-9</code></pre>
<p>See another example.</p>
<p>Example-7:</p>
<div class="sourceCode" id="cb1837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1837-1"><a href="#cb1837-1" tabindex="-1"></a>ex_text <span class="ot">&lt;-</span> <span class="st">&quot;The quick brown fox jumps over the lazy dog.&quot;</span></span>
<span id="cb1837-2"><a href="#cb1837-2" tabindex="-1"></a><span class="co"># Match TAB or SPACE Characters</span></span>
<span id="cb1837-3"><a href="#cb1837-3" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, BLANK)</span></code></pre></div>
<pre><code>## [1] │ The&lt; &gt;quick&lt; &gt;brown&lt; &gt;fox&lt; &gt;jumps&lt; &gt;over&lt; &gt;the&lt; &gt;lazy&lt; &gt;dog.</code></pre>
<div class="sourceCode" id="cb1839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1839-1"><a href="#cb1839-1" tabindex="-1"></a><span class="co"># Match all UPPER CASE characters</span></span>
<span id="cb1839-2"><a href="#cb1839-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, UPPER)</span></code></pre></div>
<pre><code>## [1] │ &lt;T&gt;he quick brown fox jumps over the lazy dog.</code></pre>
<p>Besides the afore-mentioned class constants, we have <code>lower case</code> equivalent functions for these character classes for a more useful regex building.</p>
<pre><code>alnum(lo, hi, char_class = TRUE)
alpha(lo, hi, char_class = TRUE)
blank(lo, hi, char_class = TRUE)
cntrl(lo, hi, char_class = TRUE)
digit(lo, hi, char_class = TRUE)
graph(lo, hi, char_class = TRUE)
lower(lo, hi, char_class = TRUE)
printable(lo, hi, char_class = TRUE)
punct(lo, hi, char_class = TRUE)
space(lo, hi, char_class = TRUE)
upper(lo, hi, char_class = TRUE)
hex_digit(lo, hi, char_class = TRUE)
any_char(lo, hi)
grapheme(lo, hi)
newline(lo, hi)
dgt(lo, hi, char_class = FALSE)
wrd(lo, hi, char_class = FALSE)
spc(lo, hi, char_class = FALSE)
not_dgt(lo, hi, char_class = FALSE)
not_wrd(lo, hi, char_class = FALSE)
not_spc(lo, hi, char_class = FALSE)
ascii_digit(lo, hi, char_class = TRUE)
ascii_lower(lo, hi, char_class = TRUE)
ascii_upper(lo, hi, char_class = TRUE)
ascii_alpha(lo, hi, char_class = TRUE)
ascii_alnum(lo, hi, char_class = TRUE)
char_range(lo, hi, char_class = lo &lt; hi)
number_range(lo, hi, allow_leading_zeroes = FALSE, capture = FALSE)</code></pre>
<p>In the above functions, both <code>lo</code> and <code>hi</code> accept positive integers as quantifiers; and <code>char_class</code> argument a logical value. See these examples.</p>
<p>Example-8:</p>
<div class="sourceCode" id="cb1842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1842-1"><a href="#cb1842-1" tabindex="-1"></a>ip_add <span class="ot">&lt;-</span> <span class="st">&quot;My IP address is 255.1.2.50&quot;</span></span>
<span id="cb1842-2"><a href="#cb1842-2" tabindex="-1"></a><span class="fu">str_view</span>(ip_add, <span class="fu">digit</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span></code></pre></div>
<pre><code>## [1] │ My IP address is &lt;255&gt;.&lt;1&gt;.&lt;2&gt;.&lt;50&gt;</code></pre>
<div class="sourceCode" id="cb1844"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1844-1"><a href="#cb1844-1" tabindex="-1"></a><span class="fu">str_view</span>(ip_add, <span class="fu">digit</span>(<span class="dv">3</span>))</span></code></pre></div>
<pre><code>## [1] │ My IP address is &lt;255&gt;.1.2.50</code></pre>
<div class="sourceCode" id="cb1846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1846-1"><a href="#cb1846-1" tabindex="-1"></a><span class="fu">str_view</span>(ip_add, <span class="fu">not_dgt</span>(<span class="dv">5</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;My IP&gt;&lt; addr&gt;&lt;ess i&gt;s 255.1.2.50</code></pre>
<div class="sourceCode" id="cb1848"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1848-1"><a href="#cb1848-1" tabindex="-1"></a><span class="co"># Note this will match none</span></span>
<span id="cb1848-2"><a href="#cb1848-2" tabindex="-1"></a><span class="fu">str_view</span>(ip_add, <span class="fu">space</span>(<span class="dv">2</span>))</span></code></pre></div>
</div>
<div id="word-boundaries" class="section level3" number="30.3.3">
<h3><span class="header-section-number">30.3.3</span> Word Boundaries</h3>
<p>To match a word boundary (or its negation) we have <code>BOUNDARY</code> (and <code>NOT_BOUNDARY</code>) in rebus. Function <code>whole_word(x)</code>, on the other hand, wraps the regex in word boundary tokens to match a whole word. See following example.</p>
<p>Example-9:</p>
<div class="sourceCode" id="cb1849"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1849-1"><a href="#cb1849-1" tabindex="-1"></a>ex_text <span class="ot">&lt;-</span> <span class="st">&quot;The thermometer, they were searching is placed in a leather box.&quot;</span></span>
<span id="cb1849-2"><a href="#cb1849-2" tabindex="-1"></a><span class="co"># Note three matches</span></span>
<span id="cb1849-3"><a href="#cb1849-3" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="st">&quot;the&quot;</span>)</span></code></pre></div>
<pre><code>## [1] │ The &lt;the&gt;rmometer, &lt;the&gt;y were searching is placed in a lea&lt;the&gt;r box.</code></pre>
<div class="sourceCode" id="cb1851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1851-1"><a href="#cb1851-1" tabindex="-1"></a><span class="co"># There is no match</span></span>
<span id="cb1851-2"><a href="#cb1851-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="fu">whole_word</span>(<span class="st">&quot;the&quot;</span>), <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ The thermometer, they were searching is placed in a leather box.</code></pre>
<div class="sourceCode" id="cb1853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1853-1"><a href="#cb1853-1" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, <span class="fu">case_insensitive</span>(<span class="fu">whole_word</span>(<span class="st">&quot;the&quot;</span>)), <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ &lt;The&gt; thermometer, they were searching is placed in a leather box.</code></pre>
<div class="sourceCode" id="cb1855"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1855-1"><a href="#cb1855-1" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, BOUNDARY <span class="sc">%R%</span> <span class="fu">case_insensitive</span>(<span class="st">&quot;the&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;The&gt; &lt;the&gt;rmometer, &lt;the&gt;y were searching is placed in a leather box.</code></pre>
<div class="sourceCode" id="cb1857"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1857-1"><a href="#cb1857-1" tabindex="-1"></a><span class="fu">str_view</span>(ex_text, NOT_BOUNDARY <span class="sc">%R%</span> <span class="st">&quot;the&quot;</span>)</span></code></pre></div>
<pre><code>## [1] │ The thermometer, they were searching is placed in a lea&lt;the&gt;r box.</code></pre>
</div>
</div>
<div id="quantifiers-1" class="section level2" number="30.4">
<h2><span class="header-section-number">30.4</span> Quantifiers</h2>
<p>We learnt following quantifiers in regular expressions.</p>
<ul>
<li><code>+</code> <strong>1 or more</strong> occurrences</li>
<li><code>*</code> <strong>0 or more</strong></li>
<li><code>?</code> <strong>0 or 1</strong></li>
<li><code>{}</code> specified numbers
<ul>
<li><code>{n}</code> exactly n</li>
<li><code>{n,}</code> n or more</li>
<li><code>{n,m}</code> between n and m</li>
</ul></li>
</ul>
<p>We have meaningfully named functions for each of the above quantifiers in rebus.</p>
<ul>
<li><code>one_or_more(x, char_class = NA)</code></li>
<li><code>zero_or_more(x, char_class = NA)</code></li>
<li><code>optional(x, char_class = NA)</code></li>
<li><code>repeated(x, lo, hi, lazy = FALSE, char_class = NA)</code>
<ul>
<li>where <code>lo</code> and <code>hi</code> represent <code>n</code> and <code>m</code> equivalently.</li>
</ul></li>
</ul>
<p>Additionally, we may notice an argument <code>char_class = NA</code> which accepts a logical value for case when <code>x</code> is required to be wrapped in a character class.</p>
<p>We may match two consecutive vowels using <code>repeated("aeiou", 2, char_class = TRUE)</code>. See this example.</p>
<p>Example-10:</p>
<div class="sourceCode" id="cb1859"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1859-1"><a href="#cb1859-1" tabindex="-1"></a>ex_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1 apple&quot;</span>, <span class="st">&quot;2 bananas&quot;</span>, <span class="st">&quot;3 pineapples&quot;</span>)</span>
<span id="cb1859-2"><a href="#cb1859-2" tabindex="-1"></a><span class="co"># match two consecutive vowels</span></span>
<span id="cb1859-3"><a href="#cb1859-3" tabindex="-1"></a><span class="fu">str_view</span>(ex_vec, <span class="fu">repeated</span>(<span class="st">&quot;aeiou&quot;</span>, <span class="dv">2</span>, <span class="at">char_class =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## [3] │ 3 pin&lt;ea&gt;pples</code></pre>
<div class="sourceCode" id="cb1861"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1861-1"><a href="#cb1861-1" tabindex="-1"></a><span class="co"># match a number followed by apple with an optional space</span></span>
<span id="cb1861-2"><a href="#cb1861-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_vec, <span class="fu">one_or_more</span>(DIGIT) <span class="sc">%R%</span> <span class="fu">optional</span>(BLANK) <span class="sc">%R%</span> <span class="st">&quot;apple&quot;</span>)</span></code></pre></div>
<pre><code>## [1] │ &lt;1 apple&gt;</code></pre>
</div>
<div id="anchors-1" class="section level2" number="30.5">
<h2><span class="header-section-number">30.5</span> Anchors</h2>
<p>Anchors in regular expressions allow us to match patterns at specific positions within the input string. In rebus, we have constants <code>START</code> and <code>END</code> to match the beginning or end positions within the input text, respectively.</p>
<p>Example-11:</p>
<div class="sourceCode" id="cb1863"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1863-1"><a href="#cb1863-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">&quot;The quick brown fox jumps over the lazy dog. The fox is brown.&quot;</span></span>
<span id="cb1863-2"><a href="#cb1863-2" tabindex="-1"></a><span class="fu">str_view</span>(string, START <span class="sc">%R%</span> <span class="fu">case_insensitive</span>(<span class="st">&quot;the&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;The&gt; quick brown fox jumps over the lazy dog. The fox is brown.</code></pre>
<p>In the above example, we are matching word <code>the</code> which is at the beginning of a sentence only. There is one more function <code>exactly(x)</code> in rebus which makes the regular expression match the whole string, from start to end, in fact a shortcut of <code>START %R% x %R% END</code>.</p>
<p>Example-12:</p>
<div class="sourceCode" id="cb1865"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1865-1"><a href="#cb1865-1" tabindex="-1"></a>ex_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;cherry&quot;</span>, <span class="st">&quot;pineapple&quot;</span>)</span>
<span id="cb1865-2"><a href="#cb1865-2" tabindex="-1"></a><span class="fu">str_view</span>(ex_vec, <span class="fu">exactly</span>(<span class="st">&quot;apple&quot;</span>))</span></code></pre></div>
<pre><code>## [1] │ &lt;apple&gt;</code></pre>
</div>
<div id="capture-groups-1" class="section level2" number="30.6">
<h2><span class="header-section-number">30.6</span> Capture Groups</h2>
<p>We have seen that a capture group is a way to group a part of a regular expression and capture it as a separate substring. This is useful when we want to extract or replace a specific part of a string. In R, capture groups are denoted by parentheses <code>()</code>. Anything inside the parentheses is captured and can be referenced later in the regular expression or in the replacement string. We also learnt that capturing groups are useful to refer back to it within a match with back reference: <code>\1</code> refers to the match contained in the first parenthesis, <code>\2</code> in the second parenthesis, and so on.</p>
<p>In rebus, there are two functions <code>capture(x)</code> and <code>group(x)</code> for capturing regex. Former is good with match functions while latter is mostly used with alternations.</p>
<p>Example-13:</p>
<div class="sourceCode" id="cb1867"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1867-1"><a href="#cb1867-1" tabindex="-1"></a><span class="do">## capture(x)</span></span>
<span id="cb1867-2"><a href="#cb1867-2" tabindex="-1"></a>my_fruits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;apple&#39;</span>, <span class="st">&#39;banana&#39;</span>, <span class="st">&#39;coconut&#39;</span>, <span class="st">&#39;berry&#39;</span>, <span class="st">&#39;cucumber&#39;</span>, <span class="st">&#39;date&#39;</span>)</span>
<span id="cb1867-3"><a href="#cb1867-3" tabindex="-1"></a><span class="fu">str_remove_all</span>(my_fruits, <span class="fu">capture</span>(<span class="fu">char_class</span>(<span class="st">&quot;aeiou&quot;</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;ppl&quot;   &quot;bnn&quot;   &quot;ccnt&quot;  &quot;brry&quot;  &quot;ccmbr&quot; &quot;dt&quot;</code></pre>
<div class="sourceCode" id="cb1869"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1869-1"><a href="#cb1869-1" tabindex="-1"></a><span class="do">## group()</span></span>
<span id="cb1869-2"><a href="#cb1869-2" tabindex="-1"></a>my_toppings <span class="ot">&lt;-</span> <span class="fu">group</span>(<span class="st">&quot;olive&quot;</span> <span class="sc">%|%</span> <span class="st">&quot;mushroom&quot;</span> <span class="sc">%|%</span> <span class="st">&quot;tomato&quot;</span>)</span>
<span id="cb1869-3"><a href="#cb1869-3" tabindex="-1"></a>pizza <span class="ot">&lt;-</span> <span class="st">&quot;We have olive, mushroom, chicken and capsicum pizza in our menu.&quot;</span></span>
<span id="cb1869-4"><a href="#cb1869-4" tabindex="-1"></a><span class="co"># Extract my favourite topping from available pizza menu.</span></span>
<span id="cb1869-5"><a href="#cb1869-5" tabindex="-1"></a><span class="fu">str_extract_all</span>(pizza, <span class="at">pattern =</span> my_toppings)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;olive&quot;    &quot;mushroom&quot;</code></pre>
<p>Backreferences for replacement operations, are denoted by constants <code>REF#</code> where <code>#</code> is actually a digit from 1 to 9.</p>
<p>Example-14:</p>
<div class="sourceCode" id="cb1871"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1871-1"><a href="#cb1871-1" tabindex="-1"></a>my_fruits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;apple&#39;</span>, <span class="st">&#39;banana&#39;</span>, <span class="st">&#39;coconut&#39;</span>, <span class="st">&#39;berry&#39;</span>, <span class="st">&#39;cucumber&#39;</span>, <span class="st">&#39;date&#39;</span>)</span>
<span id="cb1871-2"><a href="#cb1871-2" tabindex="-1"></a><span class="co"># search for repeated alphabet</span></span>
<span id="cb1871-3"><a href="#cb1871-3" tabindex="-1"></a><span class="fu">str_view</span>(my_fruits, <span class="fu">capture</span>(ANY_CHAR) <span class="sc">%R%</span> REF1 , <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ a&lt;pp&gt;le
## [2] │ banana
## [3] │ coconut
## [4] │ be&lt;rr&gt;y
## [5] │ cucumber
## [6] │ date</code></pre>
<p>Similar to previous chapter, we can use capturing group to replace the pattern with something else.</p>
<p>Example-15:</p>
<div class="sourceCode" id="cb1873"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1873-1"><a href="#cb1873-1" tabindex="-1"></a><span class="co"># We have names in last_name, first_name format</span></span>
<span id="cb1873-2"><a href="#cb1873-2" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Hanks, Tom&#39;</span>, <span class="st">&#39;Affleck, Ben&#39;</span>, <span class="st">&#39;Damon, Matt&#39;</span>)</span>
<span id="cb1873-3"><a href="#cb1873-3" tabindex="-1"></a><span class="fu">str_view</span>(names)</span></code></pre></div>
<pre><code>## [1] │ Hanks, Tom
## [2] │ Affleck, Ben
## [3] │ Damon, Matt</code></pre>
<div class="sourceCode" id="cb1875"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1875-1"><a href="#cb1875-1" tabindex="-1"></a><span class="co"># Pattern to capture first name and last name</span></span>
<span id="cb1875-2"><a href="#cb1875-2" tabindex="-1"></a>pat <span class="ot">&lt;-</span> <span class="fu">capture</span>(<span class="fu">whole_word</span>(<span class="fu">one_or_more</span>(ALPHA))) <span class="sc">%R%</span> <span class="st">&quot;,&quot;</span> <span class="sc">%R%</span> <span class="fu">optional</span>(SPACE) <span class="sc">%R%</span> <span class="fu">capture</span>(<span class="fu">whole_word</span>(<span class="fu">one_or_more</span>(ALPHA)))</span>
<span id="cb1875-3"><a href="#cb1875-3" tabindex="-1"></a>repl <span class="ot">&lt;-</span> REF2 <span class="sc">%R%</span> <span class="st">&quot; &quot;</span> <span class="sc">%R%</span> REF1</span>
<span id="cb1875-4"><a href="#cb1875-4" tabindex="-1"></a><span class="co"># Using this regex, we can convert these to first_name last_name format</span></span>
<span id="cb1875-5"><a href="#cb1875-5" tabindex="-1"></a><span class="fu">str_replace_all</span>(names, pat, repl)</span></code></pre></div>
<pre><code>## [1] &quot;Tom Hanks&quot;   &quot;Ben Affleck&quot; &quot;Matt Damon&quot;</code></pre>
</div>
<div id="lookarounds-1" class="section level2" number="30.7">
<h2><span class="header-section-number">30.7</span> Lookarounds</h2>
<p>As we had learnt, <strong>lookaheads</strong> and <strong>lookbehinds</strong> are zero-width assertions in regex. They are used to match a pattern only if it is followed or preceded by another pattern, respectively. The pattern in the <code>lookahead</code> or <code>lookbehind</code> is not included in the match.</p>
<p>We have intuitively named functions to deal with all four lookarounds-</p>
<pre><code>lookahead(x)
negative_lookahead(x)
lookbehind(x)
negative_lookbehind(x)</code></pre>
<p>Example-16: Find character <code>q</code> not followed by <code>u</code></p>
<div class="sourceCode" id="cb1878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1878-1"><a href="#cb1878-1" tabindex="-1"></a>countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mozambique&quot;</span>, <span class="st">&quot;qatar&quot;</span>, <span class="st">&quot;iraq&quot;</span>)</span>
<span id="cb1878-2"><a href="#cb1878-2" tabindex="-1"></a><span class="co"># With lookahead</span></span>
<span id="cb1878-3"><a href="#cb1878-3" tabindex="-1"></a><span class="fu">str_view</span>(countries, <span class="st">&quot;q&quot;</span> <span class="sc">%R%</span> <span class="fu">negative_lookahead</span>(<span class="st">&quot;u&quot;</span>))</span></code></pre></div>
<pre><code>## [2] │ &lt;q&gt;atar
## [3] │ ira&lt;q&gt;</code></pre>
<div class="sourceCode" id="cb1880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1880-1"><a href="#cb1880-1" tabindex="-1"></a><span class="co"># Without Lookahaed - Notice the difference</span></span>
<span id="cb1880-2"><a href="#cb1880-2" tabindex="-1"></a><span class="fu">str_view</span>(countries, <span class="st">&quot;q&quot;</span> <span class="sc">%R%</span> <span class="fu">negated_char_class</span>(<span class="st">&quot;u&quot;</span>))</span></code></pre></div>
<pre><code>## [2] │ &lt;qa&gt;tar</code></pre>
<p>Example-17:</p>
<div class="sourceCode" id="cb1882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1882-1"><a href="#cb1882-1" tabindex="-1"></a><span class="co"># Lookahead</span></span>
<span id="cb1882-2"><a href="#cb1882-2" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;hello world&quot;</span>, <span class="st">&quot;hello there world&quot;</span>, <span class="st">&quot;hello&quot;</span>)</span>
<span id="cb1882-3"><a href="#cb1882-3" tabindex="-1"></a><span class="fu">str_view</span>(string, <span class="st">&quot;hello&quot;</span> <span class="sc">%R%</span> <span class="fu">lookahead</span>(<span class="fu">optional</span>(SPACE) <span class="sc">%R%</span> <span class="st">&quot;world&quot;</span>), <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ &lt;hello&gt; world
## [2] │ hello there world
## [3] │ hello</code></pre>
<div class="sourceCode" id="cb1884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1884-1"><a href="#cb1884-1" tabindex="-1"></a><span class="co"># Note that &quot;world&quot; is not included in the match</span></span>
<span id="cb1884-2"><a href="#cb1884-2" tabindex="-1"></a></span>
<span id="cb1884-3"><a href="#cb1884-3" tabindex="-1"></a><span class="co"># Lookbehind</span></span>
<span id="cb1884-4"><a href="#cb1884-4" tabindex="-1"></a><span class="fu">str_view</span>(string, <span class="fu">lookbehind</span>(<span class="st">&quot;hello&quot;</span> <span class="sc">%R%</span> <span class="fu">optional</span>(SPACE)) <span class="sc">%R%</span> <span class="st">&quot;world&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ hello &lt;world&gt;
## [2] │ hello there world
## [3] │ hello</code></pre>
<div class="sourceCode" id="cb1886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1886-1"><a href="#cb1886-1" tabindex="-1"></a><span class="co"># Negative lookahead</span></span>
<span id="cb1886-2"><a href="#cb1886-2" tabindex="-1"></a><span class="fu">str_view</span>(string, <span class="st">&quot;hello&quot;</span> <span class="sc">%R%</span> <span class="fu">negative_lookahead</span>(<span class="fu">optional</span>(SPACE) <span class="sc">%R%</span> <span class="st">&quot;world&quot;</span>), <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ hello world
## [2] │ &lt;hello&gt; there world
## [3] │ &lt;hello&gt;</code></pre>
<div class="sourceCode" id="cb1888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1888-1"><a href="#cb1888-1" tabindex="-1"></a><span class="co"># Negative lookbehind</span></span>
<span id="cb1888-2"><a href="#cb1888-2" tabindex="-1"></a><span class="fu">str_view</span>(string, <span class="fu">negative_lookbehind</span>(<span class="st">&quot;hello&quot;</span> <span class="sc">%R%</span> <span class="fu">optional</span>(SPACE)) <span class="sc">%R%</span> <span class="st">&quot;world&quot;</span>, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ hello world
## [2] │ hello there &lt;world&gt;
## [3] │ hello</code></pre>
<p>More examples.</p>
<p>Example-18:</p>
<div class="sourceCode" id="cb1890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1890-1"><a href="#cb1890-1" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">&quot;I have 10 apples, 6 pineapples and 5 bananas&quot;</span></span>
<span id="cb1890-2"><a href="#cb1890-2" tabindex="-1"></a></span>
<span id="cb1890-3"><a href="#cb1890-3" tabindex="-1"></a><span class="co"># lookahead to match count of apples</span></span>
<span id="cb1890-4"><a href="#cb1890-4" tabindex="-1"></a>pattern1 <span class="ot">&lt;-</span> <span class="fu">one_or_more</span>(DIGIT) <span class="sc">%R%</span> <span class="fu">lookahead</span>(<span class="fu">optional</span>(SPACE) <span class="sc">%R%</span> <span class="st">&quot;apple&quot;</span>) </span>
<span id="cb1890-5"><a href="#cb1890-5" tabindex="-1"></a><span class="co"># How many apples?</span></span>
<span id="cb1890-6"><a href="#cb1890-6" tabindex="-1"></a><span class="fu">str_view</span>(<span class="at">string =</span> string, <span class="at">pattern =</span> pattern1, <span class="at">match =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>## [1] │ I have &lt;10&gt; apples, 6 pineapples and 5 bananas</code></pre>
</div>
<div id="some-useful-regex-functions" class="section level2" number="30.8">
<h2><span class="header-section-number">30.8</span> Some useful regex functions</h2>
<div id="matching-valid-dates" class="section level3" number="30.8.1">
<h3><span class="header-section-number">30.8.1</span> Matching valid dates</h3>
<div class="sourceCode" id="cb1892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1892-1"><a href="#cb1892-1" tabindex="-1"></a><span class="co"># Individual date-time components</span></span>
<span id="cb1892-2"><a href="#cb1892-2" tabindex="-1"></a>DTSEP             <span class="co"># optional selected punctuation or space</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; [-/.:,\ ]?</code></pre>
<div class="sourceCode" id="cb1894"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1894-1"><a href="#cb1894-1" tabindex="-1"></a>CENTURY           <span class="co"># exactly two digits</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; [0-9]{2}</code></pre>
<div class="sourceCode" id="cb1896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1896-1"><a href="#cb1896-1" tabindex="-1"></a>YEAR              <span class="co"># one to four digits</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; [0-9]{1,4}</code></pre>
<div class="sourceCode" id="cb1898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1898-1"><a href="#cb1898-1" tabindex="-1"></a>YEAR2             <span class="co"># exactly two digits</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; [0-9]{2}</code></pre>
<div class="sourceCode" id="cb1900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1900-1"><a href="#cb1900-1" tabindex="-1"></a>YEAR4             <span class="co"># exactly four digits</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; [0-9]{4}</code></pre>
<div class="sourceCode" id="cb1902"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1902-1"><a href="#cb1902-1" tabindex="-1"></a>MONTH             <span class="co"># number from 1 to 12, leading zero</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:0[1-9]|1[0-2])</code></pre>
<div class="sourceCode" id="cb1904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1904-1"><a href="#cb1904-1" tabindex="-1"></a>WEEK_OF_YEAR      <span class="co"># number from 0 to 53, leading zero</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:[0-4][0-9]|5[0-3])</code></pre>
<div class="sourceCode" id="cb1906"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1906-1"><a href="#cb1906-1" tabindex="-1"></a>DAY               <span class="co"># number from 1 to 31, leading zero</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:0[1-9]|[12][0-9]|3[01])</code></pre>
<div class="sourceCode" id="cb1908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1908-1"><a href="#cb1908-1" tabindex="-1"></a>DAY_SINGLE        <span class="co"># leading space</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?: [1-9]|[12][0-9]|3[01])</code></pre>
<div class="sourceCode" id="cb1910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1910-1"><a href="#cb1910-1" tabindex="-1"></a>HOUR24            <span class="co"># 24 hour clock, leading zero</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:[01][0-9]|2[0-3])</code></pre>
<div class="sourceCode" id="cb1912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1912-1"><a href="#cb1912-1" tabindex="-1"></a>HOUR12            <span class="co"># 12 hour clock, leading zero</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:0[1-9]|1[0-2])</code></pre>
<div class="sourceCode" id="cb1914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1914-1"><a href="#cb1914-1" tabindex="-1"></a>HOUR24_SINGLE     <span class="co"># 24 hour clock, leading space</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:[ 1][0-9]|2[0-3])</code></pre>
<div class="sourceCode" id="cb1916"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1916-1"><a href="#cb1916-1" tabindex="-1"></a>HOUR12_SINGLE     <span class="co"># 12 hour clock, leading space</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?: [1-9]|1[0-2])</code></pre>
<div class="sourceCode" id="cb1918"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1918-1"><a href="#cb1918-1" tabindex="-1"></a>MINUTE            <span class="co"># number from 0 to 59, leading zero</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; [0-5][0-9]</code></pre>
<div class="sourceCode" id="cb1920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1920-1"><a href="#cb1920-1" tabindex="-1"></a>SECOND            <span class="co"># number from 0 to 61 (leap seconds), leading zero</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:[0-5][0-9]|6[01])</code></pre>
<div class="sourceCode" id="cb1922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1922-1"><a href="#cb1922-1" tabindex="-1"></a>FRACTIONAL_SECOND <span class="co"># a second optional decimal point and up to 6 digits</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:[0-5][0-9]|6[01])(?:[.,][0-9]{1,6})?</code></pre>
<div class="sourceCode" id="cb1924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1924-1"><a href="#cb1924-1" tabindex="-1"></a>AM_PM             <span class="co"># AM or PM, any case</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:am|AM|pm|PM)</code></pre>
<div class="sourceCode" id="cb1926"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1926-1"><a href="#cb1926-1" tabindex="-1"></a>TIMEZONE_OFFSET   <span class="co"># optional plus or minus, then four digits</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; [-+]?[0-9]{4}</code></pre>
<div class="sourceCode" id="cb1928"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1928-1"><a href="#cb1928-1" tabindex="-1"></a>TIMEZONE          <span class="co"># Any value returned by OlsonNames()</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:Africa/Abidjan|Africa/Accra|Africa/Addis_Ababa|Africa/Algiers|Africa/Asmara|Africa/Asmera|Africa/Bamako|Africa/Bangui|Africa/Banjul|Africa/Bissau|Africa/Blantyre|Africa/Brazzaville|Africa/Bujumbura|Africa/Cairo|Africa/Casablanca|Africa/Ceuta|Africa/Conakry|Africa/Dakar|Africa/Dar_es_Salaam|Africa/Djibouti|Africa/Douala|Africa/El_Aaiun|Africa/Freetown|Africa/Gaborone|Africa/Harare|Africa/Johannesburg|Africa/Juba|Africa/Kampala|Africa/Khartoum|Africa/Kigali|Africa/Kinshasa|Africa/Lagos|Africa/Libreville|Africa/Lome|Africa/Luanda|Africa/Lubumbashi|Africa/Lusaka|Africa/Malabo|Africa/Maputo|Africa/Maseru|Africa/Mbabane|Africa/Mogadishu|Africa/Monrovia|Africa/Nairobi|Africa/Ndjamena|Africa/Niamey|Africa/Nouakchott|Africa/Ouagadougou|Africa/Porto-Novo|Africa/Sao_Tome|Africa/Timbuktu|Africa/Tripoli|Africa/Tunis|Africa/Windhoek|America/Adak|America/Anchorage|America/Anguilla|America/Antigua|America/Araguaina|America/Argentina/Buenos_Aires|America/Argentina/Catamarca|America/Argentina/ComodRivadavia|America/Argentina/Cordoba|America/Argentina/Jujuy|America/Argentina/La_Rioja|America/Argentina/Mendoza|America/Argentina/Rio_Gallegos|America/Argentina/Salta|America/Argentina/San_Juan|America/Argentina/San_Luis|America/Argentina/Tucuman|America/Argentina/Ushuaia|America/Aruba|America/Asuncion|America/Atikokan|America/Atka|America/Bahia|America/Bahia_Banderas|America/Barbados|America/Belem|America/Belize|America/Blanc-Sablon|America/Boa_Vista|America/Bogota|America/Boise|America/Buenos_Aires|America/Cambridge_Bay|America/Campo_Grande|America/Cancun|America/Caracas|America/Catamarca|America/Cayenne|America/Cayman|America/Chicago|America/Chihuahua|America/Ciudad_Juarez|America/Coral_Harbour|America/Cordoba|America/Costa_Rica|America/Creston|America/Cuiaba|America/Curacao|America/Danmarkshavn|America/Dawson|America/Dawson_Creek|America/Denver|America/Detroit|America/Dominica|America/Edmonton|America/Eirunepe|America/El_Salvador|America/Ensenada|America/Fort_Nelson|America/Fort_Wayne|America/Fortaleza|America/Glace_Bay|America/Godthab|America/Goose_Bay|America/Grand_Turk|America/Grenada|America/Guadeloupe|America/Guatemala|America/Guayaquil|America/Guyana|America/Halifax|America/Havana|America/Hermosillo|America/Indiana/Indianapolis|America/Indiana/Knox|America/Indiana/Marengo|America/Indiana/Petersburg|America/Indiana/Tell_City|America/Indiana/Vevay|America/Indiana/Vincennes|America/Indiana/Winamac|America/Indianapolis|America/Inuvik|America/Iqaluit|America/Jamaica|America/Jujuy|America/Juneau|America/Kentucky/Louisville|America/Kentucky/Monticello|America/Knox_IN|America/Kralendijk|America/La_Paz|America/Lima|America/Los_Angeles|America/Louisville|America/Lower_Princes|America/Maceio|America/Managua|America/Manaus|America/Marigot|America/Martinique|America/Matamoros|America/Mazatlan|America/Mendoza|America/Menominee|America/Merida|America/Metlakatla|America/Mexico_City|America/Miquelon|America/Moncton|America/Monterrey|America/Montevideo|America/Montreal|America/Montserrat|America/Nassau|America/New_York|America/Nipigon|America/Nome|America/Noronha|America/North_Dakota/Beulah|America/North_Dakota/Center|America/North_Dakota/New_Salem|America/Nuuk|America/Ojinaga|America/Panama|America/Pangnirtung|America/Paramaribo|America/Phoenix|America/Port-au-Prince|America/Port_of_Spain|America/Porto_Acre|America/Porto_Velho|America/Puerto_Rico|America/Punta_Arenas|America/Rainy_River|America/Rankin_Inlet|America/Recife|America/Regina|America/Resolute|America/Rio_Branco|America/Rosario|America/Santa_Isabel|America/Santarem|America/Santiago|America/Santo_Domingo|America/Sao_Paulo|America/Scoresbysund|America/Shiprock|America/Sitka|America/St_Barthelemy|America/St_Johns|America/St_Kitts|America/St_Lucia|America/St_Thomas|America/St_Vincent|America/Swift_Current|America/Tegucigalpa|America/Thule|America/Thunder_Bay|America/Tijuana|America/Toronto|America/Tortola|America/Vancouver|America/Virgin|America/Whitehorse|America/Winnipeg|America/Yakutat|America/Yellowknife|Antarctica/Casey|Antarctica/Davis|Antarctica/DumontDUrville|Antarctica/Macquarie|Antarctica/Mawson|Antarctica/McMurdo|Antarctica/Palmer|Antarctica/Rothera|Antarctica/South_Pole|Antarctica/Syowa|Antarctica/Troll|Antarctica/Vostok|Arctic/Longyearbyen|Asia/Aden|Asia/Almaty|Asia/Amman|Asia/Anadyr|Asia/Aqtau|Asia/Aqtobe|Asia/Ashgabat|Asia/Ashkhabad|Asia/Atyrau|Asia/Baghdad|Asia/Bahrain|Asia/Baku|Asia/Bangkok|Asia/Barnaul|Asia/Beirut|Asia/Bishkek|Asia/Brunei|Asia/Calcutta|Asia/Chita|Asia/Choibalsan|Asia/Chongqing|Asia/Chungking|Asia/Colombo|Asia/Dacca|Asia/Damascus|Asia/Dhaka|Asia/Dili|Asia/Dubai|Asia/Dushanbe|Asia/Famagusta|Asia/Gaza|Asia/Harbin|Asia/Hebron|Asia/Ho_Chi_Minh|Asia/Hong_Kong|Asia/Hovd|Asia/Irkutsk|Asia/Istanbul|Asia/Jakarta|Asia/Jayapura|Asia/Jerusalem|Asia/Kabul|Asia/Kamchatka|Asia/Karachi|Asia/Kashgar|Asia/Kathmandu|Asia/Katmandu|Asia/Khandyga|Asia/Kolkata|Asia/Krasnoyarsk|Asia/Kuala_Lumpur|Asia/Kuching|Asia/Kuwait|Asia/Macao|Asia/Macau|Asia/Magadan|Asia/Makassar|Asia/Manila|Asia/Muscat|Asia/Nicosia|Asia/Novokuznetsk|Asia/Novosibirsk|Asia/Omsk|Asia/Oral|Asia/Phnom_Penh|Asia/Pontianak|Asia/Pyongyang|Asia/Qatar|Asia/Qostanay|Asia/Qyzylorda|Asia/Rangoon|Asia/Riyadh|Asia/Saigon|Asia/Sakhalin|Asia/Samarkand|Asia/Seoul|Asia/Shanghai|Asia/Singapore|Asia/Srednekolymsk|Asia/Taipei|Asia/Tashkent|Asia/Tbilisi|Asia/Tehran|Asia/Tel_Aviv|Asia/Thimbu|Asia/Thimphu|Asia/Tokyo|Asia/Tomsk|Asia/Ujung_Pandang|Asia/Ulaanbaatar|Asia/Ulan_Bator|Asia/Urumqi|Asia/Ust-Nera|Asia/Vientiane|Asia/Vladivostok|Asia/Yakutsk|Asia/Yangon|Asia/Yekaterinburg|Asia/Yerevan|Atlantic/Azores|Atlantic/Bermuda|Atlantic/Canary|Atlantic/Cape_Verde|Atlantic/Faeroe|Atlantic/Faroe|Atlantic/Jan_Mayen|Atlantic/Madeira|Atlantic/Reykjavik|Atlantic/South_Georgia|Atlantic/St_Helena|Atlantic/Stanley|Australia/ACT|Australia/Adelaide|Australia/Brisbane|Australia/Broken_Hill|Australia/Canberra|Australia/Currie|Australia/Darwin|Australia/Eucla|Australia/Hobart|Australia/LHI|Australia/Lindeman|Australia/Lord_Howe|Australia/Melbourne|Australia/NSW|Australia/North|Australia/Perth|Australia/Queensland|Australia/South|Australia/Sydney|Australia/Tasmania|Australia/Victoria|Australia/West|Australia/Yancowinna|Brazil/Acre|Brazil/DeNoronha|Brazil/East|Brazil/West|CET|CST6CDT|Canada/Atlantic|Canada/Central|Canada/Eastern|Canada/Mountain|Canada/Newfoundland|Canada/Pacific|Canada/Saskatchewan|Canada/Yukon|Chile/Continental|Chile/EasterIsland|Cuba|EET|EST|EST5EDT|Egypt|Eire|Etc/GMT|Etc/GMT\+0|Etc/GMT\+1|Etc/GMT\+10|Etc/GMT\+11|Etc/GMT\+12|Etc/GMT\+2|Etc/GMT\+3|Etc/GMT\+4|Etc/GMT\+5|Etc/GMT\+6|Etc/GMT\+7|Etc/GMT\+8|Etc/GMT\+9|Etc/GMT-0|Etc/GMT-1|Etc/GMT-10|Etc/GMT-11|Etc/GMT-12|Etc/GMT-13|Etc/GMT-14|Etc/GMT-2|Etc/GMT-3|Etc/GMT-4|Etc/GMT-5|Etc/GMT-6|Etc/GMT-7|Etc/GMT-8|Etc/GMT-9|Etc/GMT0|Etc/Greenwich|Etc/UCT|Etc/UTC|Etc/Universal|Etc/Zulu|Europe/Amsterdam|Europe/Andorra|Europe/Astrakhan|Europe/Athens|Europe/Belfast|Europe/Belgrade|Europe/Berlin|Europe/Bratislava|Europe/Brussels|Europe/Bucharest|Europe/Budapest|Europe/Busingen|Europe/Chisinau|Europe/Copenhagen|Europe/Dublin|Europe/Gibraltar|Europe/Guernsey|Europe/Helsinki|Europe/Isle_of_Man|Europe/Istanbul|Europe/Jersey|Europe/Kaliningrad|Europe/Kiev|Europe/Kirov|Europe/Kyiv|Europe/Lisbon|Europe/Ljubljana|Europe/London|Europe/Luxembourg|Europe/Madrid|Europe/Malta|Europe/Mariehamn|Europe/Minsk|Europe/Monaco|Europe/Moscow|Europe/Nicosia|Europe/Oslo|Europe/Paris|Europe/Podgorica|Europe/Prague|Europe/Riga|Europe/Rome|Europe/Samara|Europe/San_Marino|Europe/Sarajevo|Europe/Saratov|Europe/Simferopol|Europe/Skopje|Europe/Sofia|Europe/Stockholm|Europe/Tallinn|Europe/Tirane|Europe/Tiraspol|Europe/Ulyanovsk|Europe/Uzhgorod|Europe/Vaduz|Europe/Vatican|Europe/Vienna|Europe/Vilnius|Europe/Volgograd|Europe/Warsaw|Europe/Zagreb|Europe/Zaporozhye|Europe/Zurich|GB|GB-Eire|GMT|GMT\+0|GMT-0|GMT0|Greenwich|HST|Hongkong|Iceland|Indian/Antananarivo|Indian/Chagos|Indian/Christmas|Indian/Cocos|Indian/Comoro|Indian/Kerguelen|Indian/Mahe|Indian/Maldives|Indian/Mauritius|Indian/Mayotte|Indian/Reunion|Iran|Israel|Jamaica|Japan|Kwajalein|Libya|MET|MST|MST7MDT|Mexico/BajaNorte|Mexico/BajaSur|Mexico/General|NZ|NZ-CHAT|Navajo|PRC|PST8PDT|Pacific/Apia|Pacific/Auckland|Pacific/Bougainville|Pacific/Chatham|Pacific/Chuuk|Pacific/Easter|Pacific/Efate|Pacific/Enderbury|Pacific/Fakaofo|Pacific/Fiji|Pacific/Funafuti|Pacific/Galapagos|Pacific/Gambier|Pacific/Guadalcanal|Pacific/Guam|Pacific/Honolulu|Pacific/Johnston|Pacific/Kanton|Pacific/Kiritimati|Pacific/Kosrae|Pacific/Kwajalein|Pacific/Majuro|Pacific/Marquesas|Pacific/Midway|Pacific/Nauru|Pacific/Niue|Pacific/Norfolk|Pacific/Noumea|Pacific/Pago_Pago|Pacific/Palau|Pacific/Pitcairn|Pacific/Pohnpei|Pacific/Ponape|Pacific/Port_Moresby|Pacific/Rarotonga|Pacific/Saipan|Pacific/Samoa|Pacific/Tahiti|Pacific/Tarawa|Pacific/Tongatapu|Pacific/Truk|Pacific/Wake|Pacific/Wallis|Pacific/Yap|Poland|Portugal|ROC|ROK|Singapore|Turkey|UCT|US/Alaska|US/Aleutian|US/Arizona|US/Central|US/East-Indiana|US/Eastern|US/Hawaii|US/Indiana-Starke|US/Michigan|US/Mountain|US/Pacific|US/Samoa|UTC|Universal|W-SU|WET|Zulu)</code></pre>
<div class="sourceCode" id="cb1930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1930-1"><a href="#cb1930-1" tabindex="-1"></a><span class="co"># ISO 8601 formats</span></span>
<span id="cb1930-2"><a href="#cb1930-2" tabindex="-1"></a>ISO_DATE          <span class="co"># %Y-%m-%d</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; [0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12][0-9]|3[01])</code></pre>
<div class="sourceCode" id="cb1932"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1932-1"><a href="#cb1932-1" tabindex="-1"></a>ISO_TIME          <span class="co"># %H:%M:%S</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:[01][0-9]|2[0-3]):[0-5][0-9]:(?:[0-5][0-9]|6[01])</code></pre>
<div class="sourceCode" id="cb1934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1934-1"><a href="#cb1934-1" tabindex="-1"></a>ISO_DATETIME      <span class="co"># ISO_DATE followed by ISO_TIME, separated by space or &quot;T&quot;.</span></span></code></pre></div>
<pre><code>## &lt;regex&gt; [0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12][0-9]|3[01])(?:[ T](?:[01][0-9]|2[0-3]):[0-5][0-9]:(?:[0-5][0-9]|6[01]))?</code></pre>
<div class="sourceCode" id="cb1936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1936-1"><a href="#cb1936-1" tabindex="-1"></a><span class="co"># Compound forms, separated by DTSEP</span></span>
<span id="cb1936-2"><a href="#cb1936-2" tabindex="-1"></a>YMD</span></code></pre></div>
<pre><code>## &lt;regex&gt; [0-9]{1,4}[-/.:,\ ]?(?:0[1-9]|1[0-2])[-/.:,\ ]?(?:0[1-9]|[12][0-9]|3[01])</code></pre>
<div class="sourceCode" id="cb1938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1938-1"><a href="#cb1938-1" tabindex="-1"></a>YDM</span></code></pre></div>
<pre><code>## &lt;regex&gt; [0-9]{1,4}[-/.:,\ ]?(?:0[1-9]|[12][0-9]|3[01])[-/.:,\ ]?(?:0[1-9]|1[0-2])</code></pre>
<div class="sourceCode" id="cb1940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1940-1"><a href="#cb1940-1" tabindex="-1"></a>MYD</span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:0[1-9]|1[0-2])[-/.:,\ ]?[0-9]{1,4}[-/.:,\ ]?(?:0[1-9]|[12][0-9]|3[01])</code></pre>
<div class="sourceCode" id="cb1942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1942-1"><a href="#cb1942-1" tabindex="-1"></a>MDY</span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:0[1-9]|1[0-2])[-/.:,\ ]?(?:0[1-9]|[12][0-9]|3[01])[-/.:,\ ]?[0-9]{1,4}</code></pre>
<div class="sourceCode" id="cb1944"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1944-1"><a href="#cb1944-1" tabindex="-1"></a>DYM</span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:0[1-9]|[12][0-9]|3[01])[-/.:,\ ]?[0-9]{1,4}[-/.:,\ ]?(?:0[1-9]|1[0-2])</code></pre>
<div class="sourceCode" id="cb1946"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1946-1"><a href="#cb1946-1" tabindex="-1"></a>DMY</span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:0[1-9]|[12][0-9]|3[01])[-/.:,\ ]?(?:0[1-9]|1[0-2])[-/.:,\ ]?[0-9]{1,4}</code></pre>
<div class="sourceCode" id="cb1948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1948-1"><a href="#cb1948-1" tabindex="-1"></a>HMS</span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:[01][0-9]|2[0-3])[-/.:,\ ]?[0-5][0-9][-/.:,\ ]?(?:[0-5][0-9]|6[01])</code></pre>
<div class="sourceCode" id="cb1950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1950-1"><a href="#cb1950-1" tabindex="-1"></a>HM</span></code></pre></div>
<pre><code>## &lt;regex&gt; (?:[01][0-9]|2[0-3])[-/.:,\ ]?[0-5][0-9]</code></pre>
<div class="sourceCode" id="cb1952"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1952-1"><a href="#cb1952-1" tabindex="-1"></a>MS</span></code></pre></div>
<pre><code>## &lt;regex&gt; [0-5][0-9][-/.:,\ ]?(?:[0-5][0-9]|6[01])</code></pre>
<p>Example-19:</p>
<div class="sourceCode" id="cb1954"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1954-1"><a href="#cb1954-1" tabindex="-1"></a><span class="co"># We have some dates - both valid and invalid</span></span>
<span id="cb1954-2"><a href="#cb1954-2" tabindex="-1"></a>some_dates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2000-13-01&quot;</span>, <span class="st">&quot;2025-08-09&quot;</span>,<span class="st">&quot;2000-01-32&quot;</span>, <span class="st">&quot;2000-00-01&quot;</span>, <span class="st">&quot;2000-01-00&quot;</span>, <span class="st">&quot;2020-05-20&quot;</span>)</span>
<span id="cb1954-3"><a href="#cb1954-3" tabindex="-1"></a></span>
<span id="cb1954-4"><a href="#cb1954-4" tabindex="-1"></a><span class="fu">str_view</span>(some_dates, ISO_DATE)</span></code></pre></div>
<pre><code>## [2] │ &lt;2025-08-09&gt;
## [6] │ &lt;2020-05-20&gt;</code></pre>
<div class="sourceCode" id="cb1956"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1956-1"><a href="#cb1956-1" tabindex="-1"></a><span class="co"># Similarly some time formats</span></span>
<span id="cb1956-2"><a href="#cb1956-2" tabindex="-1"></a>some_times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;24:00:00&quot;</span>, <span class="st">&quot;23:60:59&quot;</span>, <span class="st">&quot;23:59:62&quot;</span>, <span class="st">&quot;23 59 59&quot;</span>, <span class="st">&quot;23:55:55&quot;</span>, <span class="st">&quot;00:00:00&quot;</span>)</span>
<span id="cb1956-3"><a href="#cb1956-3" tabindex="-1"></a><span class="fu">str_view</span>(some_times, ISO_TIME)</span></code></pre></div>
<pre><code>## [5] │ &lt;23:55:55&gt;
## [6] │ &lt;00:00:00&gt;</code></pre>
</div>
</div>
<div id="roman-numerals" class="section level2" number="30.9">
<h2><span class="header-section-number">30.9</span> Roman numerals</h2>
<p>To match Roman numerals we have a constant <code>ROMAN</code> as well as a function <code>roman(lo, hi)</code> in rebus.</p>
<p>Example-20:</p>
<div class="sourceCode" id="cb1958"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1958-1"><a href="#cb1958-1" tabindex="-1"></a><span class="co"># Some Roman numerals, both valid and invalid</span></span>
<span id="cb1958-2"><a href="#cb1958-2" tabindex="-1"></a>some_numbers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;MMMDCCCXLVIII&quot;</span>, <span class="st">&quot;MMMCMDCCCXLVIIV&quot;</span>, <span class="st">&quot;MCD&quot;</span>, <span class="st">&quot;XIL&quot;</span>, <span class="st">&quot;LIX&quot;</span>, <span class="st">&quot;XL&quot;</span>)</span>
<span id="cb1958-3"><a href="#cb1958-3" tabindex="-1"></a><span class="co"># Find valid roam numerals</span></span>
<span id="cb1958-4"><a href="#cb1958-4" tabindex="-1"></a><span class="fu">str_view</span>(some_numbers, <span class="fu">exactly</span>(<span class="fu">roman</span>()))</span></code></pre></div>
<pre><code>## [1] │ &lt;MMMDCCCXLVIII&gt;
## [3] │ &lt;MCD&gt;
## [5] │ &lt;LIX&gt;
## [6] │ &lt;XL&gt;</code></pre>
<!--chapter:end:14-2Regex.Rmd-->
</div>
</div>
<div id="factors" class="section level1" number="31">
<h1><span class="header-section-number">31</span> Factors</h1>
<p>We often have a requirement, where we need to have our character variable representing categorical data that should take values from a fixed and known set of finite values (or categories). Additionally sometimes these categories need to be sorted in a specific order which may not be alphabetical. Categorical data like this plays an important role in data analytics.</p>
<p>To deal with such categorical data, we have a special class <code>factor</code> in R (Readers may remember that we learnt about this data type, though in short only, in section @ref(fctrss)). In data analytical tasks we often need to create use factors, so let us discuss about these in a bit detail in this chapter.</p>
<div id="factors-in-base-r" class="section level2" number="31.1">
<h2><span class="header-section-number">31.1</span> Factors in base R</h2>
<p>Factors in R are objects built over atomic data-type <code>integer</code>. We have two primary functions to create (and coerce) factors from character vectors.</p>
<ul>
<li><code>factor</code></li>
<li><code>as.factor()</code></li>
</ul>
<p>Of these, <code>factor</code> provides us with full customisation as it is the basic function to create factor objects in base R. Let us discuss both.</p>
<div id="creating-factors-from-scratch" class="section level3" number="31.1.1">
<h3><span class="header-section-number">31.1.1</span> Creating factors from scratch</h3>
<p>Now, let us create factor from a character vector having values from <code>shirt_sizes</code>.</p>
<div class="sourceCode" id="cb1960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1960-1"><a href="#cb1960-1" tabindex="-1"></a>shirt_sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;L&quot;</span>, <span class="st">&quot;XL&quot;</span>, <span class="st">&quot;XXL&quot;</span>)</span></code></pre></div>
<p>Let us say, we have 10 shirts from these sizes randomly.</p>
<div class="sourceCode" id="cb1961"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1961-1"><a href="#cb1961-1" tabindex="-1"></a><span class="co"># 10 shirts with following sizes</span></span>
<span id="cb1961-2"><a href="#cb1961-2" tabindex="-1"></a><span class="co"># Notice one shirt with size small case l and one XXXL</span></span>
<span id="cb1961-3"><a href="#cb1961-3" tabindex="-1"></a>shirts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;L&quot;</span>, <span class="st">&quot;XL&quot;</span>, <span class="st">&quot;XXXL&quot;</span>, <span class="st">&quot;S&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;L&quot;</span>, <span class="st">&quot;L&quot;</span>)</span>
<span id="cb1961-4"><a href="#cb1961-4" tabindex="-1"></a></span>
<span id="cb1961-5"><a href="#cb1961-5" tabindex="-1"></a><span class="co"># Let us create a factor of shirt_sizes</span></span>
<span id="cb1961-6"><a href="#cb1961-6" tabindex="-1"></a>shirt_f <span class="ot">&lt;-</span> <span class="fu">factor</span>(shirts, <span class="at">levels =</span> shirt_sizes)</span>
<span id="cb1961-7"><a href="#cb1961-7" tabindex="-1"></a>shirt_f</span></code></pre></div>
<pre><code>##  [1] S    &lt;NA&gt; L    XL   &lt;NA&gt; S    M    M    L    L   
## Levels: S M L XL XXL</code></pre>
<p>In the output above we get <code>NA</code>s silently in place of values that were not available in our allowed values (read levels).</p>
<p>Now check its type and class.</p>
<div class="sourceCode" id="cb1963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1963-1"><a href="#cb1963-1" tabindex="-1"></a><span class="fu">typeof</span>(shirt_f)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb1965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1965-1"><a href="#cb1965-1" tabindex="-1"></a><span class="fu">class</span>(shirt_f)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<p>We can see that <code>factor</code> class is actually built upon the <code>integer</code> class underneath and labels (taking values from levels by default) shown in the output.</p>
<div class="sourceCode" id="cb1967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1967-1"><a href="#cb1967-1" tabindex="-1"></a><span class="fu">unclass</span>(shirt_f)</span></code></pre></div>
<pre><code>##  [1]  1 NA  3  4 NA  1  2  2  3  3
## attr(,&quot;levels&quot;)
## [1] &quot;S&quot;   &quot;M&quot;   &quot;L&quot;   &quot;XL&quot;  &quot;XXL&quot;</code></pre>
<p>We can, however, modify labels without modifying the levels by providing values (in a vector) to the <code>labels</code> argument. Let us now create another factor with labels different than levels.</p>
<div class="sourceCode" id="cb1969"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1969-1"><a href="#cb1969-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1969-2"><a href="#cb1969-2" tabindex="-1"></a><span class="co"># 100 Shirts</span></span>
<span id="cb1969-3"><a href="#cb1969-3" tabindex="-1"></a>shirts2 <span class="ot">&lt;-</span> <span class="fu">sample</span>(shirt_sizes, <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1969-4"><a href="#cb1969-4" tabindex="-1"></a>shirts2_f <span class="ot">&lt;-</span> <span class="fu">factor</span>(shirts2, <span class="at">levels =</span> shirt_sizes, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Small&quot;</span>, <span class="st">&quot;Medium&quot;</span>, <span class="st">&quot;Large&quot;</span>, <span class="st">&quot;Extra Large&quot;</span>, <span class="st">&quot;Extra Extra large&quot;</span>))</span>
<span id="cb1969-5"><a href="#cb1969-5" tabindex="-1"></a><span class="co"># Let&#39;s view some shirts</span></span>
<span id="cb1969-6"><a href="#cb1969-6" tabindex="-1"></a><span class="fu">head</span>(shirts2_f)</span></code></pre></div>
<pre><code>## [1] Large             Large             Medium            Medium           
## [5] Large             Extra Extra large
## Levels: Small Medium Large Extra Large Extra Extra large</code></pre>
<div class="sourceCode" id="cb1971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1971-1"><a href="#cb1971-1" tabindex="-1"></a><span class="co"># Check its levels</span></span>
<span id="cb1971-2"><a href="#cb1971-2" tabindex="-1"></a><span class="fu">levels</span>(shirts2_f)</span></code></pre></div>
<pre><code>## [1] &quot;Small&quot;             &quot;Medium&quot;            &quot;Large&quot;            
## [4] &quot;Extra Large&quot;       &quot;Extra Extra large&quot;</code></pre>
<p>Function <code>summary</code> gives us count for each level in the given factor.</p>
<div class="sourceCode" id="cb1973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1973-1"><a href="#cb1973-1" tabindex="-1"></a><span class="fu">summary</span>(shirts2_f)</span></code></pre></div>
<pre><code>##             Small            Medium             Large       Extra Large 
##                21                20                23                17 
## Extra Extra large 
##                19</code></pre>
</div>
<div id="coercing-objects-to-factor" class="section level3" number="31.1.2">
<h3><span class="header-section-number">31.1.2</span> Coercing objects to factor</h3>
<p>Up to now, we created a factor from set of allowable finite values (read <code>levels</code>) and displayed them using meaningful <code>labels</code>. Function <code>is.factor()</code> will check whether the given vector is a factor or not. On the other hand, function <code>as.factor</code> will coerce the existing character vector to a factor variable by using all the distinct values available therein as levels, but sorted alphabetically.</p>
<div class="sourceCode" id="cb1975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1975-1"><a href="#cb1975-1" tabindex="-1"></a><span class="fu">is.factor</span>(iris<span class="sc">$</span>Species)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1977-1"><a href="#cb1977-1" tabindex="-1"></a>shirts2_coerced <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(shirts2)</span>
<span id="cb1977-2"><a href="#cb1977-2" tabindex="-1"></a><span class="fu">head</span>(shirts2_coerced)</span></code></pre></div>
<pre><code>## [1] L   L   M   M   L   XXL
## Levels: L M S XL XXL</code></pre>
<div class="sourceCode" id="cb1979"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1979-1"><a href="#cb1979-1" tabindex="-1"></a><span class="fu">levels</span>(shirts2_coerced)</span></code></pre></div>
<pre><code>## [1] &quot;L&quot;   &quot;M&quot;   &quot;S&quot;   &quot;XL&quot;  &quot;XXL&quot;</code></pre>
<div class="sourceCode" id="cb1981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1981-1"><a href="#cb1981-1" tabindex="-1"></a><span class="co"># Check summary too</span></span>
<span id="cb1981-2"><a href="#cb1981-2" tabindex="-1"></a><span class="fu">summary</span>(shirts2_coerced)</span></code></pre></div>
<pre><code>##   L   M   S  XL XXL 
##  23  20  21  17  19</code></pre>
<p>This problem was not there in our earlier factor created from scratch, because there it took levels from the provided vector which we sorted meaningfully ourselves, and thus having more control.</p>
</div>
<div id="ordfact" class="section level3" number="31.1.3">
<h3><span class="header-section-number">31.1.3</span> Order in factors</h3>
<p>To sort the factors in a meaningful way, we can actually create ordered factor. Ordered factor can be created either by</p>
<ul>
<li>using <code>ordered = TRUE</code> argument in function <code>factor</code>; or by</li>
<li>coercing a given factor to an ordered factor using function <code>ordered()</code>.</li>
</ul>
<p>Clearly, latter method will again order the given factor as per the levels present in the factor.</p>
<div class="sourceCode" id="cb1983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1983-1"><a href="#cb1983-1" tabindex="-1"></a>shirts2_ordered <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb1983-2"><a href="#cb1983-2" tabindex="-1"></a>  shirts2,</span>
<span id="cb1983-3"><a href="#cb1983-3" tabindex="-1"></a>  <span class="at">levels =</span> shirt_sizes,</span>
<span id="cb1983-4"><a href="#cb1983-4" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Small&quot;</span>, <span class="st">&quot;Medium&quot;</span>, <span class="st">&quot;Large&quot;</span>, </span>
<span id="cb1983-5"><a href="#cb1983-5" tabindex="-1"></a>             <span class="st">&quot;Extra Large&quot;</span>, <span class="st">&quot;Extra Extra large&quot;</span>),</span>
<span id="cb1983-6"><a href="#cb1983-6" tabindex="-1"></a>  <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb1983-7"><a href="#cb1983-7" tabindex="-1"></a>)</span></code></pre></div>
<p>Ordering a factor in R has another benefit, we can actually perform calculations on the ordered factor.
Suppose if we want to find how many shirts do we have of sizes “Large” or greater.</p>
<div class="sourceCode" id="cb1984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1984-1"><a href="#cb1984-1" tabindex="-1"></a><span class="co"># How many shirts are there of sizes L or greater?</span></span>
<span id="cb1984-2"><a href="#cb1984-2" tabindex="-1"></a><span class="fu">sum</span>(shirts2_ordered <span class="sc">&gt;=</span> <span class="st">&quot;Large&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 59</code></pre>
<div class="sourceCode" id="cb1986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1986-1"><a href="#cb1986-1" tabindex="-1"></a><span class="co"># But unordered factor will result in error.</span></span>
<span id="cb1986-2"><a href="#cb1986-2" tabindex="-1"></a><span class="fu">sum</span>(shirts2_f <span class="sc">&gt;=</span> <span class="st">&quot;Large&quot;</span>)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>We can check the given factor is an ordered factor or not using function <code>is.ordered()</code>. E.g.</p>
<div class="sourceCode" id="cb1988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1988-1"><a href="#cb1988-1" tabindex="-1"></a><span class="fu">is.ordered</span>(shirts2_ordered)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1990-1"><a href="#cb1990-1" tabindex="-1"></a><span class="fu">is.ordered</span>(shirts2_f)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="functions-returning-factors-as-output" class="section level3" number="31.1.4">
<h3><span class="header-section-number">31.1.4</span> Functions returning factors as output</h3>
<p>Readers may remember that in section @ref(cutt) we learnt about a function <code>cut</code> which returns a factor variable as output. In the next sections we will learn some functions which will be useful while working with factor variables, either as input or output or both.</p>
</div>
</div>
<div id="factors-in-forcats" class="section level2" number="31.2">
<h2><span class="header-section-number">31.2</span> Factors in <code>forcats</code></h2>
<p>Package <code>forcats</code> which is part of core tidyverse provides us with more robust and useful ways to create and deal with factor variables. In <code>forcats</code> we have function <code>fct</code> for creating factor variables. It will produce errors if any value is not available in the given levels, to avoid bugs/typographical errors in the code. E.g.</p>
<div class="sourceCode" id="cb1992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1992-1"><a href="#cb1992-1" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb1992-2"><a href="#cb1992-2" tabindex="-1"></a>months_31 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Mar&quot;</span>, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Aug&quot;</span>, <span class="st">&quot;Oxt&quot;</span>, <span class="st">&quot;Dec&quot;</span>)</span>
<span id="cb1992-3"><a href="#cb1992-3" tabindex="-1"></a><span class="fu">fct</span>(months_31, <span class="at">levels =</span> month.abb)</span></code></pre></div>
<pre><code>## Error in `fct()`:
## ! All values of `x` must appear in `levels` or `na`
## ℹ Missing level: &quot;Oxt&quot;</code></pre>
</div>
<div id="inspecting-factors" class="section level2" number="31.3">
<h2><span class="header-section-number">31.3</span> Inspecting Factors</h2>
<div id="summarising-factors" class="section level3" number="31.3.1">
<h3><span class="header-section-number">31.3.1</span> Summarising factors</h3>
<p>The <code>summary()</code> method works well to give the counts for each level.</p>
<div class="sourceCode" id="cb1994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1994-1"><a href="#cb1994-1" tabindex="-1"></a>shirts2_fct <span class="ot">&lt;-</span> <span class="fu">fct</span>(shirts2)</span>
<span id="cb1994-2"><a href="#cb1994-2" tabindex="-1"></a><span class="fu">summary</span>(shirts2_fct)</span></code></pre></div>
<pre><code>##   L   M XXL  XL   S 
##  23  20  19  17  21</code></pre>
<p>Like <code>count</code> in <code>dplyr</code>, here we have <code>fct_count()</code> to give us level wise counts and/or proportions. The difference from <code>summary()</code> is however in output type. Function <code>fct_count()</code> returns a <code>tibble</code> instead. E.g.</p>
<div class="sourceCode" id="cb1996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1996-1"><a href="#cb1996-1" tabindex="-1"></a><span class="fu">fct_count</span>(shirts2_fct)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   f         n
##   &lt;fct&gt; &lt;int&gt;
## 1 L        23
## 2 M        20
## 3 XXL      19
## 4 XL       17
## 5 S        21</code></pre>
<div class="sourceCode" id="cb1998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1998-1"><a href="#cb1998-1" tabindex="-1"></a><span class="co"># Sort in decreasing counts</span></span>
<span id="cb1998-2"><a href="#cb1998-2" tabindex="-1"></a><span class="fu">fct_count</span>(shirts2_fct, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   f         n
##   &lt;fct&gt; &lt;int&gt;
## 1 L        23
## 2 S        21
## 3 M        20
## 4 XXL      19
## 5 XL       17</code></pre>
<div class="sourceCode" id="cb2000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2000-1"><a href="#cb2000-1" tabindex="-1"></a><span class="co"># Include proportions also</span></span>
<span id="cb2000-2"><a href="#cb2000-2" tabindex="-1"></a><span class="fu">fct_count</span>(shirts2_fct, <span class="at">sort =</span> <span class="cn">TRUE</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   f         n     p
##   &lt;fct&gt; &lt;int&gt; &lt;dbl&gt;
## 1 L        23  0.23
## 2 S        21  0.21
## 3 M        20  0.2 
## 4 XXL      19  0.19
## 5 XL       17  0.17</code></pre>
</div>
<div id="unique-levels-only" class="section level3" number="31.3.2">
<h3><span class="header-section-number">31.3.2</span> Unique levels only</h3>
<p>Function <code>fct_unique()</code> from the package, returns a factor with unique values, removing duplicates. E.g.</p>
<div class="sourceCode" id="cb2002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2002-1"><a href="#cb2002-1" tabindex="-1"></a><span class="fu">fct_unique</span>(shirts2_fct)</span></code></pre></div>
<pre><code>## [1] L   M   XXL XL  S  
## Levels: L M XXL XL S</code></pre>
</div>
</div>
<div id="order-in-factors" class="section level2" number="31.4">
<h2><span class="header-section-number">31.4</span> Order in Factors</h2>
<div id="default-ordering-in-factors" class="section level3" number="31.4.1">
<h3><span class="header-section-number">31.4.1</span> Default ordering in factors</h3>
<p>Orders created in factor variables using <code>fct</code> are sorted as per the levels given in the level argument. If the argument is not supplied then it is sorted on the basis of first appearance (as against alphabetically in the <code>factor</code>), as we observed in output of above example.</p>
<p>To learn more functions from <code>forcats</code> we will use <code>gss_cat</code> data frame which is part of the <code>forcats</code> package itself and GSS here stands for General Social Survey. It actually consists of many factor variables. For some other use cases, we will also use <code>economics_long</code> data which is part of <code>tidyr</code> package.</p>
</div>
<div id="reordering-factors" class="section level3" number="31.4.2">
<h3><span class="header-section-number">31.4.2</span> Reordering factors</h3>
<p>If we analyse the (mean) number of hours spent per day on TV watching across different religions in <code>gss_cat</code>, we can see that -</p>
<div class="sourceCode" id="cb2004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2004-1"><a href="#cb2004-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2004-2"><a href="#cb2004-2" tabindex="-1"></a>gss_cat <span class="sc">|&gt;</span></span>
<span id="cb2004-3"><a href="#cb2004-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">tv =</span> <span class="fu">mean</span>(tvhours, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> relig) <span class="sc">|&gt;</span></span>
<span id="cb2004-4"><a href="#cb2004-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(relig, tv)) <span class="sc">+</span></span>
<span id="cb2004-5"><a href="#cb2004-5" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb2004-6"><a href="#cb2004-6" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/reord-1.png" alt="Factors with default order" width="672" />
<p class="caption">
(#fig:reord)Factors with default order
</p>
</div>
<p>In above case (@ref(fig:reord)), the order of <code>relig</code> factor is meaningful when sorted on the basis of summarised values of another numerical variable present in the data. Function <code>fct_reorder</code> is helpful in these scenarios.</p>
<pre><code>fct_reorder(
  .f,
  .x,
  .fun = median,
  ...,
  .na_rm = NULL,
  .default = Inf,
  .desc = FALSE
)</code></pre>
<p>Where -</p>
<ul>
<li><code>.f</code> is the factor variable to be sorted.</li>
<li><code>.x</code> is the numerical variable based on which <code>.f</code> is to be sorted.</li>
<li><code>.fun</code> is the optional function (default is <code>median</code>) to be used when there are multiple values of .x for any of the level in <code>.f</code>.</li>
</ul>
<p>So, in above example, we can re-order the levels using this function. See figure @ref(fig:reord2) -</p>
<div class="sourceCode" id="cb2006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2006-1"><a href="#cb2006-1" tabindex="-1"></a>gss_cat <span class="sc">|&gt;</span></span>
<span id="cb2006-2"><a href="#cb2006-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">tv =</span> <span class="fu">mean</span>(tvhours, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> relig) <span class="sc">|&gt;</span></span>
<span id="cb2006-3"><a href="#cb2006-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_reorder</span>(relig, tv), tv)) <span class="sc">+</span></span>
<span id="cb2006-4"><a href="#cb2006-4" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb2006-5"><a href="#cb2006-5" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb2006-6"><a href="#cb2006-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Religion&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/reord2-1.png" alt="Factors with reordered levels" width="672" />
<p class="caption">
(#fig:reord2)Factors with reordered levels
</p>
</div>
<p>This function is also useful in sorting box-plots. As an example refer Figure @ref(fig:reord3).</p>
<div class="sourceCode" id="cb2007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2007-1"><a href="#cb2007-1" tabindex="-1"></a>economics_long <span class="sc">|&gt;</span> </span>
<span id="cb2007-2"><a href="#cb2007-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value01, <span class="at">y =</span> variable)) <span class="sc">+</span></span>
<span id="cb2007-3"><a href="#cb2007-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb2007-4"><a href="#cb2007-4" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Unsorted Boxes&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/reord3-1.png" alt="Unsorted boxes with unordered levels" width="672" />
<p class="caption">
(#fig:reord3)Unsorted boxes with unordered levels
</p>
</div>
<div class="sourceCode" id="cb2008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2008-1"><a href="#cb2008-1" tabindex="-1"></a>economics_long <span class="sc">|&gt;</span> </span>
<span id="cb2008-2"><a href="#cb2008-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">fct_reorder</span>(variable, value01)) <span class="sc">|&gt;</span> </span>
<span id="cb2008-3"><a href="#cb2008-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value01, <span class="at">y =</span> variable)) <span class="sc">+</span></span>
<span id="cb2008-4"><a href="#cb2008-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb2008-5"><a href="#cb2008-5" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Boxes sorted on Median&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/reord4-1.png" alt="Boxes sorted on Median reordering factor levels" width="672" />
<p class="caption">
(#fig:reord4)Boxes sorted on Median reordering factor levels
</p>
</div>
</div>
<div id="reordering-factors-with-two-other-variables." class="section level3" number="31.4.3">
<h3><span class="header-section-number">31.4.3</span> Reordering factors with two other variables.</h3>
<p>Sometimes, a factor variable needs to be sorted on the basis of first (or last) values of two other variables. In such <code>fct_reorder2()</code> is useful. As compared to <code>fct_reorder()</code> it takes an extra argument <code>.y</code> and is having syntax like</p>
<pre><code>fct_reorder2(
  .f,
  .x,
  .y,
  .fun = last2,
  ...,
  .na_rm = NULL,
  .default = -Inf,
  .desc = TRUE
)</code></pre>
<p>Here default function is <code>last2</code> which simply means that levels of <code>.f</code> are sorted on the basis of last values of <code>.y</code> when plotted against <code>.x</code> as in grouped line charts. E.g. See Figure @ref(fig:reord5).</p>
<div class="sourceCode" id="cb2010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2010-1"><a href="#cb2010-1" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb2010-2"><a href="#cb2010-2" tabindex="-1"></a><span class="fu">library</span>(conflicted)</span>
<span id="cb2010-3"><a href="#cb2010-3" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(dplyr<span class="sc">::</span>filter)</span>
<span id="cb2010-4"><a href="#cb2010-4" tabindex="-1"></a></span>
<span id="cb2010-5"><a href="#cb2010-5" tabindex="-1"></a>default <span class="ot">&lt;-</span> economics_long <span class="sc">|&gt;</span> </span>
<span id="cb2010-6"><a href="#cb2010-6" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&lt;</span> <span class="fu">dmy</span>(<span class="st">&quot;31122003&quot;</span>), date <span class="sc">&gt;=</span> <span class="fu">dmy</span>(<span class="st">&quot;01011995&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2010-7"><a href="#cb2010-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, value01)) <span class="sc">+</span></span>
<span id="cb2010-8"><a href="#cb2010-8" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> variable, <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb2010-9"><a href="#cb2010-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Default legend&quot;</span>)</span>
<span id="cb2010-10"><a href="#cb2010-10" tabindex="-1"></a></span>
<span id="cb2010-11"><a href="#cb2010-11" tabindex="-1"></a>aligned <span class="ot">&lt;-</span> economics_long <span class="sc">|&gt;</span> </span>
<span id="cb2010-12"><a href="#cb2010-12" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&lt;</span> <span class="fu">dmy</span>(<span class="st">&quot;31122003&quot;</span>), date <span class="sc">&gt;=</span> <span class="fu">dmy</span>(<span class="st">&quot;01011995&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2010-13"><a href="#cb2010-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">fct_reorder2</span>(variable, date, value01)) <span class="sc">|&gt;</span> </span>
<span id="cb2010-14"><a href="#cb2010-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, value01)) <span class="sc">+</span></span>
<span id="cb2010-15"><a href="#cb2010-15" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> variable, <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb2010-16"><a href="#cb2010-16" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Legend aligned with </span><span class="sc">\n</span><span class="st">last values of each line&quot;</span>)</span>
<span id="cb2010-17"><a href="#cb2010-17" tabindex="-1"></a></span>
<span id="cb2010-18"><a href="#cb2010-18" tabindex="-1"></a>default <span class="sc">+</span> aligned</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/reord5-1.png" alt="Factors reordered on two criteria" width="672" />
<p class="caption">
(#fig:reord5)Factors reordered on two criteria
</p>
</div>
</div>
<div id="changing-orders-of-few-factor-labels-only" class="section level3" number="31.4.4">
<h3><span class="header-section-number">31.4.4</span> Changing orders of few factor labels only</h3>
<p>Sometimes, we may have a factor whose levels are already meaningfully sorted. E.g. income levels in <code>gss_cat</code>. Check the plot in Figure @ref(fig:reord6).</p>
<div class="sourceCode" id="cb2011"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2011-1"><a href="#cb2011-1" tabindex="-1"></a>gss_cat <span class="sc">|&gt;</span> </span>
<span id="cb2011-2"><a href="#cb2011-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(rincome)) <span class="sc">+</span></span>
<span id="cb2011-3"><a href="#cb2011-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb2011-4"><a href="#cb2011-4" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/reord6-1.png" alt="Default Income levels" width="672" />
<p class="caption">
(#fig:reord6)Default Income levels
</p>
</div>
<p>The levels of income are already sorted in a meaningful way. However, sometimes we may want to change order of a few levels only. E.g. <code>Not applicable</code> in the Figure @ref(fig:reord6) which if re-leveled in the end may be more meaningful. In such cases, we may use <code>fct_relevel</code>. The function takes a factor variable and thereafter we may pass all those levels as arguments which we want to move in the end. After rearranging the bars (levels), the plot will look like as in Figure @ref(fig:reord7)</p>
<div class="sourceCode" id="cb2012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2012-1"><a href="#cb2012-1" tabindex="-1"></a>gss_cat <span class="sc">|&gt;</span> </span>
<span id="cb2012-2"><a href="#cb2012-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_relevel</span>(rincome, <span class="st">&quot;Not applicable&quot;</span>))) <span class="sc">+</span></span>
<span id="cb2012-3"><a href="#cb2012-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb2012-4"><a href="#cb2012-4" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb2012-5"><a href="#cb2012-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;Income levels&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/reord7-1.png" alt="Modifying levels manually" width="672" />
<p class="caption">
(#fig:reord7)Modifying levels manually
</p>
</div>
</div>
<div id="infreq" class="section level3" number="31.4.5">
<h3><span class="header-section-number">31.4.5</span> Ordering bar charts in order of frequency</h3>
<p>Function <code>fct_infreq()</code> is helpful in sorting the factor in decreasing order of frequency and thus, can be used to sort the bar charts (Refer charts in Figure @ref(fig:fct16)).</p>
<div class="sourceCode" id="cb2013"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2013-1"><a href="#cb2013-1" tabindex="-1"></a>default <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb2013-2"><a href="#cb2013-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(trans)) <span class="sc">+</span></span>
<span id="cb2013-3"><a href="#cb2013-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb2013-4"><a href="#cb2013-4" tabindex="-1"></a></span>
<span id="cb2013-5"><a href="#cb2013-5" tabindex="-1"></a>increasing <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb2013-6"><a href="#cb2013-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_infreq</span>(trans))) <span class="sc">+</span></span>
<span id="cb2013-7"><a href="#cb2013-7" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb2013-8"><a href="#cb2013-8" tabindex="-1"></a>default <span class="sc">+</span> increasing</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/fct16-1.png" alt="Default and increasing order by Frequency" width="672" />
<p class="caption">
(#fig:fct16)Default and increasing order by Frequency
</p>
</div>
</div>
<div id="reversing-the-factor-levels" class="section level3" number="31.4.6">
<h3><span class="header-section-number">31.4.6</span> Reversing the factor levels</h3>
<p>Using <code>fct_rev()</code> we can reverse the order of levels in any factor. E.g. Figure @ref(fig:reord8).</p>
<div class="sourceCode" id="cb2014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2014-1"><a href="#cb2014-1" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> </span>
<span id="cb2014-2"><a href="#cb2014-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trans =</span> <span class="fu">fct_rev</span>(<span class="fu">fct_infreq</span>(trans))) <span class="sc">|&gt;</span> </span>
<span id="cb2014-3"><a href="#cb2014-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(trans)) <span class="sc">+</span></span>
<span id="cb2014-4"><a href="#cb2014-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/reord8-1.png" alt="Reversing levels" width="672" />
<p class="caption">
(#fig:reord8)Reversing levels
</p>
</div>
</div>
<div id="other-reordering" class="section level3" number="31.4.7">
<h3><span class="header-section-number">31.4.7</span> Other reordering</h3>
<p>There are two more functions which can be used to reorder factor levels -</p>
<ul>
<li><code>fct_inorder()</code>: by the order in which they first appear.</li>
<li><code>fct_inseq()</code>: by numeric value of level.</li>
</ul>
<p>Readers may explore these functions by themselves.</p>
</div>
<div id="more-on-ordering-factors" class="section level3" number="31.4.8">
<h3><span class="header-section-number">31.4.8</span> More on ordering factors</h3>
<p>In section @ref(ordfact) we saw how an unordered factor can be turned into an ordered factor. This ordering can cause one side effect while plotting in ggplot2. Ordered factor use <code>scale_color_viridis</code> by default whereas unordered factor doesn’t. See following example (Notice how the color scale has been Figure @ref(fig:moreord) to Figure @ref(fig:moreord2)).</p>
<div class="sourceCode" id="cb2015"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2015-1"><a href="#cb2015-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb2015-2"><a href="#cb2015-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cyl =</span> <span class="fu">ordered</span>(<span class="fu">factor</span>(cyl))) <span class="sc">%&gt;%</span> </span>
<span id="cb2015-3"><a href="#cb2015-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb2015-4"><a href="#cb2015-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">color =</span> cyl)) <span class="sc">+</span></span>
<span id="cb2015-5"><a href="#cb2015-5" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Ordered Factor&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/moreord-1.png" alt="Use of color scale in ordered and unordered factors" width="672" />
<p class="caption">
(#fig:moreord)Use of color scale in ordered and unordered factors
</p>
</div>
<div class="sourceCode" id="cb2016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2016-1"><a href="#cb2016-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb2016-2"><a href="#cb2016-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cyl =</span> <span class="fu">factor</span>(cyl)) <span class="sc">%&gt;%</span> </span>
<span id="cb2016-3"><a href="#cb2016-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb2016-4"><a href="#cb2016-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">color =</span> cyl)) <span class="sc">+</span></span>
<span id="cb2016-5"><a href="#cb2016-5" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Unordered Factor&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/moreord2-1.png" alt="Use of color scale in ordered and unordered factors" width="672" />
<p class="caption">
(#fig:moreord2)Use of color scale in ordered and unordered factors
</p>
</div>
</div>
</div>
<div id="levels-in-factors" class="section level2" number="31.5">
<h2><span class="header-section-number">31.5</span> Levels in Factors</h2>
<div id="modifying-factor-levels-by-applying-a-function" class="section level3" number="31.5.1">
<h3><span class="header-section-number">31.5.1</span> Modifying factor levels by applying a function</h3>
<p>Function <code>fct_relabel</code> in <code>forcats</code> powerhouse applies a function <code>.fun</code> to each of the level in <code>.f</code> factor supplied to it. E.g. Change the case of each of the variable name in <code>economics_long</code> (Figure @ref(fig:reord9)).</p>
<div class="sourceCode" id="cb2017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2017-1"><a href="#cb2017-1" tabindex="-1"></a>economics_long <span class="sc">|&gt;</span> </span>
<span id="cb2017-2"><a href="#cb2017-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">fct_relabel</span>(variable, str_to_upper)) <span class="sc">|&gt;</span> </span>
<span id="cb2017-3"><a href="#cb2017-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value01, <span class="at">y =</span> variable)) <span class="sc">+</span></span>
<span id="cb2017-4"><a href="#cb2017-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() </span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/reord9-1.png" alt="Applying a function to all labels" width="672" />
<p class="caption">
(#fig:reord9)Applying a function to all labels
</p>
</div>
</div>
<div id="modifying-factor-levels-manually" class="section level3" number="31.5.2">
<h3><span class="header-section-number">31.5.2</span> Modifying factor levels manually</h3>
<p>Using function <code>fct_recode()</code> we can change the levels from the given factor manually. We have to provide new levels manually through a sequence of named character vectors where the name gives the new level, and the value gives the old level. Levels not otherwise mentioned will be left as is. Levels can be removed by naming them <code>NULL</code>. See Example</p>
<div class="sourceCode" id="cb2018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2018-1"><a href="#cb2018-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;bear&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;dear&quot;</span>))</span>
<span id="cb2018-2"><a href="#cb2018-2" tabindex="-1"></a><span class="fu">fct_recode</span>(x, <span class="at">fruit =</span> <span class="st">&quot;apple&quot;</span>, <span class="at">fruit =</span> <span class="st">&quot;banana&quot;</span>)</span></code></pre></div>
<pre><code>## [1] fruit bear  fruit dear 
## Levels: fruit bear dear</code></pre>
<p>To collapse multiple levels (lumping) into one we can use its cousin <code>fct_collapse()</code>. Example</p>
<div class="sourceCode" id="cb2020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2020-1"><a href="#cb2020-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;bear&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;dear&quot;</span>))</span>
<span id="cb2020-2"><a href="#cb2020-2" tabindex="-1"></a><span class="fu">fct_collapse</span>(x, <span class="at">fruit =</span> <span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>))</span></code></pre></div>
<pre><code>## [1] fruit bear  fruit dear 
## Levels: fruit bear dear</code></pre>
</div>
<div id="lump-uncommon-factor-levels-into-other" class="section level3" number="31.5.3">
<h3><span class="header-section-number">31.5.3</span> Lump uncommon factor levels into <code>other</code></h3>
<p>Package <code>forcats</code> provides us a family of 4 functions that are useful in lumping together the levels meeting some given criteria. These are</p>
<ul>
<li><code>fct_lump_min()</code>: lumps levels that appear fewer than min times.</li>
<li><code>fct_lump_prop()</code>: lumps levels that appear in fewer than (or equal to) <code>prop</code> * <code>n</code> times.</li>
<li><code>fct_lump_n()</code> lumps all levels except for the n most frequent (or least frequent if <code>n</code> &lt; 0)</li>
<li><code>fct_lump_lowfreq()</code> lumps together the least frequent levels, ensuring that <code>"other"</code> is still the smallest level.</li>
</ul>
<p>These all functions, apart from taking factors <code>f</code> as argument, also take one or more argument, which fits into the case-</p>
<ul>
<li><code>n</code> Positive <code>n</code> preserves the most common <code>n</code> values. Negative <code>n</code> preserves the least common <code>-n</code> values.</li>
<li><code>prop</code> Positive <code>prop</code> lumps values which do not appear at least <code>prop</code> of the time. Negative prop lumps values that do not appear at most <code>-prop</code> of the time.</li>
<li><code>min</code> Preserve levels that appear at least <code>min</code> number of times.</li>
<li><code>w</code> An optional numeric vector giving weights for frequency of each value (not level) in <code>f</code>.</li>
<li><code>other_level</code>: Value of level used for <code>"other"</code>(default) values. Always placed at end of levels.</li>
</ul>
<p>Some examples-</p>
<div class="sourceCode" id="cb2022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2022-1"><a href="#cb2022-1" tabindex="-1"></a><span class="co"># We can check the religion in `gss_cat` and followers count</span></span>
<span id="cb2022-2"><a href="#cb2022-2" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span> </span>
<span id="cb2022-3"><a href="#cb2022-3" tabindex="-1"></a>  <span class="fu">count</span>(relig)</span></code></pre></div>
<pre><code>## # A tibble: 15 × 2
##    relig                       n
##    &lt;fct&gt;                   &lt;int&gt;
##  1 No answer                  93
##  2 Don&#39;t know                 15
##  3 Inter-nondenominational   109
##  4 Native american            23
##  5 Christian                 689
##  6 Orthodox-christian         95
##  7 Moslem/islam              104
##  8 Other eastern              32
##  9 Hinduism                   71
## 10 Buddhism                  147
## 11 Other                     224
## 12 None                     3523
## 13 Jewish                    388
## 14 Catholic                 5124
## 15 Protestant              10846</code></pre>
<div class="sourceCode" id="cb2024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2024-1"><a href="#cb2024-1" tabindex="-1"></a><span class="co"># Let&#39;s restrict these to 5 religions only</span></span>
<span id="cb2024-2"><a href="#cb2024-2" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span> </span>
<span id="cb2024-3"><a href="#cb2024-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_lump_n</span>(relig, <span class="at">n =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb2024-4"><a href="#cb2024-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/fctlump-1.png" alt="Lumping Factors" width="672" />
<p class="caption">
(#fig:fctlump)Lumping Factors
</p>
</div>
<p>In Figure @ref(fig:fctlump) we can see that there are five religions plus <code>"other"</code> category placed in last. We may also notice that bars are not sorted yet.</p>
<p>We may also make use of <code>w</code> argument, if we already have our factor and its counts of levels in another vector. See figure @ref(fig:fctlump2) -</p>
<div class="sourceCode" id="cb2025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2025-1"><a href="#cb2025-1" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span> </span>
<span id="cb2025-2"><a href="#cb2025-2" tabindex="-1"></a>  <span class="fu">count</span>(relig) <span class="sc">%&gt;%</span> </span>
<span id="cb2025-3"><a href="#cb2025-3" tabindex="-1"></a>  <span class="co"># Making use of `w` argument</span></span>
<span id="cb2025-4"><a href="#cb2025-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">relig =</span> <span class="fu">fct_lump_n</span>(relig, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">w =</span> n)) <span class="sc">%&gt;%</span> </span>
<span id="cb2025-5"><a href="#cb2025-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(relig, n)) <span class="sc">+</span></span>
<span id="cb2025-6"><a href="#cb2025-6" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/fctlump2-1.png" alt="Lumping Factors by making use of w argument" width="672" />
<p class="caption">
(#fig:fctlump2)Lumping Factors by making use of w argument
</p>
</div>
<p>To sort the levels in increasing order of frequency we can use <code>fct_infreq()</code> function which we learnt in section @ref(infreq). It may also take <code>w</code> argument (optionally, of course) if we have our factor levels already counted. So, to sort the levels in Figure @ref(fig:fctlump2), we may make use of this function one step before lumping. See figure @ref(fig:fctlump3).</p>
<div class="sourceCode" id="cb2026"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2026-1"><a href="#cb2026-1" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span> </span>
<span id="cb2026-2"><a href="#cb2026-2" tabindex="-1"></a>  <span class="fu">count</span>(relig) <span class="sc">%&gt;%</span> </span>
<span id="cb2026-3"><a href="#cb2026-3" tabindex="-1"></a>  <span class="co"># Sorting making use of `w` argument</span></span>
<span id="cb2026-4"><a href="#cb2026-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">relig =</span> <span class="fu">fct_infreq</span>(relig, <span class="at">w =</span> n),</span>
<span id="cb2026-5"><a href="#cb2026-5" tabindex="-1"></a>         <span class="at">relig =</span> <span class="fu">fct_lump_n</span>(relig, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">w =</span> n)) <span class="sc">%&gt;%</span> </span>
<span id="cb2026-6"><a href="#cb2026-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(relig, n)) <span class="sc">+</span></span>
<span id="cb2026-7"><a href="#cb2026-7" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/fctlump3-1.png" alt="Sorting and Lumping Factors" width="672" />
<p class="caption">
(#fig:fctlump3)Sorting and Lumping Factors
</p>
</div>
<hr />
<!--chapter:end:14-3Factors.Rmd-->
</div>
</div>
</div>
<div id="text-analytics-in-r" class="section level1" number="32">
<h1><span class="header-section-number">32</span> Text Analytics in R</h1>
<p><em>The content is under development/finalisation</em></p>
<p>Text analytics is crucial in data analytics, as text data is becoming increasingly significant across various applications, including marketing analytics. Text is often replacing other forms of unstructured data because it is cost-effective and up-to-date. To fully leverage the potential of text data, we need to understand how to process, clean, summarize, and model it. In this chapter, we will use the R workhorse tools to efficiently begin working with text. We will gain skills in wrangling and visualizing text, so that we are able to perform sentiment analysis in next chapter. We will also discuss a little about running and interpreting topic models, thereby highlighting the indispensable role of text analytics in modern data analysis.</p>
<p>Text data processing faces unique challenges due to the complexity and variability of human language. Unlike structured data, text is unstructured and highly diverse, encompassing different languages, dialects, slang, and abbreviations. This variability complicates standardization and requires sophisticated preprocessing techniques to clean and prepare the data. Additionally, the context-dependent nature of language makes accurate interpretation difficult, as words and phrases can have varying meanings based on their usage.</p>
<div id="text-pre-processing" class="section level2 unnumbered">
<h2 class="unnumbered">Text pre-processing</h2>
</div>
<div id="tokenisation" class="section level2" number="32.1">
<h2><span class="header-section-number">32.1</span> Tokenisation</h2>
</div>
<div id="stop-words" class="section level2" number="32.2">
<h2><span class="header-section-number">32.2</span> Stop words</h2>
</div>
<div id="stemming" class="section level2" number="32.3">
<h2><span class="header-section-number">32.3</span> Stemming</h2>
</div>
<div id="text-cleaning-vy-removing-punctuation-and-other-unwanted-characterstext" class="section level2" number="32.4">
<h2><span class="header-section-number">32.4</span> Text Cleaning vy removing punctuation and other unwanted characters/text</h2>
</div>
</div>
<div id="sentiment-analysis" class="section level1" number="33">
<h1><span class="header-section-number">33</span> Sentiment Analysis</h1>
<p><em>The content is under development</em></p>
</div>
<div id="visualising-text-analytics-through-wordcloud-etc." class="section level1" number="34">
<h1><span class="header-section-number">34</span> Visualising Text analytics through Wordcloud, etc.</h1>
<p><em>The content is under development is following is not finalised.</em></p>
<div id="frequency-plots" class="section level2" number="34.1">
<h2><span class="header-section-number">34.1</span> Frequency plots</h2>
</div>
<div id="wordclouds" class="section level2" number="34.2">
<h2><span class="header-section-number">34.2</span> Wordclouds</h2>
<div id="step-1prepare-data-and-load-libraries" class="section level3" number="34.2.1">
<h3><span class="header-section-number">34.2.1</span> Step-1:Prepare data and load libraries</h3>
<p>As an example we will create a word cloud with Budget Speech made by Finance Minister during her Budget speech<a href="#fn36" class="footnote-ref" id="fnref36"><sup>36</sup></a> 2022-23. All of the budget speech is available in file called <code>budget.txt</code>.</p>
<p>Load Libraries</p>
<div class="sourceCode" id="cb2027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2027-1"><a href="#cb2027-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2027-2"><a href="#cb2027-2" tabindex="-1"></a><span class="fu">library</span>(tidytext) <span class="co">#install.packages(&quot;tidytext&quot;)</span></span>
<span id="cb2027-3"><a href="#cb2027-3" tabindex="-1"></a><span class="fu">library</span>(wordcloud) <span class="co">#install.packages(&quot;wordcloud&quot;)</span></span>
<span id="cb2027-4"><a href="#cb2027-4" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb2027-5"><a href="#cb2027-5" tabindex="-1"></a><span class="fu">library</span>(ggalt)</span>
<span id="cb2027-6"><a href="#cb2027-6" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb2027-7"><a href="#cb2027-7" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb2027-8"><a href="#cb2027-8" tabindex="-1"></a><span class="fu">library</span>(conflicted)</span>
<span id="cb2027-9"><a href="#cb2027-9" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(dplyr<span class="sc">::</span>filter)</span></code></pre></div>
<p>Load data</p>
<div class="sourceCode" id="cb2028"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2028-1"><a href="#cb2028-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&#39;data/budget.txt&#39;</span>, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="step-2-reshape-the-.txt-data-frame-into-one-column" class="section level3" number="34.2.2">
<h3><span class="header-section-number">34.2.2</span> Step-2: Reshape the .txt data frame into one column</h3>
<p>Above steps will create one row per line. Let’s create a tidy data frame out of this data.</p>
<div class="sourceCode" id="cb2029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2029-1"><a href="#cb2029-1" tabindex="-1"></a>tidy_dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb2029-2"><a href="#cb2029-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to =</span> <span class="st">&#39;word&#39;</span>, <span class="at">names_to =</span> <span class="cn">NULL</span>)</span></code></pre></div>
</div>
<div id="step-3-tokenize-the-datawords" class="section level3" number="34.2.3">
<h3><span class="header-section-number">34.2.3</span> Step-3: Tokenize the data/words</h3>
<p>To tokenize the words we will use function <code>unnest_tokens()</code> from <code>tidytext</code> library. As a further step we will have a count of each word, using <code>dplyr::count</code> which will create a column <code>n</code> against each word.</p>
<div class="sourceCode" id="cb2030"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2030-1"><a href="#cb2030-1" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> tidy_dat <span class="sc">%&gt;%</span> </span>
<span id="cb2030-2"><a href="#cb2030-2" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, word) <span class="sc">%&gt;%</span> </span>
<span id="cb2030-3"><a href="#cb2030-3" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) </span></code></pre></div>
</div>
<div id="step-4-clean-stop-words" class="section level3" number="34.2.4">
<h3><span class="header-section-number">34.2.4</span> Step-4: Clean stop words</h3>
<p>The library <code>tidytext</code> has a default database which can eliminate stop words from above data. Let’s load this default stop words data.</p>
<div class="sourceCode" id="cb2031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2031-1"><a href="#cb2031-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;stop_words&quot;</span>)</span></code></pre></div>
<p>We may then remove stop words using <code>dplyr::anti_join</code>.</p>
<div class="sourceCode" id="cb2032"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2032-1"><a href="#cb2032-1" tabindex="-1"></a>tokens_clean <span class="ot">&lt;-</span> tokens <span class="sc">%&gt;%</span></span>
<span id="cb2032-2"><a href="#cb2032-2" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by=</span><span class="st">&#39;word&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2032-3"><a href="#cb2032-3" tabindex="-1"></a>  <span class="co"># remove numbers</span></span>
<span id="cb2032-4"><a href="#cb2032-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(word, <span class="st">&quot;^[0-9]&quot;</span>))</span></code></pre></div>
<p>We may remove additional stop words those specific to this data/input. To have an idea of these stop words, we may at firt, skip this step altogether and proceed to generate word cloud in next step directly. After having a first look, we can identify and then remove these additional stop words seen in first round(s).</p>
<div class="sourceCode" id="cb2033"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2033-1"><a href="#cb2033-1" tabindex="-1"></a>uni_sw <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">word =</span> <span class="fu">c</span>(<span class="st">&quot;cent&quot;</span>, <span class="st">&quot;pm&quot;</span>, <span class="st">&quot;crore&quot;</span>, </span>
<span id="cb2033-2"><a href="#cb2033-2" tabindex="-1"></a>                              <span class="st">&quot;lakh&quot;</span>, <span class="st">&quot;set&quot;</span>,</span>
<span id="cb2033-3"><a href="#cb2033-3" tabindex="-1"></a>                              <span class="st">&quot;level&quot;</span>, <span class="st">&quot;sir&quot;</span>))</span>
<span id="cb2033-4"><a href="#cb2033-4" tabindex="-1"></a></span>
<span id="cb2033-5"><a href="#cb2033-5" tabindex="-1"></a>tokens_clean <span class="ot">&lt;-</span> tokens_clean <span class="sc">%&gt;%</span> </span>
<span id="cb2033-6"><a href="#cb2033-6" tabindex="-1"></a>  <span class="fu">anti_join</span>(uni_sw, <span class="at">by =</span> <span class="st">&quot;word&quot;</span>)</span></code></pre></div>
</div>
<div id="step-5-plotgenerate-word-cloud" class="section level3" number="34.2.5">
<h3><span class="header-section-number">34.2.5</span> Step-5: Plot/generate word cloud</h3>
<p>Output/Word cloud of following code can be seen in figure @ref(fig:wordcloud).</p>
<div class="sourceCode" id="cb2034"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2034-1"><a href="#cb2034-1" tabindex="-1"></a>pal <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb2034-2"><a href="#cb2034-2" tabindex="-1"></a></span>
<span id="cb2034-3"><a href="#cb2034-3" tabindex="-1"></a><span class="co"># plot the 40 most common words</span></span>
<span id="cb2034-4"><a href="#cb2034-4" tabindex="-1"></a>tokens_clean <span class="sc">%&gt;%</span> </span>
<span id="cb2034-5"><a href="#cb2034-5" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">wordcloud</span>(word, </span>
<span id="cb2034-6"><a href="#cb2034-6" tabindex="-1"></a>                 n, </span>
<span id="cb2034-7"><a href="#cb2034-7" tabindex="-1"></a>                 <span class="at">random.order =</span> <span class="cn">FALSE</span>, </span>
<span id="cb2034-8"><a href="#cb2034-8" tabindex="-1"></a>                 <span class="at">max.words =</span> <span class="dv">40</span>, </span>
<span id="cb2034-9"><a href="#cb2034-9" tabindex="-1"></a>                 <span class="at">colors=</span>pal,</span>
<span id="cb2034-10"><a href="#cb2034-10" tabindex="-1"></a>                 <span class="at">scale=</span><span class="fu">c</span>(<span class="fl">2.5</span>, .<span class="dv">5</span>)))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/wordcloud-1.png" alt="Word Cloud of FM's Budget Speech 2022" width="672" />
<p class="caption">
(#fig:wordcloud)Word Cloud of FM’s Budget Speech 2022
</p>
</div>
<!--chapter:end:14-4text.Rmd-->
</div>
</div>
</div>
<div id="finding-string-similarity" class="section level1" number="35">
<h1><span class="header-section-number">35</span> Finding string similarity</h1>
<p>Comparison of two (or more) numeric fields is an easy job in the sense that we can use multiple statistical methods available to measure comparison between these. On the other hand, comparing strings in any way, shape or form is not a trivial task. Despite this complexity, comparing text strings is a common and fundamental task in many text-processing algorithms. Basic objective of all string similarity algorithms are to quantify the similarity between two text strings in terms of string metrics.</p>
<p>The fuzzy matching problems are to input two strings and return a score quantifying the likelihood that they are expressions of the same entity. So (<code>Geeta</code> and <code>Gita</code>) should get a high score but not (<code>Apple</code> and <code>Microsoft</code>). Over several decades, various algorithms for fuzzy string matching have emerged. They have varying strengths and weaknesses. These fall into two broad categories: <code>lexical matching</code> and <code>phonetic matching</code>.</p>
<div id="lexical-matching" class="section level2" number="35.1">
<h2><span class="header-section-number">35.1</span> Lexical matching</h2>
<p><em>Lexical matching algorithms</em> match two strings based on some model of errors. Typically they are meant to match strings that differ due to spelling or typing errors. Consider <code>Atharv</code> and <code>ahtarv</code>. A lexical matching algorithm would pick up that <code>ht</code> is a transposition of <code>th</code>. Such transposition errors are common. Given this, and that the rest of the two strings match exactly and are long enough, we should score this match as high.</p>
<p>Normally, algorithms to find lexical matching, can be classified into ‘edit distance based’ or ‘token based’.</p>
<div id="levenshtein-algorithm" class="section level3" number="35.1.1">
<h3><span class="header-section-number">35.1.1</span> Levenshtein algorithm</h3>
<p>It is named after <em>Vladimir Levenshtein</em>, who considered this distance in 1965. The <code>Levenshtein distance</code> between two words is the minimum number of single-character edits (i.e. insertions, deletions or substitutions) required to change one word into the other. Levenshtein distance may also be referred to as <em>edit distance</em>, although it may also denote a larger family of distance metrics. It is closely related to pairwise string alignments.</p>
<p>For the two words <code>helo</code> and <code>hello</code>, it is obvious that there is a missing character <code>"l"</code>. Thus to transform the word <code>helo</code> to <code>hello</code> all we need to do is insert that character. The distance, in this case, is <code>1</code> because there is only one edit needed.</p>
</div>
<div id="hamming-distance" class="section level3" number="35.1.2">
<h3><span class="header-section-number">35.1.2</span> Hamming distance</h3>
<p>This distance is computed by overlaying one string over another and finding the places where the strings vary. Note, classical implementation was meant to handle strings of same length. Some implementations may bypass this by adding a padding at prefix or suffix. Nevertheless, the logic is to find the total number of places one string is different from the other.</p>
</div>
<div id="jaro-winkler" class="section level3" number="35.1.3">
<h3><span class="header-section-number">35.1.3</span> Jaro-Winkler</h3>
<p>This algorithms gives high scores to two strings if,</p>
<ol style="list-style-type: decimal">
<li>they contain same characters, but within a certain distance from one another, and</li>
<li>the order of the matching characters is same.</li>
</ol>
<p>To be exact, the distance of finding similar character is 1 less than half of length of longest string. So if longest strings has length of 5, a character at the start of the string 1 must be found before or on ((5/2)–1) ~ 2nd position in the string 2 to be considered valid match. Because of this, the algorithm is directional and gives high score if matching is from the beginning of the strings.</p>
</div>
<div id="q-gram" class="section level3" number="35.1.4">
<h3><span class="header-section-number">35.1.4</span> Q-Gram</h3>
<p><em>Q-Grams</em> is based on the difference between occurences of <code>Q</code> consecutive characters in two strings. To illustrate take a case of Q=3 (this special case is also called trigrams). For <code>atharv</code> and its possible typo <code>ahtarv</code> the trigrams will be</p>
<ul>
<li>For atharv <code>{ath tha har arv}</code></li>
<li>for ahtarv <code>{aht hta tar arv}</code></li>
</ul>
<p>We can see that a total of <code>7</code> unique trigrams have been formed and out of these only <code>1</code> is similar. Thus, 3-gram similarility would be <code>1/7=14%</code>. We can see that this algorithm is not very effective for transpositions.</p>
</div>
</div>
<div id="phonetic-matching" class="section level2" number="35.2">
<h2><span class="header-section-number">35.2</span> Phonetic matching</h2>
<p><em>Phonetic matching algorithms</em> match strings based on how similar they sound. Consider <code>Geeta</code> and <code>Gita.</code> They sound similar enough that one person might spell as <code>Geetha</code> or <code>Geeta</code>, another as <code>Gita.</code> As in this case, one is not necessarily a misspelling of the other. just sounds similar.</p>
<div id="soundex" class="section level3" number="35.2.1">
<h3><span class="header-section-number">35.2.1</span> Soundex</h3>
<p>Created by <em>Robert Russel</em> and <em>Margaret King Odell</em> in 1918, this algorithm intended to match names and surnames based on the basic rules of English pronunciation, hence, similar names get the same value.</p>
</div>
<div id="metaphone" class="section level3" number="35.2.2">
<h3><span class="header-section-number">35.2.2</span> Metaphone</h3>
<p>Developed by <em>Lawrence Philips</em> in 1990, the Metaphone is also more accurate compared with the <code>Soundex</code> method as it takes into consideration the groups of letters. The disadvantage shows up when we apply it to reconcile the strings that are not in English, as it is based on the rules of English pronunciation.</p>
</div>
<div id="double-metaphone" class="section level3" number="35.2.3">
<h3><span class="header-section-number">35.2.3</span> Double Metaphone</h3>
<p>Following <code>Metaphone</code>, <em>Philips</em> also designed the <em>Double Metaphone</em>. As its name suggests, it returns two codes, so you have more chances to match the items, however, at the same time, it means a higher probability of an error. According to the algorithm, there are three matching levels:</p>
<ul>
<li><code>primary key to the primary key = strongest match</code>,</li>
<li><code>secondary key to the primary key = normal match</code>,</li>
<li><code>secondary key against the secondary key = weakest match</code>.</li>
</ul>
</div>
<div id="metaphone-3" class="section level3" number="35.2.4">
<h3><span class="header-section-number">35.2.4</span> Metaphone 3</h3>
<p><em>Philips</em> further refined the double metaphone algorithm to produce better results. The algorithm (Metaphone 3) is however, proprietary and is not open-source.</p>
</div>
</div>
<div id="examples" class="section level2" number="35.3">
<h2><span class="header-section-number">35.3</span> Examples</h2>
<p>In R, we can use <code>stringdist</code> package to calculate many of the above mentioned distances. The function is vectorised. The synatx is</p>
<pre><code>stringdist(
  a,
  b,
  method = c(&quot;osa&quot;, &quot;lv&quot;, &quot;dl&quot;, &quot;hamming&quot;, &quot;lcs&quot;, &quot;qgram&quot;, &quot;cosine&quot;, &quot;jaccard&quot;, &quot;jw&quot;,
    &quot;soundex&quot;),
  useBytes = FALSE,
  weight = c(d = 1, i = 1, s = 1, t = 1),
  q = 1,
  p = 0,
  bt = 0,
  nthread = getOption(&quot;sd_num_thread&quot;)
)</code></pre>
<p>where -</p>
<ul>
<li><code>a</code> and <code>b</code> are two strings/vectors for which similarity/distance is to be measured.</li>
<li><code>method</code> to be used. Default is
<ul>
<li><code>osa</code> for <em>Optimal String Alignment</em>. Other methods are-</li>
<li><code>lv</code> for <em>Levenstein distance</em>,</li>
<li><code>dl</code> for <em>Damerau-Levenshtein</em></li>
<li><code>hamming</code> for <em>Hamming distance</em></li>
<li><code>lcs</code> for <em>Longest Common Substring</em></li>
<li><code>qgram</code> for Q-Grams</li>
<li><code>cosine</code> for cosine</li>
<li><code>jaccard</code> for Jaccard’s algorithm</li>
<li><code>jw</code> for Jaro-Winkler</li>
<li><code>soundex</code> for Soundex</li>
</ul></li>
<li>Other arguments are needed on the basis of algorithm chosen.</li>
</ul>
<p>To calculate ‘metaphone’ index we can use <code>phonics</code> package and for ‘Double Metaphone’ we can use <code>PGRdup</code> package in R.</p>
<p>Example - Suppose we have a set of two names.</p>
<div class="sourceCode" id="cb2036"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2036-1"><a href="#cb2036-1" tabindex="-1"></a>nameset1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Geeta&#39;</span>, <span class="st">&#39;Susheel&#39;</span>, <span class="st">&#39;Ram&#39;</span>, <span class="st">&#39;Dr. Suchitra&#39;</span>)</span>
<span id="cb2036-2"><a href="#cb2036-2" tabindex="-1"></a>nameset2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Gita&#39;</span>, <span class="st">&#39;Sushil&#39;</span>, <span class="st">&#39;Rama&#39;</span>, <span class="st">&#39;Suchitra&#39;</span>)</span></code></pre></div>
<p>Note most of these distances/similarity indices are cases sensitive, and therefore we have to use these methods with a bit cleaning first. We can convert cases of all strings to lower-case to eliminate these (if) unwanted errors.</p>
<div class="sourceCode" id="cb2037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2037-1"><a href="#cb2037-1" tabindex="-1"></a><span class="fu">library</span>(stringdist)</span>
<span id="cb2037-2"><a href="#cb2037-2" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(dplyr))</span>
<span id="cb2037-3"><a href="#cb2037-3" tabindex="-1"></a></span>
<span id="cb2037-4"><a href="#cb2037-4" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb2037-5"><a href="#cb2037-5" tabindex="-1"></a>  <span class="at">nameset1 =</span> <span class="fu">tolower</span>(nameset1),</span>
<span id="cb2037-6"><a href="#cb2037-6" tabindex="-1"></a>  <span class="at">nameset2 =</span> <span class="fu">tolower</span>(nameset2)</span>
<span id="cb2037-7"><a href="#cb2037-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb2037-8"><a href="#cb2037-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lv_dist =</span> <span class="fu">stringdist</span>(nameset1, nameset2, <span class="at">method =</span> <span class="st">&#39;lv&#39;</span>),</span>
<span id="cb2037-9"><a href="#cb2037-9" tabindex="-1"></a>         <span class="at">jw_dist =</span> <span class="fu">stringdist</span>(nameset1, nameset2, <span class="at">method =</span> <span class="st">&#39;jw&#39;</span>),</span>
<span id="cb2037-10"><a href="#cb2037-10" tabindex="-1"></a>         <span class="at">qgram_3 =</span> <span class="fu">stringdist</span>(nameset1, nameset2, <span class="at">method =</span> <span class="st">&#39;qgram&#39;</span>, <span class="at">q=</span><span class="dv">3</span>))</span></code></pre></div>
<pre><code>##       nameset1 nameset2 lv_dist    jw_dist qgram_3
## 1        geeta     gita       2 0.21666667       5
## 2      susheel   sushil       2 0.15079365       5
## 3          ram     rama       1 0.08333333       1
## 4 dr. suchitra suchitra       4 0.25694444       4</code></pre>
<p>Creating Metaphone and Double Metaphone</p>
<div class="sourceCode" id="cb2039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2039-1"><a href="#cb2039-1" tabindex="-1"></a><span class="fu">library</span>(phonics)</span>
<span id="cb2039-2"><a href="#cb2039-2" tabindex="-1"></a></span>
<span id="cb2039-3"><a href="#cb2039-3" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb2039-4"><a href="#cb2039-4" tabindex="-1"></a>  <span class="at">nameset1 =</span> <span class="fu">tolower</span>(nameset1),</span>
<span id="cb2039-5"><a href="#cb2039-5" tabindex="-1"></a>  <span class="at">nameset2 =</span> <span class="fu">tolower</span>(nameset2)</span>
<span id="cb2039-6"><a href="#cb2039-6" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb2039-7"><a href="#cb2039-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">metaphone_1 =</span> <span class="fu">metaphone</span>(nameset1),</span>
<span id="cb2039-8"><a href="#cb2039-8" tabindex="-1"></a>         <span class="at">metaphone_2 =</span> <span class="fu">metaphone</span>(nameset2))</span></code></pre></div>
<pre><code>##       nameset1 nameset2 metaphone_1 metaphone_2
## 1        geeta     gita          JT          JT
## 2      susheel   sushil         SXL         SXL
## 3          ram     rama          RM          RM
## 4 dr. suchitra suchitra        &lt;NA&gt;        SXTR</code></pre>
<p>Note that we cannot calculate <code>metaphone</code> for special characters even for spaces.</p>
<p><em>Double metaphone</em> is not vectorised. So we have to use <code>apply</code> family of functions here.</p>
<div class="sourceCode" id="cb2041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2041-1"><a href="#cb2041-1" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(PGRdup))</span>
<span id="cb2041-2"><a href="#cb2041-2" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb2041-3"><a href="#cb2041-3" tabindex="-1"></a></span>
<span id="cb2041-4"><a href="#cb2041-4" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb2041-5"><a href="#cb2041-5" tabindex="-1"></a>  <span class="at">nameset1 =</span> <span class="fu">tolower</span>(nameset1),</span>
<span id="cb2041-6"><a href="#cb2041-6" tabindex="-1"></a>  <span class="at">nameset2 =</span> <span class="fu">tolower</span>(nameset2)</span>
<span id="cb2041-7"><a href="#cb2041-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb2041-8"><a href="#cb2041-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DMP_1_1 =</span> <span class="fu">map_chr</span>(nameset1, <span class="sc">~</span><span class="fu">DoubleMetaphone</span>(.x)[[<span class="dv">1</span>]]),</span>
<span id="cb2041-9"><a href="#cb2041-9" tabindex="-1"></a>         <span class="at">DMP_1_2 =</span> <span class="fu">map_chr</span>(nameset1, <span class="sc">~</span><span class="fu">DoubleMetaphone</span>(.x)[[<span class="dv">2</span>]]),</span>
<span id="cb2041-10"><a href="#cb2041-10" tabindex="-1"></a>         <span class="at">DMP_2_1 =</span> <span class="fu">map_chr</span>(nameset2, <span class="sc">~</span><span class="fu">DoubleMetaphone</span>(.x)[[<span class="dv">1</span>]]),</span>
<span id="cb2041-11"><a href="#cb2041-11" tabindex="-1"></a>         <span class="at">DMP_2_2 =</span> <span class="fu">map_chr</span>(nameset2, <span class="sc">~</span><span class="fu">DoubleMetaphone</span>(.x)[[<span class="dv">2</span>]]))</span></code></pre></div>
<pre><code>##       nameset1 nameset2 DMP_1_1 DMP_1_2 DMP_2_1 DMP_2_2
## 1        geeta     gita      JT      KT      JT      KT
## 2      susheel   sushil     SXL     SXL     SXL     SXL
## 3          ram     rama      RM      RM      RM      RM
## 4 dr. suchitra suchitra    TRSX    TRSK    SXTR    SKTR</code></pre>
<!--chapter:end:15-stringdist.Rmd-->
</div>
</div>
<div id="part-viii-geo-computation-in-r" class="section level1 unnumbered">
<h1 class="unnumbered">Part-VIII: Geo computation in R</h1>
</div>
<div id="maps-in-r" class="section level1" number="36">
<h1><span class="header-section-number">36</span> Maps in R</h1>
<p><em>The content is under development</em></p>
</div>
<div id="geo-coding-in-r" class="section level1" number="37">
<h1><span class="header-section-number">37</span> Geo-Coding in R</h1>
<p><em>The content is under development</em></p>
</div>
<div id="reverse-geo-coding" class="section level1" number="38">
<h1><span class="header-section-number">38</span> Reverse geo-coding</h1>
<div id="introduction" class="section level2" number="38.1">
<h2><span class="header-section-number">38.1</span> Introduction</h2>
<p><strong>Geo-coding</strong> is the process of converting a human-readable address into geographic coordinates, such as latitude and longitude. Geocoding is the process of determining the location of an address on a map. So, plotting the places on geographical map layers require extraction of latitudes and longitudes from master databases.</p>
<p><strong>Reverse geo-coding</strong>, on the other hand, is the process of converting geographic coordinates (latitude and longitude) into a human-readable address, such as a street address, city, state/province, and country. In other words, it’s the process of determining a location’s address based on its geographic coordinates.</p>
<p>Both geo-coding and reverse geo-coding are important in geospatial data analysis, as they allow us to link spatial information with non-spatial information, such as demographic data, land use data, or other forms of spatial data. This information can then be used to gain insights into patterns and relationships in the data, and to make informed decisions based on location information.</p>
<p>Reverse geo-coding can be used in forensic data analysis to help identify the location of transactions or events. For example, it can be used to determine the location of an ATM or point of sale device where a fraudulent transaction occurred. It can also be used to analyze patterns of activity in a particular geographic area, such as the frequency and timing of certain types of transactions. As another example, we may think of an application data, where mobile or hand held devices are used to capture data at the time and place of intended service delivery. Auditors may use the geo-spatial data captured by these devices to cross check/verify the actual points of service delivery.</p>
</div>
<div id="widely-used-databases" class="section level2" number="38.2">
<h2><span class="header-section-number">38.2</span> Widely used databases</h2>
<p><strong>OpenStreetMap</strong> (OSM) is one of the most popular and widely used master databases for geo-coding and reverse geo-coding. OSM is a free and open-source map of the world, created and maintained by a community of volunteers. It provides a rich and detailed set of spatial data, including street names, addresses, and other points of interest.</p>
<p>Other popular master databases for geo-coding and reverse geo-coding include <strong>Google Maps</strong>. Google Maps provides a rich set of geo-coding and reverse geo-coding APIs that are widely used in web and mobile applications. Google Maps provides a comprehensive set of spatial data, including street names, addresses, and other points of interest.</p>
</div>
<div id="example-in-r" class="section level2" number="38.3">
<h2><span class="header-section-number">38.3</span> Example in R</h2>
<div id="prerequisites" class="section level3" number="38.3.1">
<h3><span class="header-section-number">38.3.1</span> Prerequisites</h3>
<div class="sourceCode" id="cb2043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2043-1"><a href="#cb2043-1" tabindex="-1"></a><span class="fu">library</span>(tidygeocoder)</span></code></pre></div>
</div>
<div id="function-to-be-used" class="section level3" number="38.3.2">
<h3><span class="header-section-number">38.3.2</span> Function to be used</h3>
<p>We will use <code>reverse_geo()</code> function from this library. Syntax is</p>
<pre><code>reverse_geo(
  lat,
  long,
  method = &quot;osm&quot;,
  address = &quot;address&quot;,
  full_results = FALSE
  ...
)</code></pre>
<p>Here -</p>
<ul>
<li><code>lat</code> and <code>long</code> are, as the names suggest, latitude and longitudes for the place, of which address is to be extracted.</li>
<li><code>method</code> argument provides for geo service to be used. Default is <code>osm</code>. Other services available are - <code>arcgis</code>, <code>geocodio</code>, <code>google</code>, etc.</li>
<li><code>address</code> provides the column name to be used.</li>
<li><code>full_results</code> by default is <code>FALSE</code>. But if set to <code>TRUE</code> returns all available data from the geocoding service.</li>
<li>for other arguments, please check help of the function.</li>
</ul>
</div>
<div id="practical-data-set" class="section level3" number="38.3.3">
<h3><span class="header-section-number">38.3.3</span> Practical data-set</h3>
<p><strong>Remember one thing, the function is not vectorised.</strong> So we will have to use <code>apply</code> family or <code>purrr::map</code> family of functions to get reverse geo-coding information.</p>
<div class="sourceCode" id="cb2045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2045-1"><a href="#cb2045-1" tabindex="-1"></a><span class="co"># Coordinates of tajmahal</span></span>
<span id="cb2045-2"><a href="#cb2045-2" tabindex="-1"></a><span class="fu">reverse_geo</span>(<span class="at">lat =</span> <span class="fl">27.1751</span>, </span>
<span id="cb2045-3"><a href="#cb2045-3" tabindex="-1"></a>            <span class="at">long =</span> <span class="fl">78.421</span>, </span>
<span id="cb2045-4"><a href="#cb2045-4" tabindex="-1"></a>            <span class="at">full_results =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2045-5"><a href="#cb2045-5" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">&#39;osm&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 25
##     lat  long address     place_id licence osm_type osm_id osm_lat osm_lon class
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;
## 1  27.2  78.4 Sailai, Fi…   2.27e8 Data ©… way      4.56e8 27.175… 78.421… high…
## # ℹ 15 more variables: type &lt;chr&gt;, place_rank &lt;int&gt;, importance &lt;dbl&gt;,
## #   addresstype &lt;chr&gt;, name &lt;chr&gt;, suburb &lt;chr&gt;, town &lt;chr&gt;, county &lt;chr&gt;,
## #   state_district &lt;chr&gt;, state &lt;chr&gt;, `ISO3166-2-lvl4` &lt;chr&gt;, postcode &lt;chr&gt;,
## #   country &lt;chr&gt;, country_code &lt;chr&gt;, boundingbox &lt;list&gt;</code></pre>
</div>
<div id="using-it-in-a-dataset" class="section level3" number="38.3.4">
<h3><span class="header-section-number">38.3.4</span> Using it in a dataset</h3>
<p>Let’s build a sample dataset of say 4 values/places of interest in India</p>
<table>
<thead>
<tr class="header">
<th align="right">lat</th>
<th align="right">long</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">27.1751</td>
<td align="right">78.0421</td>
</tr>
<tr class="even">
<td align="right">24.8318</td>
<td align="right">79.9199</td>
</tr>
<tr class="odd">
<td align="right">27.1795</td>
<td align="right">78.0211</td>
</tr>
<tr class="even">
<td align="right">28.5245</td>
<td align="right">77.1855</td>
</tr>
</tbody>
</table>
<p>Now extracting information for these using <code>purrr::map</code> family</p>
<div class="sourceCode" id="cb2047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2047-1"><a href="#cb2047-1" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2047-2"><a href="#cb2047-2" tabindex="-1"></a><span class="fu">library</span>(purrr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2047-3"><a href="#cb2047-3" tabindex="-1"></a></span>
<span id="cb2047-4"><a href="#cb2047-4" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">pmap_dfr</span>(sample,</span>
<span id="cb2047-5"><a href="#cb2047-5" tabindex="-1"></a>     <span class="sc">~</span> <span class="fu">reverse_geo</span>(..<span class="dv">1</span>, <span class="co"># first column in sample</span></span>
<span id="cb2047-6"><a href="#cb2047-6" tabindex="-1"></a>                   ..<span class="dv">2</span>, <span class="co"># second column in sample</span></span>
<span id="cb2047-7"><a href="#cb2047-7" tabindex="-1"></a>                   <span class="at">full_results =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2047-8"><a href="#cb2047-8" tabindex="-1"></a>  <span class="fu">select</span>(lat, long, country, state, city, village, address, postcode)</span></code></pre></div>
</div>
<div id="view-above-results" class="section level3" number="38.3.5">
<h3><span class="header-section-number">38.3.5</span> View above results</h3>
<table>
<colgroup>
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="9%" />
<col width="3%" />
<col width="5%" />
<col width="61%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">lat</th>
<th align="right">long</th>
<th align="left">country</th>
<th align="left">state</th>
<th align="left">city</th>
<th align="left">village</th>
<th align="left">address</th>
<th align="left">postcode</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">27.1751</td>
<td align="right">78.0421</td>
<td align="left">India</td>
<td align="left">Uttar Pradesh</td>
<td align="left">Agra</td>
<td align="left">NA</td>
<td align="left">Taj Mahal, Taj East Gate Road, Taj Ganj, Agra, Uttar Pradesh, 282004, India</td>
<td align="left">282004</td>
</tr>
<tr class="even">
<td align="right">24.8318</td>
<td align="right">79.9199</td>
<td align="left">India</td>
<td align="left">Madhya Pradesh</td>
<td align="left">NA</td>
<td align="left">Jatkra</td>
<td align="left">Khajuraho, Jatkra, Rajnagar Tahsil, Chhatarpur, Madhya Pradesh, 471006, India</td>
<td align="left">471006</td>
</tr>
<tr class="odd">
<td align="right">27.1795</td>
<td align="right">78.0211</td>
<td align="left">India</td>
<td align="left">Uttar Pradesh</td>
<td align="left">Agra</td>
<td align="left">NA</td>
<td align="left">Agra Fort, Minar Bazaar, Subhash Bazaar, Agra, Uttar Pradesh, 280001, India</td>
<td align="left">280001</td>
</tr>
<tr class="even">
<td align="right">28.5245</td>
<td align="right">77.1855</td>
<td align="left">India</td>
<td align="left">Delhi</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Qutub Minar Complex, Kalka Das Marg, Mehrauli, Mehrauli Tehsil, South Delhi, Delhi, 110030, India</td>
<td align="left">110030</td>
</tr>
</tbody>
</table>
</div>
<div id="alternate-syntax-for-those-who-do-not-want-to-use-purrrpmap_dfr" class="section level3" number="38.3.6">
<h3><span class="header-section-number">38.3.6</span> Alternate syntax (for those who do not want to use <code>purrr::pmap_dfr</code>)</h3>
<pre><code>sapply(seq(nrow(sample)),
       function(x) reverse_geo(sample$lat[x], sample$long[x], full_results = TRUE)) %&gt;% 
  map_dfr(rbind)</code></pre>
<!--chapter:end:16-Rgeo.Rmd-->
</div>
</div>
</div>
<div id="part-ix-identifying-anamolous-observations-for-audit" class="section level1 unnumbered">
<h1 class="unnumbered">Part-IX: Identifying anamolous observations for audit</h1>
</div>
<div id="benford-testsanalysis" class="section level1" number="39">
<h1><span class="header-section-number">39</span> Benford Tests/Analysis</h1>
<div id="introduction-and-historical-context" class="section level2" number="39.1">
<h2><span class="header-section-number">39.1</span> Introduction and Historical context</h2>
<p>Benford’s Law stands out as an analysis method for both visualizing and evaluating numerical data, especially when focused on detecting fraud. It’s really handy for catching potential trickery, especially in spotting fraud. This rule tells us how often different digits (like 1, 2, 3, etc.) should show up as the first number in lots of real-world data. This law describes the frequency distribution of the first digit, from left hand side, in many real-life data sets which counter-intuitively is not uniform, and is shown in Figure @ref(fig:benlaw). Significant differences from the anticipated occurrence rates could signal that the data is questionable and might have been altered. For instance, eligibility for government assistance often hinges on meeting specific criteria, like having an income below a certain level. As a result, data might be manipulated to meet these criteria. This kind of manipulation is precisely what Benford’s Law can detect since fabricated numbers won’t align with the expected frequency pattern outlined by the law.</p>
<p>The Law is named after physicist <strong>Frank Benford</strong>, who worked on the theory in 1938 and as a result a paper titled <strong>The Law of Anomalous Numbers</strong> was published.<span class="citation"><a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a></span>. However, its discovery is associated more than five decades earlier when astronomer <strong>Simon Newcomb</strong> observed that initial pages of log tables booklet were more worn out than later pages and published a two page article titled <strong>Note on the Frequency of Use of the Different Digits in Natural Numbers</strong> in 1881.<span class="citation"><a href="#fn38" class="footnote-ref" id="fnref38"><sup>38</sup></a></span></p>
<p>More researchers continued to work on Benford’s law and its extensions. However, it took several decades to find a truly practical application. It was in last decade of twentieth Century, when Dr. Mark J. Nigrini, an accounting Professor, used the law for fraud detection/anaytics and came up with a practical fraud application. He reviewed multiple data sources like sales figures, insurance claim costs, and expense reimbursement claims and did studies on detecting overstatements and understatement of financial figures. His research confirmed the law’s proven usefulness to fraud examiners and auditors in accounting engagements.</p>
<p>His theory is that - <em>If somebody tries to falsify, say, their tax return then invariably they will have to invent some data. When trying to do this, the tendency is for people to use too many numbers starting with digits in the mid range, 5,6,7 and thus not enough numbers starting with 1.</em></p>
<div class="figure" style="text-align: center">
<img src="images/frank_benford.jpg" alt="(L to R) Frank Benford, Simon Newcomb, and Mark Nigrini (Source: Wiki)" width="32%" height="32%" /><img src="images/Simon.jpg" alt="(L to R) Frank Benford, Simon Newcomb, and Mark Nigrini (Source: Wiki)" width="32%" height="32%" /><img src="images/nigrini.jpg" alt="(L to R) Frank Benford, Simon Newcomb, and Mark Nigrini (Source: Wiki)" width="32%" height="32%" />
<p class="caption">
(#fig:benpics)(L to R) Frank Benford, Simon Newcomb, and Mark Nigrini (Source: Wiki)
</p>
</div>
</div>
<div id="benfords-law-properties-and-extensions" class="section level2" number="39.2">
<h2><span class="header-section-number">39.2</span> Benford’s Law, properties and extensions</h2>
<div id="law-of-first-digit" class="section level3" number="39.2.1">
<h3><span class="header-section-number">39.2.1</span> Law of first digit</h3>
<p>When considering the likelihood of any digit being in the first position (from the left), our initial assumption might be a simple <em>one out of nine</em> scenario, following a uniform distribution. However, this notion was challenged by Canadian-American astronomer <strong>Simon Newcomb</strong> in 1881, who noticed unusual wear patterns in logarithmic tables. While casually flipping through a logarithmic tables booklet, he discerned a curious pattern— the initial pages exhibited more wear and tear than their later counterparts.</p>
<p>Subsequently, <strong>Frank Benford</strong> conducted a comprehensive analysis of 20 diverse datasets encompassing river sizes, chemical compound weights, population data, and more. His findings revealed a successive diminishment in probability from digit 1 to 9. In essence, the probability of digit 1 occurring in the initial position is the highest, while that of digit 9 is the lowest.</p>
<p>Mathematically, <em>Benford’s Law</em> or <em>Law of first digits</em> states that the probability of any digit in first place should follow the equation @ref(eq:ben1).</p>
<span class="math display">\[\begin{equation}
P(d_i) = \log_{10}\left(1 + \frac{1}{d}\right)
(\#eq:ben1)
\end{equation}\]</span>
<ul>
<li>Where <span class="math inline">\(d_i\)</span> ranges from <span class="math inline">\(1\)</span> to <span class="math inline">\(9\)</span>.</li>
</ul>
<p>The probabilities when plotted will generate plot as depicted in Figure @ref(fig:benlaw).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/benlaw-1.png" alt="Diminishing Probabilities of First Digits - Benford Law" width="672" height="32%" />
<p class="caption">
(#fig:benlaw)Diminishing Probabilities of First Digits - Benford Law
</p>
</div>
<p>To test the proposed law, Benford analysed 20 different data-sets and he observed that nearly all follow the distribution mentioned in equation @ref(eq:ben1).</p>
<p>Let us also try to see whether the law holds by anlaysing six different datasets, which are included in R’s package called <code>benford.analysis</code>. Though we will discuss about the package in detail later in section @ref(pracben). The six datasets are mentioned in Table @ref(tab:sixben).</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:sixben)(#tab:sixben)List of six datasets for testing Benford Analysis
</caption>
<thead>
<tr>
<th style="text-align:center;">
Item
</th>
<th style="text-align:center;">
Title
</th>
<th style="text-align:center;">
Column
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
census.2000_2010
</td>
<td style="text-align:center;">
Population data - US - 2000 and 2010
</td>
<td style="text-align:center;">
pop.2000
</td>
</tr>
<tr>
<td style="text-align:center;">
census.2009
</td>
<td style="text-align:center;">
Population data of Towns and Cities of the US - 2009
</td>
<td style="text-align:center;">
pop.2009
</td>
</tr>
<tr>
<td style="text-align:center;">
corporate.payment
</td>
<td style="text-align:center;">
Corporate payments of a West Coast utility company - 2010
</td>
<td style="text-align:center;">
Amount
</td>
</tr>
<tr>
<td style="text-align:center;">
lakes.perimeter
</td>
<td style="text-align:center;">
Perimeter of lakes arround the world
</td>
<td style="text-align:center;">
perimeter.km
</td>
</tr>
<tr>
<td style="text-align:center;">
sino.forest
</td>
<td style="text-align:center;">
Financial Statemens of Sino Forest Corporation’s 2010 Report
</td>
<td style="text-align:center;">
value
</td>
</tr>
<tr>
<td style="text-align:center;">
taxable.incomes.1978
</td>
<td style="text-align:center;">
Taxable Income 1978
</td>
<td style="text-align:center;">
taxIncomes
</td>
</tr>
</tbody>
</table>
<p>The results of Benford’s law of first digit on these six datasets are calculated and have been mentioned in Table @ref(tab:tab1). It can be seen that actual frequencies of first digits, in these six datasets follow Benford’s Law. We can even plot the actual frequencies to inspect results visually. Actual Frequencies in these six datasets are plotted in @ref(fig:benplots) and it may be seen that these follow Benford’s Law largely.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:tab1)(#tab:tab1)Results of First order tests on six datasets
</caption>
<thead>
<tr>
<th style="text-align:right;">
digits
</th>
<th style="text-align:right;">
Benford
</th>
<th style="text-align:right;">
Census 2000_2010
</th>
<th style="text-align:right;">
Census 2009
</th>
<th style="text-align:right;">
Corporate Payment
</th>
<th style="text-align:right;">
Lakes Perimeter
</th>
<th style="text-align:right;">
Sino Forest
</th>
<th style="text-align:right;">
Taxable Incomes 1978
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.3010300
</td>
<td style="text-align:right;">
0.3092126
</td>
<td style="text-align:right;">
0.2941207
</td>
<td style="text-align:right;">
0.3175548
</td>
<td style="text-align:right;">
0.1508888
</td>
<td style="text-align:right;">
0.2992228
</td>
<td style="text-align:right;">
0.3278721
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.1760913
</td>
<td style="text-align:right;">
0.1797896
</td>
<td style="text-align:right;">
0.1814547
</td>
<td style="text-align:right;">
0.1611007
</td>
<td style="text-align:right;">
0.0687752
</td>
<td style="text-align:right;">
0.1606218
</td>
<td style="text-align:right;">
0.2140886
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.1249387
</td>
<td style="text-align:right;">
0.1271916
</td>
<td style="text-align:right;">
0.1200472
</td>
<td style="text-align:right;">
0.1101452
</td>
<td style="text-align:right;">
0.2170936
</td>
<td style="text-align:right;">
0.1256477
</td>
<td style="text-align:right;">
0.1235673
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0969100
</td>
<td style="text-align:right;">
0.0975454
</td>
<td style="text-align:right;">
0.0946743
</td>
<td style="text-align:right;">
0.0828655
</td>
<td style="text-align:right;">
0.1818372
</td>
<td style="text-align:right;">
0.0906736
</td>
<td style="text-align:right;">
0.0895397
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.0791812
</td>
<td style="text-align:right;">
0.0656678
</td>
<td style="text-align:right;">
0.0799118
</td>
<td style="text-align:right;">
0.1016301
</td>
<td style="text-align:right;">
0.1309577
</td>
<td style="text-align:right;">
0.0829016
</td>
<td style="text-align:right;">
0.0722473
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.0669468
</td>
<td style="text-align:right;">
0.0656678
</td>
<td style="text-align:right;">
0.0702240
</td>
<td style="text-align:right;">
0.0602811
</td>
<td style="text-align:right;">
0.0930143
</td>
<td style="text-align:right;">
0.0699482
</td>
<td style="text-align:right;">
0.0521491
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.0579919
</td>
<td style="text-align:right;">
0.0541919
</td>
<td style="text-align:right;">
0.0597673
</td>
<td style="text-align:right;">
0.0498209
</td>
<td style="text-align:right;">
0.0682885
</td>
<td style="text-align:right;">
0.0518135
</td>
<td style="text-align:right;">
0.0411117
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0511525
</td>
<td style="text-align:right;">
0.0548295
</td>
<td style="text-align:right;">
0.0534625
</td>
<td style="text-align:right;">
0.0503666
</td>
<td style="text-align:right;">
0.0502118
</td>
<td style="text-align:right;">
0.0699482
</td>
<td style="text-align:right;">
0.0393606
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.0457575
</td>
<td style="text-align:right;">
0.0459037
</td>
<td style="text-align:right;">
0.0463376
</td>
<td style="text-align:right;">
0.0662351
</td>
<td style="text-align:right;">
0.0389329
</td>
<td style="text-align:right;">
0.0492228
</td>
<td style="text-align:right;">
0.0400637
</td>
</tr>
</tbody>
</table>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/benplots-1.png" alt="Distribution of first digit frequencies in six datasets" width="672" />
<p class="caption">
(#fig:benplots)Distribution of first digit frequencies in six datasets
</p>
</div>
</div>
<div id="scale-invariance" class="section level3" number="39.2.2">
<h3><span class="header-section-number">39.2.2</span> Scale Invariance</h3>
<p>Later in 1961, <strong>Roger Pinkham</strong> showed that law is invariant to scaling.<span class="citation"><a href="#fn39" class="footnote-ref" id="fnref39"><sup>39</sup></a></span> By <em>Scale Invariance</em>, he actually showed that the law is invariant to measurements units. In other words, the law still holds if we convert units from one unit to another. For example, if price or amount figures are measured either in USD or in INR, length is measured either in KMs or Miles, the digit frequencies still follow the Benford’s Law.</p>
<p>Let us check this on one of the six datasets mentioned above, namely <code>census.2009</code>. This data-set contains the figures of population of towns and cities of the United States, as of July of 2009. We can see that first digit frequencies follow Benford’s Law/Pinkham’s Corollary in Figure @ref(fig:census). Left plot shows frequencies on original data whereas right plot shows these on randonly scaled data.</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/census-1.png" alt="First Digit Analysis on US Census 2009 data (Left) and Scaled Data (Right)" width="45%" /><img src="DauR_files/figure-html/census-2.png" alt="First Digit Analysis on US Census 2009 data (Left) and Scaled Data (Right)" width="45%" />
<p class="caption">
(#fig:census)First Digit Analysis on US Census 2009 data (Left) and Scaled Data (Right)
</p>
</div>
<p>Figure @ref(fig:census) (Left) shows that the law holds for the data. Let us also test the Pinkham’s corollary on the aforesaid data. For this let’s multiply all the figures of population by a random positive number. Through figure @ref(fig:census) (Right) it is clear that law still holds after scaling.</p>
</div>
<div id="first-two-digits" class="section level3" number="39.2.3">
<h3><span class="header-section-number">39.2.3</span> First two digits</h3>
<p>Nigrini’s contributions gained widespread recognition among scholars and practitioners, highlighting the applicability of Benford’s Law as a valuable forensic accounting and auditing tool across various datasets, particularly in the financial domain. <strong>Theodore P. Hill</strong> further<span class="citation"><a href="#fn40" class="footnote-ref" id="fnref40"><sup>40</sup></a></span> extended the scope of the law, demonstrating its validity beyond just the first digit to encompass other digits as well. Hill’s work expanded the utility of Benford’s Law, affirming its effectiveness in detecting irregularities and patterns not only in leading digits but throughout numerical sequences.</p>
<p>The formula for second significant digit can be written down in equation @ref(eq:ben2).</p>
<span class="math display">\[\begin{equation}
P(d_i) = \sum_{k = 1}^{9}\log_{10}\left(1 + \frac{1}{10k + d_i}\right)\;;\; d = 0,1,..9
(\#eq:ben2)
\end{equation}\]</span>
<ul>
<li>where <span class="math inline">\(k\)</span> represents first digit,</li>
<li><span class="math inline">\(d_i\)</span> represents second digit.</li>
</ul>
<p>The probabilities have been calculated, as depicted in Table @ref(tab:tab3). Each cell depicts the probability of occurrence of any two digit, in left side, by first digit in rows and second digit in columns. We may also verify that, row totals thereby depicting probability of occurrence of first digit corresponds Benford’s Law of First Digit. For example, the probability of having first two digits as 10 will be highest at 4.14%.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
(#tab:tab3)(#tab:tab3)First and Second Digit distributions
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="10">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Second Significant Digit
</div>
</th>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
</tr>
<tr>
<th style="text-align:right;">
First Digit
</th>
<th style="text-align:right;">
0
</th>
<th style="text-align:right;">
1
</th>
<th style="text-align:right;">
2
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
7
</th>
<th style="text-align:right;">
8
</th>
<th style="text-align:right;">
9
</th>
<th style="text-align:right;">
First Digit Freq
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.14%
</td>
<td style="text-align:right;">
3.78%
</td>
<td style="text-align:right;">
3.48%
</td>
<td style="text-align:right;">
3.22%
</td>
<td style="text-align:right;">
3.00%
</td>
<td style="text-align:right;">
2.80%
</td>
<td style="text-align:right;">
2.63%
</td>
<td style="text-align:right;">
2.48%
</td>
<td style="text-align:right;">
2.35%
</td>
<td style="text-align:right;">
2.23%
</td>
<td style="text-align:right;">
30.10%
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.12%
</td>
<td style="text-align:right;">
2.02%
</td>
<td style="text-align:right;">
1.93%
</td>
<td style="text-align:right;">
1.85%
</td>
<td style="text-align:right;">
1.77%
</td>
<td style="text-align:right;">
1.70%
</td>
<td style="text-align:right;">
1.64%
</td>
<td style="text-align:right;">
1.58%
</td>
<td style="text-align:right;">
1.52%
</td>
<td style="text-align:right;">
1.47%
</td>
<td style="text-align:right;">
17.61%
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.42%
</td>
<td style="text-align:right;">
1.38%
</td>
<td style="text-align:right;">
1.34%
</td>
<td style="text-align:right;">
1.30%
</td>
<td style="text-align:right;">
1.26%
</td>
<td style="text-align:right;">
1.22%
</td>
<td style="text-align:right;">
1.19%
</td>
<td style="text-align:right;">
1.16%
</td>
<td style="text-align:right;">
1.13%
</td>
<td style="text-align:right;">
1.10%
</td>
<td style="text-align:right;">
12.49%
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1.07%
</td>
<td style="text-align:right;">
1.05%
</td>
<td style="text-align:right;">
1.02%
</td>
<td style="text-align:right;">
1.00%
</td>
<td style="text-align:right;">
0.98%
</td>
<td style="text-align:right;">
0.95%
</td>
<td style="text-align:right;">
0.93%
</td>
<td style="text-align:right;">
0.91%
</td>
<td style="text-align:right;">
0.90%
</td>
<td style="text-align:right;">
0.88%
</td>
<td style="text-align:right;">
9.69%
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.86%
</td>
<td style="text-align:right;">
0.84%
</td>
<td style="text-align:right;">
0.83%
</td>
<td style="text-align:right;">
0.81%
</td>
<td style="text-align:right;">
0.80%
</td>
<td style="text-align:right;">
0.78%
</td>
<td style="text-align:right;">
0.77%
</td>
<td style="text-align:right;">
0.76%
</td>
<td style="text-align:right;">
0.74%
</td>
<td style="text-align:right;">
0.73%
</td>
<td style="text-align:right;">
7.92%
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.72%
</td>
<td style="text-align:right;">
0.71%
</td>
<td style="text-align:right;">
0.69%
</td>
<td style="text-align:right;">
0.68%
</td>
<td style="text-align:right;">
0.67%
</td>
<td style="text-align:right;">
0.66%
</td>
<td style="text-align:right;">
0.65%
</td>
<td style="text-align:right;">
0.64%
</td>
<td style="text-align:right;">
0.63%
</td>
<td style="text-align:right;">
0.62%
</td>
<td style="text-align:right;">
6.69%
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.62%
</td>
<td style="text-align:right;">
0.61%
</td>
<td style="text-align:right;">
0.60%
</td>
<td style="text-align:right;">
0.59%
</td>
<td style="text-align:right;">
0.58%
</td>
<td style="text-align:right;">
0.58%
</td>
<td style="text-align:right;">
0.57%
</td>
<td style="text-align:right;">
0.56%
</td>
<td style="text-align:right;">
0.55%
</td>
<td style="text-align:right;">
0.55%
</td>
<td style="text-align:right;">
5.80%
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.54%
</td>
<td style="text-align:right;">
0.53%
</td>
<td style="text-align:right;">
0.53%
</td>
<td style="text-align:right;">
0.52%
</td>
<td style="text-align:right;">
0.51%
</td>
<td style="text-align:right;">
0.51%
</td>
<td style="text-align:right;">
0.50%
</td>
<td style="text-align:right;">
0.50%
</td>
<td style="text-align:right;">
0.49%
</td>
<td style="text-align:right;">
0.49%
</td>
<td style="text-align:right;">
5.12%
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.48%
</td>
<td style="text-align:right;">
0.47%
</td>
<td style="text-align:right;">
0.47%
</td>
<td style="text-align:right;">
0.46%
</td>
<td style="text-align:right;">
0.46%
</td>
<td style="text-align:right;">
0.45%
</td>
<td style="text-align:right;">
0.45%
</td>
<td style="text-align:right;">
0.45%
</td>
<td style="text-align:right;">
0.44%
</td>
<td style="text-align:right;">
0.44%
</td>
<td style="text-align:right;">
4.58%
</td>
</tr>
<tr>
<td style="text-align:right;">
Second Digit Freq
</td>
<td style="text-align:right;">
11.97%
</td>
<td style="text-align:right;">
11.39%
</td>
<td style="text-align:right;">
10.88%
</td>
<td style="text-align:right;">
10.43%
</td>
<td style="text-align:right;">
10.03%
</td>
<td style="text-align:right;">
9.67%
</td>
<td style="text-align:right;">
9.34%
</td>
<td style="text-align:right;">
9.04%
</td>
<td style="text-align:right;">
8.76%
</td>
<td style="text-align:right;">
8.50%
</td>
<td style="text-align:right;">
100.00%
</td>
</tr>
</tbody>
</table>
<p>The law of second digit combined with original Benford’s Law of first digit thus, gives us Law of first two digits. We can verify it in the example on <code>census.2009</code> data. The resultant plot as depicted in figure @ref(fig:ben2) shows us that the law of first two digits also holds.</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/ben2-1.png" alt="Law holds for first two digits as well" width="672" />
<p class="caption">
(#fig:ben2)Law holds for first two digits as well
</p>
</div>
</div>
<div id="second-order-test" class="section level3" number="39.2.4">
<h3><span class="header-section-number">39.2.4</span> Second order test</h3>
<p><strong>Nigrini</strong> and <strong>Miller</strong>, in 2009,<span class="citation"><a href="#fn41" class="footnote-ref" id="fnref41"><sup>41</sup></a></span> introduced another advanced test based on Benford’s Law. The test states that:</p>
<blockquote>
<p>Let <span class="math inline">\(x_1\)</span>, …, <span class="math inline">\(x_N\)</span> be a data set comprising <span class="math inline">\(N\)</span> observations, and let <span class="math inline">\(y_1\)</span>, …, <span class="math inline">\(y_N\)</span> be the observations <span class="math inline">\(x_i\)</span>’s in ascending order. Then, for many natural data sets, and for large <span class="math inline">\(N\)</span>, the digits of the differences between adjacent observations <span class="math inline">\(y_{i+1} – y_i\)</span> is close to Benford’s Law. Large deviations from Benford’s Law indicate an anomaly that should be investigated.</p>
</blockquote>
<p>So, the steps may be listed as</p>
<ul>
<li>Sort data from smallest to largest</li>
<li>calculate <span class="math inline">\(N-1\)</span> differences of <span class="math inline">\(N\)</span> consecutive observations</li>
<li>Apply Benford’s law on these calculated new data.</li>
</ul>
<p>Nigrini showed that these digits are expected to closely follow the frequencies of Benford law. Using four different datasets he showed that this test can detect (i) anomalies occurring in data, (ii) whether the data has been rounded and (iii) use of fake data OR ‘statistically generated data’ in place of actual (transactional) data.</p>
</div>
<div id="summation-test" class="section level3" number="39.2.5">
<h3><span class="header-section-number">39.2.5</span> Summation Test</h3>
<p>The <strong>summation test</strong>, another second order test, looks for excessively large numbers in a dataset. It identifies numbers that are large compared to the norm for that data. The test was also proposed by <strong>Nigrini</strong><span class="citation"><a href="#fn42" class="footnote-ref" id="fnref42"><sup>42</sup></a></span> and it is based on the fact that the sums of all numbers in a Benford distribution with first-two digits (10, 11, 12, …99) should be the same. Therefore, for each of the 90 first-two digits groups sum proportions should be equal, i.e. 1/90 or 0.011. The spikes, if any indicate that there are some large single numbers or set of numbers.</p>
<p>In the next section, we will see how to implement all these tests through R.</p>
</div>
<div id="limitations-of-benford-tests" class="section level3" number="39.2.6">
<h3><span class="header-section-number">39.2.6</span> Limitations of Benford Tests</h3>
<p>Benford’s Law may not hold in the following circumstances-</p>
<ol style="list-style-type: decimal">
<li>When the data-set is comprised of assigned numbers. Like cheque numbers, invoices numbers, telephone numbers, pincodes, etc.</li>
<li>Numbers that may be influenced viz. ATM withdrawals, etc.</li>
<li>Where amounts have either lower bound, or upper bounds or both. E.g. passengers onboard airplane, hourly wage rate, etc.</li>
<li>Count of transactions less than 500.</li>
</ol>
<p>Before carrying out analyics let us also see the evaluation metrics which will help us to evaluate the goodness of fit of data to Benford’s law. Three statistics are commonly used.</p>
</div>
</div>
<div id="goodness-of-fit-metrics" class="section level2" number="39.3">
<h2><span class="header-section-number">39.3</span> Goodness of fit metrics</h2>
<p>In table @ref(tab:tab1) we saw that digit frequencies largely followed Benford’s Law in six different datasets. However, as to evaluate how close is the actual distribution with theoretical distribution, we need to evaluate the fit on some metrics. Here we will use three different metrics as follows.</p>
<div id="chis" class="section level3" number="39.3.1">
<h3><span class="header-section-number">39.3.1</span> Chi-square statistic</h3>
<p>In first of these test, we will use Chi Square Statistic. This statistic is used to test the statistical significance to the whole distribution in observed frequency of first digit and first two digits against their expected frequency under Benford’s Law (BL). The <strong>Null hypothesis states that digits follow Benford’s Law.</strong> Mathematical formula is,</p>
<span class="math display">\[\begin{equation}
\chi^2 = \sum_{i=1}^{9} \frac{(O_i - E_i)^2}{E_i}
(\#eq:ben3)
\end{equation}\]</span>
<p>where -</p>
<ul>
<li><span class="math inline">\(O_i\)</span> is the observed frequency of the i-th digit.</li>
<li><span class="math inline">\(E_i\)</span> is the expected frequency of the i-th digit predicted by Benford’s Law.</li>
</ul>
<p>This calculated chi-square statistic is compared to a critical value. The critical value for Chi-Square Test, comes from a chi-square distribution available easily in any Statistical textbook<a href="#fn43" class="footnote-ref" id="fnref43"><sup>43</sup></a>. However, for first digit test and first two digits test, the critical values are reproduced in Table @ref(tab:tab6).</p>
<table>
<caption>
(#tab:tab6)(#tab:tab6)Critical values for Chi-Square Test
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="1">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
First Digit Test
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="1">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Two Digit Test
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
Degrees of Freedom
</th>
<th style="text-align:right;">
8
</th>
<th style="text-align:right;">
89
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
10%
</td>
<td style="text-align:right;">
13.362
</td>
<td style="text-align:right;">
106.469
</td>
</tr>
<tr>
<td style="text-align:left;">
5%
</td>
<td style="text-align:right;">
15.507
</td>
<td style="text-align:right;">
112.022
</td>
</tr>
<tr>
<td style="text-align:left;">
2.5%
</td>
<td style="text-align:right;">
17.535
</td>
<td style="text-align:right;">
116.989
</td>
</tr>
<tr>
<td style="text-align:left;">
1%
</td>
<td style="text-align:right;">
20.090
</td>
<td style="text-align:right;">
122.942
</td>
</tr>
<tr>
<td style="text-align:left;">
0.1%
</td>
<td style="text-align:right;">
26.125
</td>
<td style="text-align:right;">
135.978
</td>
</tr>
</tbody>
</table>
<p>To check goodness of fit, we have to compare calculated <span class="math inline">\(χ^2\)</span> statistic with these critical values. If the observed value is above these critical values we may conclude that our initial hypothesis that data follows BL, should be rejected. Or simply that data does not conforms Benford law/Distribution.</p>
<p>For example, in <code>census.2009</code> data the chi-square statistic calculates to <code>17.524</code> which is less than 2.5% critical value 17.535. Thus, we can say with 5% confidence that <code>census.2009</code> data follows BL (first digit law).</p>
</div>
<div id="z-score" class="section level3" number="39.3.2">
<h3><span class="header-section-number">39.3.2</span> Z-score</h3>
<p>Z-statistic checks whether the individual distribution significantly differs from Benford’s Law distribution. Mathematically, Z-Statistics considers the absolute magnitude of the difference from actual to the expected, size of the data and expected proportion.</p>
<span class="math display">\[\begin{equation}
Z = \frac{(\lvert p - p_0\rvert) - (\frac{1}{2n})}{\sqrt{\frac{p_0(1-p_0)}{n}}}
(\#eq:ben4)
\end{equation} \]</span>
<p>where -</p>
<ul>
<li><span class="math inline">\(p\)</span> is the observed frequency of the leading digits in the dataset.</li>
<li><span class="math inline">\(p_0\)</span> is the expected frequency under Benford’s Law.</li>
<li><span class="math inline">\(n\)</span> is the number of records</li>
</ul>
<p>In equation @ref(eq:ben4), the last term in the numerator <span class="math inline">\(\frac{1}{2N}\)</span> is a continuity correction term and is used only when it is smaller than the first term in the numerator. Mark Nigrini has proposed that if the values of Z-statistic exceed the critical value 1.96, the null hypothesis <span class="math inline">\(H_{0A}\)</span> is rejected at 5% of significance level. Also note that <strong>Null hypothesis is same, which states that digits follow Benford’s Law.</strong></p>
<p>If the significant levels are 1% or 10%, the corresponding critical values are 2.57 and 1.64 respectively.</p>
</div>
<div id="mean-absolute-deviation" class="section level3" number="39.3.3">
<h3><span class="header-section-number">39.3.3</span> Mean absolute deviation</h3>
<p>Another Statistic, Mean Absolute Deviation also sometimes referred to as <strong>M.A.D.</strong>, measures absolute deviations of observed frequencies from theoritical ones. The mathematical formula is written in equation @ref(eq:ben5).</p>
<p><span class="math display">\[\begin{equation}
MAD = \frac{1}{9} \sum_{i=1}^{9} |O_i - E_i|
(\#eq:ben5)
\end{equation}\]</span></p>
<p>As there are no objective critical scores for the absolute deviations, the critical values prescribed by Mark J Nigrini are given in table @ref(tab:tab7) below.</p>
<table>
<caption>(#tab:tab7) Critical Scores for MAD test</caption>
<colgroup>
<col width="26%" />
<col width="24%" />
<col width="24%" />
<col width="24%" />
</colgroup>
<thead>
<tr class="header">
<th>First Digits</th>
<th></th>
<th>First-Two Digits</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.000 to 0.006</td>
<td>Close conformity</td>
<td>0.000 to 0.012</td>
<td>Close conformity</td>
</tr>
<tr class="even">
<td>0.006 to 0.012</td>
<td>Acceptable conformity</td>
<td>0.012 to 0.018</td>
<td>Acceptable conformity</td>
</tr>
<tr class="odd">
<td>0.012 to 0.015</td>
<td>Marginally acceptable conformity</td>
<td>0.018 to 0.022</td>
<td>Marginally acceptable conformity</td>
</tr>
<tr class="even">
<td>above 0.015</td>
<td>Nonconformity</td>
<td>above 0.022</td>
<td>Nonconformity</td>
</tr>
</tbody>
</table>
</div>
<div id="other-descriptive-statistics" class="section level3" number="39.3.4">
<h3><span class="header-section-number">39.3.4</span> Other descriptive Statistics</h3>
<p>If the data follows Benford’s Law, the numbers should be close to those shown in table @ref(tab:benford) following, as suggested by Mark Nigrini.</p>
<table>
<caption>(#tab:benford) Ideal Statistics for data that follows Benford’s Law</caption>
<thead>
<tr class="header">
<th align="center">Statistic</th>
<th align="center">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Mean</td>
<td align="center">0.5</td>
</tr>
<tr class="even">
<td align="center">Variance</td>
<td align="center">1/12 (0.08333…)</td>
</tr>
<tr class="odd">
<td align="center">Ex. Kurtosis</td>
<td align="center">-1.2</td>
</tr>
<tr class="even">
<td align="center">Skewness</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="important" class="section level2" number="39.4">
<h2><span class="header-section-number">39.4</span> Important</h2>
<p>Benford’s Law analysis serves as a powerful tool in uncovering potential irregularities in datasets, but it’s crucial to note that deviations from this statistical phenomenon don’t always signify fraudulent activities. While it highlights notable discrepancies between expected and observed frequencies of digits in naturally occurring datasets, these variations might stem from various legitimate factors such as data entry errors, fluctuations in processes, or different sources of data. Understanding that Benford’s Law offers a signal rather than a definitive confirmation of fraud allows for a more nuanced interpretation, encouraging further investigation to discern the true nature behind these deviations.</p>
<p>Conversely, just because a dataset adheres to Benford’s Law, it doesn’t guarantee the absence of fraud. While conformity to this statistical principle generally suggests consistency within the data, sophisticated fraudsters might deliberately manipulate information to mimic expected distributions, masking their illicit activities. Therefore, while adherence to Benford’s Law might lessen suspicion, it doesn’t serve as an absolute assurance against fraudulent behavior.</p>
<p>Benford’s Law acting as a warning signal indicates potential irregularities in the numbers. It’s vital to dive deeper and investigate why these figures seem odd. Further scrutiny helps differentiate between a minor data hiccup and a potentially significant issue. This additional examination might mean cross-checking other data, validating records, or engaging with those connected to the information. This thorough approach is crucial for unraveling the story behind these uncommon figures.</p>
</div>
<div id="pracben" class="section level2" number="39.5">
<h2><span class="header-section-number">39.5</span> Practical approach in R</h2>
<p>As already stated we will use package <code>benford.analysis</code> for carrying out analytics on Benford’s Law, in R. Let us load it.</p>
<div class="sourceCode" id="cb2049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2049-1"><a href="#cb2049-1" tabindex="-1"></a><span class="fu">library</span>(benford.analysis)</span></code></pre></div>
<p>This package provides tools that make it easier to validate data using Benford’s Law. This package has been developed by <strong>Carlos Cinelli</strong>. As the package author himself states that the main purpose of the package is to identify suspicious data that need further verification, it should always be kept in mind that these analytics only provide us red-flagged transactions that should be validated further.</p>
<p>Apart from useful functions in the package, this also loads some default datasets specially those which were used by Frank Benford while proposing his law. Let us load the census 2009 data containing the population of towns and cities of the United States, as of July of 2009.</p>
<div class="sourceCode" id="cb2050"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2050-1"><a href="#cb2050-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;census.2009&quot;</span>)</span></code></pre></div>
<p>Let us view the top 6 rows of the data.</p>
<div class="sourceCode" id="cb2051"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2051-1"><a href="#cb2051-1" tabindex="-1"></a><span class="fu">head</span>(census<span class="fl">.2009</span>)</span></code></pre></div>
<pre><code>##     state             town pop.2009
## 1 Alabama   Abbeville city     2930
## 2 Alabama  Adamsville city     4782
## 3 Alabama     Addison town      709
## 4 Alabama       Akron town      433
## 5 Alabama   Alabaster city    29861
## 6 Alabama Albertville city    20115</code></pre>
<p>In fact, this contains 19509 records.</p>
<p><strong>Problem Statement:</strong> Let us test Benford’s law on 2009 population data. Let us see whether the data conforms Benford’s law.</p>
<p>The main function <code>benford()</code> takes a vector of values to be tested as input, and creates an output of special class <code>benford</code> The syntax is</p>
<pre><code>benford(data, number.of.digits=2)</code></pre>
<p>where-</p>
<ul>
<li><code>data</code> is numeric vector on which analysis has to be performed.</li>
<li><code>number.of.digits</code> is number of digits on which analysis has to be performed. Default value is <code>2</code>.</li>
</ul>
<div class="sourceCode" id="cb2054"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2054-1"><a href="#cb2054-1" tabindex="-1"></a>census_first_digit <span class="ot">&lt;-</span> <span class="fu">benford</span>(census<span class="fl">.2009</span><span class="sc">$</span>pop<span class="fl">.2009</span>, <span class="at">number.of.digits =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Above syntax will create <code>census_first_digit</code> object which store various useful information for Benford Analytics. We may view its summary -</p>
<div class="sourceCode" id="cb2055"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2055-1"><a href="#cb2055-1" tabindex="-1"></a><span class="fu">summary</span>(census_first_digit)</span></code></pre></div>
<pre><code>##                   Length Class      Mode     
## info               4     -none-     list     
## data               4     data.table list     
## s.o.data           2     data.table list     
## bfd               13     data.table list     
## mantissa           2     data.table list     
## MAD                1     -none-     numeric  
## MAD.conformity     1     -none-     character
## distortion.factor  1     -none-     numeric  
## stats              2     -none-     list</code></pre>
<p>Let us also print the object to see what all is stored therein.</p>
<div class="sourceCode" id="cb2057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2057-1"><a href="#cb2057-1" tabindex="-1"></a><span class="fu">print</span>(census_first_digit)</span></code></pre></div>
<pre><code>## 
## Benford object:
##  
## Data: census.2009$pop.2009 
## Number of observations used = 19509 
## Number of obs. for second order = 7950 
## First digits analysed = 1
## 
## Mantissa: 
## 
##    Statistic  Value
##         Mean  0.503
##          Var  0.084
##  Ex.Kurtosis -1.207
##     Skewness -0.013
## 
## 
## The 5 largest deviations: 
## 
##   digits absolute.diff
## 1      1        134.79
## 2      2        104.64
## 3      3         95.43
## 4      6         63.94
## 5      8         45.07
## 
## Stats:
## 
##  Pearson&#39;s Chi-squared test
## 
## data:  census.2009$pop.2009
## X-squared = 17.524, df = 8, p-value = 0.0251
## 
## 
##  Mantissa Arc Test
## 
## data:  census.2009$pop.2009
## L2 = 4.198e-05, df = 2, p-value = 0.4409
## 
## Mean Absolute Deviation (MAD): 0.003119261
## MAD Conformity - Nigrini (2012): Close conformity
## Distortion Factor: 0.7404623
## 
## Remember: Real data will never conform perfectly to Benford&#39;s Law. You should not focus on p-values!</code></pre>
<p>Results of Chi-Square distribution test, MAD etc. are printed apart from top deviations. The MAD value of <code>0.003</code> shows <code>close conformity</code> with Benford’s law. Chi Square statistic at 17.524 is slightly greater than 5% critical value of 15.507. In second example we will see that results of <code>print</code> command on benford object can be further customised, using its other arguments.</p>
<p>Let us also visualise the plots. We will use <code>plot</code> command to generate the plots.</p>
<div class="sourceCode" id="cb2059"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2059-1"><a href="#cb2059-1" tabindex="-1"></a><span class="fu">plot</span>(census_first_digit)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/cenbenplot-1.png" alt="Benford Analysis Results of Census 2009 Data" width="672" />
<p class="caption">
(#fig:cenbenplot)Benford Analysis Results of Census 2009 Data
</p>
</div>
<p>We can see that by default five charts are printed.</p>
<ol style="list-style-type: decimal">
<li>Digits distribution</li>
<li>Second Order Test digit distribution</li>
<li>Summation test - digit distribution</li>
<li>Chi-Square differences</li>
<li>Summation differences</li>
</ol>
<p><em>Similarly, in second example we will see how to customise plot outputs.</em></p>
<p>We can see that first digits in census 2009 data, follows Benford’s Law closely.</p>
<div id="other-useful-functions-in-package" class="section level3" number="39.5.1">
<h3><span class="header-section-number">39.5.1</span> Other Useful functions in package</h3>
<p>You may be wondering whether we have to depend upon print function every time to get analytics insights out the object created. In fact there are several other functions in this package which are very useful while carrying out risk analysis through Benford’s Law.</p>
<ul>
<li><code>chisq</code>: Gets the Chi-squared test of a Benford object. Takes a benford object as input.</li>
<li><code>duplicatesTable</code> Shows the duplicates of the data. Similarly, takes a benford object as input.</li>
<li><code>extract.digits</code> Extracts the leading digits from the data. Takes data as input. This is useful, while carrying out analysis manually.</li>
<li><code>getBfd</code> Gets the the statistics of the first Digits of a benford object. E.g.</li>
</ul>
<div class="sourceCode" id="cb2060"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2060-1"><a href="#cb2060-1" tabindex="-1"></a><span class="fu">getBfd</span>(census_first_digit)</span></code></pre></div>
<pre><code>##    digits  data.dist data.second.order.dist benford.dist
##     &lt;int&gt;      &lt;num&gt;                  &lt;num&gt;        &lt;num&gt;
## 1:      1 0.29412066             0.55811321   0.30103000
## 2:      2 0.18145471             0.15471698   0.17609126
## 3:      3 0.12004716             0.08968553   0.12493874
## 4:      4 0.09467425             0.05761006   0.09691001
## 5:      5 0.07991184             0.04364780   0.07918125
## 6:      6 0.07022400             0.03308176   0.06694679
## 7:      7 0.05976729             0.02553459   0.05799195
## 8:      8 0.05346250             0.01987421   0.05115252
## 9:      9 0.04633759             0.01773585   0.04575749
##    data.second.order.dist.freq data.dist.freq benford.dist.freq
##                          &lt;num&gt;          &lt;num&gt;             &lt;num&gt;
## 1:                        4437           5738         5872.7942
## 2:                        1230           3540         3435.3644
## 3:                         713           2342         2437.4298
## 4:                         458           1847         1890.6174
## 5:                         347           1559         1544.7469
## 6:                         263           1370         1306.0649
## 7:                         203           1166         1131.3649
## 8:                         158           1043          997.9346
## 9:                         141            904          892.6829
##    benford.so.dist.freq data.summation abs.excess.summation difference
##                   &lt;num&gt;          &lt;num&gt;                &lt;num&gt;      &lt;num&gt;
## 1:            2393.1885       51237849             29880783 -134.79419
## 2:            1399.9255       33272136             11915070  104.63563
## 3:             993.2630       22810354              1453288  -95.42981
## 4:             770.4346       15763499              5593567  -43.61744
## 5:             629.4909       15799838              5557228   14.25307
## 6:             532.2270       14527377              6829689   63.93508
## 7:             461.0360       11371006              9986060   34.63511
## 8:             406.6626       18814056              2543010   45.06544
## 9:             363.7720        8617475             12739591   11.31712
##    squared.diff absolute.diff
##           &lt;num&gt;         &lt;num&gt;
## 1:    3.0938378     134.79419
## 2:    3.1870315     104.63563
## 3:    3.7362508      95.42981
## 4:    1.0062752      43.61744
## 5:    0.1315102      14.25307
## 6:    3.1297790      63.93508
## 7:    1.0603039      34.63511
## 8:    2.0350972      45.06544
## 9:    0.1434744      11.31712</code></pre>
<ul>
<li><code>getSuspects</code> Gets the ‘suspicious’ observations according to Benford’s Law. Takes both data as well as benford object, as inputs. Example in second case study.</li>
<li><code>MAD</code> Gets the MAD of a Benford object.</li>
<li><code>suspectsTable</code> Shows the first digits ordered by the mains discrepancies from Benford’s Law. Notice the difference from <code>getSuspects</code></li>
</ul>
</div>
<div id="example-2-corporate-payments-data" class="section level3" number="39.5.2">
<h3><span class="header-section-number">39.5.2</span> Example-2: Corporate payments data</h3>
<p><strong>Problem Statement-2:</strong> Let us analyse red-flags, on dataset of the 2010’s payments data (189470 records) of a division of a West Coast utility company. This data, <code>corporate.payments</code> is also available with the package. This time we will use first two digits in our analysis.</p>
<p><strong>Step-1:</strong> Load the dataset and view its top rows. Let’s also see its summary.</p>
<div class="sourceCode" id="cb2062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2062-1"><a href="#cb2062-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;corporate.payment&quot;</span>)</span>
<span id="cb2062-2"><a href="#cb2062-2" tabindex="-1"></a><span class="fu">head</span>(corporate.payment)</span></code></pre></div>
<pre><code>##   VendorNum       Date  InvNum Amount
## 1      2001 2010-01-02 0496J10  36.08
## 2      2001 2010-01-02 1726J10  77.80
## 3      2001 2010-01-02 2104J10  34.97
## 4      2001 2010-01-02 2445J10  59.00
## 5      2001 2010-01-02 3281J10  59.56
## 6      2001 2010-01-02 3822J10  50.38</code></pre>
<div class="sourceCode" id="cb2064"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2064-1"><a href="#cb2064-1" tabindex="-1"></a><span class="fu">summary</span>(corporate.payment)</span></code></pre></div>
<pre><code>##   VendorNum              Date               InvNum              Amount        
##  Length:189470      Min.   :2010-01-02   Length:189470      Min.   :  -71388  
##  Class :character   1st Qu.:2010-02-28   Class :character   1st Qu.:      50  
##  Mode  :character   Median :2010-06-04   Mode  :character   Median :     200  
##                     Mean   :2010-06-16                      Mean   :    2588  
##                     3rd Qu.:2010-09-30                      3rd Qu.:     835  
##                     Max.   :2010-12-31                      Max.   :26763476</code></pre>
<p>We can see it has 189470 records having</p>
<pre><code>+   Vendor Numbers
+   Date of Transaction
+   Invoice Number
+   Amount of invoice/transaction</code></pre>
<p><strong>Step-2:</strong> Create benford object</p>
<div class="sourceCode" id="cb2067"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2067-1"><a href="#cb2067-1" tabindex="-1"></a>corp_bfd <span class="ot">&lt;-</span> <span class="fu">benford</span>(corporate.payment<span class="sc">$</span>Amount, <span class="at">number.of.digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><strong>Step-3:</strong> Let us first visually inspect the results. This time we will use another argument of <code>plot</code> function in <code>benford.analysis</code> library which is <code>except</code>. Actually this can create seven different plots and by default it creates five plots as stated earlier. Thus, by writing <code>except = "none"</code> we can include all seven plots if we want. Otherwise we will have to mention exclusions from <code>c("digits", "second order", "summation", "mantissa", "chi squared", "abs diff", "ex summation")</code>. There is one more argument namely <code>multiple</code> which is TRUE by default and plots multiple charts in same window.</p>
<p>So let us build (i) Digit distribution and (ii) Second order digit distribution plots.</p>
<div class="sourceCode" id="cb2068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2068-1"><a href="#cb2068-1" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb2068-2"><a href="#cb2068-2" tabindex="-1"></a>  corp_bfd,</span>
<span id="cb2068-3"><a href="#cb2068-3" tabindex="-1"></a>  <span class="at">except =</span> <span class="fu">c</span>(</span>
<span id="cb2068-4"><a href="#cb2068-4" tabindex="-1"></a>    <span class="st">&quot;summation&quot;</span>,</span>
<span id="cb2068-5"><a href="#cb2068-5" tabindex="-1"></a>    <span class="st">&quot;mantissa&quot;</span>,</span>
<span id="cb2068-6"><a href="#cb2068-6" tabindex="-1"></a>    <span class="st">&quot;chi squared&quot;</span>,</span>
<span id="cb2068-7"><a href="#cb2068-7" tabindex="-1"></a>    <span class="st">&quot;abs diff&quot;</span>,</span>
<span id="cb2068-8"><a href="#cb2068-8" tabindex="-1"></a>    <span class="st">&quot;ex summation&quot;</span>,</span>
<span id="cb2068-9"><a href="#cb2068-9" tabindex="-1"></a>    <span class="st">&quot;chisq diff&quot;</span>,</span>
<span id="cb2068-10"><a href="#cb2068-10" tabindex="-1"></a>    <span class="st">&quot;legend&quot;</span></span>
<span id="cb2068-11"><a href="#cb2068-11" tabindex="-1"></a>  ),</span>
<span id="cb2068-12"><a href="#cb2068-12" tabindex="-1"></a>  <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb2068-13"><a href="#cb2068-13" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/corpben-1.png" alt="Benford Analysis results on Corporate payments Data" width="47%" height="30%" /><img src="DauR_files/figure-html/corpben-2.png" alt="Benford Analysis results on Corporate payments Data" width="47%" height="30%" />
<p class="caption">
(#fig:corpben)Benford Analysis results on Corporate payments Data
</p>
</div>
<p>We can see that largely the data follows Benford’s Law except an abnormal peak at 50.</p>
<p><strong>Step-4:</strong> Let us now see what is inside of this object. Function <code>print</code> in <code>benford.analysis</code> package has another argument <code>how.many</code> which simply tells us to print how many of the absolute differences.</p>
<div class="sourceCode" id="cb2069"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2069-1"><a href="#cb2069-1" tabindex="-1"></a><span class="fu">print</span>(corp_bfd, <span class="at">how.many =</span> <span class="dv">7</span>)</span></code></pre></div>
<pre><code>## 
## Benford object:
##  
## Data: corporate.payment$Amount 
## Number of observations used = 185083 
## Number of obs. for second order = 65504 
## First digits analysed = 2
## 
## Mantissa: 
## 
##    Statistic  Value
##         Mean  0.496
##          Var  0.092
##  Ex.Kurtosis -1.257
##     Skewness -0.002
## 
## 
## The 7 largest deviations: 
## 
##   digits absolute.diff
## 1     50       5938.25
## 2     11       3331.98
## 3     10       2811.92
## 4     14       1043.68
## 5     98        889.95
## 6     90        736.81
## 7     92        709.01
## 
## Stats:
## 
##  Pearson&#39;s Chi-squared test
## 
## data:  corporate.payment$Amount
## X-squared = 32094, df = 89, p-value &lt; 2.2e-16
## 
## 
##  Mantissa Arc Test
## 
## data:  corporate.payment$Amount
## L2 = 0.0039958, df = 2, p-value &lt; 2.2e-16
## 
## Mean Absolute Deviation (MAD): 0.002336614
## MAD Conformity - Nigrini (2012): Nonconformity
## Distortion Factor: -1.065467
## 
## Remember: Real data will never conform perfectly to Benford&#39;s Law. You should not focus on p-values!</code></pre>
<p>We can see that digit 50 has indeed the largest abolute difference. One of the reasons for availability of invoices in this digit group may be due to some tax capping or some other reason, which an auditor may need to investigate further.</p>
<p>Using <code>suspectsTable()</code> we can also get similar information.</p>
<div class="sourceCode" id="cb2071"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2071-1"><a href="#cb2071-1" tabindex="-1"></a><span class="fu">suspectsTable</span>(corp_bfd) <span class="sc">|&gt;</span> </span>
<span id="cb2071-2"><a href="#cb2071-2" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">7</span>)</span></code></pre></div>
<pre><code>##    digits absolute.diff
##     &lt;int&gt;         &lt;num&gt;
## 1:     50     5938.2544
## 2:     11     3331.9798
## 3:     10     2811.9177
## 4:     14     1043.6833
## 5:     98      889.9470
## 6:     90      736.8084
## 7:     92      709.0129</code></pre>
<p><strong>Step-5:</strong> Let us also get the Chi Square and other metrics</p>
<div class="sourceCode" id="cb2073"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2073-1"><a href="#cb2073-1" tabindex="-1"></a><span class="fu">chisq</span>(corp_bfd)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  corporate.payment$Amount
## X-squared = 32094, df = 89, p-value &lt; 2.2e-16</code></pre>
<p>Going strictly by numbers and p-value, which we should not depend upon in Benford Analytics, we see that Null hypothesis (Ref: section @ref(chis)) has been rejected. In other words, chi-square statistic tells us that data does not follow Benford Law.</p>
<p>To get Mean Absolute Deviation</p>
<div class="sourceCode" id="cb2075"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2075-1"><a href="#cb2075-1" tabindex="-1"></a><span class="fu">MAD</span>(corp_bfd)</span></code></pre></div>
<pre><code>## [1] 0.002336614</code></pre>
<p>Whether the value conforms to values suggested by Mark Nigrini, we can do</p>
<div class="sourceCode" id="cb2077"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2077-1"><a href="#cb2077-1" tabindex="-1"></a>corp_bfd<span class="sc">$</span>MAD.conformity</span></code></pre></div>
<pre><code>## [1] &quot;Nonconformity&quot;</code></pre>
<p><strong>Step-6:</strong> Let us generate duplicate values avilable if any, in the data. For sake of brevity here, we will print top-5 results.</p>
<div class="sourceCode" id="cb2079"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2079-1"><a href="#cb2079-1" tabindex="-1"></a><span class="fu">duplicatesTable</span>(corp_bfd) <span class="sc">|&gt;</span> </span>
<span id="cb2079-2"><a href="#cb2079-2" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##     number duplicates
##      &lt;num&gt;      &lt;int&gt;
## 1:   50.00       6022
## 2: 1153.35       2264
## 3: 1083.45       1185
## 4:  150.00       1056
## 5:  988.35       1018</code></pre>
<p>Examining output above, we can see that there are 6022 invoices having all amount of USD50 each. Probably this could be the reason for failing of null hypothesis in the data.</p>
<p><strong>Step-7:</strong> We can extract all distribution data using <code>getBFD</code> function.</p>
<div class="sourceCode" id="cb2081"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2081-1"><a href="#cb2081-1" tabindex="-1"></a><span class="fu">getBfd</span>(corp_bfd) <span class="sc">|&gt;</span> </span>
<span id="cb2081-2"><a href="#cb2081-2" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##     digits  data.dist data.second.order.dist benford.dist
##      &lt;int&gt;      &lt;num&gt;                  &lt;num&gt;        &lt;num&gt;
##  1:     10 0.05658542            0.374786273   0.04139269
##  2:     11 0.05579119            0.015922692   0.03778856
##  3:     12 0.03236926            0.014609795   0.03476211
##  4:     13 0.03116440            0.013266365   0.03218468
##  5:     14 0.02432422            0.011113825   0.02996322
##  6:     15 0.03038637            0.011510747   0.02802872
##  7:     16 0.02385416            0.010365779   0.02632894
##  8:     17 0.02179563            0.009129213   0.02482358
##  9:     18 0.02085011            0.009358207   0.02348110
## 10:     19 0.02043408            0.008106375   0.02227639
##     data.second.order.dist.freq data.dist.freq benford.dist.freq
##                           &lt;num&gt;          &lt;num&gt;             &lt;num&gt;
##  1:                       24550          10473          7661.082
##  2:                        1043          10326          6994.020
##  3:                         957           5991          6433.875
##  4:                         869           5768          5956.838
##  5:                         728           4502          5545.683
##  6:                         754           5624          5187.640
##  7:                         679           4415          4873.039
##  8:                         598           4034          4594.423
##  9:                         613           3859          4345.952
## 10:                         531           3782          4122.982
##     benford.so.dist.freq data.summation abs.excess.summation difference
##                    &lt;num&gt;          &lt;num&gt;                &lt;num&gt;      &lt;num&gt;
##  1:             2711.386       28701407             23224143  2811.9177
##  2:             2475.302       22324748             16847484  3331.9798
##  3:             2277.057       16258127             10780863  -442.8749
##  4:             2108.225       15520165             10042901  -188.8378
##  5:             1962.711       27393259             21915996 -1043.6833
##  6:             1835.994       49191988             43714724   436.3597
##  7:             1724.651       12523174              7045911  -458.0390
##  8:             1626.044       11994778              6517515  -560.4233
##  9:             1538.106        7545939              2068675  -486.9517
## 10:             1459.193        6987397              1510133  -340.9820
##     squared.diff absolute.diff
##            &lt;num&gt;         &lt;num&gt;
##  1:  1032.084049     2811.9177
##  2:  1587.368773     3331.9798
##  3:    30.485235      442.8749
##  4:     5.986347      188.8378
##  5:   196.418497     1043.6833
##  6:    36.704517      436.3597
##  7:    43.053153      458.0390
##  8:    68.359901      560.4233
##  9:    54.561565      486.9517
## 10:    28.200147      340.9820</code></pre>
<p><strong>Step-8:</strong> To get suspected/high risk records, we may make use of <code>getSuspects</code> function. As already stated it requires both benford object and data as inputs.</p>
<div class="sourceCode" id="cb2083"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2083-1"><a href="#cb2083-1" tabindex="-1"></a><span class="co"># We are printing 10 records only</span></span>
<span id="cb2083-2"><a href="#cb2083-2" tabindex="-1"></a><span class="fu">getSuspects</span>(corp_bfd, corporate.payment) <span class="sc">|&gt;</span> </span>
<span id="cb2083-3"><a href="#cb2083-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##     VendorNum       Date      InvNum  Amount
##        &lt;char&gt;     &lt;Date&gt;      &lt;char&gt;   &lt;num&gt;
##  1:      2001 2010-01-02     3822J10   50.38
##  2:      2001 2010-01-07    100107-2 1166.29
##  3:      2001 2010-01-08 11210084007 1171.45
##  4:      2001 2010-01-08     1585J10   50.42
##  5:      2001 2010-01-08     4733J10  113.34
##  6:      2001 2010-01-08     6263J10  117.22
##  7:      2001 2010-01-08     6673J10   50.80
##  8:      2001 2010-01-08     9181J10  114.78
##  9:      2001 2010-01-09     1510J10   50.49
## 10:      2001 2010-01-09     1532J10   50.45</code></pre>
<p>Moreover, by using <code>slice_max</code> function from <code>dplyr</code> we can also get <code>n</code> high-valued ‘suspects’.</p>
<div class="sourceCode" id="cb2085"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2085-1"><a href="#cb2085-1" tabindex="-1"></a><span class="fu">getSuspects</span>(corp_bfd, corporate.payment) <span class="sc">|&gt;</span></span>
<span id="cb2085-2"><a href="#cb2085-2" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> Amount, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##     VendorNum       Date                InvNum    Amount
##        &lt;char&gt;     &lt;Date&gt;                &lt;char&gt;     &lt;num&gt;
##  1:      2817 2010-10-27                10-10A 1156428.2
##  2:     17141 2010-04-05                040510 1135003.6
##  3:      2817 2010-11-30            1033500002 1112304.3
##  4:     16721 2010-09-16 SEE ATTACHED BALSHEET 1100000.0
##  5:      6118 2010-12-17             103511001  509093.7
##  6:      2817 2010-05-28                 40821  506971.5
##  7:     17284 2010-03-24                032400  504580.6
##  8:      6118 2010-08-26             102381001  504334.6
##  9:     17284 2010-03-10                 31000  502132.2
## 10:      2088 2010-03-24            1008300003  500000.0</code></pre>
<div id="conclusion" class="section level4 unnumbered">
<h4 class="unnumbered">Conclusion</h4>
<p>Though by statistics (goodness of fit metrics), the data did not conform to BL, yet we observed that there were abnormally high records starting with digits <code>50</code>. The reasons can be further investigated. By charts we also observed that, otherwise the data conform to BL. We also extracted suspected records for further investigation on other parameters/tests/verification. To sum up, we can say that, Benford Analysis can be a good starting point for fraud/forensic analytics while auditing. Before closing, let us also delve in one other example.</p>
</div>
</div>
<div id="example-3-lakes-perimeter" class="section level3" number="39.5.3">
<h3><span class="header-section-number">39.5.3</span> Example-3: Lakes Perimeter</h3>
<p>Let us apply this on <code>lakes.perimeter</code><a href="#fn44" class="footnote-ref" id="fnref44"><sup>44</sup></a> data which is available with the package.</p>
<div class="sourceCode" id="cb2087"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2087-1"><a href="#cb2087-1" tabindex="-1"></a><span class="co"># load sample data</span></span>
<span id="cb2087-2"><a href="#cb2087-2" tabindex="-1"></a><span class="fu">data</span>(lakes.perimeter) </span>
<span id="cb2087-3"><a href="#cb2087-3" tabindex="-1"></a><span class="co"># Number of rows</span></span>
<span id="cb2087-4"><a href="#cb2087-4" tabindex="-1"></a><span class="fu">nrow</span>(lakes.perimeter)</span></code></pre></div>
<pre><code>## [1] 248607</code></pre>
<div class="sourceCode" id="cb2089"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2089-1"><a href="#cb2089-1" tabindex="-1"></a><span class="co"># View top rows</span></span>
<span id="cb2089-2"><a href="#cb2089-2" tabindex="-1"></a><span class="fu">head</span>(lakes.perimeter)</span></code></pre></div>
<pre><code>##   perimeter.km
## 1          1.0
## 2          1.0
## 3          1.1
## 4          1.1
## 5          1.1
## 6          1.1</code></pre>
<div class="sourceCode" id="cb2091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2091-1"><a href="#cb2091-1" tabindex="-1"></a><span class="co"># Generate Benford Object</span></span>
<span id="cb2091-2"><a href="#cb2091-2" tabindex="-1"></a>lake_ben <span class="ot">&lt;-</span> <span class="fu">benford</span>(lakes.perimeter<span class="sc">$</span>perimeter.km, <span class="at">number.of.digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>Let us see the plots, metrics and top outliers</p>
<div class="sourceCode" id="cb2092"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2092-1"><a href="#cb2092-1" tabindex="-1"></a><span class="fu">plot</span>(lake_ben)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/unnamed-chunk-579-1.png" alt="Benford Analysis - lake Perimeter Data" width="672" />
<p class="caption">
(#fig:unnamed-chunk-579)Benford Analysis - lake Perimeter Data
</p>
</div>
<div class="sourceCode" id="cb2093"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2093-1"><a href="#cb2093-1" tabindex="-1"></a><span class="co"># Chisq test</span></span>
<span id="cb2093-2"><a href="#cb2093-2" tabindex="-1"></a><span class="fu">chisq</span>(lake_ben)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  lakes.perimeter$perimeter.km
## X-squared = 88111, df = 89, p-value &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb2095"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2095-1"><a href="#cb2095-1" tabindex="-1"></a><span class="co"># MAD</span></span>
<span id="cb2095-2"><a href="#cb2095-2" tabindex="-1"></a><span class="fu">MAD</span>(lake_ben)</span></code></pre></div>
<pre><code>## [1] 0.006012766</code></pre>
<div class="sourceCode" id="cb2097"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2097-1"><a href="#cb2097-1" tabindex="-1"></a><span class="co"># Whether it conforms?</span></span>
<span id="cb2097-2"><a href="#cb2097-2" tabindex="-1"></a>lake_ben<span class="sc">$</span>MAD.conformity</span></code></pre></div>
<pre><code>## [1] &quot;Nonconformity&quot;</code></pre>
<div class="sourceCode" id="cb2099"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2099-1"><a href="#cb2099-1" tabindex="-1"></a><span class="co"># Get top-10 suspects</span></span>
<span id="cb2099-2"><a href="#cb2099-2" tabindex="-1"></a><span class="fu">getSuspects</span>(lake_ben, lakes.perimeter) <span class="sc">|&gt;</span></span>
<span id="cb2099-3"><a href="#cb2099-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##     perimeter.km
##            &lt;num&gt;
##  1:          1.5
##  2:          1.5
##  3:          1.5
##  4:          1.5
##  5:          1.5
##  6:          1.5
##  7:          1.5
##  8:          1.5
##  9:          1.5
## 10:          1.5</code></pre>
<div class="sourceCode" id="cb2101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2101-1"><a href="#cb2101-1" tabindex="-1"></a><span class="co"># Get top-10 suspects on Squared Differences</span></span>
<span id="cb2101-2"><a href="#cb2101-2" tabindex="-1"></a><span class="fu">getSuspects</span>(lake_ben, lakes.perimeter, </span>
<span id="cb2101-3"><a href="#cb2101-3" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;squared.diff&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb2101-4"><a href="#cb2101-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##     perimeter.km
##            &lt;num&gt;
##  1:          3.6
##  2:          3.6
##  3:          3.6
##  4:          3.6
##  5:          3.6
##  6:          3.6
##  7:          3.6
##  8:          3.6
##  9:          3.6
## 10:          3.6</code></pre>
<div class="sourceCode" id="cb2103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2103-1"><a href="#cb2103-1" tabindex="-1"></a><span class="co"># Get top-10 suspects on Absolute Excess Summation</span></span>
<span id="cb2103-2"><a href="#cb2103-2" tabindex="-1"></a><span class="fu">getSuspects</span>(lake_ben, lakes.perimeter, </span>
<span id="cb2103-3"><a href="#cb2103-3" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;abs.excess.summation&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb2103-4"><a href="#cb2103-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##     perimeter.km
##            &lt;num&gt;
##  1:          1.0
##  2:          1.0
##  3:          1.3
##  4:          1.3
##  5:          1.3
##  6:          1.3
##  7:          1.3
##  8:          1.3
##  9:          1.3
## 10:          1.3</code></pre>
<div id="conclusion-1" class="section level4 unnumbered">
<h4 class="unnumbered">Conclusion</h4>
<p>We observed that data does not conform Benford’s law which is evident from plot as well as MAD value. Chi-Squared Value of <code>88111</code> also exceeds critical value very significantly. Nigrini and Miller gave some plausible explanations in their Research paper<span class="citation"><a href="#fn45" class="footnote-ref" id="fnref45"><sup>45</sup></a></span> for this non-conformity. One of the possible reasons, they propose, was that <em>perimeter is not a correct measurement for the size of a lake.</em></p>
</div>
</div>
</div>
<div id="conclusion-2" class="section level2" number="39.6">
<h2><span class="header-section-number">39.6</span> Conclusion</h2>
<p>As we conclude this chapter on Benford Analytics, it’s clear that this statistical phenomenon holds remarkable potential across diverse fields. The inherent simplicity of Benford’s Law belies its complexity and applicability. Its ability to unveil anomalies, authenticate data integrity, and aid in forensic investigations underscores its significance in modern data analysis. As we delve deeper into its intricacies and practical applications, we unravel a tool that not only scrutinizes numbers but also illuminates new avenues for precision, authenticity, and trust in our data-driven world.</p>
<hr />
<p>Further Reading-</p>
<ol style="list-style-type: decimal">
<li><p>ISACA JOURNAL ARCHIVES - <a href="https://www.isaca.org/resources/isaca-journal/past-issues/2011/understanding-and-applying-benfords-law">Understanding and Applying Benford’s Law - 1 May 2011</a></p></li>
<li><p>Newcomb, Simon. “Note on the Frequency of Use of the Different Digits in Natural Numbers.” American Journal of Mathematics, vol. 4, no. 1, 1881, pp. 39–40. JSTOR, <a href="https://doi.org/10.2307/2369148" class="uri">https://doi.org/10.2307/2369148</a>. Accessed 15 Jun. 2022.</p></li>
<li><p>Durtschi, Cindy &amp; Hillison, William &amp; Pacini, Carl. (2004). The Effective Use of Benford’s Law to Assist in Detecting Fraud in Accounting Data. J. Forensic Account.</p></li>
</ol>
<!--chapter:end:17-Anamolous.Rmd-->
</div>
</div>
<div id="anomaly-detection" class="section level1" number="40">
<h1><span class="header-section-number">40</span> Anomaly Detection</h1>
<p>Anomalies play a significant role in the field of audit. As auditors start examining data whether it be financial statements, or transactions, or other relevant data, the detection of anomalies can provide valuable insights and help identify potential issues or irregularities. Anomalies often indicate the presence of fraudulent activities. Unusual or unexpected patterns in financial transactions or account balances may suggest potential fraud or misappropriation of assets. Auditors actively search for anomalies that may indicate fraudulent behavior, such as fictitious transactions, unauthorized access, or unusual changes in financial data.</p>
<p>Anomalies in the audit context serve as indicators of potential issues, including fraud, material misstatements, control weaknesses, compliance violations, and process inefficiencies. Detecting and investigating anomalies is crucial for auditors to provide accurate and reliable financial information, enhance internal controls, and support informed decision-making by stakeholders.</p>
<div id="definition-and-types-of-anomalies" class="section level2" number="40.1">
<h2><span class="header-section-number">40.1</span> Definition and types of anomalies</h2>
<p>Anomalies are patterns or data points that deviate significantly from the expected or normal behavior within a dataset. These are also known as outliers, novelties, or deviations and can provide valuable insights into unusual events or behavior in various domains.</p>
<p>Types of anomalies:</p>
<ul>
<li><p><strong>Point Anomalies:</strong> Individual data points that are considered anomalous when compared to the rest of the dataset. For example, a temperature sensor reading that is significantly different from the expected range.</p></li>
<li><p><strong>Contextual Anomalies:</strong> Data points that are considered anomalous within a specific context or subset of the dataset. For instance, a sudden increase in obsolete website traffic.</p></li>
<li><p><strong>Collective Anomalies:</strong> Groups of data points that exhibit anomalous behavior when analyzed together but might appear normal when considered individually. An example is a sudden drop in sales for multiple related products.</p></li>
</ul>
<p><strong>Anomaly detection, in R</strong></p>
</div>
<div id="anomaly-detection---by-inspection" class="section level2" number="40.2">
<h2><span class="header-section-number">40.2</span> Anomaly detection - by inspection</h2>
<p>Several times, anomalies or outliers are detectable by observation. The <code>summary()</code> function prints the <em>maximum</em>, <em>minimum</em>, <em>upper</em> and <em>lower quartiles</em>, and the <em>mean</em> and <em>median</em>, and can give a sense for how far an extreme point lies from the rest of the data. E.g. Let’s visualise the mean annual temperatures in degrees Fahrenheit in New Haven, Connecticut, from 1912 to 1971, through a boxplot (Refer Figure @ref(fig:an1). This data is available in base R, as <code>nhtemp</code>.</p>
<div class="sourceCode" id="cb2105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2105-1"><a href="#cb2105-1" tabindex="-1"></a><span class="fu">summary</span>(nhtemp)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   47.90   50.58   51.20   51.16   51.90   54.60</code></pre>
<p>The easiest way to get a sense for how unusual a particular value is is by using a graphical summary like a boxplot. In R, this is created using the <code>boxplot</code> function. The <code>boxplot</code> function takes a column of values as an input argument, here illustrated with the temperature data, and produces a box and whiskers representation of the distribution of the values. The extreme values are represented as distinct points, making them easier to spot. We can also make use of ggplot2. Examples from both base R and ggplot2 are shown in Figure @ref(fig:an1).</p>
<div class="sourceCode" id="cb2107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2107-1"><a href="#cb2107-1" tabindex="-1"></a><span class="fu">boxplot</span>(nhtemp, <span class="at">main =</span> <span class="st">&quot;Box plot of nhtemp data&quot;</span>)</span>
<span id="cb2107-2"><a href="#cb2107-2" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(Species, Petal.Length, <span class="at">color =</span> Species )) <span class="sc">+</span></span>
<span id="cb2107-3"><a href="#cb2107-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">outlier.size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb2107-4"><a href="#cb2107-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2107-5"><a href="#cb2107-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Petal Lengths in Iris Data&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an1-1.png" alt="Outliers through Boxplot" width="45%" /><img src="DauR_files/figure-html/an1-2.png" alt="Outliers through Boxplot" width="45%" />
<p class="caption">
(#fig:an1)Outliers through Boxplot
</p>
</div>
<p>It’s important to note that a <strong>point anomaly</strong> is not necessarily always extreme. A point anomaly can also arise as an unusual combination of values across several attributes.</p>
<p>A <strong>collective anomaly</strong>, on the other hand, is a collection of similar data instances that can be considered anomalous together when compared to the rest of the data. For example, a consecutive 5 day period of high temperatures are shown by the red points in the plot. These daily temperatures are unusual because they occur together, and are likely caused by the same underlying weather event. Refer Figure @ref(fig:an2).</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an2-1.png" alt="Collective Anomalies" width="672" height="27%" />
<p class="caption">
(#fig:an2)Collective Anomalies
</p>
</div>
</div>
<div id="grubbs-test" class="section level2" number="40.3">
<h2><span class="header-section-number">40.3</span> Grubb’s Test</h2>
<p>We saw that visual assessment of outliers works well when the majority of data points are grouped together and rest of them lie separate. In statistics there are several tests to detect anomalies. <strong>Grubb’s Test</strong> is one of these. Grubb’s test assesses whether the point that lies farthest from the mean in a dataset could be an outlier. This point will either be the largest or smallest value in the data. This test is however based on assumption that data points are normally distributed. So before proceeding for this test, we must be sure that there is a plausible explanation for this assumption. <em>(We can check normality of data points by plotting a histogram. For other methods please refer to chapter on linear regression.)</em></p>
<p>Let’s run this test on <code>nhtemp</code> data example, which we have already seen in @ref(fig:an1) (Left). So let’s check its normality assumption.</p>
<div class="sourceCode" id="cb2108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2108-1"><a href="#cb2108-1" tabindex="-1"></a><span class="fu">hist</span>(nhtemp, <span class="at">breaks =</span> <span class="dv">20</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an3-1.png" alt="Histogram for Grubb's test" width="672" height="27%" />
<p class="caption">
(#fig:an3)Histogram for Grubb’s test
</p>
</div>
<p>In figure @ref(fig:an3) we can see that our assumption is nearly satisfied. Let’s run the test.</p>
<div class="sourceCode" id="cb2109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2109-1"><a href="#cb2109-1" tabindex="-1"></a><span class="fu">library</span>(outliers)</span>
<span id="cb2109-2"><a href="#cb2109-2" tabindex="-1"></a>outliers<span class="sc">::</span><span class="fu">grubbs.test</span>(nhtemp)</span></code></pre></div>
<pre><code>## 
##  Grubbs test for one outlier
## 
## data:  nhtemp
## G = 2.71806, U = 0.87266, p-value = 0.1539
## alternative hypothesis: highest value 54.6 is an outlier</code></pre>
<p>As p value is <code>0.15</code> we do not have strong evidence to reject null hypothesis that extreme maximum value is an outlier.</p>
</div>
<div id="seasonal-hybrid-esd-algorithm" class="section level2" number="40.4">
<h2><span class="header-section-number">40.4</span> Seasonal Hybrid ESD Algorithm</h2>
<p>As we have seen that above test may not be appropriate for anomaly detection (normality assumption as well as detection of extreme values only), particularly detecting anomalies from a time series that may have seasonal variations. We may install <code>AnomalyDetection</code> package development version from github using <code>devtools::install_github("twitter/AnomalyDetection")</code>. Example: in <code>JohnsonJohnson</code> data having quarterly sales data, we can use the following syntax.</p>
<div class="sourceCode" id="cb2111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2111-1"><a href="#cb2111-1" tabindex="-1"></a><span class="co">#devtools::install_github(&quot;twitter/AnomalyDetection&quot;)</span></span>
<span id="cb2111-2"><a href="#cb2111-2" tabindex="-1"></a><span class="fu">library</span>(AnomalyDetection)</span>
<span id="cb2111-3"><a href="#cb2111-3" tabindex="-1"></a><span class="fu">AnomalyDetectionVec</span>(<span class="fu">as.vector</span>(JohnsonJohnson), </span>
<span id="cb2111-4"><a href="#cb2111-4" tabindex="-1"></a>                    <span class="at">period =</span> <span class="dv">4</span>, <span class="co"># Sesaonality</span></span>
<span id="cb2111-5"><a href="#cb2111-5" tabindex="-1"></a>                    <span class="at">plot =</span> <span class="cn">TRUE</span>, <span class="co"># set FALSE when plot not needed</span></span>
<span id="cb2111-6"><a href="#cb2111-6" tabindex="-1"></a>                    <span class="at">direction =</span> <span class="st">&#39;both&#39;</span> <span class="co"># set &#39;pos&#39; for higher values</span></span>
<span id="cb2111-7"><a href="#cb2111-7" tabindex="-1"></a>                                       <span class="co"># or &#39;neg&#39; for lower values</span></span>
<span id="cb2111-8"><a href="#cb2111-8" tabindex="-1"></a>                    )</span></code></pre></div>
<pre><code>## $anoms
##   index anoms
## 1    74 12.06
## 2    75 12.15
## 3    77 14.04
## 4    78 12.96
## 5    79 14.85
## 6    81 16.20
## 7    82 14.67
## 8    83 16.02
## 
## $plot</code></pre>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an4-1.png" alt="Seasonal Hybrid ESD Algorithm" width="672" height="28%" />
<p class="caption">
(#fig:an4)Seasonal Hybrid ESD Algorithm
</p>
</div>
<p>In Figure @ref(fig:an4), we can see that in output <code>$anoms</code> containing anomalies are denoted in blue dots.</p>
</div>
<div id="k-nearest-neighbour-distance-score" class="section level2" number="40.5">
<h2><span class="header-section-number">40.5</span> k-Nearest Neighbour Distance Score</h2>
<p>One of greatest limitation of above two methods was that, these were applicable on univariate data series, whereas, in real world, data analysis will rarely be univariate. The <code>knn</code> technique works on multivariate data, but for visulaisation purposes, we will first visulaise the results on bivariate data only.</p>
<p><strong>K-Nearest Neighbour</strong> or <strong>KNN</strong> is a distance-based classifier, meaning that it implicitly assumes that the smaller the distance between two points, the more similar they are. For bivariate data, we can understand the algorithm by plotting the data-points in a two dimensional scatter plot. Now as the distance between any two points are usually calculated using <em>Euclidean Distance Metric</em>, we should ensure that the data is normalised/scaled before proceeding for distance calculation.</p>
<p><strong>Problem Statement-1:</strong> Let us try to identify outliers in <code>virginica</code> Species’ flower measurements. So let’s prepare the data. We will make use of <code>scale</code> function available in base R, to normalise the data. Remember that <code>scale</code> returns a matrix, so we may need to convert it into data.frame while using <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb2113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2113-1"><a href="#cb2113-1" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb2113-2"><a href="#cb2113-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> iris[<span class="dv">101</span><span class="sc">:</span><span class="dv">150</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb2113-3"><a href="#cb2113-3" tabindex="-1"></a><span class="co">#  Scale the data</span></span>
<span id="cb2113-4"><a href="#cb2113-4" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">scale</span>(df)</span></code></pre></div>
<p>Let us visualise the data (in first two dimensions only). However, as our data is scaled already, we can try to visualise all the dimensions using a boxplot. See both figures in @ref(fig:an5). The points/ouliers have been numbered (on the basis of row numbers) for interpretaion purposes.</p>
<div class="sourceCode" id="cb2114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2114-1"><a href="#cb2114-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb2114-2"><a href="#cb2114-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2114-3"><a href="#cb2114-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2114-4"><a href="#cb2114-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, Sepal.Width)) <span class="sc">+</span></span>
<span id="cb2114-5"><a href="#cb2114-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;seagreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb2114-6"><a href="#cb2114-6" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> row), <span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>()) <span class="sc">+</span></span>
<span id="cb2114-7"><a href="#cb2114-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb2114-8"><a href="#cb2114-8" tabindex="-1"></a></span>
<span id="cb2114-9"><a href="#cb2114-9" tabindex="-1"></a><span class="co"># Helper Function</span></span>
<span id="cb2114-10"><a href="#cb2114-10" tabindex="-1"></a>find_outlier <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb2114-11"><a href="#cb2114-11" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">&lt;</span> <span class="fu">quantile</span>(x, .<span class="dv">25</span>) <span class="sc">-</span> <span class="fl">1.5</span><span class="sc">*</span><span class="fu">IQR</span>(x) <span class="sc">|</span> x <span class="sc">&gt;</span> <span class="fu">quantile</span>(x, .<span class="dv">75</span>) <span class="sc">+</span> <span class="fl">1.5</span><span class="sc">*</span><span class="fu">IQR</span>(x))</span>
<span id="cb2114-12"><a href="#cb2114-12" tabindex="-1"></a>}</span>
<span id="cb2114-13"><a href="#cb2114-13" tabindex="-1"></a></span>
<span id="cb2114-14"><a href="#cb2114-14" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb2114-15"><a href="#cb2114-15" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2114-16"><a href="#cb2114-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2114-17"><a href="#cb2114-17" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>row, <span class="at">names_to =</span> <span class="st">&quot;Dimension&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Values&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2114-18"><a href="#cb2114-18" tabindex="-1"></a>  <span class="fu">group_by</span>(Dimension) <span class="sc">%&gt;%</span> </span>
<span id="cb2114-19"><a href="#cb2114-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outlier =</span> <span class="fu">ifelse</span>(<span class="fu">find_outlier</span>(Values), row, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2114-20"><a href="#cb2114-20" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Dimension, Values)) <span class="sc">+</span></span>
<span id="cb2114-21"><a href="#cb2114-21" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.colour =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb2114-22"><a href="#cb2114-22" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>outlier), <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb2114-23"><a href="#cb2114-23" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an5-1.png" alt="Sepal Length Vs. Widths in Virginica" width="45%" /><img src="DauR_files/figure-html/an5-2.png" alt="Sepal Length Vs. Widths in Virginica" width="45%" />
<p class="caption">
(#fig:an5)Sepal Length Vs. Widths in Virginica
</p>
</div>
<p>Now, let’s proceed to identify outliers in R. We will make use of <code>get.knn</code> function from <code>FNN</code> package. However, <code>k</code> parameter is required beforehand.</p>
<div class="sourceCode" id="cb2115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2115-1"><a href="#cb2115-1" tabindex="-1"></a><span class="co"># Load the library</span></span>
<span id="cb2115-2"><a href="#cb2115-2" tabindex="-1"></a><span class="fu">library</span>(FNN)</span>
<span id="cb2115-3"><a href="#cb2115-3" tabindex="-1"></a><span class="co"># get kNN object, using k = 5</span></span>
<span id="cb2115-4"><a href="#cb2115-4" tabindex="-1"></a>viginica_knn <span class="ot">&lt;-</span> FNN<span class="sc">::</span><span class="fu">get.knn</span>(df[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="dv">5</span>)</span></code></pre></div>
<p>The <code>knn</code> object created above will have two sub-objects (both matrices having columns equal to chosen <code>k</code>), one having nearest neighbors’ indices and another having distances from those. Let’s view their top 6 rows.</p>
<div class="sourceCode" id="cb2116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2116-1"><a href="#cb2116-1" tabindex="-1"></a><span class="fu">head</span>(viginica_knn<span class="sc">$</span>nn.index)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]   37   16   49   11   45
## [2,]    2   15   22   35   14
## [3,]   30   40   42    8   13
## [4,]   34   27   29   33   28
## [5,]    5   17   46   38   41
## [6,]   36    8   30   23   31</code></pre>
<div class="sourceCode" id="cb2118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2118-1"><a href="#cb2118-1" tabindex="-1"></a><span class="fu">head</span>(viginica_knn<span class="sc">$</span>nn.dist)</span></code></pre></div>
<pre><code>##           [,1]      [,2]      [,3]      [,4]      [,5]
## [1,] 0.3100808 0.3476803 0.3476803 0.4416741 0.6290499
## [2,] 0.0000000 0.3100808 0.4416741 0.5645648 0.6397904
## [3,] 0.1572625 0.4416741 0.4416741 0.4416741 0.4717874
## [4,] 0.3100808 0.3476803 0.3476803 0.3476803 0.4416741
## [5,] 0.0000000 0.0000000 0.3145250 0.3476803 0.4416741
## [6,] 0.1572625 0.5645648 0.6290499 0.6397904 0.6953605</code></pre>
<p>Using <code>rowMeans</code> we can calculate mean distance for each data point. The bigger this score is, the chances of that record being an outlier are relatively higher. Let’s also store that mean distance in a variable/column say <code>score</code> in main dataset, and visualise the results by setting the point-size with this mean distance (actually its square root). In Figure @ref(fig:an8), we may notice that points lying far away are bigger becuase their chances of being outliers is high.</p>
<div class="sourceCode" id="cb2120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2120-1"><a href="#cb2120-1" tabindex="-1"></a>score <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(viginica_knn<span class="sc">$</span>nn.dist)</span>
<span id="cb2120-2"><a href="#cb2120-2" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb2120-3"><a href="#cb2120-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2120-4"><a href="#cb2120-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>(),</span>
<span id="cb2120-5"><a href="#cb2120-5" tabindex="-1"></a>         <span class="at">score =</span> score) <span class="sc">%&gt;%</span> </span>
<span id="cb2120-6"><a href="#cb2120-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, Sepal.Width)) <span class="sc">+</span></span>
<span id="cb2120-7"><a href="#cb2120-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> score),<span class="at">color =</span> <span class="st">&quot;seagreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb2120-8"><a href="#cb2120-8" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> row), <span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>()) <span class="sc">+</span></span>
<span id="cb2120-9"><a href="#cb2120-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2120-10"><a href="#cb2120-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;KNN method of outlier&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an8-1.png" alt="k-Nearest Neighbour Distance" width="672" height="28%" />
<p class="caption">
(#fig:an8)k-Nearest Neighbour Distance
</p>
</div>
<p>Now, we can run the algorithm to find the outlier on the basis of all variables in the dataset.</p>
<div class="sourceCode" id="cb2121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2121-1"><a href="#cb2121-1" tabindex="-1"></a>virginica_knn <span class="ot">&lt;-</span> FNN<span class="sc">::</span><span class="fu">get.knn</span>(df, <span class="dv">5</span>)</span>
<span id="cb2121-2"><a href="#cb2121-2" tabindex="-1"></a>score <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(virginica_knn<span class="sc">$</span>nn.dist)</span>
<span id="cb2121-3"><a href="#cb2121-3" tabindex="-1"></a><span class="co"># Which point is farthest-Outlier</span></span>
<span id="cb2121-4"><a href="#cb2121-4" tabindex="-1"></a><span class="fu">which.max</span>(score)</span></code></pre></div>
<pre><code>## [1] 32</code></pre>
</div>
<div id="local-outlier-factor" class="section level2" number="40.6">
<h2><span class="header-section-number">40.6</span> Local Outlier Factor</h2>
<p>As against kNN which uses distances of k neighbors, this algorithm uses density of each data point vis-a-vis density of its nearest neighbors. kNN distance seems to be good at detecting points that are really far from their neighbors, sometimes called global anomalies, but sometimes fail to capture all of the points that might be considered anomalous like local anomalies. Local Anomalies may lie near to a cluster still they won’t be like their neighbors. To understand it better, see the plot in Figure @ref(fig:an9) consisting of dummy data.</p>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an9-1.png" alt="Local Outlier factor" width="672" height="28%" />
<p class="caption">
(#fig:an9)Local Outlier factor
</p>
</div>
<p>The red points may be global outliers, being far from its immediate neigbors, yet the blue points may be local anomalies as these are not like their immediate neighbors and may be local anomalies.</p>
<p>As stated, LOF segregates the data points based on the ratio of density of that point with that of densities of its neighbors. A score <code>&gt; 1</code> thus indicates that the data point may be an anomaly. Let’s see that on same problem statement.</p>
<div class="sourceCode" id="cb2123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2123-1"><a href="#cb2123-1" tabindex="-1"></a><span class="fu">library</span>(dbscan)</span>
<span id="cb2123-2"><a href="#cb2123-2" tabindex="-1"></a>lof_score <span class="ot">&lt;-</span> <span class="fu">lof</span>(df, <span class="dv">5</span>)</span>
<span id="cb2123-3"><a href="#cb2123-3" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb2123-4"><a href="#cb2123-4" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2123-5"><a href="#cb2123-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>(),</span>
<span id="cb2123-6"><a href="#cb2123-6" tabindex="-1"></a>         <span class="at">score =</span> lof_score) <span class="sc">%&gt;%</span> </span>
<span id="cb2123-7"><a href="#cb2123-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, Sepal.Width)) <span class="sc">+</span></span>
<span id="cb2123-8"><a href="#cb2123-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> score),<span class="at">color =</span> <span class="st">&quot;seagreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb2123-9"><a href="#cb2123-9" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> row), <span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>()) <span class="sc">+</span></span>
<span id="cb2123-10"><a href="#cb2123-10" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  </span>
<span id="cb2123-11"><a href="#cb2123-11" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2123-12"><a href="#cb2123-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;LOF method of outlier&quot;</span>)</span>
<span id="cb2123-13"><a href="#cb2123-13" tabindex="-1"></a></span>
<span id="cb2123-14"><a href="#cb2123-14" tabindex="-1"></a>df_prcomp <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(df, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2123-15"><a href="#cb2123-15" tabindex="-1"></a></span>
<span id="cb2123-16"><a href="#cb2123-16" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb2123-17"><a href="#cb2123-17" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2123-18"><a href="#cb2123-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>(),</span>
<span id="cb2123-19"><a href="#cb2123-19" tabindex="-1"></a>         <span class="at">score =</span> lof_score,</span>
<span id="cb2123-20"><a href="#cb2123-20" tabindex="-1"></a>         <span class="at">PC1 =</span> df_prcomp<span class="sc">$</span>x[,<span class="dv">1</span>],</span>
<span id="cb2123-21"><a href="#cb2123-21" tabindex="-1"></a>         <span class="at">PC2 =</span> df_prcomp<span class="sc">$</span>x[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb2123-22"><a href="#cb2123-22" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb2123-23"><a href="#cb2123-23" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> score),<span class="at">color =</span> <span class="st">&quot;seagreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb2123-24"><a href="#cb2123-24" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> row), <span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>()) <span class="sc">+</span></span>
<span id="cb2123-25"><a href="#cb2123-25" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  </span>
<span id="cb2123-26"><a href="#cb2123-26" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2123-27"><a href="#cb2123-27" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;LOF method of outlier</span><span class="sc">\n</span><span class="st">Visualised on principal components&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an10-1.png" alt="LOF" width="48%" /><img src="DauR_files/figure-html/an10-2.png" alt="LOF" width="48%" />
<p class="caption">
(#fig:an10)LOF
</p>
</div>
<p>Clearly, in Figure @ref(fig:an10) (left), where we have plotted the data in 2 dimensions only despite that we have attempted to find the LOF on the basis of all four dimensions. We can see presence of local anomalies, within the clustered data points. E.g. points nos. 31, 23, etc. were earlier given more weight instead of point nos.15, 10, etc. which are now given more weight. However, if we want to visaulise it on first two principal components, we can do that (Refer Figure @ref(fig:an10) (Right)). We can also verify this.</p>
<div class="sourceCode" id="cb2124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2124-1"><a href="#cb2124-1" tabindex="-1"></a><span class="co"># Biggest Anomaly - kNN</span></span>
<span id="cb2124-2"><a href="#cb2124-2" tabindex="-1"></a><span class="fu">which.max</span>(score)</span></code></pre></div>
<pre><code>## [1] 32</code></pre>
<div class="sourceCode" id="cb2126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2126-1"><a href="#cb2126-1" tabindex="-1"></a><span class="co"># Biggest Anomaly - LOF</span></span>
<span id="cb2126-2"><a href="#cb2126-2" tabindex="-1"></a><span class="fu">which.max</span>(lof_score)</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<p>Histograms of both <code>knn</code> and <code>LOF</code> scores can also be drawn, as in Figure @ref(fig:an12).</p>
<div class="sourceCode" id="cb2128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2128-1"><a href="#cb2128-1" tabindex="-1"></a><span class="fu">hist</span>(score, <span class="at">breaks =</span> <span class="dv">40</span>, </span>
<span id="cb2128-2"><a href="#cb2128-2" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Histogram of KNN scores in IRIS-Virginica data&quot;</span>)</span>
<span id="cb2128-3"><a href="#cb2128-3" tabindex="-1"></a><span class="fu">hist</span>(lof_score, <span class="at">breaks =</span> <span class="dv">40</span>, </span>
<span id="cb2128-4"><a href="#cb2128-4" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Histogram of LOF scores in IRIS-Virginica data&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an12-1.png" alt="Histogram - KNN(Left) and LOF (Right)" width="48%" /><img src="DauR_files/figure-html/an12-2.png" alt="Histogram - KNN(Left) and LOF (Right)" width="48%" />
<p class="caption">
(#fig:an12)Histogram - KNN(Left) and LOF (Right)
</p>
</div>
</div>
<div id="isolation-treesforest" class="section level2" number="40.7">
<h2><span class="header-section-number">40.7</span> Isolation Trees/Forest</h2>
<p>Isolation Forest is an unsupervised tree based model, which actually works on path length instead of distance or density measures. Tree based models use decision tree(s) to determine the value/class of an observation given its value. In other words, it determines or try to identify a path from the root node to a leaf node based on the value of the observation in question. Forest (or Random Forest) are actually collection of smaller trees and thus using ensemble learning methods to make decision, instead of a single complex tree.</p>
<p>Let us work on the same problem statement above. Firstly, we will build a single decision tree. WE will use a development version package <code>isofor</code> which can be downloaded using <code>remotes::install_github("Zelazny7/isofor")</code>. To build forest/tree we will use function <code>iForest</code>. Its argument <code>nt</code> will determine the number of trees to be built in ensemble. Another important argument is <code>phi</code> which determines the number of samples to draw without replacement to construct each tree. So let’s use <code>nt = 1</code> and <code>phi = 100</code>.</p>
<div class="sourceCode" id="cb2129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2129-1"><a href="#cb2129-1" tabindex="-1"></a><span class="co"># remotes::install_github(&quot;Zelazny7/isofor&quot;)</span></span>
<span id="cb2129-2"><a href="#cb2129-2" tabindex="-1"></a><span class="fu">library</span>(isofor)</span>
<span id="cb2129-3"><a href="#cb2129-3" tabindex="-1"></a><span class="co"># Generate a single tree</span></span>
<span id="cb2129-4"><a href="#cb2129-4" tabindex="-1"></a><span class="co"># Specify number of samples explicitly</span></span>
<span id="cb2129-5"><a href="#cb2129-5" tabindex="-1"></a>viginica_1 <span class="ot">&lt;-</span> <span class="fu">iForest</span>(df, <span class="at">nt =</span> <span class="dv">1</span>, <span class="at">phi =</span> <span class="dv">100</span>)</span>
<span id="cb2129-6"><a href="#cb2129-6" tabindex="-1"></a></span>
<span id="cb2129-7"><a href="#cb2129-7" tabindex="-1"></a><span class="co"># Generate isolation score</span></span>
<span id="cb2129-8"><a href="#cb2129-8" tabindex="-1"></a>iso_score_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(viginica_1, df)</span>
<span id="cb2129-9"><a href="#cb2129-9" tabindex="-1"></a></span>
<span id="cb2129-10"><a href="#cb2129-10" tabindex="-1"></a><span class="co"># View fisrt 10 scores</span></span>
<span id="cb2129-11"><a href="#cb2129-11" tabindex="-1"></a>iso_score_1[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##  [1] 0.3372822 0.3437950 0.3694749 0.4425250 0.3694749 0.4517359 0.8198250
##  [8] 0.6085593 0.4989121 0.6085593</code></pre>
<p><em>Score interpretations</em>: The closer the score is to 1, the more likely the point is an anomaly. However, if their scores are below 0.5, they are probably just normal points within the trend.</p>
<p>Let’s just visualise the scores on Principal Component plot again.</p>
<div class="sourceCode" id="cb2131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2131-1"><a href="#cb2131-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb2131-2"><a href="#cb2131-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2131-3"><a href="#cb2131-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>(),</span>
<span id="cb2131-4"><a href="#cb2131-4" tabindex="-1"></a>         <span class="at">score =</span> iso_score_1,</span>
<span id="cb2131-5"><a href="#cb2131-5" tabindex="-1"></a>         <span class="at">PC1 =</span> df_prcomp<span class="sc">$</span>x[,<span class="dv">1</span>],</span>
<span id="cb2131-6"><a href="#cb2131-6" tabindex="-1"></a>         <span class="at">PC2 =</span> df_prcomp<span class="sc">$</span>x[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb2131-7"><a href="#cb2131-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb2131-8"><a href="#cb2131-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> score),<span class="at">color =</span> <span class="st">&quot;seagreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb2131-9"><a href="#cb2131-9" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> row), <span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>()) <span class="sc">+</span></span>
<span id="cb2131-10"><a href="#cb2131-10" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  </span>
<span id="cb2131-11"><a href="#cb2131-11" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2131-12"><a href="#cb2131-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Isolation Tree based outlier</span><span class="sc">\n</span><span class="st">Visualised on principal components&quot;</span>)</span>
<span id="cb2131-13"><a href="#cb2131-13" tabindex="-1"></a></span>
<span id="cb2131-14"><a href="#cb2131-14" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb2131-15"><a href="#cb2131-15" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2131-16"><a href="#cb2131-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>(),</span>
<span id="cb2131-17"><a href="#cb2131-17" tabindex="-1"></a>         <span class="at">score =</span> iso_score_1,</span>
<span id="cb2131-18"><a href="#cb2131-18" tabindex="-1"></a>         <span class="at">PC1 =</span> df_prcomp<span class="sc">$</span>x[,<span class="dv">1</span>],</span>
<span id="cb2131-19"><a href="#cb2131-19" tabindex="-1"></a>         <span class="at">PC2 =</span> df_prcomp<span class="sc">$</span>x[,<span class="dv">2</span>],</span>
<span id="cb2131-20"><a href="#cb2131-20" tabindex="-1"></a>         <span class="at">is_outlier =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">ntile</span>(iso_score_1, <span class="dv">10</span>) <span class="sc">&gt;=</span> <span class="dv">10</span>, <span class="st">&quot;O&quot;</span>, <span class="st">&quot;N&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2131-21"><a href="#cb2131-21" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb2131-22"><a href="#cb2131-22" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> score, <span class="at">color =</span> is_outlier)) <span class="sc">+</span></span>
<span id="cb2131-23"><a href="#cb2131-23" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> row), <span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>()) <span class="sc">+</span></span>
<span id="cb2131-24"><a href="#cb2131-24" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">O =</span> <span class="st">&quot;red&quot;</span>, <span class="at">N =</span> <span class="st">&quot;black&quot;</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb2131-25"><a href="#cb2131-25" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  </span>
<span id="cb2131-26"><a href="#cb2131-26" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2131-27"><a href="#cb2131-27" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Isolation Tree based outlier</span><span class="sc">\n</span><span class="st">Top-10%&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an24-1.png" alt="Isolation Tree Method" width="48%" /><img src="DauR_files/figure-html/an24-2.png" alt="Isolation Tree Method" width="48%" />
<p class="caption">
(#fig:an24)Isolation Tree Method
</p>
</div>
<p>Let’s also try a forest (ensemble) approach. Refer Figure @ref(fig:an14), we can see that scores are modified using ensemble methods. However, when we gradually increase number of trees, these scores will stabilise.</p>
<div class="sourceCode" id="cb2132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2132-1"><a href="#cb2132-1" tabindex="-1"></a>iso_100 <span class="ot">&lt;-</span> <span class="fu">iForest</span>(df, <span class="at">nt =</span> <span class="dv">100</span>, <span class="at">phi =</span> <span class="dv">100</span>)</span>
<span id="cb2132-2"><a href="#cb2132-2" tabindex="-1"></a></span>
<span id="cb2132-3"><a href="#cb2132-3" tabindex="-1"></a><span class="co"># Generate scores</span></span>
<span id="cb2132-4"><a href="#cb2132-4" tabindex="-1"></a></span>
<span id="cb2132-5"><a href="#cb2132-5" tabindex="-1"></a>iso_score_100 <span class="ot">&lt;-</span> <span class="fu">predict</span>(iso_100, df)</span>
<span id="cb2132-6"><a href="#cb2132-6" tabindex="-1"></a></span>
<span id="cb2132-7"><a href="#cb2132-7" tabindex="-1"></a><span class="co"># View Results</span></span>
<span id="cb2132-8"><a href="#cb2132-8" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb2132-9"><a href="#cb2132-9" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2132-10"><a href="#cb2132-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">row_number</span>(),</span>
<span id="cb2132-11"><a href="#cb2132-11" tabindex="-1"></a>         <span class="at">score =</span> iso_score_100,</span>
<span id="cb2132-12"><a href="#cb2132-12" tabindex="-1"></a>         <span class="at">PC1 =</span> df_prcomp<span class="sc">$</span>x[,<span class="dv">1</span>],</span>
<span id="cb2132-13"><a href="#cb2132-13" tabindex="-1"></a>         <span class="at">PC2 =</span> df_prcomp<span class="sc">$</span>x[,<span class="dv">2</span>],</span>
<span id="cb2132-14"><a href="#cb2132-14" tabindex="-1"></a>         <span class="at">is_outlier =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">ntile</span>(iso_score_100, <span class="dv">10</span>) <span class="sc">&gt;=</span> <span class="dv">10</span>, <span class="st">&quot;O&quot;</span>, <span class="st">&quot;N&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2132-15"><a href="#cb2132-15" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb2132-16"><a href="#cb2132-16" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> score, <span class="at">color =</span> is_outlier)) <span class="sc">+</span></span>
<span id="cb2132-17"><a href="#cb2132-17" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> row), <span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>()) <span class="sc">+</span></span>
<span id="cb2132-18"><a href="#cb2132-18" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">O =</span> <span class="st">&quot;red&quot;</span>, <span class="at">N =</span> <span class="st">&quot;black&quot;</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb2132-19"><a href="#cb2132-19" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  </span>
<span id="cb2132-20"><a href="#cb2132-20" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2132-21"><a href="#cb2132-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Isolation Tree based outlier</span><span class="sc">\n</span><span class="st">Number of Trees = 100&quot;</span>)</span>
<span id="cb2132-22"><a href="#cb2132-22" tabindex="-1"></a></span>
<span id="cb2132-23"><a href="#cb2132-23" tabindex="-1"></a><span class="fu">plot</span>(iso_score_1, iso_score_100, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb2132-24"><a href="#cb2132-24" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Comparision of Tree Vs. Forest Method&quot;</span>)</span>
<span id="cb2132-25"><a href="#cb2132-25" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an14-1.png" alt="100 Isolation Trees (Left) Comparison of 1 vs. 100 trees (Right)" width="48%" /><img src="DauR_files/figure-html/an14-2.png" alt="100 Isolation Trees (Left) Comparison of 1 vs. 100 trees (Right)" width="48%" />
<p class="caption">
(#fig:an14)100 Isolation Trees (Left) Comparison of 1 vs. 100 trees (Right)
</p>
</div>
<p><strong>Contour plots:</strong> We can also visualise the results of scores of anomaly detection, using contour plots. See the plot in Figure @ref(fig:an16).</p>
<div class="sourceCode" id="cb2133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2133-1"><a href="#cb2133-1" tabindex="-1"></a><span class="co"># Create PRCOMP data</span></span>
<span id="cb2133-2"><a href="#cb2133-2" tabindex="-1"></a>df_grid <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2133-3"><a href="#cb2133-3" tabindex="-1"></a>  <span class="at">PC1 =</span> df_prcomp<span class="sc">$</span>x[,<span class="dv">1</span>],</span>
<span id="cb2133-4"><a href="#cb2133-4" tabindex="-1"></a>  <span class="at">PC2 =</span> df_prcomp<span class="sc">$</span>x[,<span class="dv">2</span>]</span>
<span id="cb2133-5"><a href="#cb2133-5" tabindex="-1"></a>)</span>
<span id="cb2133-6"><a href="#cb2133-6" tabindex="-1"></a></span>
<span id="cb2133-7"><a href="#cb2133-7" tabindex="-1"></a><span class="co"># Create Sequences</span></span>
<span id="cb2133-8"><a href="#cb2133-8" tabindex="-1"></a>pc1_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(df_prcomp<span class="sc">$</span>x[,<span class="dv">1</span>]), <span class="fu">max</span>(df_prcomp<span class="sc">$</span>x[,<span class="dv">1</span>]), <span class="at">length.out =</span> <span class="dv">25</span>)</span>
<span id="cb2133-9"><a href="#cb2133-9" tabindex="-1"></a>pc2_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(df_prcomp<span class="sc">$</span>x[,<span class="dv">2</span>]), <span class="fu">max</span>(df_prcomp<span class="sc">$</span>x[,<span class="dv">2</span>]), <span class="at">length.out =</span> <span class="dv">25</span>)</span>
<span id="cb2133-10"><a href="#cb2133-10" tabindex="-1"></a><span class="co"># Create Grid</span></span>
<span id="cb2133-11"><a href="#cb2133-11" tabindex="-1"></a>my_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">PC1 =</span> pc1_seq, <span class="at">PC2 =</span> pc2_seq)</span>
<span id="cb2133-12"><a href="#cb2133-12" tabindex="-1"></a></span>
<span id="cb2133-13"><a href="#cb2133-13" tabindex="-1"></a><span class="co"># Create model for Pr comp</span></span>
<span id="cb2133-14"><a href="#cb2133-14" tabindex="-1"></a>iso_model <span class="ot">&lt;-</span> <span class="fu">iForest</span>(df_grid, <span class="at">nt =</span> <span class="dv">100</span>, <span class="at">phi =</span> <span class="dv">100</span>)</span>
<span id="cb2133-15"><a href="#cb2133-15" tabindex="-1"></a><span class="co"># append scores</span></span>
<span id="cb2133-16"><a href="#cb2133-16" tabindex="-1"></a>my_grid<span class="sc">$</span>scores <span class="ot">&lt;-</span> <span class="fu">predict</span>(iso_model, my_grid)</span>
<span id="cb2133-17"><a href="#cb2133-17" tabindex="-1"></a></span>
<span id="cb2133-18"><a href="#cb2133-18" tabindex="-1"></a><span class="co"># Draw Plot</span></span>
<span id="cb2133-19"><a href="#cb2133-19" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb2133-20"><a href="#cb2133-20" tabindex="-1"></a><span class="fu">contourplot</span>(scores <span class="sc">~</span> PC1 <span class="sc">+</span> PC2, <span class="at">data =</span> my_grid, <span class="at">region =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an16-1.png" alt="Contour Plot" width="90%" />
<p class="caption">
(#fig:an16)Contour Plot
</p>
</div>
<p><strong>Including categorical variables</strong> One benefit of using forest tree method of anomaly detection, is that we can include categorical values also. Only condition is that these should be of <code>factor</code> type.</p>
<p><strong>Problem Statement-2:</strong> Let’s now try to find out anomalies on full <code>iris</code> data. We can check column types before proceeding.</p>
<div class="sourceCode" id="cb2134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2134-1"><a href="#cb2134-1" tabindex="-1"></a><span class="fu">sapply</span>(iris, class)</span></code></pre></div>
<pre><code>## Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species 
##    &quot;numeric&quot;    &quot;numeric&quot;    &quot;numeric&quot;    &quot;numeric&quot;     &quot;factor&quot;</code></pre>
<p>Our condition is met. So we can proceed directly to build a decision tree/Forest. For sake of simplicity, let’s build a simple tree (one). Refer Figure @ref(fig:an18).</p>
<div class="sourceCode" id="cb2136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2136-1"><a href="#cb2136-1" tabindex="-1"></a><span class="co"># New Iforest Model</span></span>
<span id="cb2136-2"><a href="#cb2136-2" tabindex="-1"></a>iso_model_new <span class="ot">&lt;-</span> <span class="fu">iForest</span>(iris, <span class="at">nt =</span> <span class="dv">1</span>, <span class="at">phi =</span> <span class="dv">100</span>)</span>
<span id="cb2136-3"><a href="#cb2136-3" tabindex="-1"></a>new_scores <span class="ot">&lt;-</span> <span class="fu">predict</span>(iso_model_new, iris)</span>
<span id="cb2136-4"><a href="#cb2136-4" tabindex="-1"></a><span class="fu">head</span>(new_scores)</span></code></pre></div>
<pre><code>## [1] 0.3687105 0.3687105 0.3687105 0.3687105 0.3687105 0.6607827</code></pre>
<div class="sourceCode" id="cb2138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2138-1"><a href="#cb2138-1" tabindex="-1"></a><span class="co"># Full PRCOMP for Visual</span></span>
<span id="cb2138-2"><a href="#cb2138-2" tabindex="-1"></a>iris_pr <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb2138-3"><a href="#cb2138-3" tabindex="-1"></a></span>
<span id="cb2138-4"><a href="#cb2138-4" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb2138-5"><a href="#cb2138-5" tabindex="-1"></a>  <span class="at">PC1 =</span> iris_pr<span class="sc">$</span>x[,<span class="dv">1</span>],</span>
<span id="cb2138-6"><a href="#cb2138-6" tabindex="-1"></a>  <span class="at">PC2 =</span> iris_pr<span class="sc">$</span>x[,<span class="dv">2</span>]</span>
<span id="cb2138-7"><a href="#cb2138-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb2138-8"><a href="#cb2138-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> new_scores,</span>
<span id="cb2138-9"><a href="#cb2138-9" tabindex="-1"></a>         <span class="at">Species =</span> iris<span class="sc">$</span>Species) <span class="sc">%&gt;%</span> </span>
<span id="cb2138-10"><a href="#cb2138-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb2138-11"><a href="#cb2138-11" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> score)) <span class="sc">+</span></span>
<span id="cb2138-12"><a href="#cb2138-12" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb2138-13"><a href="#cb2138-13" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2138-14"><a href="#cb2138-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Decision Tree</span><span class="sc">\n</span><span class="st">Visualised on Principal Components&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an18-1.png" alt="Including categorical variable" width="98%" />
<p class="caption">
(#fig:an18)Including categorical variable
</p>
</div>
</div>
<div id="including-categorical-variables-in-lof" class="section level2" number="40.8">
<h2><span class="header-section-number">40.8</span> Including categorical variables in LOF</h2>
<p>We can also include categorical variable in <code>Local outlier factor</code> using <code>gower distance</code> calculation method. Gower method lets us calculate distance between categorical observations, most importantly when the categories are not ordered. To calculate it we can use function <code>daisy</code> from library <code>cluster</code> in R. Let’s see LOF score calculation on the above example. The plot generated can be seen in Figure @ref(fig:an20).</p>
<div class="sourceCode" id="cb2139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2139-1"><a href="#cb2139-1" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb2139-2"><a href="#cb2139-2" tabindex="-1"></a>iris_dist <span class="ot">&lt;-</span> <span class="fu">daisy</span>(iris, <span class="at">metric =</span> <span class="st">&quot;gower&quot;</span>)</span>
<span id="cb2139-3"><a href="#cb2139-3" tabindex="-1"></a>iris_lof <span class="ot">&lt;-</span> <span class="fu">lof</span>(iris_dist, <span class="at">minPts =</span> <span class="dv">5</span>)</span>
<span id="cb2139-4"><a href="#cb2139-4" tabindex="-1"></a></span>
<span id="cb2139-5"><a href="#cb2139-5" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb2139-6"><a href="#cb2139-6" tabindex="-1"></a>  <span class="at">PC1 =</span> iris_pr<span class="sc">$</span>x[,<span class="dv">1</span>],</span>
<span id="cb2139-7"><a href="#cb2139-7" tabindex="-1"></a>  <span class="at">PC2 =</span> iris_pr<span class="sc">$</span>x[,<span class="dv">2</span>]</span>
<span id="cb2139-8"><a href="#cb2139-8" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb2139-9"><a href="#cb2139-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> iris_lof,</span>
<span id="cb2139-10"><a href="#cb2139-10" tabindex="-1"></a>         <span class="at">Species =</span> iris<span class="sc">$</span>Species) <span class="sc">%&gt;%</span> </span>
<span id="cb2139-11"><a href="#cb2139-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb2139-12"><a href="#cb2139-12" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> score)) <span class="sc">+</span></span>
<span id="cb2139-13"><a href="#cb2139-13" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb2139-14"><a href="#cb2139-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2139-15"><a href="#cb2139-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;LOF Scores</span><span class="sc">\n</span><span class="st">Visualised on Principal Components&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an20-1.png" alt="Including categorical variable" width="90%" />
<p class="caption">
(#fig:an20)Including categorical variable
</p>
</div>
</div>
<div id="time-series-anomalies" class="section level2" number="40.9">
<h2><span class="header-section-number">40.9</span> Time Series Anomalies</h2>
<p>In time series data, an anomaly/outlier can be termed as a data point which is not following the common collective trend or seasonal or cyclic pattern of the entire data and is significantly distinct from rest of the data.</p>
<p>To calculate/detect anomalies, in R, we make use of package <code>timetk</code>. The package works on <code>tibble</code> instead of <code>time series</code> data, so we may to prep our data/time series accordingly.</p>
<p><strong>Problem Statement</strong> Let’s find out anomalies, if any on Sunspots data available in base R<a href="#fn46" class="footnote-ref" id="fnref46"><sup>46</sup></a>.</p>
<div class="sourceCode" id="cb2140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2140-1"><a href="#cb2140-1" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;1749-01-01&quot;</span>)</span>
<span id="cb2140-2"><a href="#cb2140-2" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2013-09-01&quot;</span>)</span>
<span id="cb2140-3"><a href="#cb2140-3" tabindex="-1"></a>date_sequence <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_date, end_date, <span class="at">by =</span> <span class="st">&quot;months&quot;</span>)</span>
<span id="cb2140-4"><a href="#cb2140-4" tabindex="-1"></a></span>
<span id="cb2140-5"><a href="#cb2140-5" tabindex="-1"></a>sunspot_df <span class="ot">&lt;-</span> sunspot.month <span class="sc">%&gt;%</span></span>
<span id="cb2140-6"><a href="#cb2140-6" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2140-7"><a href="#cb2140-7" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2140-8"><a href="#cb2140-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> date_sequence)</span>
<span id="cb2140-9"><a href="#cb2140-9" tabindex="-1"></a></span>
<span id="cb2140-10"><a href="#cb2140-10" tabindex="-1"></a><span class="fu">library</span>(timetk)</span>
<span id="cb2140-11"><a href="#cb2140-11" tabindex="-1"></a>sunspot_df <span class="sc">%&gt;%</span> </span>
<span id="cb2140-12"><a href="#cb2140-12" tabindex="-1"></a>  <span class="fu">plot_anomaly_diagnostics</span>(date, value,</span>
<span id="cb2140-13"><a href="#cb2140-13" tabindex="-1"></a>                           <span class="at">.interactive =</span> <span class="cn">FALSE</span>) </span>
<span id="cb2140-14"><a href="#cb2140-14" tabindex="-1"></a></span>
<span id="cb2140-15"><a href="#cb2140-15" tabindex="-1"></a>sunspot_df <span class="sc">%&gt;%</span> </span>
<span id="cb2140-16"><a href="#cb2140-16" tabindex="-1"></a>  <span class="fu">tk_anomaly_diagnostics</span>(date, value) <span class="sc">%&gt;%</span> </span>
<span id="cb2140-17"><a href="#cb2140-17" tabindex="-1"></a>  <span class="fu">filter</span>(anomaly <span class="sc">==</span> <span class="st">&#39;Yes&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 37 × 11
##    date       observed season trend remainder seasadj remainder_l1 remainder_l2
##    &lt;date&gt;        &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
##  1 1749-11-01     159. -1.07   76.3      83.4    160.        -64.8         66.7
##  2 1769-09-01     149. -0.524  78.8      70.5    149.        -64.8         66.7
##  3 1769-10-01     158.  1.17   79.3      77.7    157.        -64.8         66.7
##  4 1769-11-01     148. -1.07   79.8      69.4    149.        -64.8         66.7
##  5 1771-05-01     153.  0.963  77.5      74.3    152.        -64.8         66.7
##  6 1777-11-01     146  -1.07   75.7      71.4    147.        -64.8         66.7
##  7 1777-12-01     157. -0.495  77.8      80.0    158.        -64.8         66.7
##  8 1778-01-01     177. -2.18   79.9      99.6    179.        -64.8         66.7
##  9 1778-05-01     239.  0.963  87.3     151.     238.        -64.8         66.7
## 10 1778-06-01     172.  0.368  89.2      82.1    171.        -64.8         66.7
## # ℹ 27 more rows
## # ℹ 3 more variables: anomaly &lt;chr&gt;, recomposed_l1 &lt;dbl&gt;, recomposed_l2 &lt;dbl&gt;</code></pre>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/an17-1.png" alt="Time Series Anomalies" width="90%" />
<p class="caption">
(#fig:an17)Time Series Anomalies
</p>
</div>
<p>We can anomalies highlighted in red, in Figure @ref(fig:an17) and anomalies filtered out in code above. We may also implement Seasonal Hybrid ESD algorithm already discussed above.</p>
<!--chapter:end:18-anomaly.Rmd-->
</div>
</div>
<div id="finding-anamolous-outliers" class="section level1" number="41">
<h1><span class="header-section-number">41</span> Finding Anamolous Outliers</h1>
<p><em>The content is under development</em></p>
<!--chapter:end:19-AnamolousOutliers.Rmd-->
</div>
<div id="dup" class="section level1" number="42">
<h1><span class="header-section-number">42</span> Duplicate Detection</h1>
<p><em>The content is under development</em></p>
<!--chapter:end:20-duplicates.Rmd-->
</div>
<div id="detecting-gaps-in-sequences" class="section level1" number="43">
<h1><span class="header-section-number">43</span> Detecting gaps in sequences</h1>
<p><em>The content is under development and finalisation</em>
Audit analytics often requires us to check for gaps in sequences of numbers. Gaps in Sequentially numbered objects such as purchase orders, invoice numbers, cheque numbers, etc should be accounted for. Thus, auditors may require to exercise this audit check as a part of audit analytics.</p>
<div id="when-sequence-numbers-are-available-as-numeric-column" class="section level2" number="43.1">
<h2><span class="header-section-number">43.1</span> When sequence numbers are available as <code>numeric</code> column</h2>
<p>We will have starting and ending numbers in such sequence. Let us allocate these in two variables.</p>
<div class="sourceCode" id="cb2142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2142-1"><a href="#cb2142-1" tabindex="-1"></a>start_num <span class="ot">&lt;-</span> <span class="dv">500301</span> <span class="co"># say</span></span>
<span id="cb2142-2"><a href="#cb2142-2" tabindex="-1"></a>end_num <span class="ot">&lt;-</span> <span class="dv">503500</span> <span class="co"># say</span></span></code></pre></div>
<p>It means we have 3200 terms (say cheques) issued in the series. Further suppose, the cheque numbers issued are stored in some column say <code>cheque_no</code> in a given data frame, have a total count say 3177. To simulate</p>
<div class="sourceCode" id="cb2143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2143-1"><a href="#cb2143-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2143-2"><a href="#cb2143-2" tabindex="-1"></a>cheque_no <span class="ot">&lt;-</span> <span class="fu">sample</span>(start_num<span class="sc">:</span>end_num, <span class="dv">3177</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>To find out the gaps we may simply use function <code>setdiff</code> on these two.</p>
<div class="sourceCode" id="cb2144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2144-1"><a href="#cb2144-1" tabindex="-1"></a><span class="fu">setdiff</span>(start_num<span class="sc">:</span>end_num, cheque_no)</span></code></pre></div>
<pre><code>##  [1] 500398 500445 500457 500716 500747 500862 501017 501018 501109 501333
## [11] 501459 501609 501823 501908 502160 502191 502609 502937 502974 503002
## [21] 503284 503385 503422</code></pre>
</div>
<div id="when-sequence-numbers-are-available-as-character-column" class="section level2" number="43.2">
<h2><span class="header-section-number">43.2</span> When sequence numbers are available as <code>character()</code> column</h2>
<p>We may easily replicate above procedure for gap detection, even if the sequence column is of character type. E.g. If the cheque numbers have a prefix say, ‘A’, then the cheque numbers may look like-</p>
<pre><code>##  [1] &quot;A502763&quot; &quot;A502811&quot; &quot;A502527&quot; &quot;A500826&quot; &quot;A500495&quot; &quot;A503286&quot; &quot;A502142&quot;
##  [8] &quot;A501442&quot; &quot;A501553&quot; &quot;A501568&quot;</code></pre>
<p>In these case, we may first substitute prefix with nothing and then proceed as above.</p>
<div class="sourceCode" id="cb2147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2147-1"><a href="#cb2147-1" tabindex="-1"></a>modified_cheques <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;&quot;</span>, cheque_no) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>()</span>
<span id="cb2147-2"><a href="#cb2147-2" tabindex="-1"></a>missing_cheques <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(start_num<span class="sc">:</span>end_num, modified_cheques)</span>
<span id="cb2147-3"><a href="#cb2147-3" tabindex="-1"></a>missing_cheques</span></code></pre></div>
<pre><code>##  [1] 500398 500445 500457 500716 500747 500862 501017 501018 501109 501333
## [11] 501459 501609 501823 501908 502160 502191 502609 502937 502974 503002
## [21] 503284 503385 503422</code></pre>
<!--chapter:end:21-gaps.Rmd-->
</div>
</div>
<div id="data-envelopment-analysis" class="section level1" number="44">
<h1><span class="header-section-number">44</span> Data Envelopment Analysis</h1>
<p>Data Envelopment Analysis (DEA) is a method for measuring the efficiency of a set of decision-making units (DMUs) that was developed in the late 1970s by Abraham Charnes, William Cooper, and Edwardo Rhodes. It was originally developed to evaluate the performance of U.S. banks, but has since been applied to a wide range of industries and sectors.</p>
<p>It provides a way to measure the relative efficiency of different DMUs, even when they produce different combinations of outputs and use different combinations of inputs. This can be useful for identifying best practices and areas for improvement, and for making decisions about which DMUs to invest in or prioritize.</p>
<div id="how-it-works" class="section level2" number="44.1">
<h2><span class="header-section-number">44.1</span> How it works?</h2>
<p>At a high level, DEA works by comparing the input-output combinations of different decision-making units (DMUs) to determine which DMUs are operating efficiently and which are not. Specifically, DEA tries to identify the “efficient frontier” of DMUs that are using their inputs to produce the optimum amount of outputs possible.</p>
<p>To do this, DEA uses a mathematical model that takes into account the inputs and outputs of each DMU, as well as any weights or constraints that may apply. The model then calculates a “score” for each DMU based on how well it performs relative to the other DMUs in the group. DMUs that score higher are considered more efficient than those that score lower.</p>
</div>
<div id="use-cases" class="section level2" number="44.2">
<h2><span class="header-section-number">44.2</span> Use-cases</h2>
<p>DEA has a wide range of applications across different industries and sectors. Here are a few examples:</p>
<ul>
<li><p><strong>Firm Performance Evaluation</strong>: DEA can be used to evaluate the performance of firms in a given industry, by comparing their input-output combinations to identify which firms are operating more efficiently than others. This can help investors and policymakers make decisions about which firms to invest in or support.</p></li>
<li><p><strong>Education Quality Assessment</strong>: DEA can be used to assess the quality of schools, by comparing their input-output combinations to identify which schools are producing better outcomes (e.g., higher test scores) with fewer resources. This can help policymakers allocate education funding more effectively.</p></li>
<li><p><strong>Healthcare Efficiency Analysis</strong>: DEA can be used to analyze the efficiency of hospitals and healthcare providers, by comparing their input-output combinations to identify which providers are delivering better outcomes (e.g., lower mortality rates) with lower costs. This can help healthcare systems optimize resource allocation and improve patient outcomes.</p></li>
<li><p><strong>Regional Development Analysis</strong>: DEA can be used to compare the efficiency of different regions or countries, by comparing their input-output combinations to identify which regions/countries are making the best use of their resources. This can help policymakers identify areas for improvement and develop targeted interventions to promote economic growth.</p></li>
</ul>
</div>
<div id="possible-uses-in-audit" class="section level2" number="44.3">
<h2><span class="header-section-number">44.3</span> Possible uses in Audit</h2>
<p>Data Envelopment Analysis (DEA) can be used in audit to evaluate the efficiency of an organization or process. Auditors can use DEA to identify areas of inefficiency within an organization by comparing the inputs and outputs of different departments or processes. For example, an auditor could use DEA to compare the efficiency of different production lines within a manufacturing plant or the efficiency of different branches within a bank.</p>
<p>By using DEA, auditors can identify areas where an organization is not using its resources effectively and recommend changes to improve efficiency. This can help organizations reduce costs, improve productivity, and increase profits. DEA can also be used to evaluate the efficiency of different audit methods and procedures. For example, an auditor could use DEA to compare the efficiency of different sampling methods to determine which method is most effective at detecting errors or fraud. Undoubtedly, DEA is a powerful tool that can help auditors identify areas of inefficiency and recommend changes to improve organizational performance.</p>
</div>
<div id="a-practical-example-in-r" class="section level2" number="44.4">
<h2><span class="header-section-number">44.4</span> A practical example in R</h2>
<p>We will now see a complete practical example of doing DEA in R.</p>
<div id="pre-requisites-1" class="section level3" number="44.4.1">
<h3><span class="header-section-number">44.4.1</span> Pre-requisites</h3>
<p>We will use library <code>deaR</code> to measuring DEA efficiency.</p>
<div class="sourceCode" id="cb2149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2149-1"><a href="#cb2149-1" tabindex="-1"></a><span class="fu">library</span>(deaR)</span></code></pre></div>
</div>
<div id="sample-data-set" class="section level3" number="44.4.2">
<h3><span class="header-section-number">44.4.2</span> Sample data-set</h3>
<p>Let us assume, we have a data/KPIs of six stores located across India.</p>
<table>
<thead>
<tr class="header">
<th align="left">Store</th>
<th align="right">x1</th>
<th align="right">x2</th>
<th align="right">y1</th>
<th align="right">y2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Delhi</td>
<td align="right">51</td>
<td align="right">38</td>
<td align="right">169</td>
<td align="right">119</td>
</tr>
<tr class="even">
<td align="left">Gurgaon</td>
<td align="right">60</td>
<td align="right">45</td>
<td align="right">243</td>
<td align="right">167</td>
</tr>
<tr class="odd">
<td align="left">Bengalore</td>
<td align="right">43</td>
<td align="right">33</td>
<td align="right">173</td>
<td align="right">158</td>
</tr>
<tr class="even">
<td align="left">Chennai</td>
<td align="right">53</td>
<td align="right">43</td>
<td align="right">216</td>
<td align="right">138</td>
</tr>
<tr class="odd">
<td align="left">Mumbai</td>
<td align="right">43</td>
<td align="right">38</td>
<td align="right">155</td>
<td align="right">161</td>
</tr>
<tr class="even">
<td align="left">Nagpur</td>
<td align="right">44</td>
<td align="right">35</td>
<td align="right">169</td>
<td align="right">157</td>
</tr>
</tbody>
</table>
<p>In the above sample, we have only two inputs, <code>x1</code> and <code>x2</code> and two outputs, <code>y1</code> and <code>y2</code>. Here -</p>
<ul>
<li><code>x1</code> and <code>x2</code> represents machine hours and employee + management hours per week;</li>
<li><code>y1</code> and <code>y2</code> represents quantity of products <code>A</code> and <code>B</code> produced per week, at the locations given.</li>
</ul>
</div>
<div id="performing-dea-in-r" class="section level3" number="44.4.3">
<h3><span class="header-section-number">44.4.3</span> Performing DEA in R</h3>
<p>Now our objective is to first find out the effective DMUs, i.e. which DMUs are using their inputs effectively. Here we will also assume constant returns to scale i.e. output will be doubled if inputs are doubled.</p>
<p>DEA in <code>deaR</code> is a two step process.</p>
<ul>
<li><strong>Step-1</strong>: We will make data in the form as required for the package; using <code>make_deadata()</code> function. <code>inputs</code>, <code>outputs</code> and <code>dmus</code> require column references in the data provided.</li>
<li><strong>Step-2</strong>: Performing actual analysis, using <code>model_basic</code> which takes previously created data (step-1) and two other essential arguments,
<ul>
<li><code>orientation</code>: which takes a string value; <code>"io"</code> (input oriented), <code>"oo"</code> (output oriented), or <code>"dir"</code> (directional)</li>
<li><code>rts</code>: again takes a string; specifying type of returns to scale, equal to <code>"crs"</code> (constant), <code>"vrs"</code> (variable), <code>"nirs"</code> (non-increasing), <code>"ndrs"</code> (non-decreasing) or <code>"grs"</code> (generalized)</li>
<li>Other arguments may be passed on as per need. See <code>?model_basic</code> for more help.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb2150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2150-1"><a href="#cb2150-1" tabindex="-1"></a>store_dea <span class="ot">&lt;-</span> <span class="fu">make_deadata</span>(store, <span class="at">inputs =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">outputs =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">dmus =</span> <span class="dv">1</span>)</span>
<span id="cb2150-2"><a href="#cb2150-2" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">model_basic</span>(store_dea, <span class="at">orientation =</span> <span class="st">&#39;io&#39;</span>, <span class="at">rts =</span> <span class="st">&#39;crs&#39;</span>)</span></code></pre></div>
<p>We have stored the DEA model in <code>model</code> variable just created. Now we can use the following functions to get <code>efficiencies</code>, <code>targets</code> and <code>lambdas</code> respectively.</p>
<div class="sourceCode" id="cb2151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2151-1"><a href="#cb2151-1" tabindex="-1"></a><span class="fu">efficiencies</span>(model)</span></code></pre></div>
<pre><code>##     Delhi   Gurgaon Bengalore   Chennai    Mumbai    Nagpur 
## 0.8254374 1.0000000 1.0000000 1.0000000 1.0000000 0.9685549</code></pre>
<div class="sourceCode" id="cb2153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2153-1"><a href="#cb2153-1" tabindex="-1"></a><span class="fu">targets</span>(model)</span></code></pre></div>
<pre><code>## $target_input
##                 x1       x2
## Delhi     41.74913 31.36662
## Gurgaon   60.00000 45.00000
## Bengalore 43.00000 33.00000
## Chennai   53.00000 43.00000
## Mumbai    43.00000 38.00000
## Nagpur    42.61641 33.38805
## 
## $target_output
##            y1  y2
## Delhi     169 119
## Gurgaon   243 167
## Bengalore 173 158
## Chennai   216 138
## Mumbai    155 161
## Nagpur    169 157</code></pre>
<div class="sourceCode" id="cb2155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2155-1"><a href="#cb2155-1" tabindex="-1"></a><span class="fu">lambdas</span>(model)</span></code></pre></div>
<pre><code>##           Delhi Gurgaon Bengalore Chennai  Mumbai Nagpur
## Delhi         0 0.64348   0.07303       0 0.00000      0
## Gurgaon       0 1.00000   0.00000       0 0.00000      0
## Bengalore     0 0.00000   1.00000       0 0.00000      0
## Chennai       0 0.00000   0.00000       1 0.00000      0
## Mumbai        0 0.00000   0.00000       0 1.00000      0
## Nagpur        0 0.00000   0.85459       0 0.13649      0</code></pre>
</div>
<div id="interpreting-above-results" class="section level3" number="44.4.4">
<h3><span class="header-section-number">44.4.4</span> Interpreting above results</h3>
<ul>
<li>As evident from the named function <code>efficiencies</code> returned the efficiencies of all DMUs. We can see that all DMUs except <code>Delhi</code> and <code>Nagpur</code> are working efficiently.</li>
<li><code>targets</code> give us the optimum values of inputs and/or outputs for the given values. We can see that we have to reduce <code>x1</code> and <code>x2</code> to given values at <code>Delhi</code> and <code>Nagpur</code>.</li>
<li><code>lambdas</code> give the lambdas of the DEA solution.</li>
<li>Further, the <code>plot()</code> function will output the following plots which are easy to inerpret.</li>
</ul>
<div class="sourceCode" id="cb2157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2157-1"><a href="#cb2157-1" tabindex="-1"></a><span class="fu">plot</span>(model)</span></code></pre></div>
<pre><code>## Press [enter] to continue</code></pre>
<pre><code>## Press [enter] to continue</code></pre>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/deaplots-1.png" alt="Data Envelopment Analysis Plots" width="30%" /><img src="DauR_files/figure-html/deaplots-2.png" alt="Data Envelopment Analysis Plots" width="30%" /><img src="DauR_files/figure-html/deaplots-3.png" alt="Data Envelopment Analysis Plots" width="30%" />
<p class="caption">
(#fig:deaplots)Data Envelopment Analysis Plots
</p>
</div>
<p>The example was simple enough. However, we can easily perform DEA on any number of inputs and outputs, using R.</p>
<!--chapter:end:26-DEA.Rmd-->
</div>
</div>
</div>
<div id="appendix-appendix" class="section level1 unnumbered">
<h1 class="unnumbered">(APPENDIX) Appendix</h1>
</div>
<div id="COLORR" class="section level1" number="45">
<h1><span class="header-section-number">45</span> Colors in R</h1>
<p>What is a visualisation without colours? Colours are crucial in conveying meaning effectively, with some colours having specific psychological associations. For instance, red can represent emotions such as love and anger, but it is also often used to indicate declines or losses in data visualizations. In the context of data visualization, color sets the mood and emphasizes the message of the display. It creates a particular atmosphere and can turn a simple visualization into a compelling data narrative.</p>
<p>While tools like ggplot2 are excellent for crafting impactful data visualizations, the default color schemes may sometimes require customization. Carefully selected colors can make it easier and quicker for users to interpret the data and grasp the intended message.</p>
<p>The strategic use of colors can highlight critical data points, differentiate categories, and depict gradients in a way that text alone cannot achieve. Effective color choices make complex data more accessible and engaging, fostering better understanding and retention of information. See the following example (Figure @ref(fig:colorex)), wherein mean highway mileage for each class of cars in <code>mpg</code> data-set has been shown. Color has been used to distinguish classes those having mileage greater than average mileage.</p>
<div class="sourceCode" id="cb2160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2160-1"><a href="#cb2160-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2160-2"><a href="#cb2160-2" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb2160-3"><a href="#cb2160-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">hwy =</span> <span class="fu">mean</span>(hwy), <span class="at">.by =</span> class) <span class="sc">%&gt;%</span> </span>
<span id="cb2160-4"><a href="#cb2160-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fu">fct_reorder</span>(class, hwy),</span>
<span id="cb2160-5"><a href="#cb2160-5" tabindex="-1"></a>         <span class="at">mean =</span> <span class="fu">mean</span>(hwy),</span>
<span id="cb2160-6"><a href="#cb2160-6" tabindex="-1"></a>         <span class="at">performance =</span> <span class="fu">ifelse</span>(hwy <span class="sc">&gt;=</span> mean, <span class="st">&quot;Above&quot;</span>, <span class="st">&quot;Below&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2160-7"><a href="#cb2160-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> class, <span class="at">x =</span> hwy, <span class="at">fill =</span> performance)) <span class="sc">+</span></span>
<span id="cb2160-8"><a href="#cb2160-8" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb2160-9"><a href="#cb2160-9" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> mean), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2160-10"><a href="#cb2160-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2160-11"><a href="#cb2160-11" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Class wise Mean Highway mileage of cars&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="DauR_files/figure-html/colorex-1.png" alt="Default colors in GGPLOT2" width="672" />
<p class="caption">
(#fig:colorex)Default colors in GGPLOT2
</p>
</div>
<p>We may notice that default color choice by R’s GGPLOT2 is not effective as it has picked negative shades for classes having good mileage.</p>
<p>In addition, it is crucial to consider color-blind friendly palettes to ensure that visualizations are accessible to all users. Approximately 8% of men and 0.5% of women globally experience some form of color blindness. By using color schemes that are distinguishable to those with color vision deficiencies, such as those provided by tools like <a href="https://en.wikipedia.org/wiki/ColorBrewer">ColorBrewer</a>, designers can create inclusive visualizations. This not only broadens the audience but also demonstrates a commitment to accessibility and inclusivity. Thoughtful color selection, including the use of color-blind friendly palettes, can significantly enhance the effectiveness and reach of data visualizations.</p>
<p>Readers who wish to learn more about usage of appropriate colors in data visualizations may <a href="https://blog.datawrapper.de/10-ways-to-use-fewer-colors-in-your-data-visualizations/">refer this blog post</a>. So let us learn how to tweak colors in data visualizations to make them convey the message clear and effective.</p>
<div id="choosing-colors-by-own-choice" class="section level2" number="45.1">
<h2><span class="header-section-number">45.1</span> Choosing colors by own choice</h2>
<p>We need different colors for making visualizations in R. In base R plots, colors are usually specified using “col” whereas in ggplot2 these are manipulated using ‘fill’ or ‘color’ aesthetics. There are 600+ built in colors in R. We can have a look on these using <code>colors()</code> function.</p>
<div class="sourceCode" id="cb2161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2161-1"><a href="#cb2161-1" tabindex="-1"></a><span class="co"># See names of random 20 colors</span></span>
<span id="cb2161-2"><a href="#cb2161-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2161-3"><a href="#cb2161-3" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">colors</span>(), <span class="dv">20</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;lightgoldenrodyellow&quot; &quot;mediumorchid1&quot;        &quot;gray26&quot;              
##  [4] &quot;palevioletred2&quot;       &quot;gray42&quot;               &quot;deeppink2&quot;           
##  [7] &quot;grey38&quot;               &quot;gray76&quot;               &quot;gray91&quot;              
## [10] &quot;azure1&quot;               &quot;indianred2&quot;           &quot;slategray3&quot;          
## [13] &quot;slategray4&quot;           &quot;darkorange1&quot;          &quot;grey87&quot;              
## [16] &quot;grey94&quot;               &quot;blue&quot;                 &quot;paleturquoise&quot;       
## [19] &quot;lightsalmon2&quot;         &quot;gray58&quot;</code></pre>
<p>As we can see that <code>colors()</code> function produces color names, we can use color names directly while plotting.</p>
<div class="sourceCode" id="cb2163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2163-1"><a href="#cb2163-1" tabindex="-1"></a><span class="co"># In base R</span></span>
<span id="cb2163-2"><a href="#cb2163-2" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;lightgoldenrodyellow&quot;</span>, <span class="st">&quot;mediumorchid1&quot;</span>, <span class="st">&quot;indianred2&quot;</span>, <span class="st">&quot;paleturquoise&quot;</span>))</span></code></pre></div>
<p><img src="DauR_files/figure-html/unnamed-chunk-593-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Or alternatively, we can use HEX color code values for these colors.</p>
<div class="sourceCode" id="cb2164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2164-1"><a href="#cb2164-1" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;#fedcba&quot;</span>, <span class="st">&quot;#abcdef&quot;</span>, <span class="st">&quot;#123456&quot;</span>, <span class="st">&quot;#654321&quot;</span>))</span></code></pre></div>
<p><img src="DauR_files/figure-html/unnamed-chunk-594-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In the following plot, readers may see random 100 colors printed from the <code>colors()</code> in R.</p>
<p><img src="DauR_files/figure-html/unnamed-chunk-595-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="colors-by-hex-values" class="section level2" number="45.2">
<h2><span class="header-section-number">45.2</span> Colors by hex values</h2>
<p>Colors in R can also be directly selected by entering the hex value of the color preceded by a <code>#</code> hash character. These hex values generally contain six hexadecimal digits, out of which-</p>
<ul>
<li>first two represent hex value of <code>red</code></li>
<li>next two represent <code>green</code></li>
<li>and last two represent <code>blue</code></li>
</ul>
<p>thus forming rgb/RGB value of a color. Readers may already know that there are sixteen hexadecimal digits, <code>0</code>, <code>1</code>, <code>2</code>, <code>3</code>, <code>4</code>, <code>5</code>, <code>6</code>, <code>7</code>, <code>8</code>, <code>9</code>, <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>, <code>e</code> and <code>f</code>. So two hexadecimal digits actually represent <span class="math inline">\(16{\times}16 = 256\)</span> values in base-10. Thus,</p>
<ul>
<li><code>#000000</code> represents perfect black (no color at all)</li>
<li><code>#ff0000</code> represents red color</li>
<li><code>#00ff00</code> represents green color</li>
<li><code>#0000ff</code> represents blue color</li>
<li><code>#ffffff</code> represents white color.</li>
</ul>
<p>See the following example.</p>
<div class="sourceCode" id="cb2165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2165-1"><a href="#cb2165-1" tabindex="-1"></a><span class="fu">barplot</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;#000000&quot;</span>, <span class="st">&quot;#ff0000&quot;</span>, <span class="st">&quot;#ffff00&quot;</span>, <span class="st">&quot;#00ffff&quot;</span>, <span class="st">&quot;#ff00ff&quot;</span>), <span class="at">main =</span> <span class="st">&quot;Some primary color Mixing&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/unnamed-chunk-596-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="color-palettes-in-base-r" class="section level2" number="45.3">
<h2><span class="header-section-number">45.3</span> Color palettes in Base R</h2>
<p>A color palette is a combination of colors used by UI designers when designing an interface. Base R has certain palettes that may be used in visualizations.</p>
<div class="sourceCode" id="cb2166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2166-1"><a href="#cb2166-1" tabindex="-1"></a><span class="fu">heat.colors</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;#FF0000&quot; &quot;#FF5500&quot; &quot;#FFAA00&quot; &quot;#FFFF00&quot; &quot;#FFFF80&quot;</code></pre>
<div class="sourceCode" id="cb2168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2168-1"><a href="#cb2168-1" tabindex="-1"></a><span class="fu">rainbow</span>(<span class="dv">7</span>)</span></code></pre></div>
<pre><code>## [1] &quot;#FF0000&quot; &quot;#FFDB00&quot; &quot;#49FF00&quot; &quot;#00FF92&quot; &quot;#0092FF&quot; &quot;#4900FF&quot; &quot;#FF00DB&quot;</code></pre>
<div class="sourceCode" id="cb2170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2170-1"><a href="#cb2170-1" tabindex="-1"></a><span class="fu">terrain.colors</span>(<span class="dv">6</span>)</span></code></pre></div>
<pre><code>## [1] &quot;#00A600&quot; &quot;#63C600&quot; &quot;#E6E600&quot; &quot;#EAB64E&quot; &quot;#EEB99F&quot; &quot;#F2F2F2&quot;</code></pre>
<div class="sourceCode" id="cb2172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2172-1"><a href="#cb2172-1" tabindex="-1"></a><span class="fu">topo.colors</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;#4C00FF&quot; &quot;#004CFF&quot; &quot;#00E5FF&quot; &quot;#00FF4D&quot; &quot;#FFFF00&quot;</code></pre>
<div class="sourceCode" id="cb2174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2174-1"><a href="#cb2174-1" tabindex="-1"></a><span class="fu">cm.colors</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] &quot;#80FFFF&quot; &quot;#BFFFFF&quot; &quot;#FFBFFF&quot; &quot;#FF80FF&quot;</code></pre>
<div class="sourceCode" id="cb2176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2176-1"><a href="#cb2176-1" tabindex="-1"></a><span class="fu">hcl.colors</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;#4B0055&quot; &quot;#00588B&quot; &quot;#009B95&quot; &quot;#53CC67&quot; &quot;#FDE333&quot;</code></pre>
<p>See colors in action in the following plots</p>
<div class="sourceCode" id="cb2178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2178-1"><a href="#cb2178-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb2178-2"><a href="#cb2178-2" tabindex="-1"></a><span class="fu">barplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">5</span>), <span class="at">main =</span> <span class="st">&quot;Heat Colors&quot;</span>)</span>
<span id="cb2178-3"><a href="#cb2178-3" tabindex="-1"></a><span class="fu">barplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="dv">7</span>), <span class="at">main =</span> <span class="st">&quot;Rainbow colors&quot;</span>)</span>
<span id="cb2178-4"><a href="#cb2178-4" tabindex="-1"></a><span class="fu">barplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">col =</span> <span class="fu">terrain.colors</span>(<span class="dv">7</span>), <span class="at">main =</span> <span class="st">&quot;Terrain Colors&quot;</span>)</span>
<span id="cb2178-5"><a href="#cb2178-5" tabindex="-1"></a><span class="fu">barplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">col =</span> <span class="fu">topo.colors</span>(<span class="dv">5</span>), <span class="at">main =</span> <span class="st">&quot;Topgraphical Colors&quot;</span>)</span>
<span id="cb2178-6"><a href="#cb2178-6" tabindex="-1"></a><span class="fu">barplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">col =</span> <span class="fu">cm.colors</span>(<span class="dv">6</span>), <span class="at">main =</span> <span class="st">&quot;CM colors&quot;</span>)</span>
<span id="cb2178-7"><a href="#cb2178-7" tabindex="-1"></a><span class="fu">barplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">col =</span> <span class="fu">hcl.colors</span>(<span class="dv">7</span>), <span class="at">main =</span> <span class="st">&quot;HCL Colors&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/unnamed-chunk-598-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="color-brewer" class="section level2" number="45.4">
<h2><span class="header-section-number">45.4</span> Color Brewer</h2>
<p>There are some color palettes created specifically for the purpose and which let us choose best colors for story telling. <a href="https://en.wikipedia.org/wiki/Cynthia_Brewer">Cynthia Brewer</a> an American cartographer, who worked on visibility and color theory in cartography developed colorblind-friendly sets of colors, known as the Brewer palettes. <code>RColorBrewer</code> package in R presents us those palettes for use in our data visualizations.</p>
<p>Let us load the package and display all available palettes there.</p>
<div class="sourceCode" id="cb2179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2179-1"><a href="#cb2179-1" tabindex="-1"></a><span class="co">#install.packages(&quot;RColorBrewer&quot;)</span></span>
<span id="cb2179-2"><a href="#cb2179-2" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb2179-3"><a href="#cb2179-3" tabindex="-1"></a><span class="fu">display.brewer.all</span>()</span></code></pre></div>
<p><img src="images/brewer.png" width="600" style="display: block; margin: auto;" /></p>
<p>These are actually divided into three categories, namely-</p>
<ul>
<li><em>Sequential</em>: For use preferably with continuous scales;</li>
<li><em>Qualitative</em>: To be used for non-ordered categorical things – such as factor, like country or continent;</li>
<li><em>Diverging</em>: For use in continuous scales showing two diverging trends like positives and negatives, etc.</li>
</ul>
<p>To display a single palette, we can use <code>display.brewer.pal(n, name)</code> where <code>n</code> and <code>name</code> are arguments requiring number of colors and palette name respectively.</p>
<div class="sourceCode" id="cb2180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2180-1"><a href="#cb2180-1" tabindex="-1"></a><span class="co"># View a single RColorBrewer palette by specifying its name</span></span>
<span id="cb2180-2"><a href="#cb2180-2" tabindex="-1"></a><span class="fu">display.brewer.pal</span>(<span class="at">n =</span> <span class="dv">7</span>, <span class="at">name =</span> <span class="st">&#39;BrBG&#39;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/unnamed-chunk-599-1.png" width="672" height="20%" style="display: block; margin: auto;" /></p>
<p>See the following examples showing us to pick color palette using</p>
<ul>
<li><code>scale_fill_brewer</code> or <code>scale_color_brewer</code> in ggplot2</li>
<li><code>brewer.pal</code> in base R plots.</li>
</ul>
<div class="sourceCode" id="cb2181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2181-1"><a href="#cb2181-1" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb2181-2"><a href="#cb2181-2" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(year, <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb2181-3"><a href="#cb2181-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb2181-4"><a href="#cb2181-4" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/unnamed-chunk-600-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb2182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2182-1"><a href="#cb2182-1" tabindex="-1"></a><span class="co"># Bar-plot using RColorBrewer</span></span>
<span id="cb2182-2"><a href="#cb2182-2" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">3</span>), <span class="at">col =</span> <span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">name =</span> <span class="st">&quot;Accent&quot;</span>))</span></code></pre></div>
<p><img src="DauR_files/figure-html/unnamed-chunk-601-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="package-colorspace" class="section level2" number="45.5">
<h2><span class="header-section-number">45.5</span> Package <code>colorspace</code></h2>
<p>The colorspace package provides a broad toolbox for selecting individual colors or color palettes, manipulating these colors, and employing them in various kinds of visualizations.</p>
<p>The colorspace package provides three types of palettes based on the HCL model:</p>
<ul>
<li><strong>Qualitative</strong>: Designed for coding categorical information, i.e., where no particular ordering of categories is available and every color should receive the same perceptual weight. Function: <code>qualitative_hcl()</code>.</li>
<li><strong>Sequential</strong>: Designed for coding ordered/numeric information, i.e., where colors go from high to low (or vice versa). Function: <code>sequential_hcl()</code>.</li>
<li><strong>Diverging</strong>: Designed for coding ordered/numeric information around a central neutral value, i.e., where colors diverge from neutral to two extremes. Function: <code>diverging_hcl()</code>.</li>
</ul>
<p>A quick overview can be gained easily with the <code>hcl_palettes()</code> function:</p>
<div class="sourceCode" id="cb2183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2183-1"><a href="#cb2183-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;colorspace&quot;</span>)</span>
<span id="cb2183-2"><a href="#cb2183-2" tabindex="-1"></a><span class="fu">hcl_palettes</span>(<span class="at">plot =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/unnamed-chunk-602-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>To provide access to the HCL color palettes from within <code>ggplot2</code> graphics suitable discrete and/or continuous ggplot2 color scales are provided. The scales are named via the scheme <code>scale_&lt;aesthetic&gt;_&lt;datatype&gt;_&lt;colorscale&gt;()</code>, where <code>&lt;aesthetic&gt;</code> is the name of the aesthetic (<code>fill</code>, <code>color</code>, <code>colour</code>), <code>&lt;datatype&gt;</code> is the type of the variable plotted (discrete or continuous) and <code>&lt;colorscale&gt;</code> sets the type of the color scale used (<code>qualitative</code>, <code>sequential</code>, <code>diverging</code>, <code>divergingx</code>).</p>
<p>To illustrate <code>diverging</code> color palette, we can plot figure @ref(fig:colorex), as</p>
<div class="sourceCode" id="cb2184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2184-1"><a href="#cb2184-1" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span></span>
<span id="cb2184-2"><a href="#cb2184-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">hwy =</span> <span class="fu">mean</span>(hwy), <span class="at">.by =</span> class) <span class="sc">%&gt;%</span></span>
<span id="cb2184-3"><a href="#cb2184-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fu">fct_reorder</span>(class, hwy)) <span class="sc">%&gt;%</span></span>
<span id="cb2184-4"><a href="#cb2184-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> class, <span class="at">x =</span> hwy, <span class="at">fill =</span> hwy)) <span class="sc">+</span></span>
<span id="cb2184-5"><a href="#cb2184-5" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb2184-6"><a href="#cb2184-6" tabindex="-1"></a>  <span class="fu">scale_fill_continuous_diverging</span>(<span class="at">palette =</span> <span class="st">&quot;Red-Green&quot;</span>, <span class="at">mid =</span> <span class="fu">mean</span>(mpg<span class="sc">$</span>hwy)) <span class="sc">+</span></span>
<span id="cb2184-7"><a href="#cb2184-7" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(mpg<span class="sc">$</span>hwy)), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2184-8"><a href="#cb2184-8" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2184-9"><a href="#cb2184-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Class wise Mean Highway mileage of cars&quot;</span>)</span></code></pre></div>
<p><img src="DauR_files/figure-html/unnamed-chunk-603-1.png" width="672" style="display: block; margin: auto;" /></p>
<hr />
<!--chapter:end:97-colors.Rmd-->
</div>
</div>
<div id="various-datasets-in-base-r-used-in-this-book" class="section level1" number="46">
<h1><span class="header-section-number">46</span> Various Datasets, in base R, used in this book</h1>
<ul>
<li><p><code>Nile</code>:
Measurements of the annual flow of the river Nile at Aswan (formerly
‘Assuan’), 1871-1970, in 10^8 m^3, “with apparent changepoint near
1898” (Cobb(1978), Table 1, p.249).</p></li>
<li><p><code>lynx</code>:
Annual numbers of lynx trappings for 1821-1934 in Canada. Taken from
Brockwell &amp; Davis (1991), this appears to be the series considered by
Campbell &amp; Walker (1977).</p></li>
<li><p><code>mtcars</code>:
The data was extracted from the 1974 <em>Motor Trend</em> US magazine, and
comprises fuel consumption and 10 aspects of automobile design and
performance for 32 automobiles (1973-74 models).</p></li>
<li><p><code>sunspot.month</code>:
Monthly numbers of sunspots, as from the World Data Center, aka SIDC.
This is the version of the data that will occasionally be updated when
new counts become available.</p></li>
<li><p><code>nhtemp</code>:
The mean annual temperature in degrees Fahrenheit in New Haven,
Connecticut, from 1912 to 1971.</p></li>
<li><p><code>airquality</code>:
Daily air quality measurements in New York, May to September 1973.</p></li>
<li><p><code>JohnsonJohnson</code>:
Quarterly earnings (dollars) per Johnson &amp; Johnson share 1960-80.</p></li>
<li><p><code>iris</code>:
This famous (Fisher’s or Anderson’s) iris data set gives the
measurements in centimeters of the variables sepal length and width and
petal length and width, respectively, for 50 flowers from each of 3</p></li>
<li><p><code>attitude</code>:
From a survey of the clerical employees of a large financial
organization, the data are aggregated from the questionnaires of the
approximately 35 employees for each of 30 (randomly selected)
departments. The numbers give the percent proportion of favourable
responses to seven questions in each department.</p></li>
<li><p><code>longley</code>:
A macroeconomic data set which provides a well-known example for a
highly collinear regression.</p></li>
<li><p><code>USArrests</code>:
This data set contains statistics, in arrests per 100,000 residents for
assault, murder, and rape in each of the 50 US states in 1973. Also
given is the percent of the population living in urban areas.</p></li>
<li><p><code>state.x77</code>:
Data sets related to the 50 states of the United States of America.</p></li>
</ul>
<!--chapter:end:98-datasets.Rmd-->
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<!--chapter:end:99-references.Rmd-->
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-R-magrittr" class="csl-entry">
Bache, Stefan Milton, and Hadley Wickham. <em>Magrittr: A Forward-Pipe Operator for r</em>, 2022. <a href="https://magrittr.tidyverse.org">https://magrittr.tidyverse.org</a>.
</div>
<div id="ref-frank_ben" class="csl-entry">
Benford, Frank. <span>“The Law of Anomalous Numbers.”</span> <em>Proceedings of the American Philosophical Society</em> 78, no. 4 (1938): 551–72. <a href="http://www.jstor.org/stable/984802">http://www.jstor.org/stable/984802</a>.
</div>
<div id="ref-R-igraph" class="csl-entry">
Csárdi, Gábor, Tamás Nepusz, Vincent Traag, Szabolcs Horvát, Fabio Zanini, Daniel Noom, and Kirill Müller. <em>Igraph: Network Analysis and Visualization</em>, 2024. <a href="https://r.igraph.org/">https://r.igraph.org/</a>.
</div>
<div id="ref-mcke" class="csl-entry">
Gardner, Everette S., and Ed. Mckenzie. <span>“Forecasting Trends in Time Series.”</span> <em>Management Science</em> 31, no. 10 (1985): 1237–46. <a href="https://doi.org/10.1287/mnsc.31.10.1237">https://doi.org/10.1287/mnsc.31.10.1237</a>.
</div>
<div id="ref-t_hill" class="csl-entry">
Hill, Theodore P. <span>“The Significant-Digit Phenomenon.”</span> <em>The American Mathematical Monthly</em> 102, no. 4 (1995): 322–27. <a href="http://www.jstor.org/stable/2974952">http://www.jstor.org/stable/2974952</a>.
</div>
<div id="ref-10.2307/1390807" class="csl-entry">
Ihaka, Ross, and Robert Gentleman. <span>“R: A Language for Data Analysis and Graphics.”</span> <em>Journal of Computational and Graphical Statistics</em> 5, no. 3 (1996): 299–314. <a href="http://www.jstor.org/stable/1390807">http://www.jstor.org/stable/1390807</a>.
</div>
<div id="ref-newcomb" class="csl-entry">
Newcomb, Simon. <span>“Note on the Frequency of Use of the Different Digits in Natural Numbers.”</span> <em>American Journal of Mathematics</em> 4, no. 1 (1881): 39–40. <a href="http://www.jstor.org/stable/2369148">http://www.jstor.org/stable/2369148</a>.
</div>
<div id="ref-nigrinifraud" class="csl-entry">
Nigrini, Mark J. <em>Benford’s Law Applications for Forensic Accounting, Auditing and Fraud Detection</em>. 1st ed. John Wiley; Sons, Ltd, 2012. <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119203094.ch5">https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119203094.ch5</a>.
</div>
<div id="ref-article2007" class="csl-entry">
Nigrini, Mark, and Steven Miller. <span>“Benford’s Law Applied to Hydrology Data—Results and Relevance to Other Geophysical Data.”</span> <em>Mathematical Geology</em> 39 (September 2007): 469–90. <a href="https://doi.org/10.1007/s11004-007-9109-5">https://doi.org/10.1007/s11004-007-9109-5</a>.
</div>
<div id="ref-article2009" class="csl-entry">
———. <span>“Data Diagnostics Using Second-Order Tests of Benford’s Law.”</span> <em>Auditing-a Journal of Practice and Theory - AUDITING-J PRACT THEOR</em> 28 (November 2009). <a href="https://doi.org/10.2308/aud.2009.28.2.305">https://doi.org/10.2308/aud.2009.28.2.305</a>.
</div>
<div id="ref-pinkham" class="csl-entry">
Pinkham, Roger S. <span>“<span class="nocase">On the Distribution of First Significant Digits</span>.”</span> <em>The Annals of Mathematical Statistics</em> 32, no. 4 (1961): 1223–30. <a href="https://doi.org/10.1214/aoms/1177704862">https://doi.org/10.1214/aoms/1177704862</a>.
</div>
<div id="ref-R-base" class="csl-entry">
R Core Team. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing, 2024. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-layered-grammar" class="csl-entry">
Wickham, Hadley. <span>“A Layered Grammar of Graphics.”</span> <em>Journal of Computational and Graphical Statistics</em> 19, no. 1 (2010): 3–28. <a href="https://doi.org/10.1198/jcgs.2009.07098">https://doi.org/10.1198/jcgs.2009.07098</a>.
</div>
<div id="ref-JSSv021i12" class="csl-entry">
———. <span>“Reshaping Data with the Reshape Package.”</span> <em>Journal of Statistical Software</em> 21, no. 12 (2007): 1–20. <a href="https://doi.org/10.18637/jss.v021.i12">https://doi.org/10.18637/jss.v021.i12</a>.
</div>
<div id="ref-JSSv059i10" class="csl-entry">
———. <span>“Tidy Data.”</span> <em>Journal of Statistical Software</em> 59, no. 10 (2014): 1–23. <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
<div id="ref-R-ggplot2" class="csl-entry">
Wickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, Dewey Dunnington, and Teun van den Brand. <em>Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics</em>, 2024. <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-R-dplyr" class="csl-entry">
Wickham, Hadley, Romain François, Lionel Henry, Kirill Müller, and Davis Vaughan. <em>Dplyr: A Grammar of Data Manipulation</em>, 2023. <a href="https://dplyr.tidyverse.org">https://dplyr.tidyverse.org</a>.
</div>
<div id="ref-R-readr" class="csl-entry">
Wickham, Hadley, Jim Hester, and Jennifer Bryan. <em>Readr: Read Rectangular Text Data</em>, 2024. <a href="https://readr.tidyverse.org">https://readr.tidyverse.org</a>.
</div>
<div id="ref-R-tidyr" class="csl-entry">
Wickham, Hadley, Davis Vaughan, and Maximilian Girlich. <em>Tidyr: Tidy Messy Data</em>, 2024. <a href="https://tidyr.tidyverse.org">https://tidyr.tidyverse.org</a>.
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Ross Ihaka and Robert Gentleman, <span>“R: A Language for Data Analysis and Graphics,”</span> <em>Journal of Computational and Graphical Statistics</em> 5, no. 3 (1996): 299–314, <a href="http://www.jstor.org/stable/1390807">http://www.jstor.org/stable/1390807</a>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><a href="https://stackoverflow.com/tags/rstudio/info">https://stackoverflow.com/tags/rstudio/info</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>R Core Team, <em>R: A Language and Environment for Statistical Computing</em> (Vienna, Austria: R Foundation for Statistical Computing, 2024), <a href="https://www.R-project.org/">https://www.R-project.org/</a>.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Single and double quotes can be used interchangeably and won’t have any difference in the objects created using any of these. Only thing that should be kept in mind is that the quote used to start the string must be used to close the string, otherwise an error may be thrown. However, this may be used to store objects with either type of string in the data itself.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Stefan Milton Bache and Hadley Wickham, <em>Magrittr: A Forward-Pipe Operator for r</em>, 2022, <a href="https://magrittr.tidyverse.org">https://magrittr.tidyverse.org</a>.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Alan Turing, who created Turing machine which in turn laid the foundation of imperative programming style, was a student of <strong>Alonzo Church</strong>.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p><a href="https://purrr.tidyverse.org/">https://purrr.tidyverse.org/</a><a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Source: <a href="https://adv-r.hadley.nz/functionals.html">Advanced R</a> by Hadley Wickham<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>If backward slash <code>\</code> is used in file paths, these must be <code>escaped</code> as R recognises <code>\</code> as escape character itself. So, <code>"my/location/here/file.txt"</code> and <code>"my\\file\\here\\file.txt"</code> are the correct way of giving file name<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>Hadley Wickham, Jim Hester, and Jennifer Bryan, <em>Readr: Read Rectangular Text Data</em>, 2024, <a href="https://readr.tidyverse.org">https://readr.tidyverse.org</a>.<a href="#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p><a href="https://www.tidyverse.org/help/" class="uri">https://www.tidyverse.org/help/</a><a href="#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p><a href="https://statmodeling.stat.columbia.edu/2021/05/14/tableau-and-the-grammar-of-graphics/">https://statmodeling.stat.columbia.edu/2021/05/14/tableau-and-the-grammar-of-graphics/</a><a href="#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>The “pressure” dataset contains measurements of vapor pressure of mercury as a function of temperature, measured at 10 different times. The line plot will show the trend of vapor pressure over time.<a href="#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p>a base R data-set having the counts of insects in agricultural experimental units treated with different insecticides.<a href="#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p><a href="https://ggplot2.tidyverse.org/" class="uri">https://ggplot2.tidyverse.org/</a><a href="#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>Hadley Wickham et al., <em>Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics</em>, 2024, <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.<a href="#fnref16" class="footnote-back">↩︎</a></p></li>
<li id="fn17"><p><a href="https://link.springer.com/book/10.1007/0-387-28695-0" class="uri">https://link.springer.com/book/10.1007/0-387-28695-0</a><a href="#fnref17" class="footnote-back">↩︎</a></p></li>
<li id="fn18"><p><a href="http://vita.had.co.nz/papers/layered-grammar.pdf" class="uri">http://vita.had.co.nz/papers/layered-grammar.pdf</a><a href="#fnref18" class="footnote-back">↩︎</a></p></li>
<li id="fn19"><p>Hadley Wickham, <span>“A Layered Grammar of Graphics,”</span> <em>Journal of Computational and Graphical Statistics</em> 19, no. 1 (2010): 3–28, <a href="https://doi.org/10.1198/jcgs.2009.07098">https://doi.org/10.1198/jcgs.2009.07098</a>.<a href="#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p>Version 3.3.0 was released in March 2020<a href="#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p>Source: Hadley Wickham’s paper on <em>the layered grammar of graphics</em><a href="#fnref21" class="footnote-back">↩︎</a></p></li>
<li id="fn22"><p>Hadley Wickham et al., <em>Dplyr: A Grammar of Data Manipulation</em>, 2023, <a href="https://dplyr.tidyverse.org">https://dplyr.tidyverse.org</a>.<a href="#fnref22" class="footnote-back">↩︎</a></p></li>
<li id="fn23"><p>Hadley Wickham, Davis Vaughan, and Maximilian Girlich, <em>Tidyr: Tidy Messy Data</em>, 2024, <a href="https://tidyr.tidyverse.org">https://tidyr.tidyverse.org</a>.<a href="#fnref23" class="footnote-back">↩︎</a></p></li>
<li id="fn24"><p><a href="https://www.jstatsoft.org/article/view/v059i10">https://www.jstatsoft.org/article/view/v059i10</a><a href="#fnref24" class="footnote-back">↩︎</a></p></li>
<li id="fn25"><p>Hadley Wickham, <span>“Tidy Data,”</span> <em>Journal of Statistical Software</em> 59, no. 10 (2014): 1–23, <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.<a href="#fnref25" class="footnote-back">↩︎</a></p></li>
<li id="fn26"><p>Hadley Wickham, <span>“Reshaping Data with the Reshape Package,”</span> <em>Journal of Statistical Software</em> 21, no. 12 (2007): 1–20, <a href="https://doi.org/10.18637/jss.v021.i12">https://doi.org/10.18637/jss.v021.i12</a>.<a href="#fnref26" class="footnote-back">↩︎</a></p></li>
<li id="fn27"><p>Image taken from Hadley Wickham’s book <a href="https://r4ds.had.co.nz/">R for data science</a><a href="#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p>all taken from package <code>tidyr</code><a href="#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p>These data-tables display the number of TB cases documented by the World Health Organization in Afghanistan, Brazil, and China between 1999 and 2000. The data contains values associated with four variables (country, year, cases, and population), but each table organizes the values in a different layout.<a href="#fnref29" class="footnote-back">↩︎</a></p></li>
<li id="fn30"><p><a href="https://www.ifac.org/system/files/downloads/a027-2010-iaasb-handbook-isa-530.pdf">https://www.ifac.org/system/files/downloads/a027-2010-iaasb-handbook-isa-530.pdf</a><a href="#fnref30" class="footnote-back">↩︎</a></p></li>
<li id="fn31"><p>Everette S. Gardner and Ed. Mckenzie, <span>“Forecasting Trends in Time Series,”</span> <em>Management Science</em> 31, no. 10 (1985): 1237–46, <a href="https://doi.org/10.1287/mnsc.31.10.1237">https://doi.org/10.1287/mnsc.31.10.1237</a>.<a href="#fnref31" class="footnote-back">↩︎</a></p></li>
<li id="fn32"><p>Loess is a method for estimating nonlinear relationships<a href="#fnref32" class="footnote-back">↩︎</a></p></li>
<li id="fn33"><p><a href="https://en.wikipedia.org/wiki/Graph_theory">https://en.wikipedia.org/wiki/Graph_theory</a><a href="#fnref33" class="footnote-back">↩︎</a></p></li>
<li id="fn34"><p>Gábor Csárdi et al., <em>Igraph: Network Analysis and Visualization</em>, 2024, <a href="https://r.igraph.org/">https://r.igraph.org/</a>.<a href="#fnref34" class="footnote-back">↩︎</a></p></li>
<li id="fn35"><p>Dont repeat yourself<a href="#fnref35" class="footnote-back">↩︎</a></p></li>
<li id="fn36"><p>Data Source: <a href="https://www.indiabudget.gov.in/">Indian Budget Portal</a><a href="#fnref36" class="footnote-back">↩︎</a></p></li>
<li id="fn37"><p>Frank Benford, <span>“The Law of Anomalous Numbers,”</span> <em>Proceedings of the American Philosophical Society</em> 78, no. 4 (1938): 551–72, <a href="http://www.jstor.org/stable/984802">http://www.jstor.org/stable/984802</a>.<a href="#fnref37" class="footnote-back">↩︎</a></p></li>
<li id="fn38"><p>Simon Newcomb, <span>“Note on the Frequency of Use of the Different Digits in Natural Numbers,”</span> <em>American Journal of Mathematics</em> 4, no. 1 (1881): 39–40, <a href="http://www.jstor.org/stable/2369148">http://www.jstor.org/stable/2369148</a>.<a href="#fnref38" class="footnote-back">↩︎</a></p></li>
<li id="fn39"><p>Roger S. Pinkham, <span>“<span class="nocase">On the Distribution of First Significant Digits</span>,”</span> <em>The Annals of Mathematical Statistics</em> 32, no. 4 (1961): 1223–30, <a href="https://doi.org/10.1214/aoms/1177704862">https://doi.org/10.1214/aoms/1177704862</a>.<a href="#fnref39" class="footnote-back">↩︎</a></p></li>
<li id="fn40"><p>Theodore P. Hill, <span>“The Significant-Digit Phenomenon,”</span> <em>The American Mathematical Monthly</em> 102, no. 4 (1995): 322–27, <a href="http://www.jstor.org/stable/2974952">http://www.jstor.org/stable/2974952</a>.<a href="#fnref40" class="footnote-back">↩︎</a></p></li>
<li id="fn41"><p>Mark Nigrini and Steven Miller, <span>“Data Diagnostics Using Second-Order Tests of Benford’s Law,”</span> <em>Auditing-a Journal of Practice and Theory - AUDITING-J PRACT THEOR</em> 28 (November 2009), <a href="https://doi.org/10.2308/aud.2009.28.2.305">https://doi.org/10.2308/aud.2009.28.2.305</a>.<a href="#fnref41" class="footnote-back">↩︎</a></p></li>
<li id="fn42"><p>Mark J Nigrini, <em>Benford’s Law Applications for Forensic Accounting, Auditing and Fraud Detection</em>, 1st ed. (John Wiley; Sons, Ltd, 2012), <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119203094.ch5">https://onlinelibrary.wiley.com/doi/abs/10.1002/9781119203094.ch5</a>.<a href="#fnref42" class="footnote-back">↩︎</a></p></li>
<li id="fn43"><p><a href="https://www.itl.nist.gov/div898/handbook/eda/section3/eda3674.htm">https://www.itl.nist.gov/div898/handbook/eda/section3/eda3674.htm</a><a href="#fnref43" class="footnote-back">↩︎</a></p></li>
<li id="fn44"><p>A dataset of the perimeter of the lakes arround the water from the global lakes and wetlands database (GLWD) <a href="http://www.worldwildlife.org/pages/global-lakes-and-wetlands-database" class="uri">http://www.worldwildlife.org/pages/global-lakes-and-wetlands-database</a><a href="#fnref44" class="footnote-back">↩︎</a></p></li>
<li id="fn45"><p>Mark Nigrini and Steven Miller, <span>“Benford’s Law Applied to Hydrology Data—Results and Relevance to Other Geophysical Data,”</span> <em>Mathematical Geology</em> 39 (September 2007): 469–90, <a href="https://doi.org/10.1007/s11004-007-9109-5">https://doi.org/10.1007/s11004-007-9109-5</a>.<a href="#fnref45" class="footnote-back">↩︎</a></p></li>
<li id="fn46"><p>Monthly numbers of sunspots, as from the World Data Center, aka SIDC. This is the version of the data that will occasionally be updated when new counts become available.<a href="#fnref46" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<!--bookdown:body:end-->
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Audit Analytics</strong>" was written by Anil Goyal. It was last built on 2024-11-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
