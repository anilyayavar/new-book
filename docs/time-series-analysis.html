<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 25 Time Series Analysis | R for Audit Analytics</title>
<meta name="author" content="Anil Goyal">
<meta name="description" content="Time series analysis is an essential technique for forecasting and analyzing trends in data over time. It is commonly used in various fields like finance, economics, and engineering. So a question...">
<meta name="generator" content="bookdown 0.40 with bs4_book()">
<meta property="og:title" content="Chapter 25 Time Series Analysis | R for Audit Analytics">
<meta property="og:type" content="book">
<meta property="og:description" content="Time series analysis is an essential technique for forecasting and analyzing trends in data over time. It is commonly used in various fields like finance, economics, and engineering. So a question...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 25 Time Series Analysis | R for Audit Analytics">
<meta name="twitter:description" content="Time series analysis is an essential technique for forecasting and analyzing trends in data over time. It is commonly used in various fields like finance, economics, and engineering. So a question...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Audit Analytics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome to R for Audit Analytics</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="about-author.html">About author</a></li>
<li><a class="" href="gearing-up.html">Gearing up</a></li>
<li><a class="" href="part-i-basic-r-programming-concepts.html">Part-I: Basic R Programming Concepts</a></li>
<li><a class="" href="r-programming-language.html"><span class="header-section-number">1</span> R Programming Language</a></li>
<li><a class="" href="subset.html"><span class="header-section-number">2</span> Subsetting R objects or accesing specific elements</a></li>
<li><a class="" href="func.html"><span class="header-section-number">3</span> Functions and operations in R</a></li>
<li><a class="" href="existing-and-useful-functions-in-base-r.html"><span class="header-section-number">4</span> Existing and useful functions in base R</a></li>
<li><a class="" href="pipes-in-r.html"><span class="header-section-number">5</span> Pipes in R</a></li>
<li><a class="" href="control-statements.html"><span class="header-section-number">6</span> Control statements</a></li>
<li><a class="" href="functional-programming.html"><span class="header-section-number">7</span> Functional Programming</a></li>
<li><a class="" href="file.html"><span class="header-section-number">8</span> File handling operations in R</a></li>
<li><a class="" href="read.html"><span class="header-section-number">9</span> Getting data in and out of R</a></li>
<li><a class="" href="data-cleaning-in-r.html"><span class="header-section-number">10</span> Data Cleaning in R</a></li>
<li><a class="" href="merging-large-number-of-similar-datasets-into-one.html"><span class="header-section-number">11</span> Merging large number of similar datasets into one</a></li>
<li><a class="" href="part-ii-exploratory-data-analysis.html">Part-II: Exploratory Data Analysis</a></li>
<li><a class="" href="visualisations-in-base-r.html"><span class="header-section-number">12</span> Visualisations in Base R</a></li>
<li><a class="" href="visualising-data-with-ggplot2.html"><span class="header-section-number">13</span> Visualising data with ggplot2</a></li>
<li><a class="" href="data-transformation-in-dplyr.html"><span class="header-section-number">14</span> Data Transformation in dplyr</a></li>
<li><a class="" href="combining-tablestabular-data.html"><span class="header-section-number">15</span> Combining Tables/tabular data</a></li>
<li><a class="" href="data-wrangling-in-tidyr.html"><span class="header-section-number">16</span> Data Wrangling in tidyr</a></li>
<li><a class="" href="generating-descriptive-statistics.html"><span class="header-section-number">17</span> Generating Descriptive statistics</a></li>
<li><a class="" href="part-iii-probability-and-sampling-in-r.html">Part-III: Probability and Sampling in R</a></li>
<li><a class="" href="probability-in-r.html"><span class="header-section-number">18</span> Probability in R</a></li>
<li><a class="" href="random-sampling-in-r.html"><span class="header-section-number">19</span> Random sampling in R</a></li>
<li><a class="" href="part-iv-machine-learning-in-r.html">Part-IV: Machine Learning in R</a></li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">20</span> Linear Regression</a></li>
<li><a class="" href="principal-component-analysis-in-r.html"><span class="header-section-number">21</span> Principal Component Analysis in R</a></li>
<li><a class="" href="clustering-in-r-using-kmeans-algorithm.html"><span class="header-section-number">22</span> Clustering in R (Using Kmeans algorithm)</a></li>
<li><a class="" href="association-rule-mining-in-r-apriori.html"><span class="header-section-number">23</span> Association Rule Mining in R (Apriori)</a></li>
<li><a class="" href="part-v-time-series-analysis.html">Part-V: Time Series Analysis</a></li>
<li><a class="" href="manipulating-datedate-time-objects-using-lubridate.html"><span class="header-section-number">24</span> Manipulating Date/Date-time objects using lubridate</a></li>
<li><a class="active" href="time-series-analysis.html"><span class="header-section-number">25</span> Time Series Analysis</a></li>
<li><a class="" href="part-vi-network-analytics.html">Part VI: Network Analytics</a></li>
<li><a class="" href="network-analyticsgraph-theory-in-r.html"><span class="header-section-number">26</span> Network Analytics/Graph theory in R</a></li>
<li><a class="" href="applying-network-analysis-in-auditfraud-detection.html"><span class="header-section-number">27</span> Applying network analysis in audit/fraud detection</a></li>
<li><a class="" href="part-vii-text-analytics-in-r.html">Part-VII: Text Analytics in R</a></li>
<li><a class="" href="string-manipulation-in-stringr.html"><span class="header-section-number">28</span> String manipulation in stringr</a></li>
<li><a class="" href="regex---a-quick-introduction.html"><span class="header-section-number">29</span> Regex - A quick introduction</a></li>
<li><a class="" href="regex-in-human-readble-format-using-rebus.html"><span class="header-section-number">30</span> Regex in human readble format using rebus</a></li>
<li><a class="" href="text-analytics-in-r.html"><span class="header-section-number">31</span> Text Analytics in R</a></li>
<li><a class="" href="sentiment-analysis.html"><span class="header-section-number">32</span> Sentiment Analysis</a></li>
<li><a class="" href="visualising-text-analytics-through-wordcloud-etc..html"><span class="header-section-number">33</span> Visualising Text analytics through Wordcloud, etc.</a></li>
<li><a class="" href="finding-string-similarity.html"><span class="header-section-number">34</span> Finding string similarity</a></li>
<li><a class="" href="part-viii-geo-computation-in-r.html">Part-VIII: Geo computation in R</a></li>
<li><a class="" href="maps-in-r.html"><span class="header-section-number">35</span> Maps in R</a></li>
<li><a class="" href="geo-coding-in-r.html"><span class="header-section-number">36</span> Geo-Coding in R</a></li>
<li><a class="" href="reverse-geo-coding.html"><span class="header-section-number">37</span> Reverse geo-coding</a></li>
<li><a class="" href="part-ix-identifying-anamolous-observations-for-audit.html">Part-IX: Identifying anamolous observations for audit</a></li>
<li><a class="" href="benford-testsanalysis.html"><span class="header-section-number">38</span> Benford Tests/Analysis</a></li>
<li><a class="" href="anomaly-detection.html"><span class="header-section-number">39</span> Anomaly Detection</a></li>
<li><a class="" href="finding-anamolous-outliers.html"><span class="header-section-number">40</span> Finding Anamolous Outliers</a></li>
<li><a class="" href="dup.html"><span class="header-section-number">41</span> Duplicate Detection</a></li>
<li><a class="" href="detecting-gaps-in-sequences.html"><span class="header-section-number">42</span> Detecting gaps in sequences</a></li>
<li><a class="" href="data-envelopment-analysis.html"><span class="header-section-number">43</span> Data Envelopment Analysis</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="colors-in-r.html"><span class="header-section-number">A</span> Colors in R</a></li>
<li><a class="" href="various-datasets-in-base-r-used-in-this-book.html"><span class="header-section-number">B</span> Various Datasets, in base R, used in this book</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="time-series-analysis" class="section level1" number="25">
<h1>
<span class="header-section-number">25</span> Time Series Analysis<a class="anchor" aria-label="anchor" href="#time-series-analysis"><i class="fas fa-link"></i></a>
</h1>
<p>Time series analysis is an essential technique for forecasting and analyzing trends in data over time. It is commonly used in various fields like finance, economics, and engineering.</p>
<p>So a question arises, what is a time series? A time series is a sequence of data points collected over time, where the observations are recorded in chronological order. Time series analysis involves analyzing and modeling these data points to understand patterns, trends, and make predictions about future values. It is therefore used in predictive as well as descriptive analysis.</p>
<p>Time Series Analysis plays an important role in audit analytics as well. A few of the use cases can be-</p>
<ul>
<li>
<strong>Revenue Analysis:</strong> An auditor may analyze revenue data over time to identify irregularities or suspicious patterns that could indicate potential fraud or misstatement. By examining the revenue time series, the auditor can look for unexpected fluctuations, unusual growth or decline trends, or abnormal seasonality. Deviations from historical patterns or industry benchmarks may indicate fraudulent activities, such as revenue manipulation, fictitious transactions, or irregular recognition practices.</li>
<li>
<strong>Inventory Analysis:</strong> Auditors often analyze inventory data to assess the adequacy of inventory levels, identify potential inventory obsolescence or shrinkage, and evaluate the efficiency of inventory management. Time series analysis can be valuable in understanding inventory patterns and identifying potential risks or anomalies.</li>
</ul>
<p>There are several time series data which are loaded by default in R; a few of these are listed below. We will use these datasets to understand the various concepts related to time series analysis.</p>
<ul>
<li>
<code>AirPassengers</code> containing monthly airline passenger numbers from 1949-1960. See figure <a href="time-series-analysis.html#fig:tsex">25.1</a> (a)</li>
<li>
<code>Nile</code> contains flow of Nile river data. See figure <a href="time-series-analysis.html#fig:tsex">25.1</a> (b)</li>
<li>
<code>sunspots</code> containing monthly sunspot numbers from 1749-1983. See figure <a href="time-series-analysis.html#fig:tsex">25.1</a> (c)</li>
<li>
<code>JohnsonJohnson</code> which contains quarterly earnings per Johnson &amp; Johnson share. See figure <a href="time-series-analysis.html#fig:tsex">25.1</a> (d)</li>
</ul>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tsex"></span>
<img src="DauR_files/figure-html/tsex-1.png" alt="Few time series data sets in R" width="672"><p class="caption">
Figure 25.1: Few time series data sets in R
</p>
</div>
<p>To analyse any time series, we have to understand its different components.</p>
<div id="components-of-time-series" class="section level2" number="25.1">
<h2>
<span class="header-section-number">25.1</span> Components of Time series<a class="anchor" aria-label="anchor" href="#components-of-time-series"><i class="fas fa-link"></i></a>
</h2>
<p>A time series can be decomposed into several components:</p>
<ul>
<li>
<strong>Level:</strong> The baseline value or average of the series over time. It represents the long-term behavior of the series. This is basic component, and is always present in a time series object. E.g. In a straight horizontal line only level is there which is equal to the value of y intercept.</li>
<li>
<strong>Trend:</strong> The overall direction of the series. It indicates whether the series is increasing, decreasing, or staying relatively constant over time. E.g. A clear increasing trend can be seen in Johnson &amp; Johnson earnings, in Figure <a href="time-series-analysis.html#fig:tsex">25.1</a> (d).</li>
<li>
<strong>Seasonality:</strong> The repetitive and predictable patterns within the series that occur at regular intervals. Seasonality can be daily, weekly, monthly, quarterly, or yearly, etc. E.g. In figure <a href="time-series-analysis.html#fig:tsex">25.1</a> (d) we may see seasonal patterns in earnings of Johnson&amp;Johnson share.</li>
<li>
<strong>Errors (Residuals):</strong> The random fluctuations or noise in the series that cannot be explained by the level, trend, or seasonality. E.g. See figure <a href="time-series-analysis.html#fig:tsex">25.1</a> (c). The error component is an important aspect of time series analysis because it provides information about the uncertainty and variability of the data.</li>
</ul>
</div>
<div id="additive-or-multiplicative-components" class="section level2" number="25.2">
<h2>
<span class="header-section-number">25.2</span> Additive or multiplicative components<a class="anchor" aria-label="anchor" href="#additive-or-multiplicative-components"><i class="fas fa-link"></i></a>
</h2>
<p>In time series analysis, the trend, seasonal, and residual components can be modeled as either additive or multiplicative. The choice of the model depends on how the components combine to create the observed values of the series.</p>
<p>An <strong>additive model</strong> assumes that the components of the time series are added together to create the observed values. In other words, the value of the time series at any point in time is equal to the sum of the trend, seasonal, and residual components at that point in time. This is expressed mathematically as:</p>
<p><span class="math display">\[
y_t = T_t + S_t + e_t
\]</span></p>
<p>where <span class="math inline">\(y_t\)</span>, <span class="math inline">\(T_t\)</span>, <span class="math inline">\(S_t\)</span> and <span class="math inline">\(e_t\)</span> are the values of the series, trend component, seasonal component and residuals, respectively at time <span class="math inline">\(t\)</span>.</p>
<p>A <strong>multiplicative model</strong>, on the other hand, assumes that the components of the time series are multiplied together to create the observed values. In other words, the value of the time series at any point in time is equal to the product of the trend, seasonal, and residual components at that point in time. This is expressed mathematically as:</p>
<p><span class="math display">\[
y_t = T_t \times S_t \times e_t
\]</span></p>
<p>where <span class="math inline">\(y_t\)</span>, <span class="math inline">\(T_t\)</span>, <span class="math inline">\(S_t\)</span> and <span class="math inline">\(e_t\)</span> are defined as before. We can convert multiplicative time series into additive time series by taking <span class="math inline">\(log\)</span>. Note that seasonal component in <code>AirPassengers</code> time series depicted in <a href="time-series-analysis.html#fig:tsex">25.1</a> (a) is multiplicative. See Figure <a href="time-series-analysis.html#fig:logts">25.2</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:logts"></span>
<img src="DauR_files/figure-html/logts-1.png" alt="Transforming Time Series" width="49%"><img src="DauR_files/figure-html/logts-2.png" alt="Transforming Time Series" width="49%"><p class="caption">
Figure 25.2: Transforming Time Series
</p>
</div>
<p>We will learn about decomposing time series components in next sections.</p>
<p><strong>Damped Trends:</strong> Gardner and Mckenzie, in 1985<span class="citation"><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Everette S. Gardner and Ed. Mckenzie, &lt;span&gt;“Forecasting Trends in Time Series,”&lt;/span&gt; &lt;em&gt;Management Science&lt;/em&gt; 31, no. 10 (1985): 1237–46, &lt;a href="https://doi.org/10.1287/mnsc.31.10.1237"&gt;https://doi.org/10.1287/mnsc.31.10.1237&lt;/a&gt;.&lt;/p&gt;'><sup>32</sup></a></span> observed that most time series methods assume that any trend will continue unabated, regardless of the forecast lead time. They, based on empirical findings, suggested that forecast accuracy can be improved by either damping or ignoring altogether trends which have a low probability of persistence. We will learn about this concept, as well in next sections.</p>
</div>
<div id="practical-examples-in-r" class="section level2" number="25.3">
<h2>
<span class="header-section-number">25.3</span> Practical examples in R<a class="anchor" aria-label="anchor" href="#practical-examples-in-r"><i class="fas fa-link"></i></a>
</h2>
<p>Before analysing time series, in R let’s see how time series objects are dealt in R.</p>
<div id="pre-requisites" class="section level3 unnumbered">
<h3>Pre-requisites<a class="anchor" aria-label="anchor" href="#pre-requisites"><i class="fas fa-link"></i></a>
</h3>
<p>Though most of the time we will be using base R, yet <code>forecast</code> is a fabulous package in R, developed by <strong>Rob Hyndman</strong>, which we will be using for predicting. Predicting values help us understand how well we have captured the hidden trends and patterns in any time series.</p>
<div class="sourceCode" id="cb1159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/">forecast</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div id="creating-a-time-series-object-in-r" class="section level3" number="25.3.1">
<h3>
<span class="header-section-number">25.3.1</span> Creating a time series object in R<a class="anchor" aria-label="anchor" href="#creating-a-time-series-object-in-r"><i class="fas fa-link"></i></a>
</h3>
<p>R provides us a simple function <code><a href="https://rdrr.io/r/stats/ts.html">ts()</a></code> to convert a series of observations (basically a vector) into a specific time series object. The syntax is -</p>
<pre><code>ts(data, 
  start = 1, 
  end = numeric(length(data)), 
  frequency = 1, 
  ...)</code></pre>
<p>where:</p>
<ul>
<li>
<code>data</code>: a numeric vector or matrix containing the data for the time series</li>
<li>
<code>start</code>: the start time of the time series, represented as either a numeric or a Date or POSIXct object</li>
<li>
<code>end</code>: the end time of the time series, represented as either a numeric or a Date or POSIXct object</li>
<li>
<code>frequency</code>: the number of observations per unit time for the time series. For example, if the data is recorded monthly, the frequency would be 12</li>
<li>
<code>...</code>: additional arguments that can be passed to the function, such as <code>names</code>, <code>delim</code>, or <code>tsp</code> (time series start and end points)</li>
</ul>
<p>Example-1: Let’s create a time series.</p>
<div class="sourceCode" id="cb1161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a numeric vector representing monthly sales data for a year</span></span>
<span><span class="va">sales</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">25</span>, <span class="fl">35</span>, <span class="fl">40</span>, <span class="fl">45</span>, <span class="fl">50</span>, <span class="fl">55</span>, <span class="fl">60</span>, <span class="fl">65</span>, <span class="fl">70</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a time series object with monthly frequency starting from January</span></span>
<span><span class="va">sales_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html">ts</a></span><span class="op">(</span><span class="va">sales</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2022</span>, <span class="fl">4</span><span class="op">)</span>, frequency <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the time series object</span></span>
<span><span class="va">sales_ts</span></span></code></pre></div>
<pre><code>##      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
## 2022              10  20  30  25  35  40  45  50  55
## 2023  60  65  70</code></pre>
<p>We can check its class.</p>
<div class="sourceCode" id="cb1163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">sales_ts</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "ts"</code></pre>
<p>Let’s also check <code>Nile</code>, which is already available in base R.</p>
<div class="sourceCode" id="cb1165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Nile</span></span></code></pre></div>
<pre><code>## Time Series:
## Start = 1871 
## End = 1970 
## Frequency = 1 
##   [1] 1120 1160  963 1210 1160 1160  813 1230 1370 1140  995  935 1110  994 1020
##  [16]  960 1180  799  958 1140 1100 1210 1150 1250 1260 1220 1030 1100  774  840
##  [31]  874  694  940  833  701  916  692 1020 1050  969  831  726  456  824  702
##  [46] 1120 1100  832  764  821  768  845  864  862  698  845  744  796 1040  759
##  [61]  781  865  845  944  984  897  822 1010  771  676  649  846  812  742  801
##  [76] 1040  860  874  848  890  744  749  838 1050  918  986  797  923  975  815
##  [91] 1020  906  901 1170  912  746  919  718  714  740</code></pre>
</div>
<div id="plotting-time-series-objects" class="section level3" number="25.3.2">
<h3>
<span class="header-section-number">25.3.2</span> Plotting Time Series Objects<a class="anchor" aria-label="anchor" href="#plotting-time-series-objects"><i class="fas fa-link"></i></a>
</h3>
<p>To plot <code>ts</code> object we can simply use <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> command or alternatively we can use <code>ggplot2</code> as well.</p>
<div class="sourceCode" id="cb1167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plotting in base R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sales_ts</span>, main <span class="op">=</span> <span class="st">"Sales during FY 2022-23\nDummy Data by author"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span><span class="st">'Logrithmic values'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'AirPassengers converted to additive'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:tsex2"></span>
<img src="DauR_files/figure-html/tsex2-1.png" alt="Example of time series plotting in R; Base R (Left) and ggplot2 (Right)" width="48%"><img src="DauR_files/figure-html/tsex2-2.png" alt="Example of time series plotting in R; Base R (Left) and ggplot2 (Right)" width="48%"><p class="caption">
Figure 25.3: Example of time series plotting in R; Base R (Left) and ggplot2 (Right)
</p>
</div>
<p><em>Note: Library <code>forecast</code> in R also provides us a function <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> which plots a time series object, similar to plot(), but the plot returned here is a <code>ggplot2</code> object which can be modified/fine-tuned using <code>ggplot2</code> functions.</em></p>
</div>
</div>
<div id="time-series-modelling-and-forecasting" class="section level2" number="25.4">
<h2>
<span class="header-section-number">25.4</span> Time series modelling and forecasting<a class="anchor" aria-label="anchor" href="#time-series-modelling-and-forecasting"><i class="fas fa-link"></i></a>
</h2>
<p>As we have already discussed, forecasting future plays an important part of time series analysis; an important prerequisite is to model our data. In fact, the forecasting/modelling techniques can be broadly classified into two categories, data based techniques and model-based techniques.</p>
<div id="data-based-techniques" class="section level3 unnumbered">
<h3>Data-based techniques<a class="anchor" aria-label="anchor" href="#data-based-techniques"><i class="fas fa-link"></i></a>
</h3>
<p>Data-based techniques, also known as statistical or empirical techniques, focus on analyzing the patterns and characteristics of the observed time series data directly. These techniques do not explicitly assume a specific underlying model structure. Instead, they rely on statistical properties and patterns present in the data. Examples of data-based techniques include:</p>
</div>
<div id="naive-method" class="section level3" number="25.4.1">
<h3>
<span class="header-section-number">25.4.1</span> Naive method<a class="anchor" aria-label="anchor" href="#naive-method"><i class="fas fa-link"></i></a>
</h3>
<p>This method assumes that the future value will be the same as the last observed value. This is the simplest and most basic forecasting method and hence named <em>naive</em>. The formula for the naive method is:</p>
<p><span class="math display">\[
\text{Naive method: }\hat{Y}_{T+1} = Y_T
\]</span></p>
<p>Here, <span class="math inline">\(\hat{Y}_{T+1}\)</span> is the forecast value for the next time period and <span class="math inline">\(Y_T\)</span> is the last observed value i.e. for a series of <span class="math inline">\(T\)</span> observations. Thus, predicting future values using naive method require no special skill.</p>
<p><strong>Problem Statement-1:</strong> Let’s predict say 5, future values of Nile flow data. In <code>forecast</code> there is a function <code>naive</code> which will do the job, once we give the value of parameter <code>h</code> which is short for forecasting <strong>h</strong>orizon. In Figure <a href="time-series-analysis.html#fig:naive">25.4</a>, we can see forecast values, in red, which are exactly same as previous/last value.</p>
<div class="sourceCode" id="cb1168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/naive.html">naive</a></span><span class="op">(</span><span class="va">Nile</span>, h <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Nile flow - forecast by Naive method"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:naive"></span>
<img src="DauR_files/figure-html/naive-1.png" alt="Naive forecasting" width="98%"><p class="caption">
Figure 25.4: Naive forecasting
</p>
</div>
<p>If we aren’t interested in visualising confidence values (by default 80% and 95% confidence values are shown in bands), we can tune parameter <code>level</code> accordingly.</p>
</div>
<div id="moving-averages" class="section level3" number="25.4.2">
<h3>
<span class="header-section-number">25.4.2</span> Moving averages<a class="anchor" aria-label="anchor" href="#moving-averages"><i class="fas fa-link"></i></a>
</h3>
<p>In this technique, the forecast value is computed as the average of the most recent observations within a sliding window of fixed length, say <span class="math inline">\(n\)</span>.. It is a technique to smooth out a time series by averaging neighboring values. It helps in reducing noise and revealing underlying trends.</p>
<p>The formula for the moving average method is:</p>
<p><span class="math display">\[
\hat{Y}_{t+1} = \frac{1}{n}(Y_t + Y_{t-1} + ... + Y_{t-n+1})
\]</span></p>
<p>Here, <span class="math inline">\(\hat{Y}_{t+1}\)</span> is the forecast value for the next time period and <span class="math inline">\(Y_t\)</span>, <span class="math inline">\(Y_{t-1}\)</span>, …, <span class="math inline">\(Y_{t-n+1}\)</span> are the past <span class="math inline">\(n\)</span> observations.</p>
<p>Smoothing through moving average can either be <strong>centre-weighted</strong> or <strong>tailed-weighted</strong>. In former, <span class="math inline">\(k\)</span> i.e. <code>order</code> of the moving average, should be an odd number because each data point is replaced with the mean of that observation and <span class="math inline">\((k-1)/2\)</span> observations before and <span class="math inline">\((k-1)/2\)</span> observations after it. Smoothed time series <code>Nile</code> for different <code>k</code> can be seen in Figure <a href="time-series-analysis.html#fig:ma">25.5</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ma"></span>
<img src="DauR_files/figure-html/ma-1.png" alt="Simple Moving Averages" width="672"><p class="caption">
Figure 25.5: Simple Moving Averages
</p>
</div>
<p><strong>Problem Statement-2:</strong> Let’s try to visualise moving average trend in Nile data. We will use <code>ma</code> function from <code>forecast</code> for this. In left side Figure of <a href="time-series-analysis.html#fig:ma1">25.6</a> we have a smoother (with k = 7) time series and 10 forecast values using last value of moving average.</p>
<p>We can also use <code>rollmean</code> function from <code>zoo</code> library, which is another package to analyse time series objects. Refer right-side figure in <a href="time-series-analysis.html#fig:ma1">25.6</a>. In this example, we have used <code>wineind</code> data/time series which shows <em>Australian total wine sales by wine makers in bottles &lt;= 1 litre. Jan 1980 – Aug 1994.</em> One of the advantage using this method, is that we can see both original and smoothed time series.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ma1"></span>
<img src="DauR_files/figure-html/ma1-1.png" alt="Simple Moving averages" width="48%"><img src="DauR_files/figure-html/ma1-2.png" alt="Simple Moving averages" width="48%"><p class="caption">
Figure 25.6: Simple Moving averages
</p>
</div>
</div>
<div id="exponential-smoothing" class="section level3" number="25.4.3">
<h3>
<span class="header-section-number">25.4.3</span> Exponential smoothing<a class="anchor" aria-label="anchor" href="#exponential-smoothing"><i class="fas fa-link"></i></a>
</h3>
<p>Exponential smoothing techniques update forecasts based on weighted averages of past observations, giving more weight to recent observations. Examples include simple exponential smoothing, Holt’s method, and Holt-Winters’ method.</p>
<p>As the name suggests simple exponential smoothing or SES is simplest of these. <strong>Simple exponential smoothing (SES)</strong> is actually a moving weighted average where recent observations are given more weights while calculating averages. <em>This method is suitable for forecasting data with no clear trend or seasonal pattern.</em></p>
<p><span class="math display">\[
\hat{y}_{T+1} = \alpha{y_T} + \alpha(1- \alpha){y_{T-1}} + \alpha(1 - \alpha)^2{y_{T-2}} + ...
\]</span></p>
<p>The value of <span class="math inline">\(\alpha\)</span>, the smoothing parameter, in above equation should follow <span class="math inline">\(0 \le \alpha \le 1\)</span>. Clearly different values of <span class="math inline">\(\alpha\)</span> will give different smoothing and we will have to adopt most suitable one, one such example with <span class="math inline">\(\alpha = 0.1\)</span> is shown in the Figure <a href="time-series-analysis.html#fig:ses1">25.7</a> (Left).</p>
<p>Holt extended SES by introducing trend component and thus a new smoothing parameter for trend <span class="math inline">\(\beta\)</span>. The method is also named after him as <strong>Holt’s Linear Method</strong> of exponential smoothing. Now there are are two equations, mathematically.</p>
<p><span class="math display">\[
\begin{aligned}
\hat{y}_{t+h|t} &amp;= l_t + hb_t \\
l_t &amp;= \alpha y_t + (1-\alpha)(l_{t-1} + b_{t-1}) \\
b_t &amp;= \beta(l_t - l_{t-1}) + (1-\beta)b_{t-1}
\end{aligned}
\]</span></p>
<p><span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> (again <span class="math inline">\(0 \le \beta \le 1\)</span>) in above equations are smoothing parameters for level and trend components, respectively; and <span class="math inline">\(h\)</span> is forecast horizon. Also, <span class="math inline">\(y_t\)</span> is the actual value, <span class="math inline">\(l_t\)</span> is the level (or intercept), <span class="math inline">\(b_t\)</span> is the trend (or slope) of the time series at time <span class="math inline">\(t\)</span>. Refer <a href="time-series-analysis.html#fig:ses1">25.7</a> (Right).</p>
<p>To apply <em>SES</em>, in R, we can use function <code>ses</code> and for applying <em>Holt’s</em> smoothing, we can use <code>holt</code>; both from <code>forecast</code> library. Example usages are as follows.</p>
<div class="sourceCode" id="cb1169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lynxses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/ses.html">ses</a></span><span class="op">(</span><span class="va">lynx</span>, h<span class="op">=</span> <span class="fl">10</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">holtfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/ses.html">holt</a></span><span class="op">(</span><span class="va">airmiles</span>, h <span class="op">=</span> <span class="fl">10</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, beta <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">lynxses</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">lynxses</span><span class="op">$</span><span class="va">fitted</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'SES with alpha = 0.1 : Lynx data'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">holtfit</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">holtfit</span><span class="op">$</span><span class="va">fitted</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Holt's Linear Trend method with beta = 0.1 : AirMiles data"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ses1"></span>
<img src="DauR_files/figure-html/ses1-1.png" alt="Simple Exponential Smoothing (Left) Vs. Holt's Linear Method (Right)" width="49%"><img src="DauR_files/figure-html/ses1-2.png" alt="Simple Exponential Smoothing (Left) Vs. Holt's Linear Method (Right)" width="49%"><p class="caption">
Figure 25.7: Simple Exponential Smoothing (Left) Vs. Holt’s Linear Method (Right)
</p>
</div>
<p>As we have discussed earlier, damped trends work better many times. So based on Mckenzie and gardner work, an additional dampening paramater <span class="math inline">\(\phi\)</span> was introduced. The equations were modified as -
<span class="math display">\[
\begin{aligned}
\hat{y}_{t+h|t} &amp;= l_t + (\phi + \phi^2 + ... + \phi^h)b_t \\
l_t &amp;= \alpha y_t + (1-\alpha)(l_{t-1} + \phi b_{t-1}) \\
b_t &amp;= \beta(l_t - l_{t-1}) + (1-\beta)\phi b_{t-1}
\end{aligned}
\]</span></p>
<p>Clearly, if <span class="math inline">\(\phi = 1\)</span>, the above equations are equivalent to Holt’s Linear Method. <span class="math inline">\(\phi\)</span> for values <span class="math inline">\(0 &lt; \phi &lt; 1\)</span>, dampens the trend, as shown in figure <a href="time-series-analysis.html#fig:hl2">25.8</a> (Left). A comparison of both can be seen in the Figure <a href="time-series-analysis.html#fig:hl2">25.8</a> (Right).</p>
<p>To extend holt’s linear method with <em>damped trends</em> in R, we can set parameter <code>damped = TRUE</code> in <code>holt</code> function discussed above. Example code can be seen below.</p>
<div class="sourceCode" id="cb1170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">holtfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/ses.html">holt</a></span><span class="op">(</span><span class="va">airmiles</span>, h <span class="op">=</span> <span class="fl">10</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, beta <span class="op">=</span> <span class="fl">0.1</span>, damped <span class="op">=</span> <span class="cn">TRUE</span>, phi <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">holtfit</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">holtfit</span><span class="op">$</span><span class="va">fitted</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'Damped Trend Forecast with phi=0.8'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">holtfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/ses.html">holt</a></span><span class="op">(</span><span class="va">airmiles</span>,</span>
<span>                h <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                alpha <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                beta <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">holtfit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/ses.html">holt</a></span><span class="op">(</span></span>
<span>  <span class="va">airmiles</span>,</span>
<span>  h <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  beta <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  damped <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  phi <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">airmiles</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">holtfit</span>, series<span class="op">=</span><span class="st">"Holt's method"</span>, PI <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">holtfit2</span>, series<span class="op">=</span><span class="st">"Holt's method with damped trend"</span>, PI <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Holt's method"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Revenue passenger miles"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Method"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:hl2"></span>
<img src="DauR_files/figure-html/hl2-1.png" alt="Linear methos Vs. Damped trends" width="49%"><img src="DauR_files/figure-html/hl2-2.png" alt="Linear methos Vs. Damped trends" width="49%"><p class="caption">
Figure 25.8: Linear methos Vs. Damped trends
</p>
</div>
<p>Now to incorporate <code>seasonality</code> (with say <span class="math inline">\(m\)</span> periods) along with trend and level, Holt and Winters suggested to incorporate additional parameter <span class="math inline">\(\gamma\)</span> in above equations.</p>
<p><span class="math display">\[
\text{Holt-Winters method:}
\]</span>
<span class="math display">\[
\begin{aligned}
\hat{y}_{t+h|t} &amp;= l_t + hb_t + s_{t+m-(m-1 \bmod m)} \\
l_t &amp;= \alpha(y_t - s_{t-m}) + (1-\alpha)(l_{t-1} + b_{t-1}) \\
b_t &amp;= \beta(l_t - l_{t-1}) + (1-\beta)b_{t-1} \\
s_t &amp;= \gamma(y_t - l_{t-1} - b_{t-1}) + (1-\gamma)s_{t-m}
\end{aligned}
\]</span></p>
<p>An example can be seen in figure <a href="time-series-analysis.html#fig:hw1">25.9</a>. To apply <em>Holt-Winters</em> method in R, we can use <code>hw</code> function with desired values of parameters. An example code may be as follows, where we have tried to extend <code>AirPassengers</code> time series with this method with both <code>additive</code> and <code>multiplicative</code> trends.</p>
<div class="sourceCode" id="cb1171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hw1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/ses.html">hw</a></span><span class="op">(</span><span class="va">AirPassengers</span>, seasonal <span class="op">=</span> <span class="st">"additive"</span><span class="op">)</span></span>
<span><span class="va">hw2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/ses.html">hw</a></span><span class="op">(</span><span class="va">AirPassengers</span>, seasonal <span class="op">=</span> <span class="st">"multiplicative"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">hw1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Additive Model"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">hw2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Multiplicative Method"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:hw1"></span>
<img src="DauR_files/figure-html/hw1-1.png" alt="Holt-Winter's Method of Forecasting" width="48%"><img src="DauR_files/figure-html/hw1-2.png" alt="Holt-Winter's Method of Forecasting" width="48%"><p class="caption">
Figure 25.9: Holt-Winter’s Method of Forecasting
</p>
</div>
</div>
<div id="seasonal-decomposition-methods" class="section level3 unnumbered">
<h3>Seasonal decomposition methods<a class="anchor" aria-label="anchor" href="#seasonal-decomposition-methods"><i class="fas fa-link"></i></a>
</h3>
<p>Seasonal decomposition techniques decompose a time series into its different components, such as trend, seasonality, and noise. This allows for a better understanding of the individual components and their impact on the overall series. There are several methods to decompose a time series into its different components. We will however, discuss two of these.</p>
</div>
<div id="classical-seasonal-decomposition" class="section level3" number="25.4.4">
<h3>
<span class="header-section-number">25.4.4</span> Classical seasonal decomposition<a class="anchor" aria-label="anchor" href="#classical-seasonal-decomposition"><i class="fas fa-link"></i></a>
</h3>
<p>First of these methods is <strong>classical decomposition method</strong> which decomposes a time series into its trend, seasonal, and residual components. It assumes that the seasonal component repeats identically from year to year, and the trend component changes linearly over time. The steps involved in the classical decomposition method are as follows:</p>
<ul>
<li>
<strong>Trend Component:</strong> The trend component is estimated using a moving average or regression method.</li>
<li>
<strong>Seasonal Component:</strong> The seasonal component is estimated by averaging the values across the same seasonal periods in different years.</li>
<li>
<strong>Residual Component:</strong> The residual component is obtained by subtracting the trend and seasonal components from the original time series.</li>
</ul>
<p><strong>Problem Statement:</strong> Let’s try to decompose a time series say <code>AirPassengers</code> to see its components. To decompose a time series in R, we will use function <code>decompose</code> as shown in the following code. Decomposing time series in R gives us four different plots each for (i) Observed i.e. original values, (ii) trend, (iii) seasonality and (iv) random noise available.</p>
<p>Case-1: Additive decomposition</p>
<div class="sourceCode" id="cb1172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">decomposed_air_passengers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/decompose.html">decompose</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">decomposed_air_passengers</span><span class="op">)</span></span></code></pre></div>
<pre><code>##          Length Class  Mode     
## x        144    ts     numeric  
## seasonal 144    ts     numeric  
## trend    144    ts     numeric  
## random   144    ts     numeric  
## figure    12    -none- numeric  
## type       1    -none- character</code></pre>
<p>Case-2: Multiplicative decomposition. In this case we can use argument <code>type</code>.</p>
<div class="sourceCode" id="cb1174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">decomposed_air_passengers2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/decompose.html">decompose</a></span><span class="op">(</span><span class="va">AirPassengers</span>, type <span class="op">=</span> <span class="st">"multiplicative"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">decomposed_air_passengers2</span><span class="op">)</span></span></code></pre></div>
<pre><code>##          Length Class  Mode     
## x        144    ts     numeric  
## seasonal 144    ts     numeric  
## trend    144    ts     numeric  
## random   144    ts     numeric  
## figure    12    -none- numeric  
## type       1    -none- character</code></pre>
<p>A plot of decomposed <code>AirPassengers</code>, using classical approach is shown in Figure <a href="time-series-analysis.html#fig:stl1">25.10</a>.</p>
<div class="sourceCode" id="cb1176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AirPassengers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/decompose.html">decompose</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:stl1"></span>
<img src="DauR_files/figure-html/stl1-1.png" alt="Seasonal Decomposition Techniques" width="672"><p class="caption">
Figure 25.10: Seasonal Decomposition Techniques
</p>
</div>
</div>
<div id="seasonal-and-trend-decomposition-using-loess." class="section level3" number="25.4.5">
<h3>
<span class="header-section-number">25.4.5</span> Seasonal and Trend decomposition using Loess<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Loess is a method for estimating nonlinear relationships&lt;/p&gt;"><sup>33</sup></a>.<a class="anchor" aria-label="anchor" href="#seasonal-and-trend-decomposition-using-loess."><i class="fas fa-link"></i></a>
</h3>
<p>STL (Seasonal and Trend decomposition using Loess) is a robust and flexible method for decomposing a time series into its trend, seasonal, and residual components. It uses local regression (Loess) to estimate the trend and seasonal components. The STL algorithm is as follows:</p>
<ul>
<li>Seasonal Component: The seasonal component is estimated using Loess, which fits a smooth curve to the seasonal patterns.</li>
<li>Trend Component: The trend component is estimated by removing the estimated seasonal component from the original time series.</li>
<li>Residual Component: The residual component is obtained by subtracting the estimated trend and seasonal components from the original time series.</li>
</ul>
<p>To decompose time series in R, using STL, we will use function <code>stl</code> as shown below. A plot of STL decomposed <code>AirPassengers</code> is shown in figure <a href="time-series-analysis.html#fig:stl2">25.11</a>.</p>
<div class="sourceCode" id="cb1177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/stl.html">stl</a></span><span class="op">(</span><span class="va">AirPassengers</span>, s.window <span class="op">=</span> <span class="st">"periodic"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:stl2"></span>
<img src="DauR_files/figure-html/stl2-1.png" alt="STL Decomposition" width="672"><p class="caption">
Figure 25.11: STL Decomposition
</p>
</div>
</div>
<div id="model-based-techniques" class="section level3 unnumbered">
<h3>Model-based techniques<a class="anchor" aria-label="anchor" href="#model-based-techniques"><i class="fas fa-link"></i></a>
</h3>
<p>Model-based techniques involve fitting a specific mathematical or statistical model to the observed time series data. These techniques assume a particular structure for the data and estimate model parameters based on that. Model-based techniques typically require more assumptions but can provide a more detailed understanding of the underlying dynamics. Examples of model-based techniques include:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Autoregressive Integrated Moving Average (ARIMA)</strong>: ARIMA models capture the linear dependencies between lagged observations and differences of the time series. They are commonly used for modeling stationary time series.</p></li>
<li><p><strong>Seasonal ARIMA (SARIMA)</strong>: SARIMA models extend the ARIMA framework to incorporate seasonality in the data. They are suitable for time series exhibiting both trend and seasonality.</p></li>
</ol>
<p>In future version of the book, we will discuss these methods.</p>
</div>
</div>
<div id="plotting-different-elements-of-time-series" class="section level2" number="25.5">
<h2>
<span class="header-section-number">25.5</span> Plotting different elements of time series<a class="anchor" aria-label="anchor" href="#plotting-different-elements-of-time-series"><i class="fas fa-link"></i></a>
</h2>
<p>In R, we can use functions such as -</p>
<ul>
<li>
<code><a href="https://pkg.robjhyndman.com/forecast/reference/seasonplot.html">ggseasonplot()</a></code>: to create a seasonal plot</li>
<li>
<code><a href="https://pkg.robjhyndman.com/forecast/reference/ggmonthplot.html">ggsubseriesplot()</a></code>: to create mini plots for each season and show seasonal means</li>
<li>
<code><a href="https://pkg.robjhyndman.com/forecast/reference/gglagplot.html">gglagplot()</a></code>: Plot the time series against lags of itself</li>
<li>
<code><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf()</a></code>: Plot the autocorrelation function (ACF)</li>
</ul>
<p>Example-1:</p>
<div class="sourceCode" id="cb1178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, </span>
<span>                                           vjust <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                                           hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/seasonplot.html">ggseasonplot</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/ggmonthplot.html">ggsubseriesplot</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'Sub-Series Plot'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">g1</span> <span class="op">/</span> <span class="va">g2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-387"></span>
<img src="DauR_files/figure-html/unnamed-chunk-387-1.png" alt="Seasonalilty" width="672"><p class="caption">
Figure 25.12: Seasonalilty
</p>
</div>
<p>Example-2: Lag Plot of <code>AirPassengers</code> may be seen at Figure <a href="time-series-analysis.html#fig:lagp">25.13</a>. In the figure notice that plot at lag=12 suggest that series has seasonality with 12 periods.</p>
<div class="sourceCode" id="cb1179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/gglagplot.html">gglagplot</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'Lag Plots'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:lagp"></span>
<img src="DauR_files/figure-html/lagp-1.png" alt="Seasonalilty through Lagplots" width="672"><p class="caption">
Figure 25.13: Seasonalilty through Lagplots
</p>
</div>
<hr>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="manipulating-datedate-time-objects-using-lubridate.html"><span class="header-section-number">24</span> Manipulating Date/Date-time objects using lubridate</a></div>
<div class="next"><a href="part-vi-network-analytics.html">Part VI: Network Analytics</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#time-series-analysis"><span class="header-section-number">25</span> Time Series Analysis</a></li>
<li><a class="nav-link" href="#components-of-time-series"><span class="header-section-number">25.1</span> Components of Time series</a></li>
<li><a class="nav-link" href="#additive-or-multiplicative-components"><span class="header-section-number">25.2</span> Additive or multiplicative components</a></li>
<li>
<a class="nav-link" href="#practical-examples-in-r"><span class="header-section-number">25.3</span> Practical examples in R</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pre-requisites">Pre-requisites</a></li>
<li><a class="nav-link" href="#creating-a-time-series-object-in-r"><span class="header-section-number">25.3.1</span> Creating a time series object in R</a></li>
<li><a class="nav-link" href="#plotting-time-series-objects"><span class="header-section-number">25.3.2</span> Plotting Time Series Objects</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#time-series-modelling-and-forecasting"><span class="header-section-number">25.4</span> Time series modelling and forecasting</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-based-techniques">Data-based techniques</a></li>
<li><a class="nav-link" href="#naive-method"><span class="header-section-number">25.4.1</span> Naive method</a></li>
<li><a class="nav-link" href="#moving-averages"><span class="header-section-number">25.4.2</span> Moving averages</a></li>
<li><a class="nav-link" href="#exponential-smoothing"><span class="header-section-number">25.4.3</span> Exponential smoothing</a></li>
<li><a class="nav-link" href="#seasonal-decomposition-methods">Seasonal decomposition methods</a></li>
<li><a class="nav-link" href="#classical-seasonal-decomposition"><span class="header-section-number">25.4.4</span> Classical seasonal decomposition</a></li>
<li><a class="nav-link" href="#seasonal-and-trend-decomposition-using-loess."><span class="header-section-number">25.4.5</span> Seasonal and Trend decomposition using Loess33.</a></li>
<li><a class="nav-link" href="#model-based-techniques">Model-based techniques</a></li>
</ul>
</li>
<li><a class="nav-link" href="#plotting-different-elements-of-time-series"><span class="header-section-number">25.5</span> Plotting different elements of time series</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Audit Analytics</strong>" was written by Anil Goyal. It was last built on 2024-07-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
