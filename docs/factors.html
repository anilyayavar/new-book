<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Chapter 31 Factors | R for Audit Analytics</title>

    <meta name="author" content="Anil Goyal" />
  
   <meta name="description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Chapter 31 Factors | R for Audit Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://anilyayavar.github.io/new-book/" />
  <meta property="og:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg" />
  <meta property="og:description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 31 Factors | R for Audit Analytics" />
  
  <meta name="twitter:description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />
  <meta name="twitter:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.8.0/transition.js"></script>
    <script src="libs/bs3compat-0.8.0/tabs.js"></script>
    <script src="libs/bs3compat-0.8.0/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
    <style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
      <link rel="stylesheet" href="style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Audit Analytics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="factors" class="section level1" number="31">
<h1><span class="header-section-number">Chapter 31</span> Factors</h1>
<p>We often have a requirement, where we need to have our character variable representing categorical data that should take values from a fixed and known set of finite values (or categories). Additionally sometimes these categories need to be sorted in a specific order which may not be alphabetical. Categorical data like this plays an important role in data analytics.</p>
<p>To deal with such categorical data, we have a special class <code>factor</code> in R (Readers may remember that we learnt about this data type, though in short only, in section <a href="r-programming-language.html#fctrss">1.5.1</a>). In data analytical tasks we often need to create use factors, so let us discuss about these in a bit detail in this chapter.</p>
<div id="factors-in-base-r" class="section level2" number="31.1">
<h2><span class="header-section-number">31.1</span> Factors in base R</h2>
<p>Factors in R are objects built over atomic data-type <code>integer</code>. We have two primary functions to create (and coerce) factors from character vectors.</p>
<ul>
<li><code>factor</code></li>
<li><code>as.factor()</code></li>
</ul>
<p>Of these, <code>factor</code> provides us with full customisation as it is the basic function to create factor objects in base R. Let us discuss both.</p>
<div id="creating-factors-from-scratch" class="section level3" number="31.1.1">
<h3><span class="header-section-number">31.1.1</span> Creating factors from scratch</h3>
<p>Now, let us create factor from a character vector having values from <code>shirt_sizes</code>.</p>
<div class="sourceCode" id="cb1960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1960-1"><a href="factors.html#cb1960-1" tabindex="-1"></a>shirt_sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;L&quot;</span>, <span class="st">&quot;XL&quot;</span>, <span class="st">&quot;XXL&quot;</span>)</span></code></pre></div>
<p>Let us say, we have 10 shirts from these sizes randomly.</p>
<div class="sourceCode" id="cb1961"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1961-1"><a href="factors.html#cb1961-1" tabindex="-1"></a><span class="co"># 10 shirts with following sizes</span></span>
<span id="cb1961-2"><a href="factors.html#cb1961-2" tabindex="-1"></a><span class="co"># Notice one shirt with size small case l and one XXXL</span></span>
<span id="cb1961-3"><a href="factors.html#cb1961-3" tabindex="-1"></a>shirts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;L&quot;</span>, <span class="st">&quot;XL&quot;</span>, <span class="st">&quot;XXXL&quot;</span>, <span class="st">&quot;S&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;L&quot;</span>, <span class="st">&quot;L&quot;</span>)</span>
<span id="cb1961-4"><a href="factors.html#cb1961-4" tabindex="-1"></a></span>
<span id="cb1961-5"><a href="factors.html#cb1961-5" tabindex="-1"></a><span class="co"># Let us create a factor of shirt_sizes</span></span>
<span id="cb1961-6"><a href="factors.html#cb1961-6" tabindex="-1"></a>shirt_f <span class="ot">&lt;-</span> <span class="fu">factor</span>(shirts, <span class="at">levels =</span> shirt_sizes)</span>
<span id="cb1961-7"><a href="factors.html#cb1961-7" tabindex="-1"></a>shirt_f</span></code></pre></div>
<pre><code>##  [1] S    &lt;NA&gt; L    XL   &lt;NA&gt; S    M    M    L    L   
## Levels: S M L XL XXL</code></pre>
<p>In the output above we get <code>NA</code>s silently in place of values that were not available in our allowed values (read levels).</p>
<p>Now check its type and class.</p>
<div class="sourceCode" id="cb1963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1963-1"><a href="factors.html#cb1963-1" tabindex="-1"></a><span class="fu">typeof</span>(shirt_f)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb1965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1965-1"><a href="factors.html#cb1965-1" tabindex="-1"></a><span class="fu">class</span>(shirt_f)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<p>We can see that <code>factor</code> class is actually built upon the <code>integer</code> class underneath and labels (taking values from levels by default) shown in the output.</p>
<div class="sourceCode" id="cb1967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1967-1"><a href="factors.html#cb1967-1" tabindex="-1"></a><span class="fu">unclass</span>(shirt_f)</span></code></pre></div>
<pre><code>##  [1]  1 NA  3  4 NA  1  2  2  3  3
## attr(,&quot;levels&quot;)
## [1] &quot;S&quot;   &quot;M&quot;   &quot;L&quot;   &quot;XL&quot;  &quot;XXL&quot;</code></pre>
<p>We can, however, modify labels without modifying the levels by providing values (in a vector) to the <code>labels</code> argument. Let us now create another factor with labels different than levels.</p>
<div class="sourceCode" id="cb1969"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1969-1"><a href="factors.html#cb1969-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1969-2"><a href="factors.html#cb1969-2" tabindex="-1"></a><span class="co"># 100 Shirts</span></span>
<span id="cb1969-3"><a href="factors.html#cb1969-3" tabindex="-1"></a>shirts2 <span class="ot">&lt;-</span> <span class="fu">sample</span>(shirt_sizes, <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1969-4"><a href="factors.html#cb1969-4" tabindex="-1"></a>shirts2_f <span class="ot">&lt;-</span> <span class="fu">factor</span>(shirts2, <span class="at">levels =</span> shirt_sizes, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Small&quot;</span>, <span class="st">&quot;Medium&quot;</span>, <span class="st">&quot;Large&quot;</span>, <span class="st">&quot;Extra Large&quot;</span>, <span class="st">&quot;Extra Extra large&quot;</span>))</span>
<span id="cb1969-5"><a href="factors.html#cb1969-5" tabindex="-1"></a><span class="co"># Let&#39;s view some shirts</span></span>
<span id="cb1969-6"><a href="factors.html#cb1969-6" tabindex="-1"></a><span class="fu">head</span>(shirts2_f)</span></code></pre></div>
<pre><code>## [1] Large             Large             Medium            Medium           
## [5] Large             Extra Extra large
## Levels: Small Medium Large Extra Large Extra Extra large</code></pre>
<div class="sourceCode" id="cb1971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1971-1"><a href="factors.html#cb1971-1" tabindex="-1"></a><span class="co"># Check its levels</span></span>
<span id="cb1971-2"><a href="factors.html#cb1971-2" tabindex="-1"></a><span class="fu">levels</span>(shirts2_f)</span></code></pre></div>
<pre><code>## [1] &quot;Small&quot;             &quot;Medium&quot;            &quot;Large&quot;            
## [4] &quot;Extra Large&quot;       &quot;Extra Extra large&quot;</code></pre>
<p>Function <code>summary</code> gives us count for each level in the given factor.</p>
<div class="sourceCode" id="cb1973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1973-1"><a href="factors.html#cb1973-1" tabindex="-1"></a><span class="fu">summary</span>(shirts2_f)</span></code></pre></div>
<pre><code>##             Small            Medium             Large       Extra Large 
##                21                20                23                17 
## Extra Extra large 
##                19</code></pre>
</div>
<div id="coercing-objects-to-factor" class="section level3" number="31.1.2">
<h3><span class="header-section-number">31.1.2</span> Coercing objects to factor</h3>
<p>Up to now, we created a factor from set of allowable finite values (read <code>levels</code>) and displayed them using meaningful <code>labels</code>. Function <code>is.factor()</code> will check whether the given vector is a factor or not. On the other hand, function <code>as.factor</code> will coerce the existing character vector to a factor variable by using all the distinct values available therein as levels, but sorted alphabetically.</p>
<div class="sourceCode" id="cb1975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1975-1"><a href="factors.html#cb1975-1" tabindex="-1"></a><span class="fu">is.factor</span>(iris<span class="sc">$</span>Species)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1977-1"><a href="factors.html#cb1977-1" tabindex="-1"></a>shirts2_coerced <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(shirts2)</span>
<span id="cb1977-2"><a href="factors.html#cb1977-2" tabindex="-1"></a><span class="fu">head</span>(shirts2_coerced)</span></code></pre></div>
<pre><code>## [1] L   L   M   M   L   XXL
## Levels: L M S XL XXL</code></pre>
<div class="sourceCode" id="cb1979"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1979-1"><a href="factors.html#cb1979-1" tabindex="-1"></a><span class="fu">levels</span>(shirts2_coerced)</span></code></pre></div>
<pre><code>## [1] &quot;L&quot;   &quot;M&quot;   &quot;S&quot;   &quot;XL&quot;  &quot;XXL&quot;</code></pre>
<div class="sourceCode" id="cb1981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1981-1"><a href="factors.html#cb1981-1" tabindex="-1"></a><span class="co"># Check summary too</span></span>
<span id="cb1981-2"><a href="factors.html#cb1981-2" tabindex="-1"></a><span class="fu">summary</span>(shirts2_coerced)</span></code></pre></div>
<pre><code>##   L   M   S  XL XXL 
##  23  20  21  17  19</code></pre>
<p>This problem was not there in our earlier factor created from scratch, because there it took levels from the provided vector which we sorted meaningfully ourselves, and thus having more control.</p>
</div>
<div id="ordfact" class="section level3" number="31.1.3">
<h3><span class="header-section-number">31.1.3</span> Order in factors</h3>
<p>To sort the factors in a meaningful way, we can actually create ordered factor. Ordered factor can be created either by</p>
<ul>
<li>using <code>ordered = TRUE</code> argument in function <code>factor</code>; or by</li>
<li>coercing a given factor to an ordered factor using function <code>ordered()</code>.</li>
</ul>
<p>Clearly, latter method will again order the given factor as per the levels present in the factor.</p>
<div class="sourceCode" id="cb1983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1983-1"><a href="factors.html#cb1983-1" tabindex="-1"></a>shirts2_ordered <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb1983-2"><a href="factors.html#cb1983-2" tabindex="-1"></a>  shirts2,</span>
<span id="cb1983-3"><a href="factors.html#cb1983-3" tabindex="-1"></a>  <span class="at">levels =</span> shirt_sizes,</span>
<span id="cb1983-4"><a href="factors.html#cb1983-4" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Small&quot;</span>, <span class="st">&quot;Medium&quot;</span>, <span class="st">&quot;Large&quot;</span>, </span>
<span id="cb1983-5"><a href="factors.html#cb1983-5" tabindex="-1"></a>             <span class="st">&quot;Extra Large&quot;</span>, <span class="st">&quot;Extra Extra large&quot;</span>),</span>
<span id="cb1983-6"><a href="factors.html#cb1983-6" tabindex="-1"></a>  <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb1983-7"><a href="factors.html#cb1983-7" tabindex="-1"></a>)</span></code></pre></div>
<p>Ordering a factor in R has another benefit, we can actually perform calculations on the ordered factor.
Suppose if we want to find how many shirts do we have of sizes “Large” or greater.</p>
<div class="sourceCode" id="cb1984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1984-1"><a href="factors.html#cb1984-1" tabindex="-1"></a><span class="co"># How many shirts are there of sizes L or greater?</span></span>
<span id="cb1984-2"><a href="factors.html#cb1984-2" tabindex="-1"></a><span class="fu">sum</span>(shirts2_ordered <span class="sc">&gt;=</span> <span class="st">&quot;Large&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 59</code></pre>
<div class="sourceCode" id="cb1986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1986-1"><a href="factors.html#cb1986-1" tabindex="-1"></a><span class="co"># But unordered factor will result in error.</span></span>
<span id="cb1986-2"><a href="factors.html#cb1986-2" tabindex="-1"></a><span class="fu">sum</span>(shirts2_f <span class="sc">&gt;=</span> <span class="st">&quot;Large&quot;</span>)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>We can check the given factor is an ordered factor or not using function <code>is.ordered()</code>. E.g.</p>
<div class="sourceCode" id="cb1988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1988-1"><a href="factors.html#cb1988-1" tabindex="-1"></a><span class="fu">is.ordered</span>(shirts2_ordered)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1990-1"><a href="factors.html#cb1990-1" tabindex="-1"></a><span class="fu">is.ordered</span>(shirts2_f)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="functions-returning-factors-as-output" class="section level3" number="31.1.4">
<h3><span class="header-section-number">31.1.4</span> Functions returning factors as output</h3>
<p>Readers may remember that in section <a href="existing-and-useful-functions-in-base-r.html#cutt">4.12.9</a> we learnt about a function <code>cut</code> which returns a factor variable as output. In the next sections we will learn some functions which will be useful while working with factor variables, either as input or output or both.</p>
</div>
</div>
<div id="factors-in-forcats" class="section level2" number="31.2">
<h2><span class="header-section-number">31.2</span> Factors in <code>forcats</code></h2>
<p>Package <code>forcats</code> which is part of core tidyverse provides us with more robust and useful ways to create and deal with factor variables. In <code>forcats</code> we have function <code>fct</code> for creating factor variables. It will produce errors if any value is not available in the given levels, to avoid bugs/typographical errors in the code. E.g.</p>
<div class="sourceCode" id="cb1992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1992-1"><a href="factors.html#cb1992-1" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb1992-2"><a href="factors.html#cb1992-2" tabindex="-1"></a>months_31 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Mar&quot;</span>, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Aug&quot;</span>, <span class="st">&quot;Oxt&quot;</span>, <span class="st">&quot;Dec&quot;</span>)</span>
<span id="cb1992-3"><a href="factors.html#cb1992-3" tabindex="-1"></a><span class="fu">fct</span>(months_31, <span class="at">levels =</span> month.abb)</span></code></pre></div>
<pre><code>## Error in `fct()`:
## ! All values of `x` must appear in `levels` or `na`
## ℹ Missing level: &quot;Oxt&quot;</code></pre>
</div>
<div id="inspecting-factors" class="section level2" number="31.3">
<h2><span class="header-section-number">31.3</span> Inspecting Factors</h2>
<div id="summarising-factors" class="section level3" number="31.3.1">
<h3><span class="header-section-number">31.3.1</span> Summarising factors</h3>
<p>The <code>summary()</code> method works well to give the counts for each level.</p>
<div class="sourceCode" id="cb1994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1994-1"><a href="factors.html#cb1994-1" tabindex="-1"></a>shirts2_fct <span class="ot">&lt;-</span> <span class="fu">fct</span>(shirts2)</span>
<span id="cb1994-2"><a href="factors.html#cb1994-2" tabindex="-1"></a><span class="fu">summary</span>(shirts2_fct)</span></code></pre></div>
<pre><code>##   L   M XXL  XL   S 
##  23  20  19  17  21</code></pre>
<p>Like <code>count</code> in <code>dplyr</code>, here we have <code>fct_count()</code> to give us level wise counts and/or proportions. The difference from <code>summary()</code> is however in output type. Function <code>fct_count()</code> returns a <code>tibble</code> instead. E.g.</p>
<div class="sourceCode" id="cb1996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1996-1"><a href="factors.html#cb1996-1" tabindex="-1"></a><span class="fu">fct_count</span>(shirts2_fct)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   f         n
##   &lt;fct&gt; &lt;int&gt;
## 1 L        23
## 2 M        20
## 3 XXL      19
## 4 XL       17
## 5 S        21</code></pre>
<div class="sourceCode" id="cb1998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1998-1"><a href="factors.html#cb1998-1" tabindex="-1"></a><span class="co"># Sort in decreasing counts</span></span>
<span id="cb1998-2"><a href="factors.html#cb1998-2" tabindex="-1"></a><span class="fu">fct_count</span>(shirts2_fct, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   f         n
##   &lt;fct&gt; &lt;int&gt;
## 1 L        23
## 2 S        21
## 3 M        20
## 4 XXL      19
## 5 XL       17</code></pre>
<div class="sourceCode" id="cb2000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2000-1"><a href="factors.html#cb2000-1" tabindex="-1"></a><span class="co"># Include proportions also</span></span>
<span id="cb2000-2"><a href="factors.html#cb2000-2" tabindex="-1"></a><span class="fu">fct_count</span>(shirts2_fct, <span class="at">sort =</span> <span class="cn">TRUE</span>, <span class="at">prop =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   f         n     p
##   &lt;fct&gt; &lt;int&gt; &lt;dbl&gt;
## 1 L        23  0.23
## 2 S        21  0.21
## 3 M        20  0.2 
## 4 XXL      19  0.19
## 5 XL       17  0.17</code></pre>
</div>
<div id="unique-levels-only" class="section level3" number="31.3.2">
<h3><span class="header-section-number">31.3.2</span> Unique levels only</h3>
<p>Function <code>fct_unique()</code> from the package, returns a factor with unique values, removing duplicates. E.g.</p>
<div class="sourceCode" id="cb2002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2002-1"><a href="factors.html#cb2002-1" tabindex="-1"></a><span class="fu">fct_unique</span>(shirts2_fct)</span></code></pre></div>
<pre><code>## [1] L   M   XXL XL  S  
## Levels: L M XXL XL S</code></pre>
</div>
</div>
<div id="order-in-factors" class="section level2" number="31.4">
<h2><span class="header-section-number">31.4</span> Order in Factors</h2>
<div id="default-ordering-in-factors" class="section level3" number="31.4.1">
<h3><span class="header-section-number">31.4.1</span> Default ordering in factors</h3>
<p>Orders created in factor variables using <code>fct</code> are sorted as per the levels given in the level argument. If the argument is not supplied then it is sorted on the basis of first appearance (as against alphabetically in the <code>factor</code>), as we observed in output of above example.</p>
<p>To learn more functions from <code>forcats</code> we will use <code>gss_cat</code> data frame which is part of the <code>forcats</code> package itself and GSS here stands for General Social Survey. It actually consists of many factor variables. For some other use cases, we will also use <code>economics_long</code> data which is part of <code>tidyr</code> package.</p>
</div>
<div id="reordering-factors" class="section level3" number="31.4.2">
<h3><span class="header-section-number">31.4.2</span> Reordering factors</h3>
<p>If we analyse the (mean) number of hours spent per day on TV watching across different religions in <code>gss_cat</code>, we can see that -</p>
<div class="sourceCode" id="cb2004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2004-1"><a href="factors.html#cb2004-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2004-2"><a href="factors.html#cb2004-2" tabindex="-1"></a>gss_cat <span class="sc">|&gt;</span></span>
<span id="cb2004-3"><a href="factors.html#cb2004-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">tv =</span> <span class="fu">mean</span>(tvhours, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> relig) <span class="sc">|&gt;</span></span>
<span id="cb2004-4"><a href="factors.html#cb2004-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(relig, tv)) <span class="sc">+</span></span>
<span id="cb2004-5"><a href="factors.html#cb2004-5" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb2004-6"><a href="factors.html#cb2004-6" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:reord"></span>
<img src="DauR_files/figure-html/reord-1.png" alt="Factors with default order" width="672" />
<p class="caption">
Figure 31.1: Factors with default order
</p>
</div>
<p>In above case (<a href="factors.html#fig:reord">31.1</a>), the order of <code>relig</code> factor is meaningful when sorted on the basis of summarised values of another numerical variable present in the data. Function <code>fct_reorder</code> is helpful in these scenarios.</p>
<pre><code>fct_reorder(
  .f,
  .x,
  .fun = median,
  ...,
  .na_rm = NULL,
  .default = Inf,
  .desc = FALSE
)</code></pre>
<p>Where -</p>
<ul>
<li><code>.f</code> is the factor variable to be sorted.</li>
<li><code>.x</code> is the numerical variable based on which <code>.f</code> is to be sorted.</li>
<li><code>.fun</code> is the optional function (default is <code>median</code>) to be used when there are multiple values of .x for any of the level in <code>.f</code>.</li>
</ul>
<p>So, in above example, we can re-order the levels using this function. See figure <a href="factors.html#fig:reord2">31.2</a> -</p>
<div class="sourceCode" id="cb2006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2006-1"><a href="factors.html#cb2006-1" tabindex="-1"></a>gss_cat <span class="sc">|&gt;</span></span>
<span id="cb2006-2"><a href="factors.html#cb2006-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">tv =</span> <span class="fu">mean</span>(tvhours, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.by =</span> relig) <span class="sc">|&gt;</span></span>
<span id="cb2006-3"><a href="factors.html#cb2006-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_reorder</span>(relig, tv), tv)) <span class="sc">+</span></span>
<span id="cb2006-4"><a href="factors.html#cb2006-4" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb2006-5"><a href="factors.html#cb2006-5" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb2006-6"><a href="factors.html#cb2006-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Religion&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:reord2"></span>
<img src="DauR_files/figure-html/reord2-1.png" alt="Factors with reordered levels" width="672" />
<p class="caption">
Figure 31.2: Factors with reordered levels
</p>
</div>
<p>This function is also useful in sorting box-plots. As an example refer Figure <a href="factors.html#fig:reord3">31.3</a>.</p>
<div class="sourceCode" id="cb2007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2007-1"><a href="factors.html#cb2007-1" tabindex="-1"></a>economics_long <span class="sc">|&gt;</span> </span>
<span id="cb2007-2"><a href="factors.html#cb2007-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value01, <span class="at">y =</span> variable)) <span class="sc">+</span></span>
<span id="cb2007-3"><a href="factors.html#cb2007-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb2007-4"><a href="factors.html#cb2007-4" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Unsorted Boxes&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:reord3"></span>
<img src="DauR_files/figure-html/reord3-1.png" alt="Unsorted boxes with unordered levels" width="672" />
<p class="caption">
Figure 31.3: Unsorted boxes with unordered levels
</p>
</div>
<div class="sourceCode" id="cb2008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2008-1"><a href="factors.html#cb2008-1" tabindex="-1"></a>economics_long <span class="sc">|&gt;</span> </span>
<span id="cb2008-2"><a href="factors.html#cb2008-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">fct_reorder</span>(variable, value01)) <span class="sc">|&gt;</span> </span>
<span id="cb2008-3"><a href="factors.html#cb2008-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value01, <span class="at">y =</span> variable)) <span class="sc">+</span></span>
<span id="cb2008-4"><a href="factors.html#cb2008-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb2008-5"><a href="factors.html#cb2008-5" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Boxes sorted on Median&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:reord4"></span>
<img src="DauR_files/figure-html/reord4-1.png" alt="Boxes sorted on Median reordering factor levels" width="672" />
<p class="caption">
Figure 31.4: Boxes sorted on Median reordering factor levels
</p>
</div>
</div>
<div id="reordering-factors-with-two-other-variables." class="section level3" number="31.4.3">
<h3><span class="header-section-number">31.4.3</span> Reordering factors with two other variables.</h3>
<p>Sometimes, a factor variable needs to be sorted on the basis of first (or last) values of two other variables. In such <code>fct_reorder2()</code> is useful. As compared to <code>fct_reorder()</code> it takes an extra argument <code>.y</code> and is having syntax like</p>
<pre><code>fct_reorder2(
  .f,
  .x,
  .y,
  .fun = last2,
  ...,
  .na_rm = NULL,
  .default = -Inf,
  .desc = TRUE
)</code></pre>
<p>Here default function is <code>last2</code> which simply means that levels of <code>.f</code> are sorted on the basis of last values of <code>.y</code> when plotted against <code>.x</code> as in grouped line charts. E.g. See Figure <a href="factors.html#fig:reord5">31.5</a>.</p>
<div class="sourceCode" id="cb2010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2010-1"><a href="factors.html#cb2010-1" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb2010-2"><a href="factors.html#cb2010-2" tabindex="-1"></a><span class="fu">library</span>(conflicted)</span>
<span id="cb2010-3"><a href="factors.html#cb2010-3" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(dplyr<span class="sc">::</span>filter)</span>
<span id="cb2010-4"><a href="factors.html#cb2010-4" tabindex="-1"></a></span>
<span id="cb2010-5"><a href="factors.html#cb2010-5" tabindex="-1"></a>default <span class="ot">&lt;-</span> economics_long <span class="sc">|&gt;</span> </span>
<span id="cb2010-6"><a href="factors.html#cb2010-6" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&lt;</span> <span class="fu">dmy</span>(<span class="st">&quot;31122003&quot;</span>), date <span class="sc">&gt;=</span> <span class="fu">dmy</span>(<span class="st">&quot;01011995&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2010-7"><a href="factors.html#cb2010-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, value01)) <span class="sc">+</span></span>
<span id="cb2010-8"><a href="factors.html#cb2010-8" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> variable, <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb2010-9"><a href="factors.html#cb2010-9" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Default legend&quot;</span>)</span>
<span id="cb2010-10"><a href="factors.html#cb2010-10" tabindex="-1"></a></span>
<span id="cb2010-11"><a href="factors.html#cb2010-11" tabindex="-1"></a>aligned <span class="ot">&lt;-</span> economics_long <span class="sc">|&gt;</span> </span>
<span id="cb2010-12"><a href="factors.html#cb2010-12" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&lt;</span> <span class="fu">dmy</span>(<span class="st">&quot;31122003&quot;</span>), date <span class="sc">&gt;=</span> <span class="fu">dmy</span>(<span class="st">&quot;01011995&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2010-13"><a href="factors.html#cb2010-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">fct_reorder2</span>(variable, date, value01)) <span class="sc">|&gt;</span> </span>
<span id="cb2010-14"><a href="factors.html#cb2010-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, value01)) <span class="sc">+</span></span>
<span id="cb2010-15"><a href="factors.html#cb2010-15" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> variable, <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb2010-16"><a href="factors.html#cb2010-16" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Legend aligned with </span><span class="sc">\n</span><span class="st">last values of each line&quot;</span>)</span>
<span id="cb2010-17"><a href="factors.html#cb2010-17" tabindex="-1"></a></span>
<span id="cb2010-18"><a href="factors.html#cb2010-18" tabindex="-1"></a>default <span class="sc">+</span> aligned</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:reord5"></span>
<img src="DauR_files/figure-html/reord5-1.png" alt="Factors reordered on two criteria" width="672" />
<p class="caption">
Figure 31.5: Factors reordered on two criteria
</p>
</div>
</div>
<div id="changing-orders-of-few-factor-labels-only" class="section level3" number="31.4.4">
<h3><span class="header-section-number">31.4.4</span> Changing orders of few factor labels only</h3>
<p>Sometimes, we may have a factor whose levels are already meaningfully sorted. E.g. income levels in <code>gss_cat</code>. Check the plot in Figure <a href="factors.html#fig:reord6">31.6</a>.</p>
<div class="sourceCode" id="cb2011"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2011-1"><a href="factors.html#cb2011-1" tabindex="-1"></a>gss_cat <span class="sc">|&gt;</span> </span>
<span id="cb2011-2"><a href="factors.html#cb2011-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(rincome)) <span class="sc">+</span></span>
<span id="cb2011-3"><a href="factors.html#cb2011-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb2011-4"><a href="factors.html#cb2011-4" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:reord6"></span>
<img src="DauR_files/figure-html/reord6-1.png" alt="Default Income levels" width="672" />
<p class="caption">
Figure 31.6: Default Income levels
</p>
</div>
<p>The levels of income are already sorted in a meaningful way. However, sometimes we may want to change order of a few levels only. E.g. <code>Not applicable</code> in the Figure <a href="factors.html#fig:reord6">31.6</a> which if re-leveled in the end may be more meaningful. In such cases, we may use <code>fct_relevel</code>. The function takes a factor variable and thereafter we may pass all those levels as arguments which we want to move in the end. After rearranging the bars (levels), the plot will look like as in Figure <a href="factors.html#fig:reord7">31.7</a></p>
<div class="sourceCode" id="cb2012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2012-1"><a href="factors.html#cb2012-1" tabindex="-1"></a>gss_cat <span class="sc">|&gt;</span> </span>
<span id="cb2012-2"><a href="factors.html#cb2012-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_relevel</span>(rincome, <span class="st">&quot;Not applicable&quot;</span>))) <span class="sc">+</span></span>
<span id="cb2012-3"><a href="factors.html#cb2012-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb2012-4"><a href="factors.html#cb2012-4" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb2012-5"><a href="factors.html#cb2012-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;Income levels&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:reord7"></span>
<img src="DauR_files/figure-html/reord7-1.png" alt="Modifying levels manually" width="672" />
<p class="caption">
Figure 31.7: Modifying levels manually
</p>
</div>
</div>
<div id="infreq" class="section level3" number="31.4.5">
<h3><span class="header-section-number">31.4.5</span> Ordering bar charts in order of frequency</h3>
<p>Function <code>fct_infreq()</code> is helpful in sorting the factor in decreasing order of frequency and thus, can be used to sort the bar charts (Refer charts in Figure <a href="factors.html#fig:fct16">31.8</a>).</p>
<div class="sourceCode" id="cb2013"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2013-1"><a href="factors.html#cb2013-1" tabindex="-1"></a>default <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb2013-2"><a href="factors.html#cb2013-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(trans)) <span class="sc">+</span></span>
<span id="cb2013-3"><a href="factors.html#cb2013-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb2013-4"><a href="factors.html#cb2013-4" tabindex="-1"></a></span>
<span id="cb2013-5"><a href="factors.html#cb2013-5" tabindex="-1"></a>increasing <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb2013-6"><a href="factors.html#cb2013-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_infreq</span>(trans))) <span class="sc">+</span></span>
<span id="cb2013-7"><a href="factors.html#cb2013-7" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb2013-8"><a href="factors.html#cb2013-8" tabindex="-1"></a>default <span class="sc">+</span> increasing</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fct16"></span>
<img src="DauR_files/figure-html/fct16-1.png" alt="Default and increasing order by Frequency" width="672" />
<p class="caption">
Figure 31.8: Default and increasing order by Frequency
</p>
</div>
</div>
<div id="reversing-the-factor-levels" class="section level3" number="31.4.6">
<h3><span class="header-section-number">31.4.6</span> Reversing the factor levels</h3>
<p>Using <code>fct_rev()</code> we can reverse the order of levels in any factor. E.g. Figure <a href="factors.html#fig:reord8">31.9</a>.</p>
<div class="sourceCode" id="cb2014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2014-1"><a href="factors.html#cb2014-1" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> </span>
<span id="cb2014-2"><a href="factors.html#cb2014-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trans =</span> <span class="fu">fct_rev</span>(<span class="fu">fct_infreq</span>(trans))) <span class="sc">|&gt;</span> </span>
<span id="cb2014-3"><a href="factors.html#cb2014-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(trans)) <span class="sc">+</span></span>
<span id="cb2014-4"><a href="factors.html#cb2014-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:reord8"></span>
<img src="DauR_files/figure-html/reord8-1.png" alt="Reversing levels" width="672" />
<p class="caption">
Figure 31.9: Reversing levels
</p>
</div>
</div>
<div id="other-reordering" class="section level3" number="31.4.7">
<h3><span class="header-section-number">31.4.7</span> Other reordering</h3>
<p>There are two more functions which can be used to reorder factor levels -</p>
<ul>
<li><code>fct_inorder()</code>: by the order in which they first appear.</li>
<li><code>fct_inseq()</code>: by numeric value of level.</li>
</ul>
<p>Readers may explore these functions by themselves.</p>
</div>
<div id="more-on-ordering-factors" class="section level3" number="31.4.8">
<h3><span class="header-section-number">31.4.8</span> More on ordering factors</h3>
<p>In section <a href="factors.html#ordfact">31.1.3</a> we saw how an unordered factor can be turned into an ordered factor. This ordering can cause one side effect while plotting in ggplot2. Ordered factor use <code>scale_color_viridis</code> by default whereas unordered factor doesn’t. See following example (Notice how the color scale has been Figure <a href="factors.html#fig:moreord">31.10</a> to Figure <a href="factors.html#fig:moreord2">31.11</a>).</p>
<div class="sourceCode" id="cb2015"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2015-1"><a href="factors.html#cb2015-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb2015-2"><a href="factors.html#cb2015-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cyl =</span> <span class="fu">ordered</span>(<span class="fu">factor</span>(cyl))) <span class="sc">%&gt;%</span> </span>
<span id="cb2015-3"><a href="factors.html#cb2015-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb2015-4"><a href="factors.html#cb2015-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">color =</span> cyl)) <span class="sc">+</span></span>
<span id="cb2015-5"><a href="factors.html#cb2015-5" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Ordered Factor&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:moreord"></span>
<img src="DauR_files/figure-html/moreord-1.png" alt="Use of color scale in ordered and unordered factors" width="672" />
<p class="caption">
Figure 31.10: Use of color scale in ordered and unordered factors
</p>
</div>
<div class="sourceCode" id="cb2016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2016-1"><a href="factors.html#cb2016-1" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb2016-2"><a href="factors.html#cb2016-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cyl =</span> <span class="fu">factor</span>(cyl)) <span class="sc">%&gt;%</span> </span>
<span id="cb2016-3"><a href="factors.html#cb2016-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(wt, mpg)) <span class="sc">+</span></span>
<span id="cb2016-4"><a href="factors.html#cb2016-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">color =</span> cyl)) <span class="sc">+</span></span>
<span id="cb2016-5"><a href="factors.html#cb2016-5" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Unordered Factor&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:moreord2"></span>
<img src="DauR_files/figure-html/moreord2-1.png" alt="Use of color scale in ordered and unordered factors" width="672" />
<p class="caption">
Figure 31.11: Use of color scale in ordered and unordered factors
</p>
</div>
</div>
</div>
<div id="levels-in-factors" class="section level2" number="31.5">
<h2><span class="header-section-number">31.5</span> Levels in Factors</h2>
<div id="modifying-factor-levels-by-applying-a-function" class="section level3" number="31.5.1">
<h3><span class="header-section-number">31.5.1</span> Modifying factor levels by applying a function</h3>
<p>Function <code>fct_relabel</code> in <code>forcats</code> powerhouse applies a function <code>.fun</code> to each of the level in <code>.f</code> factor supplied to it. E.g. Change the case of each of the variable name in <code>economics_long</code> (Figure <a href="factors.html#fig:reord9">31.12</a>).</p>
<div class="sourceCode" id="cb2017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2017-1"><a href="factors.html#cb2017-1" tabindex="-1"></a>economics_long <span class="sc">|&gt;</span> </span>
<span id="cb2017-2"><a href="factors.html#cb2017-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">fct_relabel</span>(variable, str_to_upper)) <span class="sc">|&gt;</span> </span>
<span id="cb2017-3"><a href="factors.html#cb2017-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value01, <span class="at">y =</span> variable)) <span class="sc">+</span></span>
<span id="cb2017-4"><a href="factors.html#cb2017-4" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() </span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:reord9"></span>
<img src="DauR_files/figure-html/reord9-1.png" alt="Applying a function to all labels" width="672" />
<p class="caption">
Figure 31.12: Applying a function to all labels
</p>
</div>
</div>
<div id="modifying-factor-levels-manually" class="section level3" number="31.5.2">
<h3><span class="header-section-number">31.5.2</span> Modifying factor levels manually</h3>
<p>Using function <code>fct_recode()</code> we can change the levels from the given factor manually. We have to provide new levels manually through a sequence of named character vectors where the name gives the new level, and the value gives the old level. Levels not otherwise mentioned will be left as is. Levels can be removed by naming them <code>NULL</code>. See Example</p>
<div class="sourceCode" id="cb2018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2018-1"><a href="factors.html#cb2018-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;bear&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;dear&quot;</span>))</span>
<span id="cb2018-2"><a href="factors.html#cb2018-2" tabindex="-1"></a><span class="fu">fct_recode</span>(x, <span class="at">fruit =</span> <span class="st">&quot;apple&quot;</span>, <span class="at">fruit =</span> <span class="st">&quot;banana&quot;</span>)</span></code></pre></div>
<pre><code>## [1] fruit bear  fruit dear 
## Levels: fruit bear dear</code></pre>
<p>To collapse multiple levels (lumping) into one we can use its cousin <code>fct_collapse()</code>. Example</p>
<div class="sourceCode" id="cb2020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2020-1"><a href="factors.html#cb2020-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;bear&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;dear&quot;</span>))</span>
<span id="cb2020-2"><a href="factors.html#cb2020-2" tabindex="-1"></a><span class="fu">fct_collapse</span>(x, <span class="at">fruit =</span> <span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>))</span></code></pre></div>
<pre><code>## [1] fruit bear  fruit dear 
## Levels: fruit bear dear</code></pre>
</div>
<div id="lump-uncommon-factor-levels-into-other" class="section level3" number="31.5.3">
<h3><span class="header-section-number">31.5.3</span> Lump uncommon factor levels into <code>other</code></h3>
<p>Package <code>forcats</code> provides us a family of 4 functions that are useful in lumping together the levels meeting some given criteria. These are</p>
<ul>
<li><code>fct_lump_min()</code>: lumps levels that appear fewer than min times.</li>
<li><code>fct_lump_prop()</code>: lumps levels that appear in fewer than (or equal to) <code>prop</code> * <code>n</code> times.</li>
<li><code>fct_lump_n()</code> lumps all levels except for the n most frequent (or least frequent if <code>n</code> &lt; 0)</li>
<li><code>fct_lump_lowfreq()</code> lumps together the least frequent levels, ensuring that <code>"other"</code> is still the smallest level.</li>
</ul>
<p>These all functions, apart from taking factors <code>f</code> as argument, also take one or more argument, which fits into the case-</p>
<ul>
<li><code>n</code> Positive <code>n</code> preserves the most common <code>n</code> values. Negative <code>n</code> preserves the least common <code>-n</code> values.</li>
<li><code>prop</code> Positive <code>prop</code> lumps values which do not appear at least <code>prop</code> of the time. Negative prop lumps values that do not appear at most <code>-prop</code> of the time.</li>
<li><code>min</code> Preserve levels that appear at least <code>min</code> number of times.</li>
<li><code>w</code> An optional numeric vector giving weights for frequency of each value (not level) in <code>f</code>.</li>
<li><code>other_level</code>: Value of level used for <code>"other"</code>(default) values. Always placed at end of levels.</li>
</ul>
<p>Some examples-</p>
<div class="sourceCode" id="cb2022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2022-1"><a href="factors.html#cb2022-1" tabindex="-1"></a><span class="co"># We can check the religion in `gss_cat` and followers count</span></span>
<span id="cb2022-2"><a href="factors.html#cb2022-2" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span> </span>
<span id="cb2022-3"><a href="factors.html#cb2022-3" tabindex="-1"></a>  <span class="fu">count</span>(relig)</span></code></pre></div>
<pre><code>## # A tibble: 15 × 2
##    relig                       n
##    &lt;fct&gt;                   &lt;int&gt;
##  1 No answer                  93
##  2 Don&#39;t know                 15
##  3 Inter-nondenominational   109
##  4 Native american            23
##  5 Christian                 689
##  6 Orthodox-christian         95
##  7 Moslem/islam              104
##  8 Other eastern              32
##  9 Hinduism                   71
## 10 Buddhism                  147
## 11 Other                     224
## 12 None                     3523
## 13 Jewish                    388
## 14 Catholic                 5124
## 15 Protestant              10846</code></pre>
<div class="sourceCode" id="cb2024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2024-1"><a href="factors.html#cb2024-1" tabindex="-1"></a><span class="co"># Let&#39;s restrict these to 5 religions only</span></span>
<span id="cb2024-2"><a href="factors.html#cb2024-2" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span> </span>
<span id="cb2024-3"><a href="factors.html#cb2024-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">fct_lump_n</span>(relig, <span class="at">n =</span> <span class="dv">5</span>))) <span class="sc">+</span></span>
<span id="cb2024-4"><a href="factors.html#cb2024-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fctlump"></span>
<img src="DauR_files/figure-html/fctlump-1.png" alt="Lumping Factors" width="672" />
<p class="caption">
Figure 31.13: Lumping Factors
</p>
</div>
<p>In Figure <a href="factors.html#fig:fctlump">31.13</a> we can see that there are five religions plus <code>"other"</code> category placed in last. We may also notice that bars are not sorted yet.</p>
<p>We may also make use of <code>w</code> argument, if we already have our factor and its counts of levels in another vector. See figure <a href="factors.html#fig:fctlump2">31.14</a> -</p>
<div class="sourceCode" id="cb2025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2025-1"><a href="factors.html#cb2025-1" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span> </span>
<span id="cb2025-2"><a href="factors.html#cb2025-2" tabindex="-1"></a>  <span class="fu">count</span>(relig) <span class="sc">%&gt;%</span> </span>
<span id="cb2025-3"><a href="factors.html#cb2025-3" tabindex="-1"></a>  <span class="co"># Making use of `w` argument</span></span>
<span id="cb2025-4"><a href="factors.html#cb2025-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">relig =</span> <span class="fu">fct_lump_n</span>(relig, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">w =</span> n)) <span class="sc">%&gt;%</span> </span>
<span id="cb2025-5"><a href="factors.html#cb2025-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(relig, n)) <span class="sc">+</span></span>
<span id="cb2025-6"><a href="factors.html#cb2025-6" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fctlump2"></span>
<img src="DauR_files/figure-html/fctlump2-1.png" alt="Lumping Factors by making use of w argument" width="672" />
<p class="caption">
Figure 31.14: Lumping Factors by making use of w argument
</p>
</div>
<p>To sort the levels in increasing order of frequency we can use <code>fct_infreq()</code> function which we learnt in section <a href="factors.html#infreq">31.4.5</a>. It may also take <code>w</code> argument (optionally, of course) if we have our factor levels already counted. So, to sort the levels in Figure <a href="factors.html#fig:fctlump2">31.14</a>, we may make use of this function one step before lumping. See figure <a href="factors.html#fig:fctlump3">31.15</a>.</p>
<div class="sourceCode" id="cb2026"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2026-1"><a href="factors.html#cb2026-1" tabindex="-1"></a>gss_cat <span class="sc">%&gt;%</span> </span>
<span id="cb2026-2"><a href="factors.html#cb2026-2" tabindex="-1"></a>  <span class="fu">count</span>(relig) <span class="sc">%&gt;%</span> </span>
<span id="cb2026-3"><a href="factors.html#cb2026-3" tabindex="-1"></a>  <span class="co"># Sorting making use of `w` argument</span></span>
<span id="cb2026-4"><a href="factors.html#cb2026-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">relig =</span> <span class="fu">fct_infreq</span>(relig, <span class="at">w =</span> n),</span>
<span id="cb2026-5"><a href="factors.html#cb2026-5" tabindex="-1"></a>         <span class="at">relig =</span> <span class="fu">fct_lump_n</span>(relig, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">w =</span> n)) <span class="sc">%&gt;%</span> </span>
<span id="cb2026-6"><a href="factors.html#cb2026-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(relig, n)) <span class="sc">+</span></span>
<span id="cb2026-7"><a href="factors.html#cb2026-7" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fctlump3"></span>
<img src="DauR_files/figure-html/fctlump3-1.png" alt="Sorting and Lumping Factors" width="672" />
<p class="caption">
Figure 31.15: Sorting and Lumping Factors
</p>
</div>
<hr />

</div>
</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Audit Analytics</strong>" was written by Anil Goyal. It was last built on 2024-11-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
