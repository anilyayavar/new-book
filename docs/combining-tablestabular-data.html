<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 15 Combining Tables/tabular data | Data Analytics in Audit, using R</title>
<meta name="author" content="Anil Goyal">
<meta name="description" content="Figure 15.1: Most of times, joining two or more tables will be required to perform analytics  In real world scenarios, there may hardly be a case when we have to analyse one single table. There...">
<meta name="generator" content="bookdown 0.40 with bs4_book()">
<meta property="og:title" content="Chapter 15 Combining Tables/tabular data | Data Analytics in Audit, using R">
<meta property="og:type" content="book">
<meta property="og:description" content="Figure 15.1: Most of times, joining two or more tables will be required to perform analytics  In real world scenarios, there may hardly be a case when we have to analyse one single table. There...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 15 Combining Tables/tabular data | Data Analytics in Audit, using R">
<meta name="twitter:description" content="Figure 15.1: Most of times, joining two or more tables will be required to perform analytics  In real world scenarios, there may hardly be a case when we have to analyse one single table. There...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Analytics in Audit, using R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="about-author.html">About author</a></li>
<li><a class="" href="gearing-up.html">Gearing up</a></li>
<li><a class="" href="part-i-basic-r-programming-concepts.html">Part-I: Basic R Programming Concepts</a></li>
<li><a class="" href="r-programming-language.html"><span class="header-section-number">1</span> R Programming Language</a></li>
<li><a class="" href="subset.html"><span class="header-section-number">2</span> Subsetting R objects or accesing specific elements</a></li>
<li><a class="" href="func.html"><span class="header-section-number">3</span> Functions and operations in R</a></li>
<li><a class="" href="existing-and-useful-functions-in-base-r.html"><span class="header-section-number">4</span> Existing and useful functions in base R</a></li>
<li><a class="" href="pipes-in-r.html"><span class="header-section-number">5</span> Pipes in R</a></li>
<li><a class="" href="control-statements.html"><span class="header-section-number">6</span> Control statements</a></li>
<li><a class="" href="functional-programming.html"><span class="header-section-number">7</span> Functional Programming</a></li>
<li><a class="" href="file.html"><span class="header-section-number">8</span> File handling operations in R</a></li>
<li><a class="" href="read.html"><span class="header-section-number">9</span> Getting data in and out of R</a></li>
<li><a class="" href="data-cleaning-in-r.html"><span class="header-section-number">10</span> Data Cleaning in R</a></li>
<li><a class="" href="merging-large-number-of-similar-datasets-into-one.html"><span class="header-section-number">11</span> Merging large number of similar datasets into one</a></li>
<li><a class="" href="part-ii-exploratory-data-analysis.html">Part-II: Exploratory Data Analysis</a></li>
<li><a class="" href="visualisations-in-base-r.html"><span class="header-section-number">12</span> Visualisations in Base R</a></li>
<li><a class="" href="visualising-data-with-ggplot2.html"><span class="header-section-number">13</span> Visualising data with ggplot2</a></li>
<li><a class="" href="data-transformation-in-dplyr.html"><span class="header-section-number">14</span> Data Transformation in dplyr</a></li>
<li><a class="active" href="combining-tablestabular-data.html"><span class="header-section-number">15</span> Combining Tables/tabular data</a></li>
<li><a class="" href="data-wrangling-in-tidyr.html"><span class="header-section-number">16</span> Data Wrangling in tidyr</a></li>
<li><a class="" href="generating-descriptive-statistics.html"><span class="header-section-number">17</span> Generating Descriptive statistics</a></li>
<li><a class="" href="part-iii-probability-and-sampling-in-r.html">Part-III: Probability and Sampling in R</a></li>
<li><a class="" href="probability-in-r.html"><span class="header-section-number">18</span> Probability in R</a></li>
<li><a class="" href="random-sampling-in-r.html"><span class="header-section-number">19</span> Random sampling in R</a></li>
<li><a class="" href="part-iv-machine-learning-in-r.html">Part-IV: Machine Learning in R</a></li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">20</span> Linear Regression</a></li>
<li><a class="" href="principal-component-analysis-in-r.html"><span class="header-section-number">21</span> Principal Component Analysis in R</a></li>
<li><a class="" href="clustering-in-r-using-kmeans-algorithm.html"><span class="header-section-number">22</span> Clustering in R (Using Kmeans algorithm)</a></li>
<li><a class="" href="association-rule-mining-in-r-apriori.html"><span class="header-section-number">23</span> Association Rule Mining in R (Apriori)</a></li>
<li><a class="" href="part-v-time-series-analysis.html">Part-V: Time Series Analysis</a></li>
<li><a class="" href="manipulating-datedate-time-objects-using-lubridate.html"><span class="header-section-number">24</span> Manipulating Date/Date-time objects using lubridate</a></li>
<li><a class="" href="time-series-analysis.html"><span class="header-section-number">25</span> Time Series Analysis</a></li>
<li><a class="" href="part-vi-network-analytics.html">Part VI: Network Analytics</a></li>
<li><a class="" href="network-analyticsgraph-theory-in-r.html"><span class="header-section-number">26</span> Network Analytics/Graph theory in R</a></li>
<li><a class="" href="applying-network-analysis-in-auditfraud-detection.html"><span class="header-section-number">27</span> Applying network analysis in audit/fraud detection</a></li>
<li><a class="" href="part-vii-text-analytics-in-r.html">Part-VII: Text Analytics in R</a></li>
<li><a class="" href="string-manipulation-in-stringr.html"><span class="header-section-number">28</span> String manipulation in stringr</a></li>
<li><a class="" href="regex---a-quick-introduction.html"><span class="header-section-number">29</span> Regex - A quick introduction</a></li>
<li><a class="" href="regex-in-human-readble-format-using-rebus.html"><span class="header-section-number">30</span> Regex in human readble format using rebus</a></li>
<li><a class="" href="text-analytics-in-r.html"><span class="header-section-number">31</span> Text Analytics in R</a></li>
<li><a class="" href="sentiment-analysis.html"><span class="header-section-number">32</span> Sentiment Analysis</a></li>
<li><a class="" href="visualising-text-analytics-through-wordcloud-etc..html"><span class="header-section-number">33</span> Visualising Text analytics through Wordcloud, etc.</a></li>
<li><a class="" href="finding-string-similarity.html"><span class="header-section-number">34</span> Finding string similarity</a></li>
<li><a class="" href="part-viii-geo-computation-in-r.html">Part-VIII: Geo computation in R</a></li>
<li><a class="" href="maps-in-r.html"><span class="header-section-number">35</span> Maps in R</a></li>
<li><a class="" href="geo-coding-in-r.html"><span class="header-section-number">36</span> Geo-Coding in R</a></li>
<li><a class="" href="reverse-geo-coding.html"><span class="header-section-number">37</span> Reverse geo-coding</a></li>
<li><a class="" href="part-ix-identifying-anamolous-observations-for-audit.html">Part-IX: Identifying anamolous observations for audit</a></li>
<li><a class="" href="benford-testsanalysis.html"><span class="header-section-number">38</span> Benford Tests/Analysis</a></li>
<li><a class="" href="anomaly-detection.html"><span class="header-section-number">39</span> Anomaly Detection</a></li>
<li><a class="" href="finding-anamolous-outliers.html"><span class="header-section-number">40</span> Finding Anamolous Outliers</a></li>
<li><a class="" href="dup.html"><span class="header-section-number">41</span> Duplicate Detection</a></li>
<li><a class="" href="detecting-gaps-in-sequences.html"><span class="header-section-number">42</span> Detecting gaps in sequences</a></li>
<li><a class="" href="data-envelopment-analysis.html"><span class="header-section-number">43</span> Data Envelopment Analysis</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="colors-in-r.html"><span class="header-section-number">A</span> Colors in R</a></li>
<li><a class="" href="various-datasets-in-base-r-used-in-this-book.html"><span class="header-section-number">B</span> Various Datasets, in base R, used in this book</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="combining-tablestabular-data" class="section level1" number="15">
<h1>
<span class="header-section-number">15</span> Combining Tables/tabular data<a class="anchor" aria-label="anchor" href="#combining-tablestabular-data"><i class="fas fa-link"></i></a>
</h1>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-286"></span>
<img src="images/conf.jpg" alt="Most of times, joining two or more tables will be required to perform analytics" width="75%" height="75%"><p class="caption">
Figure 15.1: Most of times, joining two or more tables will be required to perform analytics
</p>
</div>
<p>In real world scenarios, there may hardly be a case when we have to analyse one single table. There may be cases when we have to either join tables split into multiple smaller tables (e.g. we can have smaller tables split States-wise), or the tables may be divided into various smaller master and transaction tables (relational databases).</p>
<p>We may thus divide the data tables joining requirements into three broad categories-</p>
<ul>
<li>Simple joins or concatenation</li>
<li>Relational Joins</li>
<li>Filtering Joins</li>
</ul>
<p>Let us discuss each of these with examples.</p>
<div id="simple-joinsconcatenation" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> Simple joins/concatenation<a class="anchor" aria-label="anchor" href="#simple-joinsconcatenation"><i class="fas fa-link"></i></a>
</h2>
<p>Many times tables split into smaller tables have to be joined back before proceeding further for data analytics. We may have to join two or more tables either columnwise (e.g. some of the features for all rows have been split into a separate table) or row wise (e.g. all the fields/columns are split into smaller tables like a separate table for each State). Diagramatically these joins may be depicted as shown in figure <a href="combining-tablestabular-data.html#fig:joins">15.2</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:joins"></span>
<img src="images/concat_joins.png" alt="Illustration of Simple joins/concatenation" width="99%"><p class="caption">
Figure 15.2: Illustration of Simple joins/concatenation
</p>
</div>
<div id="column-binding" class="section level3" number="15.1.1">
<h3>
<span class="header-section-number">15.1.1</span> Column binding<a class="anchor" aria-label="anchor" href="#column-binding"><i class="fas fa-link"></i></a>
</h3>
<p>As we have already seen that data frames act like matrices in many ways except to that fact that these support heterogeneous data unlike matrices. We have also discussed the ways two matrices can be joined. Base R has two dedicated functions i.e. <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code> and <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code> for these operations.</p>
<p>In <em>tidyverse</em> (dplyr specifically) we have two similar functions <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> and <code>bind_rows</code> respectively which provide us better functionality for these use cases. The syntax for finction <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> used for concatenating two or more tables <em>column wise</em> is -</p>
<pre><code>bind_cols(
  ...,
  .name_repair = c("unique", "universal", "check_unique")
)</code></pre>
<p>Where -</p>
<ul>
<li>
<code>...</code> represent data frames to be combined</li>
<li>
<code>.name_repair</code> argument chooses method to rename duplicate column names, if any.</li>
</ul>
<p>Example-1:</p>
<div class="sourceCode" id="cb880"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, .name_repair <span class="op">=</span> <span class="st">'universal'</span><span class="op">)</span></span></code></pre></div>
<pre><code>## New names:
## • `Species` -&gt; `Species...3`
## • `Species` -&gt; `Species...6`</code></pre>
<pre><code>##   Sepal.Length Sepal.Width Species...3 Petal.Length Petal.Width Species...6
## 1          5.1         3.5      setosa          1.4         0.2      setosa
## 2          4.9         3.0      setosa          1.4         0.2      setosa
## 3          4.7         3.2      setosa          1.3         0.2      setosa</code></pre>
<blockquote>
<p>Note: The data frames to be merged should be row-consistent for column binding. Try this <code>bind_cols(iris[1:3, 1:2], iris[1:4, 3:4])</code> and see the results.</p>
</blockquote>
</div>
<div id="row-binding" class="section level3" number="15.1.2">
<h3>
<span class="header-section-number">15.1.2</span> Row binding<a class="anchor" aria-label="anchor" href="#row-binding"><i class="fas fa-link"></i></a>
</h3>
<p>The syntax used for appending rows of one or more tables together in one table is -</p>
<pre><code>bind_rows(..., .id = NULL)</code></pre>
<p>where -</p>
<ul>
<li>
<code>...</code> represent data frames to be combined</li>
<li>
<code>.id</code> argument creates a new column of identifiers.</li>
</ul>
<p>To understand it better, let us see this example</p>
<div class="sourceCode" id="cb884"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">setosa</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">versicolor</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fl">51</span><span class="op">:</span><span class="fl">53</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">virginica</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fl">101</span><span class="op">:</span><span class="fl">103</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">setosa</span>, <span class="va">versicolor</span>, <span class="va">virginica</span>, .id <span class="op">=</span> <span class="st">'groups'</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   groups Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1      1          5.1         3.5          1.4         0.2
## 2      1          4.9         3.0          1.4         0.2
## 3      1          4.7         3.2          1.3         0.2
## 4      2          7.0         3.2          4.7         1.4
## 5      2          6.4         3.2          4.5         1.5
## 6      2          6.9         3.1          4.9         1.5
## 7      3          6.3         3.3          6.0         2.5
## 8      3          5.8         2.7          5.1         1.9
## 9      3          7.1         3.0          5.9         2.1</code></pre>
<blockquote>
<p>Note: In the above example if the requirement is to store data tables names into the new <em>identifier</em> column just list convert the databases into a list and <code>.id</code> will take element_names as the values in identifiers. Try this <code>bind_rows(list(setosa=setosa, versicolor=versicolor, virginica=virginica), .id = 'Species')</code></p>
</blockquote>
</div>
</div>
<div id="relational-joins" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> Relational joins<a class="anchor" aria-label="anchor" href="#relational-joins"><i class="fas fa-link"></i></a>
</h2>
<p>Relational Joins are usually needed to join multiple tables based on <em>primary key</em> and <em>secondary keys</em>. The joins may either be <em>one-to-one</em> key join or <em>one-to-many</em> key joins. Broadly these can either be <em>inner joins</em> or <em>outer joins</em>. Diagrammatically these may be represented as shown in figure <a href="combining-tablestabular-data.html#fig:joinm">15.3</a> wherein it may be noticed that additional columns from <code>right</code> data frame gets appended to <code>left</code> data frame. For this reason, these four joins are also known as mutating joins.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:joinm"></span>
<img src="images/mutating_joins.png" alt="Illustration of Mutating Joins in dplyr" width="99%"><p class="caption">
Figure 15.3: Illustration of Mutating Joins in dplyr
</p>
</div>
<p>The syntax of all these joins is nearly same-</p>
<pre><code>*_join(x, y, by = NULL, copy = FALSE, suffix = c('.x', '.y'), ... , keep = FALSE)</code></pre>
<p>where -</p>
<ul>
<li>
<code>x</code> and <code>y</code> are data frames to be joined</li>
<li>
<code>by</code> is a character vector of column names to be joined by</li>
<li>
<code>suffix</code> argument provides suffixes to be added to column names, if any of those are duplicate</li>
<li>
<code>keep</code> argument decides whether the join keys from both x and y be preserved in the output?</li>
</ul>
<p>Let’s discuss each of these joins individually.</p>
<div id="inner-joins" class="section level3" number="15.2.1">
<h3>
<span class="header-section-number">15.2.1</span> Inner Joins<a class="anchor" aria-label="anchor" href="#inner-joins"><i class="fas fa-link"></i></a>
</h3>
<p>Inner Joins keeps only those rows where matching keys are present in both the data frames.</p>
<p>Example-1:</p>
<div class="sourceCode" id="cb887"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">band_members</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 Mick  Stones 
## 2 John  Beatles
## 3 Paul  Beatles</code></pre>
<div class="sourceCode" id="cb889"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">band_instruments</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   name  plays 
##   &lt;chr&gt; &lt;chr&gt; 
## 1 John  guitar
## 2 Paul  bass  
## 3 Keith guitar</code></pre>
<div class="sourceCode" id="cb891"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">band_members</span>, <span class="va">band_instruments</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Joining with `by = join_by(name)`</code></pre>
<pre><code>## # A tibble: 2 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass</code></pre>
</div>
<div id="left-joins" class="section level3" number="15.2.2">
<h3>
<span class="header-section-number">15.2.2</span> Left Joins<a class="anchor" aria-label="anchor" href="#left-joins"><i class="fas fa-link"></i></a>
</h3>
<p>Left Joins on the other hand preserves all rows of data frame passed as <code>x</code> i.e. first argument irrespective of the fact that matching key record is available in second data table or not.</p>
<p>Example-1:</p>
<div class="sourceCode" id="cb894"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">band_members</span>, <span class="va">band_instruments</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Joining with `by = join_by(name)`</code></pre>
<pre><code>## # A tibble: 3 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass</code></pre>
</div>
<div id="right-joins" class="section level3" number="15.2.3">
<h3>
<span class="header-section-number">15.2.3</span> Right Joins<a class="anchor" aria-label="anchor" href="#right-joins"><i class="fas fa-link"></i></a>
</h3>
<p>Right join, is similar to left join and preserves all rows of data frame passed as <code>y</code> i.e. second argument irrespective of the fact that matching key record is available in first data table or not.</p>
<p>Example-1:</p>
<div class="sourceCode" id="cb897"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span><span class="va">band_members</span>, <span class="va">band_instruments</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Joining with `by = join_by(name)`</code></pre>
<pre><code>## # A tibble: 3 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass  
## 3 Keith &lt;NA&gt;    guitar</code></pre>
</div>
<div id="full-joins" class="section level3" number="15.2.4">
<h3>
<span class="header-section-number">15.2.4</span> Full Joins<a class="anchor" aria-label="anchor" href="#full-joins"><i class="fas fa-link"></i></a>
</h3>
<p>Full join returns all the rows of both the data tables despite non-availability of matching key in either of the tables.</p>
<p>Example-1:</p>
<div class="sourceCode" id="cb900"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">band_members</span>, <span class="va">band_instruments</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Joining with `by = join_by(name)`</code></pre>
<pre><code>## # A tibble: 4 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass  
## 4 Keith &lt;NA&gt;    guitar</code></pre>
<p>You must have noticed that each of the examples shown above has thrown a warning that join has been performed on variable <code>name</code>. We may override this warning by specifically providing the joining <em>key</em> column name(s) in <code>by</code> argument i.e. <code>by = "name"</code>.</p>
<p>There may be cases when the joining <em>key</em> column(s) in the two data frames are of different names. These cases can also be handled by using <code>by</code> argument.</p>
<p>Example-</p>
<div class="sourceCode" id="cb903"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">band_instruments2</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   artist plays 
##   &lt;chr&gt;  &lt;chr&gt; 
## 1 John   guitar
## 2 Paul   bass  
## 3 Keith  guitar</code></pre>
<div class="sourceCode" id="cb905"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">band_members</span>, <span class="va">band_instruments2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'name'</span> <span class="op">=</span> <span class="st">'artist'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass</code></pre>
<blockquote>
<p>Note: Each of the <code>*_join()</code> can be joined on multiple keys/columns (i.e. more than one) using <code>by</code> argument as explained above.</p>
</blockquote>
</div>
<div id="many-to-many-joins" class="section level3 unnumbered">
<h3>Many-to-many Joins<a class="anchor" aria-label="anchor" href="#many-to-many-joins"><i class="fas fa-link"></i></a>
</h3>
<p>Example of four of the above-mentioned joins are many to many joins and thus need to be used carefully. See the following example</p>
<div class="sourceCode" id="cb907"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">21</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df1</span></span></code></pre></div>
<pre><code>##    x  y
## 1  1 11
## 2  1 12
## 3 NA 21</code></pre>
<div class="sourceCode" id="cb909"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">101</span>, <span class="fl">102</span>, <span class="fl">201</span>, <span class="fl">202</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df2</span></span></code></pre></div>
<pre><code>##    x   z
## 1  1 101
## 2  1 102
## 3 NA 201
## 4 NA 202</code></pre>
<div class="sourceCode" id="cb911"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df2</span>, by <span class="op">=</span> <span class="st">'x'</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning in left_join(., df2, by = "x"): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 1 of `x` matches multiple rows in `y`.
## ℹ Row 1 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship =
##   "many-to-many"` to silence this warning.</code></pre>
<pre><code>##    x  y   z
## 1  1 11 101
## 2  1 11 102
## 3  1 12 101
## 4  1 12 102
## 5 NA 21 201
## 6 NA 21 202</code></pre>
<p>In fact, we can use argument <code>relationship</code> explicitly to silence this warning and avoid errors. This argument can take one of these values</p>
<ul>
<li>
<code>NULL</code> (default)</li>
<li><code>"one-to-one"</code></li>
<li><code>"one-to-many"</code></li>
<li><code>"many-to-one"</code></li>
<li><code>"many-to-many"</code></li>
</ul>
<p>Example above re-coded</p>
<div class="sourceCode" id="cb914"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df2</span>, by <span class="op">=</span> <span class="st">'x'</span>, relationship <span class="op">=</span> <span class="st">"many-to-many"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##    x  y   z
## 1  1 11 101
## 2  1 11 102
## 3  1 12 101
## 4  1 12 102
## 5 NA 21 201
## 6 NA 21 202</code></pre>
</div>
</div>
<div id="filtering-joins" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> Filtering Joins<a class="anchor" aria-label="anchor" href="#filtering-joins"><i class="fas fa-link"></i></a>
</h2>
<p>The other joins available in <code>dplyr</code> are basically filtering joins. These joins will not result in appending additional columns present in <code>right</code> data frame to <code>left</code> data frame. Only the common keys (columns) from right data frame will be used to filter left data frame.</p>
<div id="semi-joins" class="section level3" number="15.3.1">
<h3>
<span class="header-section-number">15.3.1</span> Semi Joins<a class="anchor" aria-label="anchor" href="#semi-joins"><i class="fas fa-link"></i></a>
</h3>
<p>First of these is <code>semi_join</code> which essentially filters those rows from a data frame, which are based on another data frame. See this example-</p>
<div class="sourceCode" id="cb916"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">21</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df1</span></span></code></pre></div>
<pre><code>##    x   y
## 1  1  11
## 2  2  21
## 3 NA 100</code></pre>
<div class="sourceCode" id="cb918"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">101</span>, <span class="fl">301</span>, <span class="fl">401</span>, <span class="fl">501</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df2</span></span></code></pre></div>
<pre><code>##    x   z
## 1  1 101
## 2  3 301
## 3  4 401
## 4 NA 501</code></pre>
<div class="sourceCode" id="cb920"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">df2</span>, by <span class="op">=</span> <span class="st">'x'</span><span class="op">)</span></span></code></pre></div>
<pre><code>##    x   y
## 1  1  11
## 2 NA 100</code></pre>
</div>
<div id="anti-joins" class="section level3" number="15.3.2">
<h3>
<span class="header-section-number">15.3.2</span> Anti Joins<a class="anchor" aria-label="anchor" href="#anti-joins"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>anti_join</code> is basically opposite to that of <code>semi_join</code>. It keeps only those records from left data-frame which are not available in right data-frame. Example</p>
<div class="sourceCode" id="cb922"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">df2</span>, by <span class="op">=</span> <span class="st">'x'</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   x  y
## 1 2 21</code></pre>
</div>
</div>
<div id="relational-but-non-equi-joins" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> Relational, but non-equi joins<a class="anchor" aria-label="anchor" href="#relational-but-non-equi-joins"><i class="fas fa-link"></i></a>
</h2>
<p>Till now, we have learnt joins that use syntax of dplyr version before 1.1.0. However, in dplyr newest version, 1.1.0, released in January 2023, a new helper function <code><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by()</a></code> has been introduced. It actually, constructs a specification that describes how to join two tables using a small domain specific language. The result can be supplied as the by argument to any of the join functions that we have learnt above. For equal joins, we have learnt above, there are two slight but easier to implement changes if we use <code><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by()</a></code> -</p>
<ul>
<li>we may pass variable names in by argument instead of using characters as described above.</li>
<li>instead of using <code>=</code> we have to use <code>==</code> which is actually the equality operator as opposed to assignment operator we were using earlier.</li>
</ul>
<p>So our syntax for <code>left_join</code> example is</p>
<div class="sourceCode" id="cb924"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">band_instruments2</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   artist plays 
##   &lt;chr&gt;  &lt;chr&gt; 
## 1 John   guitar
## 2 Paul   bass  
## 3 Keith  guitar</code></pre>
<div class="sourceCode" id="cb926"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">band_members</span>, <span class="va">band_instruments2</span>, by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="va">artist</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass</code></pre>
<p>Simple, isn’t it. But now using the potential of this new helper function, we can on the other hand join two (or more data frames) using inequality conditions.</p>
<div id="inequality-joins" class="section level3" number="15.4.1">
<h3>
<span class="header-section-number">15.4.1</span> Inequality Joins<a class="anchor" aria-label="anchor" href="#inequality-joins"><i class="fas fa-link"></i></a>
</h3>
<p>Inequality joins match on an inequality, such as <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, or <code>&lt;=</code>, and are common in time series analysis and genomics. To construct an inequality join using <code><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by()</a></code>, we have to supply two column names separated by one of the above mentioned inequalities. See the following example for better understanding of inequality joins.</p>
<p>Example- Suppose we have two tables, one containing product-wise <code>sales</code> and another containing <code>rates</code> as and when these are revised. So, in order to have total sales amount, we can use inequality join.</p>
<div class="sourceCode" id="cb928"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sales</span></span>
<span><span class="va">sales</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  product.id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>  sales.date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"01-01-2022"</span>,</span>
<span>                 <span class="st">"02-02-2022"</span>,<span class="st">"05-11-2022"</span>,<span class="st">"05-04-2022"</span>,</span>
<span>                 <span class="st">"05-10-2022"</span>,<span class="st">"01-02-2022"</span>,<span class="st">"01-01-2023"</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%d-%m-%Y"</span><span class="op">)</span>,</span>
<span>  quantity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5L</span>, <span class="fl">10L</span>, <span class="fl">15L</span>, <span class="fl">5L</span>, <span class="fl">15L</span>, <span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Print it</span></span>
<span><span class="va">sales</span></span></code></pre></div>
<pre><code>##   product.id sales.date quantity
## 1          A 2022-01-01        5
## 2          A 2022-02-02       10
## 3          A 2022-11-05       15
## 4          A 2022-04-05        5
## 5          A 2022-10-05       15
## 6          B 2022-02-01        1
## 7          B 2023-01-01        2</code></pre>
<div class="sourceCode" id="cb930"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rates</span></span>
<span><span class="va">rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  product.id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>  revision.date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"01-02-2022"</span>,</span>
<span>                    <span class="st">"03-04-2022"</span>,<span class="st">"05-10-2022"</span>,<span class="st">"01-01-2022"</span>,</span>
<span>                    <span class="st">"05-10-2022"</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%d-%m-%Y"</span><span class="op">)</span>,</span>
<span>  rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50L</span>, <span class="fl">60L</span>, <span class="fl">70L</span>, <span class="fl">500L</span>, <span class="fl">1500L</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#print it</span></span>
<span><span class="va">rates</span></span></code></pre></div>
<pre><code>##   product.id revision.date rate
## 1          A    2022-02-01   50
## 2          A    2022-04-03   60
## 3          A    2022-10-05   70
## 4          B    2022-01-01  500
## 5          B    2022-10-05 1500</code></pre>
<div class="sourceCode" id="cb932"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># total sale(1st attempt)</span></span>
<span><span class="va">sales</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">rates</span>,</span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">product.id</span>,</span>
<span>                         <span class="va">sales.date</span> <span class="op">&gt;=</span> <span class="va">revision.date</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##    product.id sales.date quantity revision.date rate
## 1           A 2022-01-01        5          &lt;NA&gt;   NA
## 2           A 2022-02-02       10    2022-02-01   50
## 3           A 2022-11-05       15    2022-02-01   50
## 4           A 2022-11-05       15    2022-04-03   60
## 5           A 2022-11-05       15    2022-10-05   70
## 6           A 2022-04-05        5    2022-02-01   50
## 7           A 2022-04-05        5    2022-04-03   60
## 8           A 2022-10-05       15    2022-02-01   50
## 9           A 2022-10-05       15    2022-04-03   60
## 10          A 2022-10-05       15    2022-10-05   70
## 11          B 2022-02-01        1    2022-01-01  500
## 12          B 2023-01-01        2    2022-01-01  500
## 13          B 2023-01-01        2    2022-10-05 1500</code></pre>
<p>We got the results, but the results/rates are obtained fixed on all earlier dates. To solve this issue, we have <strong>rolling joins</strong>. See next section.</p>
</div>
<div id="rolling-joins" class="section level3" number="15.4.2">
<h3>
<span class="header-section-number">15.4.2</span> Rolling Joins<a class="anchor" aria-label="anchor" href="#rolling-joins"><i class="fas fa-link"></i></a>
</h3>
<p>Rolling joins are a variant of inequality joins that limit the results returned from an inequality join condition. They are useful for “rolling” the closest match forward/backwards when there isn’t an exact match. To construct a rolling join, we have to wrap inequality condition with <code>closest()</code>.</p>
<p>Above example solved by wrapping date condition in <code>closest()</code></p>
<div class="sourceCode" id="cb934"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sales</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">rates</span>,</span>
<span>            by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">product.id</span>,</span>
<span>                         <span class="fu">closest</span><span class="op">(</span><span class="va">sales.date</span> <span class="op">&gt;=</span> <span class="va">revision.date</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   product.id sales.date quantity revision.date rate
## 1          A 2022-01-01        5          &lt;NA&gt;   NA
## 2          A 2022-02-02       10    2022-02-01   50
## 3          A 2022-11-05       15    2022-10-05   70
## 4          A 2022-04-05        5    2022-04-03   60
## 5          A 2022-10-05       15    2022-10-05   70
## 6          B 2022-02-01        1    2022-01-01  500
## 7          B 2023-01-01        2    2022-10-05 1500</code></pre>
<p>We may see that we do not have rates for product <code>A</code> for sales made on <code>01-01-2022</code>.</p>
</div>
<div id="overlap-joins" class="section level3" number="15.4.3">
<h3>
<span class="header-section-number">15.4.3</span> Overlap Joins<a class="anchor" aria-label="anchor" href="#overlap-joins"><i class="fas fa-link"></i></a>
</h3>
<p>Overlap joins are a special case of inequality joins involving one or two columns from the left-hand table overlapping a range defined by two columns from the right-hand table. There are three helpers that <code><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by()</a></code> recognizes to assist with constructing overlap joins, all of which can be constructed from simpler inequalities.</p>
<ul>
<li><p><code>between(x, y_lower, y_upper, ..., bounds = "[]")</code> which is just short for <code>x &gt;= y_lower, x &lt;= y_upper</code></p></li>
<li><p><code>within(x_lower, x_upper, y_lower, y_upper)</code> which is just short for <code>x_lower &gt;= y_lower, x_upper &lt;= y_upper</code></p></li>
<li><p><code>overlaps(x_lower, x_upper, y_lower, y_upper, ..., bounds = "[]")</code> which is short for <code>x_lower &lt;= y_upper, x_upper &gt;= y_lower</code></p></li>
</ul>
<p>We can make use of these functions as per our need.</p>
<p>Example-2: Suppose we have <code>orders</code> data where we have customer-wise orders, corresponsing order dates and ship dates. Let us suppose we want to know about customers who placed another order, without waiting for shipping of any of their previous/earlier order.</p>
<div class="sourceCode" id="cb936"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>customer_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, </span>
<span><span class="st">"C"</span><span class="op">)</span>, order_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, order_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2019-01-01"</span>, <span class="st">"2019-01-05"</span>, </span>
<span><span class="st">"2019-01-16"</span>, <span class="st">"2019-01-05"</span>, <span class="st">"2019-01-06"</span>, <span class="st">"2019-01-07"</span>, <span class="st">"2019-01-09"</span></span>
<span><span class="op">)</span>, ship_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2019-01-30"</span>, <span class="st">"2019-02-10"</span>, <span class="st">"2019-01-18"</span>, <span class="st">"2019-01-08"</span>, </span>
<span><span class="st">"2019-01-08"</span>, <span class="st">"2019-01-08"</span>, <span class="st">"2019-01-10"</span><span class="op">)</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, </span>
<span><span class="op">-</span><span class="fl">7L</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print </span></span>
<span><span class="va">orders</span></span></code></pre></div>
<pre><code>##   customer_id order_id order_date  ship_date
## 1           A        1 2019-01-01 2019-01-30
## 2           A        2 2019-01-05 2019-02-10
## 3           A        3 2019-01-16 2019-01-18
## 4           B        4 2019-01-05 2019-01-08
## 5           B        5 2019-01-06 2019-01-08
## 6           C        6 2019-01-07 2019-01-08
## 7           C        7 2019-01-09 2019-01-10</code></pre>
<div class="sourceCode" id="cb938"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># customers who placed the orders without</span></span>
<span><span class="co"># waiting to ship their earlier order</span></span>
<span><span class="va">orders</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">orders</span>,</span>
<span>             by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">customer_id</span>,</span>
<span>                          <span class="fu">overlaps</span><span class="op">(</span><span class="va">order_date</span>, <span class="va">ship_date</span>, <span class="va">order_date</span>, <span class="va">ship_date</span><span class="op">)</span>,</span>
<span>                          <span class="va">order_id</span> <span class="op">&lt;</span> <span class="va">order_id</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code>##   customer_id order_id.x order_date.x ship_date.x order_id.y order_date.y
## 1           A          1   2019-01-01  2019-01-30          2   2019-01-05
## 2           A          1   2019-01-01  2019-01-30          3   2019-01-16
## 3           A          2   2019-01-05  2019-02-10          3   2019-01-16
## 4           B          4   2019-01-05  2019-01-08          5   2019-01-06
##   ship_date.y
## 1  2019-02-10
## 2  2019-01-18
## 3  2019-01-18
## 4  2019-01-08</code></pre>
</div>
<div id="example-uses-of-rolling-joins." class="section level3" number="15.4.4">
<h3>
<span class="header-section-number">15.4.4</span> Example uses of rolling joins.<a class="anchor" aria-label="anchor" href="#example-uses-of-rolling-joins."><i class="fas fa-link"></i></a>
</h3>
<p><strong>The content is under development.</strong></p>
</div>
<div id="cross-joins" class="section level3" number="15.4.5">
<h3>
<span class="header-section-number">15.4.5</span> Cross Joins<a class="anchor" aria-label="anchor" href="#cross-joins"><i class="fas fa-link"></i></a>
</h3>
<p>This join matches everything with everything and therefore can be thought of as a cross product of two data frames. We can use <code>cross_join</code> for this special join. If we have <code>m</code> and <code>n</code> rows in two data frames, then as a result of cross join we will have <code>m*n</code> rows.</p>
<p>Example-</p>
<div class="sourceCode" id="cb940"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>products <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'C'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/cross_join.html">cross_join</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   products.x products.y
## 1          A          A
## 2          A          B
## 3          A          C
## 4          B          A
## 5          B          B
## 6          B          C
## 7          C          A
## 8          C          B
## 9          C          C</code></pre>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="data-transformation-in-dplyr.html"><span class="header-section-number">14</span> Data Transformation in dplyr</a></div>
<div class="next"><a href="data-wrangling-in-tidyr.html"><span class="header-section-number">16</span> Data Wrangling in tidyr</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#combining-tablestabular-data"><span class="header-section-number">15</span> Combining Tables/tabular data</a></li>
<li>
<a class="nav-link" href="#simple-joinsconcatenation"><span class="header-section-number">15.1</span> Simple joins/concatenation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#column-binding"><span class="header-section-number">15.1.1</span> Column binding</a></li>
<li><a class="nav-link" href="#row-binding"><span class="header-section-number">15.1.2</span> Row binding</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#relational-joins"><span class="header-section-number">15.2</span> Relational joins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#inner-joins"><span class="header-section-number">15.2.1</span> Inner Joins</a></li>
<li><a class="nav-link" href="#left-joins"><span class="header-section-number">15.2.2</span> Left Joins</a></li>
<li><a class="nav-link" href="#right-joins"><span class="header-section-number">15.2.3</span> Right Joins</a></li>
<li><a class="nav-link" href="#full-joins"><span class="header-section-number">15.2.4</span> Full Joins</a></li>
<li><a class="nav-link" href="#many-to-many-joins">Many-to-many Joins</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#filtering-joins"><span class="header-section-number">15.3</span> Filtering Joins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#semi-joins"><span class="header-section-number">15.3.1</span> Semi Joins</a></li>
<li><a class="nav-link" href="#anti-joins"><span class="header-section-number">15.3.2</span> Anti Joins</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#relational-but-non-equi-joins"><span class="header-section-number">15.4</span> Relational, but non-equi joins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#inequality-joins"><span class="header-section-number">15.4.1</span> Inequality Joins</a></li>
<li><a class="nav-link" href="#rolling-joins"><span class="header-section-number">15.4.2</span> Rolling Joins</a></li>
<li><a class="nav-link" href="#overlap-joins"><span class="header-section-number">15.4.3</span> Overlap Joins</a></li>
<li><a class="nav-link" href="#example-uses-of-rolling-joins."><span class="header-section-number">15.4.4</span> Example uses of rolling joins.</a></li>
<li><a class="nav-link" href="#cross-joins"><span class="header-section-number">15.4.5</span> Cross Joins</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Analytics in Audit, using R</strong>" was written by Anil Goyal. It was last built on 2024-07-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
