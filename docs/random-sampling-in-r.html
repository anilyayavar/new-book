<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Chapter 19 Random sampling in R | R for Audit Analytics</title>

    <meta name="author" content="Anil Goyal" />
  
   <meta name="description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Chapter 19 Random sampling in R | R for Audit Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://anilyayavar.github.io/new-book/" />
  <meta property="og:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg" />
  <meta property="og:description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 19 Random sampling in R | R for Audit Analytics" />
  
  <meta name="twitter:description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />
  <meta name="twitter:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.8.0/transition.js"></script>
    <script src="libs/bs3compat-0.8.0/tabs.js"></script>
    <script src="libs/bs3compat-0.8.0/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
    <style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
      <link rel="stylesheet" href="style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Audit Analytics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="random-sampling-in-r" class="section level1" number="19">
<h1><span class="header-section-number">Chapter 19</span> Random sampling in R</h1>
<p>International Standard On Auditing - 530 defines<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a> audit sampling as <em>the application of audit procedures to less than 100% of items within a population of audit relevance such that all sampling units have a chance of selection in order to provide the auditor with a reasonable basis on which to draw conclusions about the entire population.</em> Statistical sampling is further defines as <em>an approach to sampling having two characteristics - random selection of samples, and the use of probability theory to evaluate sample results, including measurement of sampling risk.</em></p>
<p>Appendix 4 of ISA 53 further prescribes different statistical methods of sample selection. We will discuss here each type of sampling methodology used to sample records for audit.</p>
<p><strong>Prerequisites</strong></p>
<p>Load <code>tidyverse</code></p>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1120-1"><a href="random-sampling-in-r.html#cb1120-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="simple-random-sampling-with-and-without-replacement" class="section level2" number="19.1">
<h2><span class="header-section-number">19.1</span> Simple Random Sampling (With and without replacement)</h2>
<p>In this method, records are selected completely at random, by generating random numbers e.g. using random number tables, etc. Refer figure <a href="random-sampling-in-r.html#fig:simple">19.1</a> for illustration. We can replicate the method of random number generation in R. Even the method of random number generation can be reproducible, by fixing the random number seed. Mainly two functions will be used here <code>sample()</code> and <code>set.seed()</code> already discussed in section <a href="existing-and-useful-functions-in-base-r.html#prob">4.9</a>. Since <code>sample()</code> function takes a vector as input and gives vector as output again, we can make use of <code>dplyr::slice_sample()</code> function, discussed in section <a href="existing-and-useful-functions-in-base-r.html#prob">4.9</a>, which operates on data frames instead.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:simple"></span>
<img src="images/simple.png" alt="Illustration of Simple Random Sampling" width="99%" />
<p class="caption">
Figure 19.1: Illustration of Simple Random Sampling
</p>
</div>
<p>Let’s see this sampling on <code>iris</code> data. Suppose we have to select a sample of <code>n=12</code> records, without replacement-</p>
<pre><code>dat &lt;- iris # input data
# set the seed
set.seed(123)
# sample n records
dat %&gt;% 
  slice_sample(n = 12, replace = FALSE)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Sepal.Length</th>
<th align="right">Sepal.Width</th>
<th align="right">Petal.Length</th>
<th align="right">Petal.Width</th>
<th align="left">Species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4.3</td>
<td align="right">3.0</td>
<td align="right">1.1</td>
<td align="right">0.1</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">5.0</td>
<td align="right">3.3</td>
<td align="right">1.4</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">7.7</td>
<td align="right">3.8</td>
<td align="right">6.7</td>
<td align="right">2.2</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">4.4</td>
<td align="right">3.2</td>
<td align="right">1.3</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">5.9</td>
<td align="right">3.0</td>
<td align="right">5.1</td>
<td align="right">1.8</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.5</td>
<td align="right">3.0</td>
<td align="right">5.2</td>
<td align="right">2.0</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.5</td>
<td align="right">2.5</td>
<td align="right">4.0</td>
<td align="right">1.3</td>
<td align="left">versicolor</td>
</tr>
<tr class="even">
<td align="right">5.5</td>
<td align="right">2.6</td>
<td align="right">4.4</td>
<td align="right">1.2</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">5.8</td>
<td align="right">2.7</td>
<td align="right">5.1</td>
<td align="right">1.9</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.1</td>
<td align="right">3.0</td>
<td align="right">4.6</td>
<td align="right">1.4</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">6.3</td>
<td align="right">3.4</td>
<td align="right">5.6</td>
<td align="right">2.4</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">5.1</td>
<td align="right">2.5</td>
<td align="right">3.0</td>
<td align="right">1.1</td>
<td align="left">versicolor</td>
</tr>
</tbody>
</table>
<p>The syntax is simple. In the first step we have fixed the random number seed for reproducibility. Using <code>slice_sample()</code> we have selected <code>n=12</code> records without replacement (<code>replace = FALSE</code>).</p>
<blockquote>
<p>If sample size is based on some proportion, we have to use <code>prop = .10</code> (say 10%) instead of <code>n</code> argument. Moreover, if sampling is with replacement, we have to use <code>replace = TRUE</code>.</p>
</blockquote>
</div>
<div id="srs" class="section level2" number="19.2">
<h2><span class="header-section-number">19.2</span> Systematic random sampling</h2>
<p>ISA 530 defines this sampling approach as <em>‘Systematic selection, in which the number of sampling units in the population is divided by the sample size to give a sampling interval, for example 50, and having determined a starting point within the first 50, each 50th sampling unit thereafter is selected. Although the starting point may be determined haphazardly, the sample is more likely to be truly random if it is determined by use of a computerized random number generator or random number tables. When using systematic selection, the auditor would need to determine that sampling units within the population are not structured in such a way that the sampling interval corresponds with a particular pattern in the population.’</em> Refer figure <a href="random-sampling-in-r.html#fig:systematic">19.2</a> for illustration.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:systematic"></span>
<img src="images/systematic.png" alt="Illustration of Systematic Random Sampling" width="99%" />
<p class="caption">
Figure 19.2: Illustration of Systematic Random Sampling
</p>
</div>
<p>We can replicate this approach again following two steps-</p>
<p><strong>Step-1:</strong> Select <code>n</code> as the sample size. Then generate a maximum starting point say <code>s</code> by dividing number of rows in the data by <code>n</code>. Thereafter we have to choose a starting point from <code>1:s</code>. We can use sample function here. Let’s say this starting number is <code>s1</code>. Then we have to generate an arithmetic sequence, say <code>rand_seq</code> starting from <code>s1</code> and increasing every <code>s</code> steps thereafter with total <code>n</code> terms.</p>
<p><strong>Step-2:</strong> In the next step we will shuffle the data by using <code>slice_sample</code> and select a sample using function <code>filter</code>.</p>
<p>The methodology is replicated as</p>
<pre><code>set.seed(123)
n &lt;- 15 # sample size
s &lt;- floor(nrow(dat)/n)
s1 &lt;- sample(1:s, 1, replace = FALSE)
rand_seq &lt;- seq(s1, by = s, length.out = n)
dat %&gt;% 
  slice_sample(prop = 1) %&gt;% 
  filter(row_number() %in% rand_seq)
  </code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Sepal.Length</th>
<th align="right">Sepal.Width</th>
<th align="right">Petal.Length</th>
<th align="right">Petal.Width</th>
<th align="left">Species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">7.7</td>
<td align="right">3.8</td>
<td align="right">6.7</td>
<td align="right">2.2</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.1</td>
<td align="right">2.8</td>
<td align="right">4.0</td>
<td align="right">1.3</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">7.6</td>
<td align="right">3.0</td>
<td align="right">6.6</td>
<td align="right">2.1</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">7.2</td>
<td align="right">3.2</td>
<td align="right">6.0</td>
<td align="right">1.8</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">7.2</td>
<td align="right">3.0</td>
<td align="right">5.8</td>
<td align="right">1.6</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.3</td>
<td align="right">2.7</td>
<td align="right">4.9</td>
<td align="right">1.8</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">4.8</td>
<td align="right">3.1</td>
<td align="right">1.6</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">6.4</td>
<td align="right">2.8</td>
<td align="right">5.6</td>
<td align="right">2.1</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.6</td>
<td align="right">3.0</td>
<td align="right">4.5</td>
<td align="right">1.5</td>
<td align="left">versicolor</td>
</tr>
<tr class="even">
<td align="right">4.9</td>
<td align="right">2.5</td>
<td align="right">4.5</td>
<td align="right">1.7</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.9</td>
<td align="right">3.2</td>
<td align="right">4.8</td>
<td align="right">1.8</td>
<td align="left">versicolor</td>
</tr>
<tr class="even">
<td align="right">6.3</td>
<td align="right">3.3</td>
<td align="right">6.0</td>
<td align="right">2.5</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.4</td>
<td align="right">3.7</td>
<td align="right">1.5</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">6.7</td>
<td align="right">3.1</td>
<td align="right">4.4</td>
<td align="right">1.4</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">5.2</td>
<td align="right">3.5</td>
<td align="right">1.5</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
</tbody>
</table>
</div>
<div id="probability-proportionate-to-size-with-or-without-replacement-a.k.a-monetary-unit-sampling" class="section level2" number="19.3">
<h2><span class="header-section-number">19.3</span> Probability Proportionate to size (with or without replacement) a.k.a monetary unit sampling</h2>
<p>This sampling approach is defined in ISA-530 as <em>“a type of value-weighted selection in which sample size, selection and evaluation results in a conclusion in monetary amounts.”</em></p>
<p>Our methodology is not much difference from methodology adopted in section <a href="random-sampling-in-r.html#srs">19.2</a> except that we will make use of <code>weight_by =</code> argument now.</p>
<p>Let’s use <code>state.x77</code> data that comes with base R. Since the data is in matrix format, let’s first convert it data frame using <code>as.data.frame()</code> first.</p>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="random-sampling-in-r.html#cb1123-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(state.x77)</span></code></pre></div>
<p>Other steps are simple.</p>
<pre><code>set.seed(123)
dat %&gt;% 
  slice_sample(n=12, weight_by = Population)</code></pre>
<table>
<colgroup>
<col width="17%" />
<col width="13%" />
<col width="8%" />
<col width="13%" />
<col width="11%" />
<col width="8%" />
<col width="10%" />
<col width="7%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Population</th>
<th align="right">Income</th>
<th align="right">Illiteracy</th>
<th align="right">Life Exp</th>
<th align="right">Murder</th>
<th align="right">HS Grad</th>
<th align="right">Frost</th>
<th align="right">Area</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Pennsylvania</td>
<td align="right">11860</td>
<td align="right">4449</td>
<td align="right">1.0</td>
<td align="right">70.43</td>
<td align="right">6.1</td>
<td align="right">50.2</td>
<td align="right">126</td>
<td align="right">44966</td>
</tr>
<tr class="even">
<td align="left">Kentucky</td>
<td align="right">3387</td>
<td align="right">3712</td>
<td align="right">1.6</td>
<td align="right">70.10</td>
<td align="right">10.6</td>
<td align="right">38.5</td>
<td align="right">95</td>
<td align="right">39650</td>
</tr>
<tr class="odd">
<td align="left">Michigan</td>
<td align="right">9111</td>
<td align="right">4751</td>
<td align="right">0.9</td>
<td align="right">70.63</td>
<td align="right">11.1</td>
<td align="right">52.8</td>
<td align="right">125</td>
<td align="right">56817</td>
</tr>
<tr class="even">
<td align="left">Oregon</td>
<td align="right">2284</td>
<td align="right">4660</td>
<td align="right">0.6</td>
<td align="right">72.13</td>
<td align="right">4.2</td>
<td align="right">60.0</td>
<td align="right">44</td>
<td align="right">96184</td>
</tr>
<tr class="odd">
<td align="left">Utah</td>
<td align="right">1203</td>
<td align="right">4022</td>
<td align="right">0.6</td>
<td align="right">72.90</td>
<td align="right">4.5</td>
<td align="right">67.3</td>
<td align="right">137</td>
<td align="right">82096</td>
</tr>
<tr class="even">
<td align="left">California</td>
<td align="right">21198</td>
<td align="right">5114</td>
<td align="right">1.1</td>
<td align="right">71.71</td>
<td align="right">10.3</td>
<td align="right">62.6</td>
<td align="right">20</td>
<td align="right">156361</td>
</tr>
<tr class="odd">
<td align="left">Virginia</td>
<td align="right">4981</td>
<td align="right">4701</td>
<td align="right">1.4</td>
<td align="right">70.08</td>
<td align="right">9.5</td>
<td align="right">47.8</td>
<td align="right">85</td>
<td align="right">39780</td>
</tr>
<tr class="even">
<td align="left">Arizona</td>
<td align="right">2212</td>
<td align="right">4530</td>
<td align="right">1.8</td>
<td align="right">70.55</td>
<td align="right">7.8</td>
<td align="right">58.1</td>
<td align="right">15</td>
<td align="right">113417</td>
</tr>
<tr class="odd">
<td align="left">Georgia</td>
<td align="right">4931</td>
<td align="right">4091</td>
<td align="right">2.0</td>
<td align="right">68.54</td>
<td align="right">13.9</td>
<td align="right">40.6</td>
<td align="right">60</td>
<td align="right">58073</td>
</tr>
<tr class="even">
<td align="left">Massachusetts</td>
<td align="right">5814</td>
<td align="right">4755</td>
<td align="right">1.1</td>
<td align="right">71.83</td>
<td align="right">3.3</td>
<td align="right">58.5</td>
<td align="right">103</td>
<td align="right">7826</td>
</tr>
<tr class="odd">
<td align="left">Hawaii</td>
<td align="right">868</td>
<td align="right">4963</td>
<td align="right">1.9</td>
<td align="right">73.60</td>
<td align="right">6.2</td>
<td align="right">61.9</td>
<td align="right">0</td>
<td align="right">6425</td>
</tr>
<tr class="even">
<td align="left">New Jersey</td>
<td align="right">7333</td>
<td align="right">5237</td>
<td align="right">1.1</td>
<td align="right">70.93</td>
<td align="right">5.2</td>
<td align="right">52.5</td>
<td align="right">115</td>
<td align="right">7521</td>
</tr>
</tbody>
</table>
</div>
<div id="stratified-random-sampling" class="section level2" number="19.4">
<h2><span class="header-section-number">19.4</span> Stratified random sampling</h2>
<p>Stratification is defined in ISA-530 as <em>the process of dividing a population into sub-populations, each of which is a group of sampling units which have similar characteristics (often monetary value).</em> Thus, stratified random sampling may imply any of the afore-mentioned sampling techniques applied to individual strata instead of whole population. Refer figure <a href="random-sampling-in-r.html#fig:strata">19.3</a> for illustration.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:strata"></span>
<img src="images/stratified.png" alt="Illustration of Stratified Random Sampling" width="99%" />
<p class="caption">
Figure 19.3: Illustration of Stratified Random Sampling
</p>
</div>
<p>The function <code>dplyr::group_by()</code> will be used here for stratification. Thereafter we can proceed for sampling described as above.</p>
<p>Example Data: - Let’s include region in <code>state.x77</code> data using <code>dplyr::bind_cols</code>.</p>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="random-sampling-in-r.html#cb1125-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb1125-2"><a href="random-sampling-in-r.html#cb1125-2" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(state.x77),</span>
<span id="cb1125-3"><a href="random-sampling-in-r.html#cb1125-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(state.region)</span>
<span id="cb1125-4"><a href="random-sampling-in-r.html#cb1125-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Let’s see first 6 rows of this data</p>
<table>
<colgroup>
<col width="12%" />
<col width="12%" />
<col width="7%" />
<col width="12%" />
<col width="10%" />
<col width="7%" />
<col width="8%" />
<col width="6%" />
<col width="7%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Population</th>
<th align="right">Income</th>
<th align="right">Illiteracy</th>
<th align="right">Life Exp</th>
<th align="right">Murder</th>
<th align="right">HS Grad</th>
<th align="right">Frost</th>
<th align="right">Area</th>
<th align="left">state.region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">3615</td>
<td align="right">3624</td>
<td align="right">2.1</td>
<td align="right">69.05</td>
<td align="right">15.1</td>
<td align="right">41.3</td>
<td align="right">20</td>
<td align="right">50708</td>
<td align="left">South</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="right">365</td>
<td align="right">6315</td>
<td align="right">1.5</td>
<td align="right">69.31</td>
<td align="right">11.3</td>
<td align="right">66.7</td>
<td align="right">152</td>
<td align="right">566432</td>
<td align="left">West</td>
</tr>
<tr class="odd">
<td align="left">Arizona</td>
<td align="right">2212</td>
<td align="right">4530</td>
<td align="right">1.8</td>
<td align="right">70.55</td>
<td align="right">7.8</td>
<td align="right">58.1</td>
<td align="right">15</td>
<td align="right">113417</td>
<td align="left">West</td>
</tr>
<tr class="even">
<td align="left">Arkansas</td>
<td align="right">2110</td>
<td align="right">3378</td>
<td align="right">1.9</td>
<td align="right">70.66</td>
<td align="right">10.1</td>
<td align="right">39.9</td>
<td align="right">65</td>
<td align="right">51945</td>
<td align="left">South</td>
</tr>
<tr class="odd">
<td align="left">California</td>
<td align="right">21198</td>
<td align="right">5114</td>
<td align="right">1.1</td>
<td align="right">71.71</td>
<td align="right">10.3</td>
<td align="right">62.6</td>
<td align="right">20</td>
<td align="right">156361</td>
<td align="left">West</td>
</tr>
<tr class="even">
<td align="left">Colorado</td>
<td align="right">2541</td>
<td align="right">4884</td>
<td align="right">0.7</td>
<td align="right">72.06</td>
<td align="right">6.8</td>
<td align="right">63.9</td>
<td align="right">166</td>
<td align="right">103766</td>
<td align="left">West</td>
</tr>
</tbody>
</table>
<p>We can check a summary of number of States per region</p>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1126-1"><a href="random-sampling-in-r.html#cb1126-1" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> </span>
<span id="cb1126-2"><a href="random-sampling-in-r.html#cb1126-2" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&#39;State&#39;</span>) <span class="sc">%&gt;%</span> <span class="co"># this step will not be </span></span>
<span id="cb1126-3"><a href="random-sampling-in-r.html#cb1126-3" tabindex="-1"></a>                                  <span class="co"># used in databases without row names</span></span>
<span id="cb1126-4"><a href="random-sampling-in-r.html#cb1126-4" tabindex="-1"></a>  <span class="fu">group_by</span>(state.region) <span class="sc">%&gt;%</span> </span>
<span id="cb1126-5"><a href="random-sampling-in-r.html#cb1126-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">states =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   state.region  states
##   &lt;fct&gt;          &lt;int&gt;
## 1 Northeast          9
## 2 South             16
## 3 North Central     12
## 4 West              13</code></pre>
<p><strong>Case-1:</strong> When the sample size is constant for all strata. Say <code>2</code> records per region.</p>
<pre><code>set.seed(123)
n &lt;- 2
dat %&gt;% 
  tibble::rownames_to_column(&#39;State&#39;) %&gt;% # this step will not be used in databases without row names
  group_by(state.region) %&gt;% 
  slice_sample(n=n) %&gt;% 
  ungroup()</code></pre>
<table>
<colgroup>
<col width="15%" />
<col width="11%" />
<col width="7%" />
<col width="11%" />
<col width="9%" />
<col width="7%" />
<col width="8%" />
<col width="6%" />
<col width="6%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">State</th>
<th align="right">Population</th>
<th align="right">Income</th>
<th align="right">Illiteracy</th>
<th align="right">Life Exp</th>
<th align="right">Murder</th>
<th align="right">HS Grad</th>
<th align="right">Frost</th>
<th align="right">Area</th>
<th align="left">state.region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Massachusetts</td>
<td align="right">5814</td>
<td align="right">4755</td>
<td align="right">1.1</td>
<td align="right">71.83</td>
<td align="right">3.3</td>
<td align="right">58.5</td>
<td align="right">103</td>
<td align="right">7826</td>
<td align="left">Northeast</td>
</tr>
<tr class="even">
<td align="left">New York</td>
<td align="right">18076</td>
<td align="right">4903</td>
<td align="right">1.4</td>
<td align="right">70.55</td>
<td align="right">10.9</td>
<td align="right">52.7</td>
<td align="right">82</td>
<td align="right">47831</td>
<td align="left">Northeast</td>
</tr>
<tr class="odd">
<td align="left">Delaware</td>
<td align="right">579</td>
<td align="right">4809</td>
<td align="right">0.9</td>
<td align="right">70.06</td>
<td align="right">6.2</td>
<td align="right">54.6</td>
<td align="right">103</td>
<td align="right">1982</td>
<td align="left">South</td>
</tr>
<tr class="even">
<td align="left">North Carolina</td>
<td align="right">5441</td>
<td align="right">3875</td>
<td align="right">1.8</td>
<td align="right">69.21</td>
<td align="right">11.1</td>
<td align="right">38.5</td>
<td align="right">80</td>
<td align="right">48798</td>
<td align="left">South</td>
</tr>
<tr class="odd">
<td align="left">Indiana</td>
<td align="right">5313</td>
<td align="right">4458</td>
<td align="right">0.7</td>
<td align="right">70.88</td>
<td align="right">7.1</td>
<td align="right">52.9</td>
<td align="right">122</td>
<td align="right">36097</td>
<td align="left">North Central</td>
</tr>
<tr class="even">
<td align="left">Minnesota</td>
<td align="right">3921</td>
<td align="right">4675</td>
<td align="right">0.6</td>
<td align="right">72.96</td>
<td align="right">2.3</td>
<td align="right">57.6</td>
<td align="right">160</td>
<td align="right">79289</td>
<td align="left">North Central</td>
</tr>
<tr class="odd">
<td align="left">Utah</td>
<td align="right">1203</td>
<td align="right">4022</td>
<td align="right">0.6</td>
<td align="right">72.90</td>
<td align="right">4.5</td>
<td align="right">67.3</td>
<td align="right">137</td>
<td align="right">82096</td>
<td align="left">West</td>
</tr>
<tr class="even">
<td align="left">Hawaii</td>
<td align="right">868</td>
<td align="right">4963</td>
<td align="right">1.9</td>
<td align="right">73.60</td>
<td align="right">6.2</td>
<td align="right">61.9</td>
<td align="right">0</td>
<td align="right">6425</td>
<td align="left">West</td>
</tr>
</tbody>
</table>
<p><strong>Case-2:</strong> When the sample size or proportion is different among strata.
This time let us assume that column for <em>stratum</em> is not directly available in the data.<br />
- Say, 20% of States having Population upto <code>1000</code>;
- 30% of States having population greater than <code>1000</code> but upto <code>5000</code> and finally;
- 50% of states having population more than <code>5000</code> have to be sampled.</p>
<p>In this scenario, our strategy would be use <code>purrr::map2_dfr()</code> function after splitting the data with <code>group_split()</code> function.</p>
<p>Syntax would be</p>
<pre><code># define proportions
props &lt;- c(0.2, 0.3, 0.5)

# set seed
set.seed(123)

# take data
dat %&gt;% 
  # reduntant step where data has no column names
  tibble::rownames_to_column(&#39;State&#39;) %&gt;%
  # create column according to stratums
  mutate(stratum = cut(Population, c(0, 1000, 5000, max(Population)),
                      labels = c(&quot;Low&quot;, &quot;Mid&quot;, &quot;High&quot;))) %&gt;% 
  # split data into groups
  group_split(stratum) %&gt;% 
  # sample in each group
  map2_dfr(props,
           .f = function(d, w) slice_sample(d, prop = w))</code></pre>
<p>We may check the sample selected across each stratum</p>
<table>
<thead>
<tr class="header">
<th align="left">stratum</th>
<th align="right">Total</th>
<th align="right">Selected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Low</td>
<td align="right">12</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Mid</td>
<td align="right">26</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">High</td>
<td align="right">12</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
</div>
<div id="cluster-sampling" class="section level2" number="19.5">
<h2><span class="header-section-number">19.5</span> Cluster sampling</h2>
<p>ISA 530 does not explicitly define cluster sampling. Actually this sampling is sampling of strata and we can apply above mentioned techniques easily to sample clusters. E.g. in the sample data above, we can sample say, 2 clusters (or regions).</p>
<p>Thus, our strategy would be first to sample groups from unique available values and thereafter filter all the records.</p>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="random-sampling-in-r.html#cb1130-1" tabindex="-1"></a><span class="co"># set the seed</span></span>
<span id="cb1130-2"><a href="random-sampling-in-r.html#cb1130-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1130-3"><a href="random-sampling-in-r.html#cb1130-3" tabindex="-1"></a><span class="co"># sample clusters</span></span>
<span id="cb1130-4"><a href="random-sampling-in-r.html#cb1130-4" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">sample</span>(</span>
<span id="cb1130-5"><a href="random-sampling-in-r.html#cb1130-5" tabindex="-1"></a>  <span class="fu">unique</span>(dat<span class="sc">$</span>state.region),</span>
<span id="cb1130-6"><a href="random-sampling-in-r.html#cb1130-6" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb1130-7"><a href="random-sampling-in-r.html#cb1130-7" tabindex="-1"></a>)</span>
<span id="cb1130-8"><a href="random-sampling-in-r.html#cb1130-8" tabindex="-1"></a><span class="co"># filter all records in above clusters</span></span>
<span id="cb1130-9"><a href="random-sampling-in-r.html#cb1130-9" tabindex="-1"></a>clust_samp <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb1130-10"><a href="random-sampling-in-r.html#cb1130-10" tabindex="-1"></a>  <span class="fu">filter</span>(state.region <span class="sc">%in%</span> clusters)</span>
<span id="cb1130-11"><a href="random-sampling-in-r.html#cb1130-11" tabindex="-1"></a><span class="co"># check number of records</span></span>
<span id="cb1130-12"><a href="random-sampling-in-r.html#cb1130-12" tabindex="-1"></a>clust_samp<span class="sc">$</span>state.region <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## .
##     Northeast         South North Central          West 
##             9             0            12             0</code></pre>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="30">
<li id="fn30"><p><a href="https://www.ifac.org/system/files/downloads/a027-2010-iaasb-handbook-isa-530.pdf">https://www.ifac.org/system/files/downloads/a027-2010-iaasb-handbook-isa-530.pdf</a><a href="random-sampling-in-r.html#fnref30" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Audit Analytics</strong>" was written by Anil Goyal. It was last built on 2024-11-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
