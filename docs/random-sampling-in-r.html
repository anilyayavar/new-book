<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 19 Random sampling in R | Data Analytics in Audit, using R</title>
<meta name="author" content="Anil Goyal">
<meta name="description" content="International Standard On Auditing - 530 defines31 audit sampling as the application of audit procedures to less than 100% of items within a population of audit relevance such that all sampling...">
<meta name="generator" content="bookdown 0.40 with bs4_book()">
<meta property="og:title" content="Chapter 19 Random sampling in R | Data Analytics in Audit, using R">
<meta property="og:type" content="book">
<meta property="og:description" content="International Standard On Auditing - 530 defines31 audit sampling as the application of audit procedures to less than 100% of items within a population of audit relevance such that all sampling...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 19 Random sampling in R | Data Analytics in Audit, using R">
<meta name="twitter:description" content="International Standard On Auditing - 530 defines31 audit sampling as the application of audit procedures to less than 100% of items within a population of audit relevance such that all sampling...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Analytics in Audit, using R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="about-author.html">About author</a></li>
<li><a class="" href="gearing-up.html">Gearing up</a></li>
<li><a class="" href="part-i-basic-r-programming-concepts.html">Part-I: Basic R Programming Concepts</a></li>
<li><a class="" href="r-programming-language.html"><span class="header-section-number">1</span> R Programming Language</a></li>
<li><a class="" href="subset.html"><span class="header-section-number">2</span> Subsetting R objects or accesing specific elements</a></li>
<li><a class="" href="func.html"><span class="header-section-number">3</span> Functions and operations in R</a></li>
<li><a class="" href="existing-and-useful-functions-in-base-r.html"><span class="header-section-number">4</span> Existing and useful functions in base R</a></li>
<li><a class="" href="pipes-in-r.html"><span class="header-section-number">5</span> Pipes in R</a></li>
<li><a class="" href="control-statements.html"><span class="header-section-number">6</span> Control statements</a></li>
<li><a class="" href="functional-programming.html"><span class="header-section-number">7</span> Functional Programming</a></li>
<li><a class="" href="file.html"><span class="header-section-number">8</span> File handling operations in R</a></li>
<li><a class="" href="read.html"><span class="header-section-number">9</span> Getting data in and out of R</a></li>
<li><a class="" href="data-cleaning-in-r.html"><span class="header-section-number">10</span> Data Cleaning in R</a></li>
<li><a class="" href="merging-large-number-of-similar-datasets-into-one.html"><span class="header-section-number">11</span> Merging large number of similar datasets into one</a></li>
<li><a class="" href="part-ii-exploratory-data-analysis.html">Part-II: Exploratory Data Analysis</a></li>
<li><a class="" href="visualisations-in-base-r.html"><span class="header-section-number">12</span> Visualisations in Base R</a></li>
<li><a class="" href="visualising-data-with-ggplot2.html"><span class="header-section-number">13</span> Visualising data with ggplot2</a></li>
<li><a class="" href="data-transformation-in-dplyr.html"><span class="header-section-number">14</span> Data Transformation in dplyr</a></li>
<li><a class="" href="combining-tablestabular-data.html"><span class="header-section-number">15</span> Combining Tables/tabular data</a></li>
<li><a class="" href="data-wrangling-in-tidyr.html"><span class="header-section-number">16</span> Data Wrangling in tidyr</a></li>
<li><a class="" href="generating-descriptive-statistics.html"><span class="header-section-number">17</span> Generating Descriptive statistics</a></li>
<li><a class="" href="part-iii-probability-and-sampling-in-r.html">Part-III: Probability and Sampling in R</a></li>
<li><a class="" href="probability-in-r.html"><span class="header-section-number">18</span> Probability in R</a></li>
<li><a class="active" href="random-sampling-in-r.html"><span class="header-section-number">19</span> Random sampling in R</a></li>
<li><a class="" href="part-iv-machine-learning-in-r.html">Part-IV: Machine Learning in R</a></li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">20</span> Linear Regression</a></li>
<li><a class="" href="principal-component-analysis-in-r.html"><span class="header-section-number">21</span> Principal Component Analysis in R</a></li>
<li><a class="" href="clustering-in-r-using-kmeans-algorithm.html"><span class="header-section-number">22</span> Clustering in R (Using Kmeans algorithm)</a></li>
<li><a class="" href="association-rule-mining-in-r-apriori.html"><span class="header-section-number">23</span> Association Rule Mining in R (Apriori)</a></li>
<li><a class="" href="part-v-time-series-analysis.html">Part-V: Time Series Analysis</a></li>
<li><a class="" href="manipulating-datedate-time-objects-using-lubridate.html"><span class="header-section-number">24</span> Manipulating Date/Date-time objects using lubridate</a></li>
<li><a class="" href="time-series-analysis.html"><span class="header-section-number">25</span> Time Series Analysis</a></li>
<li><a class="" href="part-vi-network-analytics.html">Part VI: Network Analytics</a></li>
<li><a class="" href="network-analyticsgraph-theory-in-r.html"><span class="header-section-number">26</span> Network Analytics/Graph theory in R</a></li>
<li><a class="" href="applying-network-analysis-in-auditfraud-detection.html"><span class="header-section-number">27</span> Applying network analysis in audit/fraud detection</a></li>
<li><a class="" href="part-vii-text-analytics-in-r.html">Part-VII: Text Analytics in R</a></li>
<li><a class="" href="string-manipulation-in-stringr.html"><span class="header-section-number">28</span> String manipulation in stringr</a></li>
<li><a class="" href="regex---a-quick-introduction.html"><span class="header-section-number">29</span> Regex - A quick introduction</a></li>
<li><a class="" href="regex-in-human-readble-format-using-rebus.html"><span class="header-section-number">30</span> Regex in human readble format using rebus</a></li>
<li><a class="" href="text-analytics-in-r.html"><span class="header-section-number">31</span> Text Analytics in R</a></li>
<li><a class="" href="sentiment-analysis.html"><span class="header-section-number">32</span> Sentiment Analysis</a></li>
<li><a class="" href="visualising-text-analytics-through-wordcloud-etc..html"><span class="header-section-number">33</span> Visualising Text analytics through Wordcloud, etc.</a></li>
<li><a class="" href="finding-string-similarity.html"><span class="header-section-number">34</span> Finding string similarity</a></li>
<li><a class="" href="part-viii-geo-computation-in-r.html">Part-VIII: Geo computation in R</a></li>
<li><a class="" href="maps-in-r.html"><span class="header-section-number">35</span> Maps in R</a></li>
<li><a class="" href="geo-coding-in-r.html"><span class="header-section-number">36</span> Geo-Coding in R</a></li>
<li><a class="" href="reverse-geo-coding.html"><span class="header-section-number">37</span> Reverse geo-coding</a></li>
<li><a class="" href="part-ix-identifying-anamolous-observations-for-audit.html">Part-IX: Identifying anamolous observations for audit</a></li>
<li><a class="" href="benford-testsanalysis.html"><span class="header-section-number">38</span> Benford Tests/Analysis</a></li>
<li><a class="" href="anomaly-detection.html"><span class="header-section-number">39</span> Anomaly Detection</a></li>
<li><a class="" href="finding-anamolous-outliers.html"><span class="header-section-number">40</span> Finding Anamolous Outliers</a></li>
<li><a class="" href="dup.html"><span class="header-section-number">41</span> Duplicate Detection</a></li>
<li><a class="" href="detecting-gaps-in-sequences.html"><span class="header-section-number">42</span> Detecting gaps in sequences</a></li>
<li><a class="" href="data-envelopment-analysis.html"><span class="header-section-number">43</span> Data Envelopment Analysis</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="colors-in-r.html"><span class="header-section-number">A</span> Colors in R</a></li>
<li><a class="" href="various-datasets-in-base-r-used-in-this-book.html"><span class="header-section-number">B</span> Various Datasets, in base R, used in this book</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="random-sampling-in-r" class="section level1" number="19">
<h1>
<span class="header-section-number">19</span> Random sampling in R<a class="anchor" aria-label="anchor" href="#random-sampling-in-r"><i class="fas fa-link"></i></a>
</h1>
<p>International Standard On Auditing - 530 defines<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.ifac.org/system/files/downloads/a027-2010-iaasb-handbook-isa-530.pdf"&gt;https://www.ifac.org/system/files/downloads/a027-2010-iaasb-handbook-isa-530.pdf&lt;/a&gt;&lt;/p&gt;'><sup>31</sup></a> audit sampling as <em>the application of audit procedures to less than 100% of items within a population of audit relevance such that all sampling units have a chance of selection in order to provide the auditor with a reasonable basis on which to draw conclusions about the entire population.</em> Statistical sampling is further defines as <em>an approach to sampling having two characteristics - random selection of samples, and the use of probability theory to evaluate sample results, including measurement of sampling risk.</em></p>
<p>Appendix 4 of ISA 53 further prescribes different statistical methods of sample selection. We will discuss here each type of sampling methodology used to sample records for audit.</p>
<p><strong>Prerequisites</strong></p>
<p>Load <code>tidyverse</code></p>
<div class="sourceCode" id="cb1064"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<div id="simple-random-sampling-with-and-without-replacement" class="section level2" number="19.1">
<h2>
<span class="header-section-number">19.1</span> Simple Random Sampling (With and without replacement)<a class="anchor" aria-label="anchor" href="#simple-random-sampling-with-and-without-replacement"><i class="fas fa-link"></i></a>
</h2>
<p>In this method, records are selected completely at random, by generating random numbers e.g. using random number tables, etc. Refer figure <a href="random-sampling-in-r.html#fig:simple">19.1</a> for illustration. We can replicate the method of random number generation in R. Even the method of random number generation can be reproducible, by fixing the random number seed. Mainly two functions will be used here <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> and <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> already discussed in section <a href="existing-and-useful-functions-in-base-r.html#prob">4.9</a>. Since <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> function takes a vector as input and gives vector as output again, we can make use of <code><a href="https://dplyr.tidyverse.org/reference/slice.html">dplyr::slice_sample()</a></code> function, discussed in section <a href="existing-and-useful-functions-in-base-r.html#prob">4.9</a>, which operates on data frames instead.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:simple"></span>
<img src="images/simple.png" alt="Illustration of Simple Random Sampling" width="99%"><p class="caption">
Figure 19.1: Illustration of Simple Random Sampling
</p>
</div>
<p>Let’s see this sampling on <code>iris</code> data. Suppose we have to select a sample of <code>n=12</code> records, without replacement-</p>
<pre><code>dat &lt;- iris # input data
# set the seed
set.seed(123)
# sample n records
dat %&gt;% 
  slice_sample(n = 12, replace = FALSE)</code></pre>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">Sepal.Length</th>
<th align="right">Sepal.Width</th>
<th align="right">Petal.Length</th>
<th align="right">Petal.Width</th>
<th align="left">Species</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">4.3</td>
<td align="right">3.0</td>
<td align="right">1.1</td>
<td align="right">0.1</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">5.0</td>
<td align="right">3.3</td>
<td align="right">1.4</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">7.7</td>
<td align="right">3.8</td>
<td align="right">6.7</td>
<td align="right">2.2</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">4.4</td>
<td align="right">3.2</td>
<td align="right">1.3</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">5.9</td>
<td align="right">3.0</td>
<td align="right">5.1</td>
<td align="right">1.8</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.5</td>
<td align="right">3.0</td>
<td align="right">5.2</td>
<td align="right">2.0</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.5</td>
<td align="right">2.5</td>
<td align="right">4.0</td>
<td align="right">1.3</td>
<td align="left">versicolor</td>
</tr>
<tr class="even">
<td align="right">5.5</td>
<td align="right">2.6</td>
<td align="right">4.4</td>
<td align="right">1.2</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">5.8</td>
<td align="right">2.7</td>
<td align="right">5.1</td>
<td align="right">1.9</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.1</td>
<td align="right">3.0</td>
<td align="right">4.6</td>
<td align="right">1.4</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">6.3</td>
<td align="right">3.4</td>
<td align="right">5.6</td>
<td align="right">2.4</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">5.1</td>
<td align="right">2.5</td>
<td align="right">3.0</td>
<td align="right">1.1</td>
<td align="left">versicolor</td>
</tr>
</tbody>
</table></div>
<p>The syntax is simple. In the first step we have fixed the random number seed for reproducibility. Using <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code> we have selected <code>n=12</code> records without replacement (<code>replace = FALSE</code>).</p>
<blockquote>
<p>If sample size is based on some proportion, we have to use <code>prop = .10</code> (say 10%) instead of <code>n</code> argument. Moreover, if sampling is with replacement, we have to use <code>replace = TRUE</code>.</p>
</blockquote>
</div>
<div id="srs" class="section level2" number="19.2">
<h2>
<span class="header-section-number">19.2</span> Systematic random sampling<a class="anchor" aria-label="anchor" href="#srs"><i class="fas fa-link"></i></a>
</h2>
<p>ISA 530 defines this sampling approach as <em>‘Systematic selection, in which the number of sampling units in the population is divided by the sample size to give a sampling interval, for example 50, and having determined a starting point within the first 50, each 50th sampling unit thereafter is selected. Although the starting point may be determined haphazardly, the sample is more likely to be truly random if it is determined by use of a computerized random number generator or random number tables. When using systematic selection, the auditor would need to determine that sampling units within the population are not structured in such a way that the sampling interval corresponds with a particular pattern in the population.’</em> Refer figure <a href="random-sampling-in-r.html#fig:systematic">19.2</a> for illustration.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:systematic"></span>
<img src="images/systematic.png" alt="Illustration of Systematic Random Sampling" width="99%"><p class="caption">
Figure 19.2: Illustration of Systematic Random Sampling
</p>
</div>
<p>We can replicate this approach again following two steps-</p>
<p><strong>Step-1:</strong> Select <code>n</code> as the sample size. Then generate a maximum starting point say <code>s</code> by dividing number of rows in the data by <code>n</code>. Thereafter we have to choose a starting point from <code>1:s</code>. We can use sample function here. Let’s say this starting number is <code>s1</code>. Then we have to generate an arithmetic sequence, say <code>rand_seq</code> starting from <code>s1</code> and increasing every <code>s</code> steps thereafter with total <code>n</code> terms.</p>
<p><strong>Step-2:</strong> In the next step we will shuffle the data by using <code>slice_sample</code> and select a sample using function <code>filter</code>.</p>
<p>The methodology is replicated as</p>
<pre><code>set.seed(123)
n &lt;- 15 # sample size
s &lt;- floor(nrow(dat)/n)
s1 &lt;- sample(1:s, 1, replace = FALSE)
rand_seq &lt;- seq(s1, by = s, length.out = n)
dat %&gt;% 
  slice_sample(prop = 1) %&gt;% 
  filter(row_number() %in% rand_seq)
  </code></pre>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">Sepal.Length</th>
<th align="right">Sepal.Width</th>
<th align="right">Petal.Length</th>
<th align="right">Petal.Width</th>
<th align="left">Species</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">7.7</td>
<td align="right">3.8</td>
<td align="right">6.7</td>
<td align="right">2.2</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.1</td>
<td align="right">2.8</td>
<td align="right">4.0</td>
<td align="right">1.3</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">7.6</td>
<td align="right">3.0</td>
<td align="right">6.6</td>
<td align="right">2.1</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">7.2</td>
<td align="right">3.2</td>
<td align="right">6.0</td>
<td align="right">1.8</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">7.2</td>
<td align="right">3.0</td>
<td align="right">5.8</td>
<td align="right">1.6</td>
<td align="left">virginica</td>
</tr>
<tr class="even">
<td align="right">6.3</td>
<td align="right">2.7</td>
<td align="right">4.9</td>
<td align="right">1.8</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">4.8</td>
<td align="right">3.1</td>
<td align="right">1.6</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">6.4</td>
<td align="right">2.8</td>
<td align="right">5.6</td>
<td align="right">2.1</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.6</td>
<td align="right">3.0</td>
<td align="right">4.5</td>
<td align="right">1.5</td>
<td align="left">versicolor</td>
</tr>
<tr class="even">
<td align="right">4.9</td>
<td align="right">2.5</td>
<td align="right">4.5</td>
<td align="right">1.7</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.9</td>
<td align="right">3.2</td>
<td align="right">4.8</td>
<td align="right">1.8</td>
<td align="left">versicolor</td>
</tr>
<tr class="even">
<td align="right">6.3</td>
<td align="right">3.3</td>
<td align="right">6.0</td>
<td align="right">2.5</td>
<td align="left">virginica</td>
</tr>
<tr class="odd">
<td align="right">5.4</td>
<td align="right">3.7</td>
<td align="right">1.5</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">6.7</td>
<td align="right">3.1</td>
<td align="right">4.4</td>
<td align="right">1.4</td>
<td align="left">versicolor</td>
</tr>
<tr class="odd">
<td align="right">5.2</td>
<td align="right">3.5</td>
<td align="right">1.5</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
</tbody>
</table></div>
</div>
<div id="probability-proportionate-to-size-with-or-without-replacement-a.k.a-monetary-unit-sampling" class="section level2" number="19.3">
<h2>
<span class="header-section-number">19.3</span> Probability Proportionate to size (with or without replacement) a.k.a monetary unit sampling<a class="anchor" aria-label="anchor" href="#probability-proportionate-to-size-with-or-without-replacement-a.k.a-monetary-unit-sampling"><i class="fas fa-link"></i></a>
</h2>
<p>This sampling approach is defined in ISA-530 as <em>“a type of value-weighted selection in which sample size, selection and evaluation results in a conclusion in monetary amounts.”</em></p>
<p>Our methodology is not much difference from methodology adopted in section <a href="random-sampling-in-r.html#srs">19.2</a> except that we will make use of <code>weight_by =</code> argument now.</p>
<p>Let’s use <code>state.x77</code> data that comes with base R. Since the data is in matrix format, let’s first convert it data frame using <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> first.</p>
<div class="sourceCode" id="cb1067"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">state.x77</span><span class="op">)</span></span></code></pre></div>
<p>Other steps are simple.</p>
<pre><code>set.seed(123)
dat %&gt;% 
  slice_sample(n=12, weight_by = Population)</code></pre>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="17%">
<col width="13%">
<col width="8%">
<col width="13%">
<col width="11%">
<col width="8%">
<col width="10%">
<col width="7%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Population</th>
<th align="right">Income</th>
<th align="right">Illiteracy</th>
<th align="right">Life Exp</th>
<th align="right">Murder</th>
<th align="right">HS Grad</th>
<th align="right">Frost</th>
<th align="right">Area</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Pennsylvania</td>
<td align="right">11860</td>
<td align="right">4449</td>
<td align="right">1.0</td>
<td align="right">70.43</td>
<td align="right">6.1</td>
<td align="right">50.2</td>
<td align="right">126</td>
<td align="right">44966</td>
</tr>
<tr class="even">
<td align="left">Kentucky</td>
<td align="right">3387</td>
<td align="right">3712</td>
<td align="right">1.6</td>
<td align="right">70.10</td>
<td align="right">10.6</td>
<td align="right">38.5</td>
<td align="right">95</td>
<td align="right">39650</td>
</tr>
<tr class="odd">
<td align="left">Michigan</td>
<td align="right">9111</td>
<td align="right">4751</td>
<td align="right">0.9</td>
<td align="right">70.63</td>
<td align="right">11.1</td>
<td align="right">52.8</td>
<td align="right">125</td>
<td align="right">56817</td>
</tr>
<tr class="even">
<td align="left">Oregon</td>
<td align="right">2284</td>
<td align="right">4660</td>
<td align="right">0.6</td>
<td align="right">72.13</td>
<td align="right">4.2</td>
<td align="right">60.0</td>
<td align="right">44</td>
<td align="right">96184</td>
</tr>
<tr class="odd">
<td align="left">Utah</td>
<td align="right">1203</td>
<td align="right">4022</td>
<td align="right">0.6</td>
<td align="right">72.90</td>
<td align="right">4.5</td>
<td align="right">67.3</td>
<td align="right">137</td>
<td align="right">82096</td>
</tr>
<tr class="even">
<td align="left">California</td>
<td align="right">21198</td>
<td align="right">5114</td>
<td align="right">1.1</td>
<td align="right">71.71</td>
<td align="right">10.3</td>
<td align="right">62.6</td>
<td align="right">20</td>
<td align="right">156361</td>
</tr>
<tr class="odd">
<td align="left">Virginia</td>
<td align="right">4981</td>
<td align="right">4701</td>
<td align="right">1.4</td>
<td align="right">70.08</td>
<td align="right">9.5</td>
<td align="right">47.8</td>
<td align="right">85</td>
<td align="right">39780</td>
</tr>
<tr class="even">
<td align="left">Arizona</td>
<td align="right">2212</td>
<td align="right">4530</td>
<td align="right">1.8</td>
<td align="right">70.55</td>
<td align="right">7.8</td>
<td align="right">58.1</td>
<td align="right">15</td>
<td align="right">113417</td>
</tr>
<tr class="odd">
<td align="left">Georgia</td>
<td align="right">4931</td>
<td align="right">4091</td>
<td align="right">2.0</td>
<td align="right">68.54</td>
<td align="right">13.9</td>
<td align="right">40.6</td>
<td align="right">60</td>
<td align="right">58073</td>
</tr>
<tr class="even">
<td align="left">Massachusetts</td>
<td align="right">5814</td>
<td align="right">4755</td>
<td align="right">1.1</td>
<td align="right">71.83</td>
<td align="right">3.3</td>
<td align="right">58.5</td>
<td align="right">103</td>
<td align="right">7826</td>
</tr>
<tr class="odd">
<td align="left">Hawaii</td>
<td align="right">868</td>
<td align="right">4963</td>
<td align="right">1.9</td>
<td align="right">73.60</td>
<td align="right">6.2</td>
<td align="right">61.9</td>
<td align="right">0</td>
<td align="right">6425</td>
</tr>
<tr class="even">
<td align="left">New Jersey</td>
<td align="right">7333</td>
<td align="right">5237</td>
<td align="right">1.1</td>
<td align="right">70.93</td>
<td align="right">5.2</td>
<td align="right">52.5</td>
<td align="right">115</td>
<td align="right">7521</td>
</tr>
</tbody>
</table></div>
</div>
<div id="stratified-random-sampling" class="section level2" number="19.4">
<h2>
<span class="header-section-number">19.4</span> Stratified random sampling<a class="anchor" aria-label="anchor" href="#stratified-random-sampling"><i class="fas fa-link"></i></a>
</h2>
<p>Stratification is defined in ISA-530 as <em>the process of dividing a population into sub-populations, each of which is a group of sampling units which have similar characteristics (often monetary value).</em> Thus, stratified random sampling may imply any of the afore-mentioned sampling techniques applied to individual strata instead of whole population. Refer figure <a href="random-sampling-in-r.html#fig:strata">19.3</a> for illustration.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:strata"></span>
<img src="images/stratified.png" alt="Illustration of Stratified Random Sampling" width="99%"><p class="caption">
Figure 19.3: Illustration of Stratified Random Sampling
</p>
</div>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">dplyr::group_by()</a></code> will be used here for stratification. Thereafter we can proceed for sampling described as above.</p>
<p>Example Data: - Let’s include region in <code>state.x77</code> data using <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">dplyr::bind_cols</a></code>.</p>
<div class="sourceCode" id="cb1069"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">state.x77</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">state.region</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s see first 6 rows of this data</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="12%">
<col width="12%">
<col width="7%">
<col width="12%">
<col width="10%">
<col width="7%">
<col width="8%">
<col width="6%">
<col width="7%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">Population</th>
<th align="right">Income</th>
<th align="right">Illiteracy</th>
<th align="right">Life Exp</th>
<th align="right">Murder</th>
<th align="right">HS Grad</th>
<th align="right">Frost</th>
<th align="right">Area</th>
<th align="left">state.region</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">3615</td>
<td align="right">3624</td>
<td align="right">2.1</td>
<td align="right">69.05</td>
<td align="right">15.1</td>
<td align="right">41.3</td>
<td align="right">20</td>
<td align="right">50708</td>
<td align="left">South</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="right">365</td>
<td align="right">6315</td>
<td align="right">1.5</td>
<td align="right">69.31</td>
<td align="right">11.3</td>
<td align="right">66.7</td>
<td align="right">152</td>
<td align="right">566432</td>
<td align="left">West</td>
</tr>
<tr class="odd">
<td align="left">Arizona</td>
<td align="right">2212</td>
<td align="right">4530</td>
<td align="right">1.8</td>
<td align="right">70.55</td>
<td align="right">7.8</td>
<td align="right">58.1</td>
<td align="right">15</td>
<td align="right">113417</td>
<td align="left">West</td>
</tr>
<tr class="even">
<td align="left">Arkansas</td>
<td align="right">2110</td>
<td align="right">3378</td>
<td align="right">1.9</td>
<td align="right">70.66</td>
<td align="right">10.1</td>
<td align="right">39.9</td>
<td align="right">65</td>
<td align="right">51945</td>
<td align="left">South</td>
</tr>
<tr class="odd">
<td align="left">California</td>
<td align="right">21198</td>
<td align="right">5114</td>
<td align="right">1.1</td>
<td align="right">71.71</td>
<td align="right">10.3</td>
<td align="right">62.6</td>
<td align="right">20</td>
<td align="right">156361</td>
<td align="left">West</td>
</tr>
<tr class="even">
<td align="left">Colorado</td>
<td align="right">2541</td>
<td align="right">4884</td>
<td align="right">0.7</td>
<td align="right">72.06</td>
<td align="right">6.8</td>
<td align="right">63.9</td>
<td align="right">166</td>
<td align="right">103766</td>
<td align="left">West</td>
</tr>
</tbody>
</table></div>
<p>We can check a summary of number of States per region</p>
<div class="sourceCode" id="cb1070"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">'State'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># this step will not be </span></span>
<span>                                  <span class="co"># used in databases without row names</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">state.region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>states <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   state.region  states
##   &lt;fct&gt;          &lt;int&gt;
## 1 Northeast          9
## 2 South             16
## 3 North Central     12
## 4 West              13</code></pre>
<p><strong>Case-1:</strong> When the sample size is constant for all strata. Say <code>2</code> records per region.</p>
<pre><code>set.seed(123)
n &lt;- 2
dat %&gt;% 
  tibble::rownames_to_column('State') %&gt;% # this step will not be used in databases without row names
  group_by(state.region) %&gt;% 
  slice_sample(n=n) %&gt;% 
  ungroup()</code></pre>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="15%">
<col width="11%">
<col width="7%">
<col width="11%">
<col width="9%">
<col width="7%">
<col width="8%">
<col width="6%">
<col width="6%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="left">State</th>
<th align="right">Population</th>
<th align="right">Income</th>
<th align="right">Illiteracy</th>
<th align="right">Life Exp</th>
<th align="right">Murder</th>
<th align="right">HS Grad</th>
<th align="right">Frost</th>
<th align="right">Area</th>
<th align="left">state.region</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Massachusetts</td>
<td align="right">5814</td>
<td align="right">4755</td>
<td align="right">1.1</td>
<td align="right">71.83</td>
<td align="right">3.3</td>
<td align="right">58.5</td>
<td align="right">103</td>
<td align="right">7826</td>
<td align="left">Northeast</td>
</tr>
<tr class="even">
<td align="left">New York</td>
<td align="right">18076</td>
<td align="right">4903</td>
<td align="right">1.4</td>
<td align="right">70.55</td>
<td align="right">10.9</td>
<td align="right">52.7</td>
<td align="right">82</td>
<td align="right">47831</td>
<td align="left">Northeast</td>
</tr>
<tr class="odd">
<td align="left">Delaware</td>
<td align="right">579</td>
<td align="right">4809</td>
<td align="right">0.9</td>
<td align="right">70.06</td>
<td align="right">6.2</td>
<td align="right">54.6</td>
<td align="right">103</td>
<td align="right">1982</td>
<td align="left">South</td>
</tr>
<tr class="even">
<td align="left">North Carolina</td>
<td align="right">5441</td>
<td align="right">3875</td>
<td align="right">1.8</td>
<td align="right">69.21</td>
<td align="right">11.1</td>
<td align="right">38.5</td>
<td align="right">80</td>
<td align="right">48798</td>
<td align="left">South</td>
</tr>
<tr class="odd">
<td align="left">Indiana</td>
<td align="right">5313</td>
<td align="right">4458</td>
<td align="right">0.7</td>
<td align="right">70.88</td>
<td align="right">7.1</td>
<td align="right">52.9</td>
<td align="right">122</td>
<td align="right">36097</td>
<td align="left">North Central</td>
</tr>
<tr class="even">
<td align="left">Minnesota</td>
<td align="right">3921</td>
<td align="right">4675</td>
<td align="right">0.6</td>
<td align="right">72.96</td>
<td align="right">2.3</td>
<td align="right">57.6</td>
<td align="right">160</td>
<td align="right">79289</td>
<td align="left">North Central</td>
</tr>
<tr class="odd">
<td align="left">Utah</td>
<td align="right">1203</td>
<td align="right">4022</td>
<td align="right">0.6</td>
<td align="right">72.90</td>
<td align="right">4.5</td>
<td align="right">67.3</td>
<td align="right">137</td>
<td align="right">82096</td>
<td align="left">West</td>
</tr>
<tr class="even">
<td align="left">Hawaii</td>
<td align="right">868</td>
<td align="right">4963</td>
<td align="right">1.9</td>
<td align="right">73.60</td>
<td align="right">6.2</td>
<td align="right">61.9</td>
<td align="right">0</td>
<td align="right">6425</td>
<td align="left">West</td>
</tr>
</tbody>
</table></div>
<p><strong>Case-2:</strong> When the sample size or proportion is different among strata.
This time let us assume that column for <em>stratum</em> is not directly available in the data.<br>
- Say, 20% of States having Population upto <code>1000</code>;
- 30% of States having population greater than <code>1000</code> but upto <code>5000</code> and finally;
- 50% of states having population more than <code>5000</code> have to be sampled.</p>
<p>In this scenario, our strategy would be use <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html">purrr::map2_dfr()</a></code> function after splitting the data with <code><a href="https://dplyr.tidyverse.org/reference/group_split.html">group_split()</a></code> function.</p>
<p>Syntax would be</p>
<pre><code># define proportions
props &lt;- c(0.2, 0.3, 0.5)

# set seed
set.seed(123)

# take data
dat %&gt;% 
  # reduntant step where data has no column names
  tibble::rownames_to_column('State') %&gt;%
  # create column according to stratums
  mutate(stratum = cut(Population, c(0, 1000, 5000, max(Population)),
                      labels = c("Low", "Mid", "High"))) %&gt;% 
  # split data into groups
  group_split(stratum) %&gt;% 
  # sample in each group
  map2_dfr(props,
           .f = function(d, w) slice_sample(d, prop = w))</code></pre>
<p>We may check the sample selected across each stratum</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">stratum</th>
<th align="right">Total</th>
<th align="right">Selected</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Low</td>
<td align="right">12</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Mid</td>
<td align="right">26</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">High</td>
<td align="right">12</td>
<td align="right">6</td>
</tr>
</tbody>
</table></div>
</div>
<div id="cluster-sampling" class="section level2" number="19.5">
<h2>
<span class="header-section-number">19.5</span> Cluster sampling<a class="anchor" aria-label="anchor" href="#cluster-sampling"><i class="fas fa-link"></i></a>
</h2>
<p>ISA 530 does not explicitly define cluster sampling. Actually this sampling is sampling of strata and we can apply above mentioned techniques easily to sample clusters. E.g. in the sample data above, we can sample say, 2 clusters (or regions).</p>
<p>Thus, our strategy would be first to sample groups from unique available values and thereafter filter all the records.</p>
<div class="sourceCode" id="cb1074"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set the seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># sample clusters</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">state.region</span><span class="op">)</span>,</span>
<span>  size <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># filter all records in above clusters</span></span>
<span><span class="va">clust_samp</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">state.region</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters</span><span class="op">)</span></span>
<span><span class="co"># check number of records</span></span>
<span><span class="va">clust_samp</span><span class="op">$</span><span class="va">state.region</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## .
##     Northeast         South North Central          West 
##             9             0            12             0</code></pre>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="probability-in-r.html"><span class="header-section-number">18</span> Probability in R</a></div>
<div class="next"><a href="part-iv-machine-learning-in-r.html">Part-IV: Machine Learning in R</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#random-sampling-in-r"><span class="header-section-number">19</span> Random sampling in R</a></li>
<li><a class="nav-link" href="#simple-random-sampling-with-and-without-replacement"><span class="header-section-number">19.1</span> Simple Random Sampling (With and without replacement)</a></li>
<li><a class="nav-link" href="#srs"><span class="header-section-number">19.2</span> Systematic random sampling</a></li>
<li><a class="nav-link" href="#probability-proportionate-to-size-with-or-without-replacement-a.k.a-monetary-unit-sampling"><span class="header-section-number">19.3</span> Probability Proportionate to size (with or without replacement) a.k.a monetary unit sampling</a></li>
<li><a class="nav-link" href="#stratified-random-sampling"><span class="header-section-number">19.4</span> Stratified random sampling</a></li>
<li><a class="nav-link" href="#cluster-sampling"><span class="header-section-number">19.5</span> Cluster sampling</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Analytics in Audit, using R</strong>" was written by Anil Goyal. It was last built on 2024-07-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
