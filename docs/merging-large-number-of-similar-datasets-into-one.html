<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 11 Merging large number of similar datasets into one | R for Audit Analytics</title>
<meta name="author" content="Anil Goyal">
<meta name="description" content="Data preparation for performing analytics is an important task and may require more time than actual analytics because we rarely have data in ideal format. Importing csv or flat files is rather an...">
<meta name="generator" content="bookdown 0.40 with bs4_book()">
<meta property="og:title" content="Chapter 11 Merging large number of similar datasets into one | R for Audit Analytics">
<meta property="og:type" content="book">
<meta property="og:url" content="https://anilyayavar.github.io/new-book/merging-large-number-of-similar-datasets-into-one.html">
<meta property="og:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg">
<meta property="og:description" content="Data preparation for performing analytics is an important task and may require more time than actual analytics because we rarely have data in ideal format. Importing csv or flat files is rather an...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 11 Merging large number of similar datasets into one | R for Audit Analytics">
<meta name="twitter:description" content="Data preparation for performing analytics is an important task and may require more time than actual analytics because we rarely have data in ideal format. Importing csv or flat files is rather an...">
<meta name="twitter:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Audit Analytics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome to R for Audit Analytics</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="about-author.html">About author</a></li>
<li><a class="" href="gearing-up.html">Gearing up</a></li>
<li><a class="" href="part-i-basic-r-programming-concepts.html">Part-I: Basic R Programming Concepts</a></li>
<li><a class="" href="r-programming-language.html"><span class="header-section-number">1</span> R Programming Language</a></li>
<li><a class="" href="subset.html"><span class="header-section-number">2</span> Subsetting R objects or accesing specific elements</a></li>
<li><a class="" href="func.html"><span class="header-section-number">3</span> Functions and operations in R</a></li>
<li><a class="" href="existing-and-useful-functions-in-base-r.html"><span class="header-section-number">4</span> Existing and useful functions in base R</a></li>
<li><a class="" href="pipes-in-r.html"><span class="header-section-number">5</span> Pipes in R</a></li>
<li><a class="" href="control-statements.html"><span class="header-section-number">6</span> Control statements</a></li>
<li><a class="" href="functional-programming.html"><span class="header-section-number">7</span> Functional Programming</a></li>
<li><a class="" href="file.html"><span class="header-section-number">8</span> File handling operations in R</a></li>
<li><a class="" href="read.html"><span class="header-section-number">9</span> Getting data in and out of R</a></li>
<li><a class="" href="data-cleaning-in-r.html"><span class="header-section-number">10</span> Data Cleaning in R</a></li>
<li><a class="active" href="merging-large-number-of-similar-datasets-into-one.html"><span class="header-section-number">11</span> Merging large number of similar datasets into one</a></li>
<li><a class="" href="part-ii-exploratory-data-analysis.html">Part-II: Exploratory Data Analysis</a></li>
<li><a class="" href="visualisations-in-base-r.html"><span class="header-section-number">12</span> Visualisations in Base R</a></li>
<li><a class="" href="visualising-data-with-ggplot2.html"><span class="header-section-number">13</span> Visualising data with ggplot2</a></li>
<li><a class="" href="data-transformation-in-dplyr.html"><span class="header-section-number">14</span> Data Transformation in dplyr</a></li>
<li><a class="" href="combining-tablestabular-data.html"><span class="header-section-number">15</span> Combining Tables/tabular data</a></li>
<li><a class="" href="data-wrangling-in-tidyr.html"><span class="header-section-number">16</span> Data Wrangling in tidyr</a></li>
<li><a class="" href="generating-descriptive-statistics.html"><span class="header-section-number">17</span> Generating Descriptive statistics</a></li>
<li><a class="" href="part-iii-probability-and-sampling-in-r.html">Part-III: Probability and Sampling in R</a></li>
<li><a class="" href="probability-in-r.html"><span class="header-section-number">18</span> Probability in R</a></li>
<li><a class="" href="random-sampling-in-r.html"><span class="header-section-number">19</span> Random sampling in R</a></li>
<li><a class="" href="part-iv-machine-learning-in-r.html">Part-IV: Machine Learning in R</a></li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">20</span> Linear Regression</a></li>
<li><a class="" href="principal-component-analysis-in-r.html"><span class="header-section-number">21</span> Principal Component Analysis in R</a></li>
<li><a class="" href="clustering-in-r-using-kmeans-algorithm.html"><span class="header-section-number">22</span> Clustering in R (Using Kmeans algorithm)</a></li>
<li><a class="" href="association-rule-mining-in-r-apriori.html"><span class="header-section-number">23</span> Association Rule Mining in R (Apriori)</a></li>
<li><a class="" href="part-v-time-series-analysis.html">Part-V: Time Series Analysis</a></li>
<li><a class="" href="dates-and-times.html"><span class="header-section-number">24</span> Dates and Times</a></li>
<li><a class="" href="time-series-analysis.html"><span class="header-section-number">25</span> Time Series Analysis</a></li>
<li><a class="" href="part-vi-network-analytics.html">Part VI: Network Analytics</a></li>
<li><a class="" href="network-analyticsgraph-theory-in-r.html"><span class="header-section-number">26</span> Network Analytics/Graph theory in R</a></li>
<li><a class="" href="applying-network-analysis-in-auditfraud-detection.html"><span class="header-section-number">27</span> Applying network analysis in audit/fraud detection</a></li>
<li><a class="" href="part-vii-text-analytics-in-r.html">Part-VII: Text Analytics in R</a></li>
<li><a class="" href="string-manipulation-in-stringr.html"><span class="header-section-number">28</span> String manipulation in stringr</a></li>
<li><a class="" href="regex---a-quick-introduction.html"><span class="header-section-number">29</span> Regex - A quick introduction</a></li>
<li><a class="" href="regex-in-human-readble-format-using-rebus.html"><span class="header-section-number">30</span> Regex in human readble format using rebus</a></li>
<li><a class="" href="text-analytics-in-r.html"><span class="header-section-number">31</span> Text Analytics in R</a></li>
<li><a class="" href="sentiment-analysis.html"><span class="header-section-number">32</span> Sentiment Analysis</a></li>
<li><a class="" href="visualising-text-analytics-through-wordcloud-etc..html"><span class="header-section-number">33</span> Visualising Text analytics through Wordcloud, etc.</a></li>
<li><a class="" href="finding-string-similarity.html"><span class="header-section-number">34</span> Finding string similarity</a></li>
<li><a class="" href="part-viii-geo-computation-in-r.html">Part-VIII: Geo computation in R</a></li>
<li><a class="" href="maps-in-r.html"><span class="header-section-number">35</span> Maps in R</a></li>
<li><a class="" href="geo-coding-in-r.html"><span class="header-section-number">36</span> Geo-Coding in R</a></li>
<li><a class="" href="reverse-geo-coding.html"><span class="header-section-number">37</span> Reverse geo-coding</a></li>
<li><a class="" href="part-ix-identifying-anamolous-observations-for-audit.html">Part-IX: Identifying anamolous observations for audit</a></li>
<li><a class="" href="benford-testsanalysis.html"><span class="header-section-number">38</span> Benford Tests/Analysis</a></li>
<li><a class="" href="anomaly-detection.html"><span class="header-section-number">39</span> Anomaly Detection</a></li>
<li><a class="" href="finding-anamolous-outliers.html"><span class="header-section-number">40</span> Finding Anamolous Outliers</a></li>
<li><a class="" href="dup.html"><span class="header-section-number">41</span> Duplicate Detection</a></li>
<li><a class="" href="detecting-gaps-in-sequences.html"><span class="header-section-number">42</span> Detecting gaps in sequences</a></li>
<li><a class="" href="data-envelopment-analysis.html"><span class="header-section-number">43</span> Data Envelopment Analysis</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="colors-in-r.html"><span class="header-section-number">A</span> Colors in R</a></li>
<li><a class="" href="various-datasets-in-base-r-used-in-this-book.html"><span class="header-section-number">B</span> Various Datasets, in base R, used in this book</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="merging-large-number-of-similar-datasets-into-one" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> Merging large number of similar datasets into one<a class="anchor" aria-label="anchor" href="#merging-large-number-of-similar-datasets-into-one"><i class="fas fa-link"></i></a>
</h1>
<p>Data preparation for performing analytics is an important task and may require more time than actual analytics because we rarely have data in ideal format. Importing csv or flat files is rather an easy job. However, considering large popularity of MS Excel, we at times have our data saved in excel files.</p>
<p>Sometimes, one single data frame/table is divided into multiple sheets in one excel file whereas sometimes these tables are divided in multiple files. Here we are discussing few of these cases, where we can reduce our data preparation time by effectively writing the code for import of such data into our environment.</p>
<div id="case-1-merging-multiple-excel-sheets-into-one-data-frame" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> <strong>Case-1</strong>: Merging multiple excel sheets into one data frame<a class="anchor" aria-label="anchor" href="#case-1-merging-multiple-excel-sheets-into-one-data-frame"><i class="fas fa-link"></i></a>
</h2>
<p>As an example, let’s say we have multiple States’ data saved on a different sheet in one excel file say <code>Daur.xlsx</code>. See preview in fig <a href="merging-large-number-of-similar-datasets-into-one.html#fig:prevexcel">11.1</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:prevexcel"></span>
<img src="images/excel.png" alt="Preview of example excel file" width="100%"><p class="caption">
Figure 11.1: Preview of example excel file
</p>
</div>
<p>We will use library <code>readxl</code> to read excel files. This library is bundled with <code>tidyverse</code> but is not part of core tidyverse, so it has to be loaded explicitly, though explicit download is not required if <code>tidyverse</code> is installed in the system.</p>
<div class="sourceCode" id="cb740"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span></code></pre></div>
<p>The following steps are used-</p>
<p>Step-1: Read path</p>
<p>Step-2: Collect Names of all sheets</p>
<p>Step-3: Set names of elements of above vector onto itself</p>
<p>Step-4: Read and combine all tables into one. We will use <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html">purrr::map_dfr</a></code> for this.</p>
<div class="sourceCode" id="cb741"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step-1</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"data/daur1.xlsx"</span></span>
<span><span class="co"># Step-2</span></span>
<span><span class="va">states_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/excel_sheets.html">excel_sheets</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span><span class="co"># step-3</span></span>
<span>    <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span><span class="co"># step-4</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html">map_dfr</a></span><span class="op">(</span><span class="va">read_excel</span>, path<span class="op">=</span><span class="va">path</span>, .id <span class="op">=</span> <span class="st">'State_name'</span><span class="op">)</span></span>
<span><span class="co"># print file</span></span>
<span><span class="va">states_data</span></span></code></pre></div>
<pre><code>## # A tibble: 18 × 4
##    State_name     Year    Metric_1 Metric_2
##    &lt;chr&gt;          &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1 Andhra Pradesh 2015-16      119      121
##  2 Andhra Pradesh 2016-17      114      134
##  3 Andhra Pradesh 2017-18      115      122
##  4 Andhra Pradesh 2018-19      129      137
##  5 Andhra Pradesh 2019-20      149      129
##  6 Andhra Pradesh 2020-21      104      124
##  7 Assam          2015-16      104      145
##  8 Assam          2016-17      114      144
##  9 Assam          2017-18      116      116
## 10 Assam          2018-19      129      130
## 11 Assam          2019-20      144      134
## 12 Assam          2020-21      124      116
## 13 Bihar          2015-16      109      148
## 14 Bihar          2016-17      134      106
## 15 Bihar          2017-18      131      133
## 16 Bihar          2018-19      131      100
## 17 Bihar          2019-20      131      127
## 18 Bihar          2020-21      128      103</code></pre>
<p>We can see that data from all the sheets have been merged into table and one extra column has been created using sheet name. The name of that column has been provided through <code>.id</code> argument. If the new column is not required, simply don’t use this argument.</p>
</div>
<div id="case-2-merging-multiple-files-into-one-data-frame" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> <strong>Case-2</strong>: Merging multiple files into one data frame<a class="anchor" aria-label="anchor" href="#case-2-merging-multiple-files-into-one-data-frame"><i class="fas fa-link"></i></a>
</h2>
<p>Often we have our source data split into multiple files, which we will have to compile in one single data frame before proceeding In this case, we may collect all such files in one directory and follow these steps-</p>
<p>Step-1: Store all file names using <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code></p>
<p>Step-2: We may read all files in one list using either <code>lapply</code> or <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map</a></code>.</p>
<p>Step-3: If data structures in all the files are same, we can directly use <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html">purrr::map_dfr</a></code> which will read all files and give us a data frame. If however, the structure of data in all files are not same, we may convert all columns into character type before merging these files. We can thereafter proceed for merging all data using either <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html">purrr::map_dfr</a></code> or <code>lapply</code> in combination with <code>do.call</code>.</p>
</div>
<div id="case-3-split-and-save-one-data-frame-into-multiple-excelcsv-files-simultaneously." class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> <strong>Case-3</strong>: Split and save one data frame into multiple excel/csv files simultaneously.<a class="anchor" aria-label="anchor" href="#case-3-split-and-save-one-data-frame-into-multiple-excelcsv-files-simultaneously."><i class="fas fa-link"></i></a>
</h2>
<p>As an example will use <code>states_data</code> created in case-1. We can use the following algorithm</p>
<p>Step-1: Create a vector of file names using <code>paste0</code>
Step-2: Split data frame into a list with separate dataframe for each state
Step-3: Write to a separate file using <code><a href="https://purrr.tidyverse.org/reference/map2.html">purrr::walk2()</a></code></p>
<p>The complete algorithm is</p>
<div class="sourceCode" id="cb743"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># step-1 : create a vector of file names (output)</span></span>
<span><span class="va">file_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">states_data</span><span class="op">$</span><span class="va">State_name</span><span class="op">)</span>, <span class="st">".csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">states_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html">group_split</a></span><span class="op">(</span><span class="va">State_name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">walk2</a></span><span class="op">(</span><span class="va">file_names</span>, <span class="va">write.csv</span><span class="op">)</span></span></code></pre></div>
<p>We can check that 3 new files with state_names as filenames have been created in the <code>data</code> folder/directory as desired.</p>
</div>
<div id="case-4-splitting-one-data-into-muliple-files-having-multiple-sheets" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> <strong>Case-4</strong>: Splitting one data into muliple files having multiple sheets<a class="anchor" aria-label="anchor" href="#case-4-splitting-one-data-into-muliple-files-having-multiple-sheets"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes, we may require to split a file not only into multiple files, but simultaeously require to split each file into multiple excel sheets. E.g. A data having States and districts is to be split into State-wise files having a separate sheet for each district.</p>
<p>This can be achieved using <code>writexl</code> library. In this case, we may write a custom function which can do our job easily.</p>
<div class="sourceCode" id="cb744"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/writexl/">writexl</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">book_and_sheets</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">df_by_x</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">save_to_excel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">[[</span><span class="va">y</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu">writexl</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/writexl/reference/write_xlsx.html">write_xlsx</a></span><span class="op">(</span></span>
<span>        path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/data_by_"</span>, <span class="va">b</span>,<span class="st">"_"</span>,<span class="va">x</span>, <span class="st">".xlsx"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html">imap</a></span><span class="op">(</span><span class="va">df_by_x</span>, <span class="va">save_to_excel</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The function <code>book_and_sheets</code> designed in above code helps us to write a data say <code>df</code> into separate files based on column <code>x</code> and each of these files is further divided into sheets based on column <code>y</code>. Only thing to be remembered is that we have to pass, <code>x</code> and <code>y</code> arguments as character strings; and <code>df</code> as variable.</p>
<p>Example - splitting <code>mtcars</code> into files based on <code>cyl</code> and sheets based on <code>gear</code></p>
<div class="sourceCode" id="cb745"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">book_and_sheets</span><span class="op">(</span><span class="va">mtcars</span>, <span class="st">'cyl'</span>, <span class="st">'gear'</span><span class="op">)</span></span></code></pre></div>
<pre><code>## $`4`
## [1] "G:\\OneDrive - A c GeM CAG of INDIA (1)\\new book\\Data\\data_by_4_cyl.xlsx"
## 
## $`6`
## [1] "G:\\OneDrive - A c GeM CAG of INDIA (1)\\new book\\Data\\data_by_6_cyl.xlsx"
## 
## $`8`
## [1] "G:\\OneDrive - A c GeM CAG of INDIA (1)\\new book\\Data\\data_by_8_cyl.xlsx"</code></pre>
<p>We can check that three excel files have been created in directory <code>data/</code>.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="data-cleaning-in-r.html"><span class="header-section-number">10</span> Data Cleaning in R</a></div>
<div class="next"><a href="part-ii-exploratory-data-analysis.html">Part-II: Exploratory Data Analysis</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#merging-large-number-of-similar-datasets-into-one"><span class="header-section-number">11</span> Merging large number of similar datasets into one</a></li>
<li><a class="nav-link" href="#case-1-merging-multiple-excel-sheets-into-one-data-frame"><span class="header-section-number">11.1</span> Case-1: Merging multiple excel sheets into one data frame</a></li>
<li><a class="nav-link" href="#case-2-merging-multiple-files-into-one-data-frame"><span class="header-section-number">11.2</span> Case-2: Merging multiple files into one data frame</a></li>
<li><a class="nav-link" href="#case-3-split-and-save-one-data-frame-into-multiple-excelcsv-files-simultaneously."><span class="header-section-number">11.3</span> Case-3: Split and save one data frame into multiple excel/csv files simultaneously.</a></li>
<li><a class="nav-link" href="#case-4-splitting-one-data-into-muliple-files-having-multiple-sheets"><span class="header-section-number">11.4</span> Case-4: Splitting one data into muliple files having multiple sheets</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Audit Analytics</strong>" was written by Anil Goyal. It was last built on 2024-07-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
