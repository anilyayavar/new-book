<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Chapter 16 Data Wrangling in tidyr | R for Audit Analytics</title>

    <meta name="author" content="Anil Goyal" />
  
   <meta name="description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Chapter 16 Data Wrangling in tidyr | R for Audit Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://anilyayavar.github.io/new-book/" />
  <meta property="og:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg" />
  <meta property="og:description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 Data Wrangling in tidyr | R for Audit Analytics" />
  
  <meta name="twitter:description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />
  <meta name="twitter:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.8.0/transition.js"></script>
    <script src="libs/bs3compat-0.8.0/tabs.js"></script>
    <script src="libs/bs3compat-0.8.0/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
    <style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
      <link rel="stylesheet" href="style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Audit Analytics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="data-wrangling-in-tidyr" class="section level1" number="16">
<h1><span class="header-section-number">Chapter 16</span> Data Wrangling in <code>tidyr</code></h1>
<p>In this chapter we will learn about reshaping data to the format most suitable for our data analysis work. To reshape the data, we will use <code>tidyr</code> package<span class="citation"><a href="#fn23" class="footnote-ref" id="fnref23"><sup>23</sup></a></span> which is part of core <code>tidyverse</code> and can be loaded either by calling <code>library(tidyr)</code> or <code>library(tidyverse)</code>.</p>
<p><strong>Prerequisites</strong></p>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb998-1"><a href="data-wrangling-in-tidyr.html#cb998-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div id="concepts-of-tidy-data" class="section level2" number="16.1">
<h2><span class="header-section-number">16.1</span> Concepts of tidy data</h2>
<p><a href="https://hadley.nz/">Hadley Wickham</a>, the chief scientist behind development of RStudio, tidyverse, and much more, introduced the concept of tidy data in a paper<a href="#fn24" class="footnote-ref" id="fnref24"><sup>24</sup></a> published in the Journal of Statistical Software.<span class="citation"><a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a></span> Tidy data is a framework to structure data sets so they can be easily analyzed and visualized. It can be thought of as a goal one should aim for when cleaning data. Once we understand what tidy data is, that knowledge will make our data analysis, visualization, and collection much easier.<span class="citation"><a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a></span></p>
<p>A tidy data-set has the following properties:</p>
<ol style="list-style-type: decimal">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table.</li>
</ol>
<p>Diagrammatically<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a> this can be represented as in figure <a href="data-wrangling-in-tidyr.html#fig:tidy">16.1</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:tidy"></span>
<img src="images/tidy-1.png" alt="Diagrammatic representation of tidy data" width="99%" />
<p class="caption">
Figure 16.1: Diagrammatic representation of tidy data
</p>
</div>
<p>Once a dataset is tidy, it can be used as input into a variety of other functions that may transform, model, or visualize the data.</p>
<p>Consider these five examples<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a>. All these examples<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a> represent same data but shown in different formats-</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="data-wrangling-in-tidyr.html#cb999-1" tabindex="-1"></a><span class="co">#Example-1</span></span>
<span id="cb999-2"><a href="data-wrangling-in-tidyr.html#cb999-2" tabindex="-1"></a>tidyr<span class="sc">::</span>table1</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1001-1"><a href="data-wrangling-in-tidyr.html#cb1001-1" tabindex="-1"></a><span class="co"># Example-2</span></span>
<span id="cb1001-2"><a href="data-wrangling-in-tidyr.html#cb1001-2" tabindex="-1"></a>tidyr<span class="sc">::</span>table2</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
##    country      year type            count
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1003-1"><a href="data-wrangling-in-tidyr.html#cb1003-1" tabindex="-1"></a><span class="co"># Example-3</span></span>
<span id="cb1003-2"><a href="data-wrangling-in-tidyr.html#cb1003-2" tabindex="-1"></a>tidyr<span class="sc">::</span>table3</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   country      year rate             
##   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1005-1"><a href="data-wrangling-in-tidyr.html#cb1005-1" tabindex="-1"></a><span class="co"># Example-4 (Same data in 2 data tables now)</span></span>
<span id="cb1005-2"><a href="data-wrangling-in-tidyr.html#cb1005-2" tabindex="-1"></a>tidyr<span class="sc">::</span>table4a</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   country     `1999` `2000`
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="data-wrangling-in-tidyr.html#cb1007-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table4b</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   country         `1999`     `2000`
##   &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan   19987071   20595360
## 2 Brazil       172006362  174504898
## 3 China       1272915272 1280428583</code></pre>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1009-1"><a href="data-wrangling-in-tidyr.html#cb1009-1" tabindex="-1"></a><span class="co"># Example-5</span></span>
<span id="cb1009-2"><a href="data-wrangling-in-tidyr.html#cb1009-2" tabindex="-1"></a>tidyr<span class="sc">::</span>table5</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country     century year  rate             
##   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 19      99    745/19987071     
## 2 Afghanistan 20      00    2666/20595360    
## 3 Brazil      19      99    37737/172006362  
## 4 Brazil      20      00    80488/174504898  
## 5 China       19      99    212258/1272915272
## 6 China       20      00    213766/1280428583</code></pre>
<p>Let us discuss these example one by one -</p>
<ul>
<li><code>table1</code> fulfills all three rules stated above and is thus, in tidy format. Notice that every observation has its own row, and each variable is stored in a separate column.</li>
<li><code>table2</code> stores one observation in two columns (separately for cases and population) and is thus not tidy.</li>
<li><code>table3</code> stores two variables in one column (cases and population together) and is thus not tidy.</li>
<li><code>table4a</code> and <code>table4b</code> clearly stores one observation in two different tables and is thus not tidy. We may further notice that both these tables use values as column headers, which also violate rule no.3 stated above.</li>
<li><code>table5</code> again stores one variable i.e. year in two separate columns, and thus does not follow rule no.2 stated above.</li>
</ul>
<div id="reshaping-data" class="section level5 unnumbered">
<h5>Reshaping data</h5>
<p>In real world problems we will mostly come across data-sets that are not in tidy formats and for data analysis, visualisation we will need <code>tidying</code> the datasets. To do this we will first need to understand what actually is a value, a variable/field and an observation. As a second step of <em>tidying</em> we will require to reshape the data by either -</p>
<ul>
<li>re-organising the observation originally spread into multiple rows (e.g. <code>table2</code>), in one row; OR</li>
<li>re-organising the variable spread into multiple columns (e.g. <code>table3</code>, etc.), in one single column.</li>
</ul>
<p>To perform this <em>tidying</em> exercise, we will need two most important functions from <code>tidyr</code> i.e. <code>pivot_longer</code> and <code>pivot_wider</code>. So let us understand the functioning of these.</p>
</div>
</div>
<div id="longer-format-through-function-pivot_longer" class="section level2" number="16.2">
<h2><span class="header-section-number">16.2</span> LONGER format through function <code>pivot_longer()</code></h2>
<p>Often we will come across data sets that will have values (instead of actual variable name) as column headers. Let us take the example of <code>table4a</code> or <code>table4b</code> shown above. Both these tables have values of variable <code>year</code> as column names. So we need to re-structure these tables into a longer format where these values form part of columns instead of column names. We will use <code>pivot_longer()</code> function for this. Th basic syntax is-</p>
<pre><code>pivot_longer(
  data,
  cols,
  names_to = &quot;name&quot;,
  values_to = &quot;value&quot;,
  ...
)</code></pre>
<p><em>Note that there many more useful arguments to this function, but first let us consider on these only.</em></p>
<ul>
<li><code>cols</code> indicate names of columns (as a character vector) to be converted into longer format</li>
<li><code>names_to = "name"</code> argument will actually convert values used as column headers back to a column with given “name”</li>
<li><code>values_to = "value"</code> argument will convert values of all those columns back into one column with given name “value” (e.g. population in table4b).</li>
</ul>
<p>This can be understood through the gif (animated) image <a href="data-wrangling-in-tidyr.html#fig:tidy1">16.2</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:tidy1"></span>
<img src="images/long.gif" alt="Data Reshaping to longer format"  />
<p class="caption">
Figure 16.2: Data Reshaping to longer format
</p>
</div>
<p>Basic functionality can be understood using the following example-</p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="data-wrangling-in-tidyr.html#cb1012-1" tabindex="-1"></a>iris_summary <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span> </span>
<span id="cb1012-2"><a href="data-wrangling-in-tidyr.html#cb1012-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb1012-3"><a href="data-wrangling-in-tidyr.html#cb1012-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Sepal.Width),</span>
<span id="cb1012-4"><a href="data-wrangling-in-tidyr.html#cb1012-4" tabindex="-1"></a>            <span class="at">st_dev =</span> <span class="fu">sd</span>(Sepal.Width))</span>
<span id="cb1012-5"><a href="data-wrangling-in-tidyr.html#cb1012-5" tabindex="-1"></a>iris_summary</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   Species     mean st_dev
##   &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1 setosa      3.43  0.379
## 2 versicolor  2.77  0.314
## 3 virginica   2.97  0.322</code></pre>
<p>Using <code>pivot_wider</code> we can convert column headers into values. Check the diagram in figure <a href="data-wrangling-in-tidyr.html#fig:plong">16.3</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plong"></span>
<img src="images/pivot_longer.png" alt="Diagrammatic representation of pivot\_longer" width="99%" />
<p class="caption">
Figure 16.3: Diagrammatic representation of pivot_longer
</p>
</div>
<p>Now we are ready to convert <code>table4a</code> into a tidier format.</p>
<div id="case-i-when-values-are-in-column-headers" class="section level3 unnumbered">
<h3>Case-I when values are in column headers</h3>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1014-1"><a href="data-wrangling-in-tidyr.html#cb1014-1" tabindex="-1"></a><span class="fu">pivot_longer</span>(</span>
<span id="cb1014-2"><a href="data-wrangling-in-tidyr.html#cb1014-2" tabindex="-1"></a>  table4a, </span>
<span id="cb1014-3"><a href="data-wrangling-in-tidyr.html#cb1014-3" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&#39;1999&#39;</span>, <span class="st">&#39;2000&#39;</span>), </span>
<span id="cb1014-4"><a href="data-wrangling-in-tidyr.html#cb1014-4" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">&#39;year&#39;</span>, </span>
<span id="cb1014-5"><a href="data-wrangling-in-tidyr.html#cb1014-5" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">&#39;cases&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   country     year   cases
##   &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;
## 1 Afghanistan 1999     745
## 2 Afghanistan 2000    2666
## 3 Brazil      1999   37737
## 4 Brazil      2000   80488
## 5 China       1999  212258
## 6 China       2000  213766</code></pre>
<p>With <em>pipes</em> and a little tweaking, the above syntax could have been written as-</p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1016-1"><a href="data-wrangling-in-tidyr.html#cb1016-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table4a <span class="sc">%&gt;%</span>                         <span class="co"># first argument passed through pipe </span></span>
<span id="cb1016-2"><a href="data-wrangling-in-tidyr.html#cb1016-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>country,     <span class="co"># all columns except country</span></span>
<span id="cb1016-3"><a href="data-wrangling-in-tidyr.html#cb1016-3" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb1016-4"><a href="data-wrangling-in-tidyr.html#cb1016-4" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;cases&quot;</span>)</span></code></pre></div>
</div>
<div id="case-ii-when-both-variables-and-variable-names-are-combined-together-as-column-names" class="section level3 unnumbered">
<h3>Case-II when both variables and variable names are combined together as column names</h3>
<p>We have seen a simple case to tidy the table when the values (e.g. years) were depicted as column names instead of variables i.e. actual data. There may be cases when column names are a combination of both.</p>
<p>Example - Say we have a table <code>table6</code> as</p>
<pre><code>## # A tibble: 3 × 5
##   country     cases_1999 cases_2000   pop_1999   pop_2000
##   &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan        745       2666   19987071   20595360
## 2 Brazil           37737      80488  172006362  174504898
## 3 China           212258     213766 1272915272 1280428583</code></pre>
<p>We may use <code>names_sep</code> argument in this case, which will separate the combined variables from the column names -</p>
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1018-1"><a href="data-wrangling-in-tidyr.html#cb1018-1" tabindex="-1"></a>table6 <span class="sc">%&gt;%</span> </span>
<span id="cb1018-2"><a href="data-wrangling-in-tidyr.html#cb1018-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>country,</span>
<span id="cb1018-3"><a href="data-wrangling-in-tidyr.html#cb1018-3" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1018-4"><a href="data-wrangling-in-tidyr.html#cb1018-4" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;count_type&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb1018-5"><a href="data-wrangling-in-tidyr.html#cb1018-5" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
##    country     count_type year       count
##    &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;dbl&gt;
##  1 Afghanistan cases      1999         745
##  2 Afghanistan cases      2000        2666
##  3 Afghanistan pop        1999    19987071
##  4 Afghanistan pop        2000    20595360
##  5 Brazil      cases      1999       37737
##  6 Brazil      cases      2000       80488
##  7 Brazil      pop        1999   172006362
##  8 Brazil      pop        2000   174504898
##  9 China       cases      1999      212258
## 10 China       cases      2000      213766
## 11 China       pop        1999  1272915272
## 12 China       pop        2000  1280428583</code></pre>
<blockquote>
<p>Note that we have two column names in argument <code>names_to</code>.</p>
</blockquote>
<p>Though the above table is still not in tidy format, yet the example was taken to show the functioning of other arguments of the <code>pivot_longer</code>. We provided two static column names to the related argument and the variables were created after splitting the headers with sep <code>_</code>. We actually require one dynamic value to be retained as column name (<code>cases</code> and <code>pop</code> here) but need to convert <code>year</code> to variables.</p>
<p>To do so we will use special value <code>".value"</code> in the related argument. Understanding the special value becomes clear with the animated figure <a href="data-wrangling-in-tidyr.html#fig:tidy2">16.4</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:tidy2"></span>
<img src="images/case3.gif" alt="When headers contain both headers and data combined together"  />
<p class="caption">
Figure 16.4: When headers contain both headers and data combined together
</p>
</div>
<p>Example-</p>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1020-1"><a href="data-wrangling-in-tidyr.html#cb1020-1" tabindex="-1"></a>table6 <span class="sc">%&gt;%</span> </span>
<span id="cb1020-2"><a href="data-wrangling-in-tidyr.html#cb1020-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>country,</span>
<span id="cb1020-3"><a href="data-wrangling-in-tidyr.html#cb1020-3" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1020-4"><a href="data-wrangling-in-tidyr.html#cb1020-4" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb1020-5"><a href="data-wrangling-in-tidyr.html#cb1020-5" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country     year   cases        pop
##   &lt;chr&gt;       &lt;chr&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan 1999     745   19987071
## 2 Afghanistan 2000    2666   20595360
## 3 Brazil      1999   37737  172006362
## 4 Brazil      2000   80488  174504898
## 5 China       1999  212258 1272915272
## 6 China       2000  213766 1280428583</code></pre>
<blockquote>
<p>Note that by using <code>.value</code> the argument <code>values_to</code> becomes meaning less.</p>
</blockquote>
</div>
</div>
<div id="wider-format-through-pivot_wider" class="section level2" number="16.3">
<h2><span class="header-section-number">16.3</span> WIDER format through <code>pivot_wider()</code></h2>
<p>As the name suggests, <code>pivot_wider()</code> does exactly opposite to what a <code>pivot_longer</code> does. Additionally, this function is used to create summary reports, as pivot functionality in MS Excel, through <code>values_fn</code> argument. Diagrammatically this can be represented as in figure <a href="data-wrangling-in-tidyr.html#fig:pwide">16.6</a>. The basic syntax (with commonly used arguments) is-</p>
<pre><code>pivot_wider(
  data,
  id_cols = NULL,
  names_from = name,
  values_from = value,
  values_fill = NULL,
  values_fn = NULL,
  ...
)</code></pre>
<p>where-</p>
<ul>
<li><code>id_cols</code> is a vector of columns that uniquely identifies each observation</li>
<li><code>names_from</code> is a vector of columns to get the name of the output column</li>
<li><code>values_from</code> similarly provides columns to get the cell values from</li>
<li><code>values_fill</code> provides what each value should be filled in with when missing</li>
<li><code>values_fn</code> is a named list - to apply different aggregations to different <code>values_from</code> columns</li>
</ul>
<blockquote>
<p>Also note that there are many other arguments for this function, which may be used to deal with complicated tables.</p>
</blockquote>
Basic functionality of this function can be understood with the following animated figure <a href="data-wrangling-in-tidyr.html#fig:tidy3">16.5</a>.
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:tidy3"></span>
<img src="images/wider.gif" alt="Basic functionality of Pivot wider"  />
<p class="caption">
Figure 16.5: Basic functionality of Pivot wider
</p>
</div>
<p>A diagrammtic representation of the mechanics behind the function is also shown in Figure <a href="data-wrangling-in-tidyr.html#fig:pwide">16.6</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:pwide"></span>
<img src="images/pivot_wider.png" alt="Diagrammatic representation of pivot\_wider" width="99%" />
<p class="caption">
Figure 16.6: Diagrammatic representation of pivot_wider
</p>
</div>
<p>Example-1:</p>
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1023-1"><a href="data-wrangling-in-tidyr.html#cb1023-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1023-2"><a href="data-wrangling-in-tidyr.html#cb1023-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;type&quot;</span>,</span>
<span id="cb1023-3"><a href="data-wrangling-in-tidyr.html#cb1023-3" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Example-2:</p>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="data-wrangling-in-tidyr.html#cb1025-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1025-2"><a href="data-wrangling-in-tidyr.html#cb1025-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year,</span>
<span id="cb1025-3"><a href="data-wrangling-in-tidyr.html#cb1025-3" tabindex="-1"></a>              <span class="at">values_from =</span> count)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country     type           `1999`     `2000`
##   &lt;chr&gt;       &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt;
## 1 Afghanistan cases             745       2666
## 2 Afghanistan population   19987071   20595360
## 3 Brazil      cases           37737      80488
## 4 Brazil      population  172006362  174504898
## 5 China       cases          212258     213766
## 6 China       population 1272915272 1280428583</code></pre>
<p>Example-3: Summarisation</p>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="data-wrangling-in-tidyr.html#cb1027-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1027-2"><a href="data-wrangling-in-tidyr.html#cb1027-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> country,</span>
<span id="cb1027-3"><a href="data-wrangling-in-tidyr.html#cb1027-3" tabindex="-1"></a>              <span class="at">names_from =</span> type,</span>
<span id="cb1027-4"><a href="data-wrangling-in-tidyr.html#cb1027-4" tabindex="-1"></a>              <span class="at">values_from =</span> count,</span>
<span id="cb1027-5"><a href="data-wrangling-in-tidyr.html#cb1027-5" tabindex="-1"></a>              <span class="at">values_fn =</span> mean)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   country       cases  population
##   &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;
## 1 Afghanistan   1706.   20291216.
## 2 Brazil       59112.  173255630 
## 3 China       213012  1276671928.</code></pre>
<p>Example-4: Summarisation with different id_cols</p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="data-wrangling-in-tidyr.html#cb1029-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1029-2"><a href="data-wrangling-in-tidyr.html#cb1029-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> year,</span>
<span id="cb1029-3"><a href="data-wrangling-in-tidyr.html#cb1029-3" tabindex="-1"></a>              <span class="at">names_from =</span> type,</span>
<span id="cb1029-4"><a href="data-wrangling-in-tidyr.html#cb1029-4" tabindex="-1"></a>              <span class="at">values_from =</span> count,</span>
<span id="cb1029-5"><a href="data-wrangling-in-tidyr.html#cb1029-5" tabindex="-1"></a>              <span class="at">values_fn =</span> sum)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##    year  cases population
##   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1  1999 250740 1464908705
## 2  2000 296920 1475528841</code></pre>
<p>Example-5: Use of multiple columns in <code>names_from</code> argument</p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="data-wrangling-in-tidyr.html#cb1031-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1031-2"><a href="data-wrangling-in-tidyr.html#cb1031-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(year, type),</span>
<span id="cb1031-3"><a href="data-wrangling-in-tidyr.html#cb1031-3" tabindex="-1"></a>               <span class="at">values_from =</span> count)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   country     `1999_cases` `1999_population` `2000_cases` `2000_population`
##   &lt;chr&gt;              &lt;dbl&gt;             &lt;dbl&gt;        &lt;dbl&gt;             &lt;dbl&gt;
## 1 Afghanistan          745          19987071         2666          20595360
## 2 Brazil             37737         172006362        80488         174504898
## 3 China             212258        1272915272       213766        1280428583</code></pre>
<p>What if order is reversed in <code>names_from</code> arg. See Example-6:</p>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1033-1"><a href="data-wrangling-in-tidyr.html#cb1033-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table2 <span class="sc">%&gt;%</span> </span>
<span id="cb1033-2"><a href="data-wrangling-in-tidyr.html#cb1033-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(type, year),</span>
<span id="cb1033-3"><a href="data-wrangling-in-tidyr.html#cb1033-3" tabindex="-1"></a>               <span class="at">values_from =</span> count)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   country     cases_1999 population_1999 cases_2000 population_2000
##   &lt;chr&gt;            &lt;dbl&gt;           &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;
## 1 Afghanistan        745        19987071       2666        20595360
## 2 Brazil           37737       172006362      80488       174504898
## 3 China           212258      1272915272     213766      1280428583</code></pre>
<p>Example-7: Multiple columns in <code>values_from</code></p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="data-wrangling-in-tidyr.html#cb1035-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table1 <span class="sc">%&gt;%</span> </span>
<span id="cb1035-2"><a href="data-wrangling-in-tidyr.html#cb1035-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year,</span>
<span id="cb1035-3"><a href="data-wrangling-in-tidyr.html#cb1035-3" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(cases, population))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   country     cases_1999 cases_2000 population_1999 population_2000
##   &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;
## 1 Afghanistan        745       2666        19987071        20595360
## 2 Brazil           37737      80488       172006362       174504898
## 3 China           212258     213766      1272915272      1280428583</code></pre>
<p>Example-8: Use of names_vary argument to control the order of output columns</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="data-wrangling-in-tidyr.html#cb1037-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table1 <span class="sc">%&gt;%</span> </span>
<span id="cb1037-2"><a href="data-wrangling-in-tidyr.html#cb1037-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year,</span>
<span id="cb1037-3"><a href="data-wrangling-in-tidyr.html#cb1037-3" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(cases, population),</span>
<span id="cb1037-4"><a href="data-wrangling-in-tidyr.html#cb1037-4" tabindex="-1"></a>              <span class="at">names_vary =</span> <span class="st">&quot;slowest&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   country     cases_1999 population_1999 cases_2000 population_2000
##   &lt;chr&gt;            &lt;dbl&gt;           &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;
## 1 Afghanistan        745        19987071       2666        20595360
## 2 Brazil           37737       172006362      80488       174504898
## 3 China           212258      1272915272     213766      1280428583</code></pre>
<p>For more details please refer to <a href="https://tidyr.tidyverse.org/articles/pivot.html">package vignette</a> or <a href="https://r4ds.had.co.nz/tidy-data.html">Chapter-12 of R for Data Science book</a>.</p>
</div>
<div id="separate-columns-into-multiple-columns-join-columns-into-one-column" class="section level2" number="16.4">
<h2><span class="header-section-number">16.4</span> Separate Column(s) into multiple columns/ Join columns into one column</h2>
<div id="separate-a-character-column-into-multiple-with-separate" class="section level3 unnumbered">
<h3>Separate a character column into multiple with <code>separate()</code></h3>
<p>As the name suggests, <code>separate()</code> function is used to separate a given character column into multiple columns either using a regular expression or a vector of character positions.
The syntax is -</p>
<pre><code>separate(
  data,
  col,
  into,
  sep = &quot;[^[:alnum:]]+&quot;,
  remove = TRUE,
  convert = FALSE,
  extra = &quot;warn&quot;,
  fill = &quot;warn&quot;,
  ...
)</code></pre>
<p>Explanation of purpose of different arguments in above syntax -</p>
<ol style="list-style-type: decimal">
<li><code>data</code> is as usual name of the data frame</li>
<li><code>col</code> is the name of the column which is required to be separated.</li>
<li><code>into</code> should be a character vector, which usually should be equal length of maximum number of new columns which will be created out of such separation. (Refer examples nos. 1)</li>
<li><code>sep</code> provides a separator value. (Refer Example -3 below).</li>
<li><code>remove</code> if <code>FALSE</code>, the original column is not removed from the output. (Refer Example -3 below).</li>
<li><code>convert</code> if <code>TRUE</code>, the component columns are converted to double/integer/logical/NA, if possible. This is useful if the component columns are integer, numeric or logical. (Refer Example-1 below).</li>
<li><code>extra</code> argument is used to control when number of desired component columns are less than the maximum possible count. (Refer Example-4 below).</li>
<li><code>fill</code> argument is on the other hand, useful when the number of components are different for each row. (Refer Example-2 below)</li>
</ol>
<p>Example-1:</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="data-wrangling-in-tidyr.html#cb1040-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table3 <span class="sc">%&gt;%</span> </span>
<span id="cb1040-2"><a href="data-wrangling-in-tidyr.html#cb1040-2" tabindex="-1"></a>  <span class="fu">separate</span>(rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1040-3"><a href="data-wrangling-in-tidyr.html#cb1040-3" tabindex="-1"></a>           <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="co"># optional - will convert the values</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Example-2:</p>
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1042-1"><a href="data-wrangling-in-tidyr.html#cb1042-1" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb1042-2"><a href="data-wrangling-in-tidyr.html#cb1042-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;a+b&quot;</span>, <span class="st">&quot;c+d+e&quot;</span>)</span>
<span id="cb1042-3"><a href="data-wrangling-in-tidyr.html#cb1042-3" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb1042-4"><a href="data-wrangling-in-tidyr.html#cb1042-4" tabindex="-1"></a>  <span class="fu">separate</span>(x,</span>
<span id="cb1042-5"><a href="data-wrangling-in-tidyr.html#cb1042-5" tabindex="-1"></a>           <span class="at">into=</span><span class="fu">c</span>(<span class="st">&#39;X1&#39;</span>, <span class="st">&#39;X2&#39;</span>, <span class="st">&#39;X3&#39;</span>),</span>
<span id="cb1042-6"><a href="data-wrangling-in-tidyr.html#cb1042-6" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;left&quot;</span>)</span></code></pre></div>
<pre><code>##     X1   X2 X3
## 1 &lt;NA&gt; &lt;NA&gt;  a
## 2 &lt;NA&gt;    a  b
## 3    c    d  e</code></pre>
<p>Example-3:</p>
<div class="sourceCode" id="cb1044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="data-wrangling-in-tidyr.html#cb1044-1" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb1044-2"><a href="data-wrangling-in-tidyr.html#cb1044-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;A$B&quot;</span>, <span class="st">&quot;C+D&quot;</span>, <span class="st">&quot;E-F&quot;</span>)</span>
<span id="cb1044-3"><a href="data-wrangling-in-tidyr.html#cb1044-3" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb1044-4"><a href="data-wrangling-in-tidyr.html#cb1044-4" tabindex="-1"></a>  <span class="fu">separate</span>(x, </span>
<span id="cb1044-5"><a href="data-wrangling-in-tidyr.html#cb1044-5" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">-|</span><span class="sc">\\</span><span class="st">$&quot;</span>,</span>
<span id="cb1044-6"><a href="data-wrangling-in-tidyr.html#cb1044-6" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&#39;X1&#39;</span>, <span class="st">&#39;X2&#39;</span>),</span>
<span id="cb1044-7"><a href="data-wrangling-in-tidyr.html#cb1044-7" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1 rows [2].</code></pre>
<pre><code>##     x  X1   X2
## 1 A$B   A    B
## 2 C+D C+D &lt;NA&gt;
## 3 E-F   E    F</code></pre>
<p>Example-4:</p>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="data-wrangling-in-tidyr.html#cb1047-1" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb1047-2"><a href="data-wrangling-in-tidyr.html#cb1047-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;a+b&quot;</span>, <span class="st">&quot;c+d+e&quot;</span>)</span>
<span id="cb1047-3"><a href="data-wrangling-in-tidyr.html#cb1047-3" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb1047-4"><a href="data-wrangling-in-tidyr.html#cb1047-4" tabindex="-1"></a>  <span class="fu">separate</span>(x,</span>
<span id="cb1047-5"><a href="data-wrangling-in-tidyr.html#cb1047-5" tabindex="-1"></a>           <span class="at">into=</span><span class="fu">c</span>(<span class="st">&#39;X1&#39;</span>, <span class="st">&#39;X2&#39;</span>),</span>
<span id="cb1047-6"><a href="data-wrangling-in-tidyr.html#cb1047-6" tabindex="-1"></a>           <span class="at">extra =</span> <span class="st">&quot;merge&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1 rows [1].</code></pre>
<pre><code>##   X1   X2
## 1  a &lt;NA&gt;
## 2  a    b
## 3  c  d+e</code></pre>
</div>
<div id="unite-multiple-character-columns-into-one-using-unite" class="section level3 unnumbered">
<h3>Unite multiple character columns into one using <code>unite()</code></h3>
<p>It complements <code>separate</code> by uniting the columns into one. Its syntax is</p>
<pre><code>unite(data, 
      col, 
      ..., 
      sep = &quot;_&quot;, 
      remove = TRUE, 
      na.rm = FALSE)</code></pre>
<p>Explanation of arguments in the above syntax-</p>
<ol style="list-style-type: decimal">
<li><code>data</code> is as usual name of the data frame.</li>
<li><code>col</code> should be the name of new column to be formed (should be a string),</li>
<li><code>...</code> the names of columns to be united should be provided</li>
<li><code>sep</code> is separator to be used for uniting</li>
<li><code>remove</code> if <code>FALSE</code>, will not remove original component columns</li>
<li><code>na.rm</code> if <code>TRUE</code>, the missing values will be removed beforehand.</li>
</ol>
<p>Example-1a:</p>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="data-wrangling-in-tidyr.html#cb1051-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table5 <span class="sc">%&gt;%</span> </span>
<span id="cb1051-2"><a href="data-wrangling-in-tidyr.html#cb1051-2" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">&quot;Year&quot;</span>,</span>
<span id="cb1051-3"><a href="data-wrangling-in-tidyr.html#cb1051-3" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">&quot;century&quot;</span>, <span class="st">&quot;year&quot;</span>), </span>
<span id="cb1051-4"><a href="data-wrangling-in-tidyr.html#cb1051-4" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb1051-5"><a href="data-wrangling-in-tidyr.html#cb1051-5" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   country     Year  century year  rate             
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 1999  19      99    745/19987071     
## 2 Afghanistan 2000  20      00    2666/20595360    
## 3 Brazil      1999  19      99    37737/172006362  
## 4 Brazil      2000  20      00    80488/174504898  
## 5 China       1999  19      99    212258/1272915272
## 6 China       2000  20      00    213766/1280428583</code></pre>
<p>Example-1b:
We may complete the tidying process in the next step</p>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1053-1"><a href="data-wrangling-in-tidyr.html#cb1053-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table5 <span class="sc">%&gt;%</span> </span>
<span id="cb1053-2"><a href="data-wrangling-in-tidyr.html#cb1053-2" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">&quot;Year&quot;</span>,</span>
<span id="cb1053-3"><a href="data-wrangling-in-tidyr.html#cb1053-3" tabindex="-1"></a>        <span class="fu">c</span>(<span class="st">&quot;century&quot;</span>, <span class="st">&quot;year&quot;</span>), </span>
<span id="cb1053-4"><a href="data-wrangling-in-tidyr.html#cb1053-4" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1053-5"><a href="data-wrangling-in-tidyr.html#cb1053-5" tabindex="-1"></a>  <span class="fu">separate</span>(rate, </span>
<span id="cb1053-6"><a href="data-wrangling-in-tidyr.html#cb1053-6" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1053-7"><a href="data-wrangling-in-tidyr.html#cb1053-7" tabindex="-1"></a>           <span class="at">convert =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   country     Year   cases population
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan 1999     745   19987071
## 2 Afghanistan 2000    2666   20595360
## 3 Brazil      1999   37737  172006362
## 4 Brazil      2000   80488  174504898
## 5 China       1999  212258 1272915272
## 6 China       2000  213766 1280428583</code></pre>
<p>Example-</p>
</div>
</div>
<div id="separate-rows-into-multiple-rows" class="section level2" number="16.5">
<h2><span class="header-section-number">16.5</span> Separate row(s) into multiple rows</h2>
<div id="split-data-into-multiple-rows-with-separate_rows" class="section level3 unnumbered">
<h3>Split data into multiple rows with <code>separate_rows()</code></h3>
<p>This function is used to separate delimited values placed in one single cell/column into multiple rows (as against in rows using <code>separate</code>).
See Example-</p>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1055-1"><a href="data-wrangling-in-tidyr.html#cb1055-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table3 <span class="sc">%&gt;%</span> </span>
<span id="cb1055-2"><a href="data-wrangling-in-tidyr.html#cb1055-2" tabindex="-1"></a>  <span class="fu">separate_rows</span>(</span>
<span id="cb1055-3"><a href="data-wrangling-in-tidyr.html#cb1055-3" tabindex="-1"></a>    rate,</span>
<span id="cb1055-4"><a href="data-wrangling-in-tidyr.html#cb1055-4" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>,</span>
<span id="cb1055-5"><a href="data-wrangling-in-tidyr.html#cb1055-5" tabindex="-1"></a>    <span class="at">convert =</span> <span class="cn">TRUE</span></span>
<span id="cb1055-6"><a href="data-wrangling-in-tidyr.html#cb1055-6" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 12 × 3
##    country      year       rate
##    &lt;chr&gt;       &lt;dbl&gt;      &lt;int&gt;
##  1 Afghanistan  1999        745
##  2 Afghanistan  1999   19987071
##  3 Afghanistan  2000       2666
##  4 Afghanistan  2000   20595360
##  5 Brazil       1999      37737
##  6 Brazil       1999  172006362
##  7 Brazil       2000      80488
##  8 Brazil       2000  174504898
##  9 China        1999     212258
## 10 China        1999 1272915272
## 11 China        2000     213766
## 12 China        2000 1280428583</code></pre>
<p>To create <code>type</code> we have to however, add an extra step to the above example-</p>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="data-wrangling-in-tidyr.html#cb1057-1" tabindex="-1"></a>tidyr<span class="sc">::</span>table3 <span class="sc">%&gt;%</span> </span>
<span id="cb1057-2"><a href="data-wrangling-in-tidyr.html#cb1057-2" tabindex="-1"></a>  <span class="fu">separate_rows</span>(</span>
<span id="cb1057-3"><a href="data-wrangling-in-tidyr.html#cb1057-3" tabindex="-1"></a>    rate,</span>
<span id="cb1057-4"><a href="data-wrangling-in-tidyr.html#cb1057-4" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>,</span>
<span id="cb1057-5"><a href="data-wrangling-in-tidyr.html#cb1057-5" tabindex="-1"></a>    <span class="at">convert =</span> <span class="cn">TRUE</span></span>
<span id="cb1057-6"><a href="data-wrangling-in-tidyr.html#cb1057-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1057-7"><a href="data-wrangling-in-tidyr.html#cb1057-7" tabindex="-1"></a>  <span class="fu">group_by</span>(country, year) <span class="sc">%&gt;%</span> </span>
<span id="cb1057-8"><a href="data-wrangling-in-tidyr.html#cb1057-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;pop&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 12 × 4
## # Groups:   country, year [6]
##    country      year       rate type 
##    &lt;chr&gt;       &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;
##  1 Afghanistan  1999        745 cases
##  2 Afghanistan  1999   19987071 pop  
##  3 Afghanistan  2000       2666 cases
##  4 Afghanistan  2000   20595360 pop  
##  5 Brazil       1999      37737 cases
##  6 Brazil       1999  172006362 pop  
##  7 Brazil       2000      80488 cases
##  8 Brazil       2000  174504898 pop  
##  9 China        1999     212258 cases
## 10 China        1999 1272915272 pop  
## 11 China        2000     213766 cases
## 12 China        2000 1280428583 pop</code></pre>
</div>
</div>
<div id="expand-table-to-handle-missing-rowsvalues" class="section level2" number="16.6">
<h2><span class="header-section-number">16.6</span> Expand table to handle missing rows/values</h2>
<p>Sometimes, when we deal with missing data, we require to handle implicit missing values as well. Either we have to turn these values into explicit missing values or we have to fill appropriate values. In such cases, two functions namely <code>complete</code> and <code>fill</code> both from same package are extremely useful. Let’s learn these as well.</p>
<div id="turn-implicit-missing-values-to-explicit-using-complete" class="section level3 unnumbered">
<h3>Turn implicit missing values to explicit using <code>complete()</code></h3>
<p>As th name suggests, this function is used to turn implicit missing values (invisible rows) to explicit missing values (visible rows with <code>NA</code>).</p>
<p>As an example, let’s suppose fuel prices are revised randomly. Say, after revision on <code>1 January 2020</code> prices revise on <code>20 January 2020</code>. So we will have only 2 rows in data for say <code>Janaury 2020</code>. Thus, there are 29 implicit missing values in the data.</p>
<p>The syntax is</p>
<pre><code>complete(data, 
         ..., 
         fill = list(), 
         explicit = TRUE)</code></pre>
<p>Where -</p>
<ul>
<li><code>data</code> is as usual argument to provide data frame</li>
<li><code>...</code> are meant to provide column names to be completed</li>
<li><code>fill</code> provides a list to supply a single value which can be provided instead of <code>NA</code> for missing combinations.</li>
</ul>
<p>In the example mentioned above we can proceed as</p>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1060-1"><a href="data-wrangling-in-tidyr.html#cb1060-1" tabindex="-1"></a><span class="co"># First create a sample data</span></span>
<span id="cb1060-2"><a href="data-wrangling-in-tidyr.html#cb1060-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1060-3"><a href="data-wrangling-in-tidyr.html#cb1060-3" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-20&quot;</span>)),</span>
<span id="cb1060-4"><a href="data-wrangling-in-tidyr.html#cb1060-4" tabindex="-1"></a>  <span class="at">price =</span> <span class="fu">c</span>(<span class="fl">75.12</span>, <span class="fl">78.32</span>)</span>
<span id="cb1060-5"><a href="data-wrangling-in-tidyr.html#cb1060-5" tabindex="-1"></a>)</span>
<span id="cb1060-6"><a href="data-wrangling-in-tidyr.html#cb1060-6" tabindex="-1"></a>df </span></code></pre></div>
<pre><code>##         date price
## 1 2020-01-01 75.12
## 2 2020-01-20 78.32</code></pre>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="data-wrangling-in-tidyr.html#cb1062-1" tabindex="-1"></a><span class="co"># Use tidyr::complete to see explicit missing values</span></span>
<span id="cb1062-2"><a href="data-wrangling-in-tidyr.html#cb1062-2" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb1062-3"><a href="data-wrangling-in-tidyr.html#cb1062-3" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-31&quot;</span>), <span class="at">by =</span> <span class="st">&quot;day&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 31 × 2
##    date       price
##    &lt;date&gt;     &lt;dbl&gt;
##  1 2020-01-01  75.1
##  2 2020-01-02  NA  
##  3 2020-01-03  NA  
##  4 2020-01-04  NA  
##  5 2020-01-05  NA  
##  6 2020-01-06  NA  
##  7 2020-01-07  NA  
##  8 2020-01-08  NA  
##  9 2020-01-09  NA  
## 10 2020-01-10  NA  
## # ℹ 21 more rows</code></pre>
<p>Though the above example created dates as per the criteria given, <code>complete</code> function can find all unique combinations in the set of columns provided and return complete set of observations. See this example</p>
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1064-1"><a href="data-wrangling-in-tidyr.html#cb1064-1" tabindex="-1"></a><span class="co">#Let&#39;s create a sample data</span></span>
<span id="cb1064-2"><a href="data-wrangling-in-tidyr.html#cb1064-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1064-3"><a href="data-wrangling-in-tidyr.html#cb1064-3" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1064-4"><a href="data-wrangling-in-tidyr.html#cb1064-4" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2021</span>),</span>
<span id="cb1064-5"><a href="data-wrangling-in-tidyr.html#cb1064-5" tabindex="-1"></a>  <span class="at">qtr =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb1064-6"><a href="data-wrangling-in-tidyr.html#cb1064-6" tabindex="-1"></a>  <span class="at">sales =</span> <span class="fu">runif</span>(<span class="dv">5</span>, <span class="dv">100</span>, <span class="dv">200</span>)</span>
<span id="cb1064-7"><a href="data-wrangling-in-tidyr.html#cb1064-7" tabindex="-1"></a>)</span>
<span id="cb1064-8"><a href="data-wrangling-in-tidyr.html#cb1064-8" tabindex="-1"></a>df2</span></code></pre></div>
<pre><code>##   year qtr    sales
## 1 2020   1 128.7578
## 2 2020   3 178.8305
## 3 2020   4 140.8977
## 4 2021   2 188.3017
## 5 2021   3 194.0467</code></pre>
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1066-1"><a href="data-wrangling-in-tidyr.html#cb1066-1" tabindex="-1"></a><span class="co"># use complete to find all combination</span></span>
<span id="cb1066-2"><a href="data-wrangling-in-tidyr.html#cb1066-2" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span> </span>
<span id="cb1066-3"><a href="data-wrangling-in-tidyr.html#cb1066-3" tabindex="-1"></a>  <span class="fu">complete</span>(year, qtr, <span class="co"># cols provided</span></span>
<span id="cb1066-4"><a href="data-wrangling-in-tidyr.html#cb1066-4" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">sales =</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##    year   qtr sales
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  2020     1  129.
## 2  2020     2    0 
## 3  2020     3  179.
## 4  2020     4  141.
## 5  2021     1    0 
## 6  2021     2  188.
## 7  2021     3  194.
## 8  2021     4    0</code></pre>
<p><strong>Note:</strong> If <code>fill</code> argument would not have been used, the value of sales in missing columns would have been <code>NA</code> instead of provided value.</p>
</div>
<div id="fill-missing-values-based-on-criteria-fill" class="section level3 unnumbered">
<h3>Fill missing values based on criteria <code>fill()</code></h3>
<p>This function helps in filling the missing values using previous or next entry. Think of a paper sheet where many cells in a table have been filled as <code>"-do-"</code>. Syntax is -</p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1068-1"><a href="data-wrangling-in-tidyr.html#cb1068-1" tabindex="-1"></a><span class="fu">fill</span>(data, <span class="co"># used to provide data</span></span>
<span id="cb1068-2"><a href="data-wrangling-in-tidyr.html#cb1068-2" tabindex="-1"></a>     ..., <span class="co"># provide columns to be filled</span></span>
<span id="cb1068-3"><a href="data-wrangling-in-tidyr.html#cb1068-3" tabindex="-1"></a>     <span class="at">.direction =</span> <span class="fu">c</span>(<span class="st">&quot;down&quot;</span>, <span class="st">&quot;up&quot;</span>, <span class="st">&quot;downup&quot;</span>, <span class="st">&quot;updown&quot;</span>))</span></code></pre></div>
<p>The arguments are pretty simple. Most of the time <code>"down"</code> method is used. As an example we could see the example of fuel prices mentioned above.</p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1069-1"><a href="data-wrangling-in-tidyr.html#cb1069-1" tabindex="-1"></a>fill_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb1069-2"><a href="data-wrangling-in-tidyr.html#cb1069-2" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2020-01-31&quot;</span>), <span class="at">by =</span> <span class="st">&quot;day&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1069-3"><a href="data-wrangling-in-tidyr.html#cb1069-3" tabindex="-1"></a>  <span class="fu">fill</span>(price, <span class="at">.direction =</span> <span class="st">&quot;down&quot;</span>)</span>
<span id="cb1069-4"><a href="data-wrangling-in-tidyr.html#cb1069-4" tabindex="-1"></a></span>
<span id="cb1069-5"><a href="data-wrangling-in-tidyr.html#cb1069-5" tabindex="-1"></a><span class="fu">head</span>(fill_df)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   date       price
##   &lt;date&gt;     &lt;dbl&gt;
## 1 2020-01-01  75.1
## 2 2020-01-02  75.1
## 3 2020-01-03  75.1
## 4 2020-01-04  75.1
## 5 2020-01-05  75.1
## 6 2020-01-06  75.1</code></pre>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1071-1"><a href="data-wrangling-in-tidyr.html#cb1071-1" tabindex="-1"></a><span class="fu">tail</span>(fill_df)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   date       price
##   &lt;date&gt;     &lt;dbl&gt;
## 1 2020-01-26  78.3
## 2 2020-01-27  78.3
## 3 2020-01-28  78.3
## 4 2020-01-29  78.3
## 5 2020-01-30  78.3
## 6 2020-01-31  78.3</code></pre>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="23">
<li id="fn23"><p>Hadley Wickham, Davis Vaughan, and Maximilian Girlich, <em>Tidyr: Tidy Messy Data</em>, 2024, <a href="https://tidyr.tidyverse.org">https://tidyr.tidyverse.org</a>.<a href="data-wrangling-in-tidyr.html#fnref23" class="footnote-back">↩︎</a></p></li>
<li id="fn24"><p><a href="https://www.jstatsoft.org/article/view/v059i10">https://www.jstatsoft.org/article/view/v059i10</a><a href="data-wrangling-in-tidyr.html#fnref24" class="footnote-back">↩︎</a></p></li>
<li id="fn25"><p>Hadley Wickham, <span>“Tidy Data,”</span> <em>Journal of Statistical Software</em> 59, no. 10 (2014): 1–23, <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.<a href="data-wrangling-in-tidyr.html#fnref25" class="footnote-back">↩︎</a></p></li>
<li id="fn26"><p>Hadley Wickham, <span>“Reshaping Data with the Reshape Package,”</span> <em>Journal of Statistical Software</em> 21, no. 12 (2007): 1–20, <a href="https://doi.org/10.18637/jss.v021.i12">https://doi.org/10.18637/jss.v021.i12</a>.<a href="data-wrangling-in-tidyr.html#fnref26" class="footnote-back">↩︎</a></p></li>
<li id="fn27"><p>Image taken from Hadley Wickham’s book <a href="https://r4ds.had.co.nz/">R for data science</a><a href="data-wrangling-in-tidyr.html#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p>all taken from package <code>tidyr</code><a href="data-wrangling-in-tidyr.html#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p>These data-tables display the number of TB cases documented by the World Health Organization in Afghanistan, Brazil, and China between 1999 and 2000. The data contains values associated with four variables (country, year, cases, and population), but each table organizes the values in a different layout.<a href="data-wrangling-in-tidyr.html#fnref29" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Audit Analytics</strong>" was written by Anil Goyal. It was last built on 2024-11-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
