<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Chapter 38 Reverse geo-coding | R for Audit Analytics</title>

    <meta name="author" content="Anil Goyal" />
  
   <meta name="description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Chapter 38 Reverse geo-coding | R for Audit Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://anilyayavar.github.io/new-book/" />
  <meta property="og:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg" />
  <meta property="og:description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 38 Reverse geo-coding | R for Audit Analytics" />
  
  <meta name="twitter:description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />
  <meta name="twitter:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.8.0/transition.js"></script>
    <script src="libs/bs3compat-0.8.0/tabs.js"></script>
    <script src="libs/bs3compat-0.8.0/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
    <style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
      <link rel="stylesheet" href="style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Audit Analytics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="reverse-geo-coding" class="section level1" number="38">
<h1><span class="header-section-number">Chapter 38</span> Reverse geo-coding</h1>
<div id="introduction" class="section level2" number="38.1">
<h2><span class="header-section-number">38.1</span> Introduction</h2>
<p><strong>Geo-coding</strong> is the process of converting a human-readable address into geographic coordinates, such as latitude and longitude. Geocoding is the process of determining the location of an address on a map. So, plotting the places on geographical map layers require extraction of latitudes and longitudes from master databases.</p>
<p><strong>Reverse geo-coding</strong>, on the other hand, is the process of converting geographic coordinates (latitude and longitude) into a human-readable address, such as a street address, city, state/province, and country. In other words, it’s the process of determining a location’s address based on its geographic coordinates.</p>
<p>Both geo-coding and reverse geo-coding are important in geospatial data analysis, as they allow us to link spatial information with non-spatial information, such as demographic data, land use data, or other forms of spatial data. This information can then be used to gain insights into patterns and relationships in the data, and to make informed decisions based on location information.</p>
<p>Reverse geo-coding can be used in forensic data analysis to help identify the location of transactions or events. For example, it can be used to determine the location of an ATM or point of sale device where a fraudulent transaction occurred. It can also be used to analyze patterns of activity in a particular geographic area, such as the frequency and timing of certain types of transactions. As another example, we may think of an application data, where mobile or hand held devices are used to capture data at the time and place of intended service delivery. Auditors may use the geo-spatial data captured by these devices to cross check/verify the actual points of service delivery.</p>
</div>
<div id="widely-used-databases" class="section level2" number="38.2">
<h2><span class="header-section-number">38.2</span> Widely used databases</h2>
<p><strong>OpenStreetMap</strong> (OSM) is one of the most popular and widely used master databases for geo-coding and reverse geo-coding. OSM is a free and open-source map of the world, created and maintained by a community of volunteers. It provides a rich and detailed set of spatial data, including street names, addresses, and other points of interest.</p>
<p>Other popular master databases for geo-coding and reverse geo-coding include <strong>Google Maps</strong>. Google Maps provides a rich set of geo-coding and reverse geo-coding APIs that are widely used in web and mobile applications. Google Maps provides a comprehensive set of spatial data, including street names, addresses, and other points of interest.</p>
</div>
<div id="example-in-r" class="section level2" number="38.3">
<h2><span class="header-section-number">38.3</span> Example in R</h2>
<div id="prerequisites" class="section level3" number="38.3.1">
<h3><span class="header-section-number">38.3.1</span> Prerequisites</h3>
<div class="sourceCode" id="cb2043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2043-1"><a href="reverse-geo-coding.html#cb2043-1" tabindex="-1"></a><span class="fu">library</span>(tidygeocoder)</span></code></pre></div>
</div>
<div id="function-to-be-used" class="section level3" number="38.3.2">
<h3><span class="header-section-number">38.3.2</span> Function to be used</h3>
<p>We will use <code>reverse_geo()</code> function from this library. Syntax is</p>
<pre><code>reverse_geo(
  lat,
  long,
  method = &quot;osm&quot;,
  address = &quot;address&quot;,
  full_results = FALSE
  ...
)</code></pre>
<p>Here -</p>
<ul>
<li><code>lat</code> and <code>long</code> are, as the names suggest, latitude and longitudes for the place, of which address is to be extracted.</li>
<li><code>method</code> argument provides for geo service to be used. Default is <code>osm</code>. Other services available are - <code>arcgis</code>, <code>geocodio</code>, <code>google</code>, etc.</li>
<li><code>address</code> provides the column name to be used.</li>
<li><code>full_results</code> by default is <code>FALSE</code>. But if set to <code>TRUE</code> returns all available data from the geocoding service.</li>
<li>for other arguments, please check help of the function.</li>
</ul>
</div>
<div id="practical-data-set" class="section level3" number="38.3.3">
<h3><span class="header-section-number">38.3.3</span> Practical data-set</h3>
<p><strong>Remember one thing, the function is not vectorised.</strong> So we will have to use <code>apply</code> family or <code>purrr::map</code> family of functions to get reverse geo-coding information.</p>
<div class="sourceCode" id="cb2045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2045-1"><a href="reverse-geo-coding.html#cb2045-1" tabindex="-1"></a><span class="co"># Coordinates of tajmahal</span></span>
<span id="cb2045-2"><a href="reverse-geo-coding.html#cb2045-2" tabindex="-1"></a><span class="fu">reverse_geo</span>(<span class="at">lat =</span> <span class="fl">27.1751</span>, </span>
<span id="cb2045-3"><a href="reverse-geo-coding.html#cb2045-3" tabindex="-1"></a>            <span class="at">long =</span> <span class="fl">78.421</span>, </span>
<span id="cb2045-4"><a href="reverse-geo-coding.html#cb2045-4" tabindex="-1"></a>            <span class="at">full_results =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2045-5"><a href="reverse-geo-coding.html#cb2045-5" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">&#39;osm&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 25
##     lat  long address     place_id licence osm_type osm_id osm_lat osm_lon class
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;
## 1  27.2  78.4 Sailai, Fi…   2.27e8 Data ©… way      4.56e8 27.175… 78.421… high…
## # ℹ 15 more variables: type &lt;chr&gt;, place_rank &lt;int&gt;, importance &lt;dbl&gt;,
## #   addresstype &lt;chr&gt;, name &lt;chr&gt;, suburb &lt;chr&gt;, town &lt;chr&gt;, county &lt;chr&gt;,
## #   state_district &lt;chr&gt;, state &lt;chr&gt;, `ISO3166-2-lvl4` &lt;chr&gt;, postcode &lt;chr&gt;,
## #   country &lt;chr&gt;, country_code &lt;chr&gt;, boundingbox &lt;list&gt;</code></pre>
</div>
<div id="using-it-in-a-dataset" class="section level3" number="38.3.4">
<h3><span class="header-section-number">38.3.4</span> Using it in a dataset</h3>
<p>Let’s build a sample dataset of say 4 values/places of interest in India</p>
<table>
<thead>
<tr class="header">
<th align="right">lat</th>
<th align="right">long</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">27.1751</td>
<td align="right">78.0421</td>
</tr>
<tr class="even">
<td align="right">24.8318</td>
<td align="right">79.9199</td>
</tr>
<tr class="odd">
<td align="right">27.1795</td>
<td align="right">78.0211</td>
</tr>
<tr class="even">
<td align="right">28.5245</td>
<td align="right">77.1855</td>
</tr>
</tbody>
</table>
<p>Now extracting information for these using <code>purrr::map</code> family</p>
<div class="sourceCode" id="cb2047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2047-1"><a href="reverse-geo-coding.html#cb2047-1" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2047-2"><a href="reverse-geo-coding.html#cb2047-2" tabindex="-1"></a><span class="fu">library</span>(purrr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2047-3"><a href="reverse-geo-coding.html#cb2047-3" tabindex="-1"></a></span>
<span id="cb2047-4"><a href="reverse-geo-coding.html#cb2047-4" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">pmap_dfr</span>(sample,</span>
<span id="cb2047-5"><a href="reverse-geo-coding.html#cb2047-5" tabindex="-1"></a>     <span class="sc">~</span> <span class="fu">reverse_geo</span>(..<span class="dv">1</span>, <span class="co"># first column in sample</span></span>
<span id="cb2047-6"><a href="reverse-geo-coding.html#cb2047-6" tabindex="-1"></a>                   ..<span class="dv">2</span>, <span class="co"># second column in sample</span></span>
<span id="cb2047-7"><a href="reverse-geo-coding.html#cb2047-7" tabindex="-1"></a>                   <span class="at">full_results =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2047-8"><a href="reverse-geo-coding.html#cb2047-8" tabindex="-1"></a>  <span class="fu">select</span>(lat, long, country, state, city, village, address, postcode)</span></code></pre></div>
</div>
<div id="view-above-results" class="section level3" number="38.3.5">
<h3><span class="header-section-number">38.3.5</span> View above results</h3>
<table>
<colgroup>
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="9%" />
<col width="3%" />
<col width="5%" />
<col width="61%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">lat</th>
<th align="right">long</th>
<th align="left">country</th>
<th align="left">state</th>
<th align="left">city</th>
<th align="left">village</th>
<th align="left">address</th>
<th align="left">postcode</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">27.1751</td>
<td align="right">78.0421</td>
<td align="left">India</td>
<td align="left">Uttar Pradesh</td>
<td align="left">Agra</td>
<td align="left">NA</td>
<td align="left">Taj Mahal, Taj East Gate Road, Taj Ganj, Agra, Uttar Pradesh, 282004, India</td>
<td align="left">282004</td>
</tr>
<tr class="even">
<td align="right">24.8318</td>
<td align="right">79.9199</td>
<td align="left">India</td>
<td align="left">Madhya Pradesh</td>
<td align="left">NA</td>
<td align="left">Jatkra</td>
<td align="left">Khajuraho, Jatkra, Rajnagar Tahsil, Chhatarpur, Madhya Pradesh, 471006, India</td>
<td align="left">471006</td>
</tr>
<tr class="odd">
<td align="right">27.1795</td>
<td align="right">78.0211</td>
<td align="left">India</td>
<td align="left">Uttar Pradesh</td>
<td align="left">Agra</td>
<td align="left">NA</td>
<td align="left">Agra Fort, Minar Bazaar, Subhash Bazaar, Agra, Uttar Pradesh, 280001, India</td>
<td align="left">280001</td>
</tr>
<tr class="even">
<td align="right">28.5245</td>
<td align="right">77.1855</td>
<td align="left">India</td>
<td align="left">Delhi</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Qutub Minar Complex, Kalka Das Marg, Mehrauli, Mehrauli Tehsil, South Delhi, Delhi, 110030, India</td>
<td align="left">110030</td>
</tr>
</tbody>
</table>
</div>
<div id="alternate-syntax-for-those-who-do-not-want-to-use-purrrpmap_dfr" class="section level3" number="38.3.6">
<h3><span class="header-section-number">38.3.6</span> Alternate syntax (for those who do not want to use <code>purrr::pmap_dfr</code>)</h3>
<pre><code>sapply(seq(nrow(sample)),
       function(x) reverse_geo(sample$lat[x], sample$long[x], full_results = TRUE)) %&gt;% 
  map_dfr(rbind)</code></pre>

</div>
</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Audit Analytics</strong>" was written by Anil Goyal. It was last built on 2024-11-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
