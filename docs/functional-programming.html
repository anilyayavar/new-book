<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Chapter 7 Functional Programming | R for Audit Analytics</title>

    <meta name="author" content="Anil Goyal" />
  
   <meta name="description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="Chapter 7 Functional Programming | R for Audit Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://anilyayavar.github.io/new-book/" />
  <meta property="og:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg" />
  <meta property="og:description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Functional Programming | R for Audit Analytics" />
  
  <meta name="twitter:description" content="This book is intended for auditors performing exploratory data analytics using R programming language, mainly Base R and Tidyverse." />
  <meta name="twitter:image" content="https://anilyayavar.github.io/new-book/images/cover.jpg" />
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.8.0/transition.js"></script>
    <script src="libs/bs3compat-0.8.0/tabs.js"></script>
    <script src="libs/bs3compat-0.8.0/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
    <style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
      <link rel="stylesheet" href="style.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Audit Analytics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="functional-programming" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Functional Programming</h1>
<div id="what-is-functional-programming" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> What is functional programming?</h2>
<p>Conceptually functional programming philosophy is based on lambda calculus. Lambda calculus is a framework developed by Alonzo Church<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> to study computations with functions.</p>
<p>Functional programming is a programming paradigm in which we try to bind everything in pure mathematical functions style. It is a declarative type of programming style. Its main focus is on <strong>what to solve</strong> in contrast to an imperative style where the main focus is <strong>how to solve</strong>. For a more elaborated definition readers may see this wikipedia <a href="https://en.wikipedia.org/wiki/Functional_programming">link</a>. Simply putting functional programming is like doing something repeatedly but in declarative style. Here, functions are the primary method with which we carry out tasks. All actions are just implementations of functions we are using.</p>
<p>Functional programming use high order functions. A high order function is actually a function that accepts a function as an argument, or returns a function; in short, function that operates upon a function. We have already seen one such example may be without noticing it, <code>args()</code> function take a function as an argument and in turn return its arguments.</p>
<p>Let us learn a bit more here.</p>
<div id="usage-of-functional-programming-in-r" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Usage of functional programming in R</h3>
<p>Strictly speaking R is not a functional programming language. But we have already seen that one of the greatest strengths of R is parallel operations on vectors. In fact we need functional programming where concurrency or parallelism is required. Till now we have seen that most of the functions work on all atomic objects (vectors, matrices, arrays, etc.), but what about working of these functions on recursive objects i.e. lists? Check this example (in your console)-</p>
<pre><code>list1 &lt;- list(50000, 5000, 56)
sum(list1)</code></pre>
<blockquote>
<p>Of course, we can solve the above problem by using for loops. See</p>
</blockquote>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="functional-programming.html#cb610-1" tabindex="-1"></a>list1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">50000</span>, <span class="dv">5000</span>, <span class="dv">56</span>)</span>
<span id="cb610-2"><a href="functional-programming.html#cb610-2" tabindex="-1"></a><span class="co"># for loop strategy</span></span>
<span id="cb610-3"><a href="functional-programming.html#cb610-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb610-4"><a href="functional-programming.html#cb610-4" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(list1)){</span>
<span id="cb610-5"><a href="functional-programming.html#cb610-5" tabindex="-1"></a>  x[i] <span class="ot">&lt;-</span> list1[[i]]</span>
<span id="cb610-6"><a href="functional-programming.html#cb610-6" tabindex="-1"></a>}</span>
<span id="cb610-7"><a href="functional-programming.html#cb610-7" tabindex="-1"></a><span class="fu">sum</span>(x)</span></code></pre></div>
<pre><code>## [1] 55056</code></pre>
<p>Consider another list, where we want to calculate mean of each element of that list.</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="functional-programming.html#cb612-1" tabindex="-1"></a>list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb612-2"><a href="functional-programming.html#cb612-2" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb612-3"><a href="functional-programming.html#cb612-3" tabindex="-1"></a>  <span class="dv">11</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb612-4"><a href="functional-programming.html#cb612-4" tabindex="-1"></a>  <span class="dv">21</span><span class="sc">:</span><span class="dv">30</span></span>
<span id="cb612-5"><a href="functional-programming.html#cb612-5" tabindex="-1"></a>)</span></code></pre></div>
<p>Of course, we may use a for loop again, but in R these operations can be done easily with <em>apply</em> group of functions, which are one of the most famous and most used features in R.</p>
</div>
</div>
<div id="apply-family-of-functions" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> <code>apply</code> family of functions</h2>
<p>First of these functions is <code>apply()</code> which works on matrices/data frames.</p>
<div id="function-apply" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Function <code>apply()</code></h3>
<p>The basic syntax of <code>apply</code> is</p>
<pre><code>apply(m, MARGIN, FUN, f_args)</code></pre>
<p>where</p>
<ul>
<li><code>m</code> is the matrix</li>
<li><code>MARGIN</code> is the dimension. If we want to <em>apply</em> function to each row then use <code>1</code> or else if it is to be column-wise use <code>2</code></li>
<li><code>FUN</code> is the desired function which we want to apply</li>
<li><code>f_args</code> are the optional set of arguments, if needed to be supplied to <code>fun</code>.</li>
</ul>
<p>An illustrative construction of <code>apply</code> function can be seen in <a href="functional-programming.html#fig:applyimage">7.1</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:applyimage"></span>
<img src="images/apply.png" alt="Illustration of function apply" width="100%" />
<p class="caption">
Figure 7.1: Illustration of function apply
</p>
</div>
<p>Check this example</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="functional-programming.html#cb614-1" tabindex="-1"></a>(mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">nrow =</span> <span class="dv">5</span>))</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    6
## [2,]    2    7
## [3,]    3    8
## [4,]    4    9
## [5,]    5   10</code></pre>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="functional-programming.html#cb616-1" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, mean)</span></code></pre></div>
<pre><code>## [1] 3.5 4.5 5.5 6.5 7.5</code></pre>
<p><strong>Note:</strong> <code>rowMeans(mat)</code> in above example would have given similar results, but for sake of simplicity we have provided a simplest example.</p>
<p><strong>Further note that we may also write our own customised function in the argument.</strong> See this another example, where we will take sum of squares of each row. We may define our own custom function for the purpose and then <code>apply</code> it.</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="functional-programming.html#cb618-1" tabindex="-1"></a>my_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb618-2"><a href="functional-programming.html#cb618-2" tabindex="-1"></a>  <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb618-3"><a href="functional-programming.html#cb618-3" tabindex="-1"></a>}</span>
<span id="cb618-4"><a href="functional-programming.html#cb618-4" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, my_fun)</span></code></pre></div>
<pre><code>## [1]  37  53  73  97 125</code></pre>
<p>The need to writing a custom function before hand may be eliminated if the function so defined is not be used further. We may write anonymous function directly in the <code>apply</code> syntax -</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="functional-programming.html#cb620-1" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1]  37  53  73  97 125</code></pre>
<div class="rmdnote">
<p><strong>In R version 4.1 and onwards R has devised shorthand style of defining inline custom functions, where we can write backslash i.e. <code>\</code> instead of writing <code>function</code>.</strong> We could have written above expression as-</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="functional-programming.html#cb622-1" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, <span class="at">FUN =</span> \(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb622-2"><a href="functional-programming.html#cb622-2" tabindex="-1"></a><span class="do">## [1]  37  53  73  97 125</span></span></code></pre></div>
</div>
<div id="apply-need-not-necessarily-output-vectors-only" class="section level4 unnumbered">
<h4><code>apply()</code> need not necessarily output vectors only</h4>
<p>If <code>FUN</code> applied on rows/columns of matrix outputs vector of length more than 1, the output will be in matrix format. But the thing to note here is that matrix will be displayed columnwise always irrespective of fact whether <code>MARGIN</code> is <code>1</code> or <code>2</code>. As an easy example we could have shown this using function like <code>sqrt</code>, but <code>apply(matrix, MARGIN, sqrt)</code> will work like <code>sqrt(matrix)</code> only. So let’s take a different example. Suppose we want to calculate <code>column-wise</code> cumulative sum in a given matrix.</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="functional-programming.html#cb623-1" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">2</span>, cumsum)</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    6
## [2,]    3   13
## [3,]    6   21
## [4,]   10   30
## [5,]   15   40</code></pre>
<p>The output here is eaxctly what was desired. But what if, our requirement was to take <code>row-wise</code> cumulative sum?</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="functional-programming.html#cb625-1" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, cumsum)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    2    3    4    5
## [2,]    7    9   11   13   15</code></pre>
<p>It may now be noticed that the output is actually <em>transpose</em> of what we were expecting. Actually the output of each iteration of <code>apply</code> function is displayed in one column always. Let us check our understanding with one more example taking function which may give output that is not dependent on input vector length.</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="functional-programming.html#cb627-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb627-2"><a href="functional-programming.html#cb627-2" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, sample, <span class="dv">4</span>, <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    7    8    4   10
## [2,]    6    2    8    4   10
## [3,]    1    2    3    4   10
## [4,]    1    2    3    9    5</code></pre>
<p>Thus we may conclude that-</p>
<ul>
<li>If <code>FUN</code> outputs a scalar, the output of <code>apply</code> will be a vector of <strong>length</strong> equal to
<ul>
<li>number of <code>rows</code> in input matrix given that <code>MARGIN</code> selected in 1,</li>
<li>number of <code>columns</code> in input matrix given that <code>MARGIN</code> selected in 2.</li>
</ul></li>
<li>if <code>FUN</code> outputs a vector(of length &gt;1) then output of <code>apply</code> will be a matrix having <strong>number of columns</strong> equal to -
<ul>
<li>number of <code>rows</code> in input matrix given that <code>MARGIN</code> selected in 1,</li>
<li>number of <code>columns</code> in input matrix given that <code>MARGIN</code> selected in 2.</li>
</ul></li>
</ul>
<p>These have been tabulated in table <a href="functional-programming.html#tab:apply">7.1</a>.</p>
<table>
<caption><span id="tab:apply">Table 7.1: </span> Relation between input and output data structure in <code>apply</code></caption>
<thead>
<tr class="header">
<th>Input matrix <span class="math inline">\(m*n\)</span></th>
<th align="center"><code>MARGIN = 1</code></th>
<th align="center"><code>MARGIN = 2</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FUN gives scalar</td>
<td align="center">Vector size <span class="math inline">\(m\)</span></td>
<td align="center">Vector size <span class="math inline">\(n\)</span></td>
</tr>
<tr class="even">
<td>FUN gives vector size <span class="math inline">\(p\)</span></td>
<td align="center">Matrix <span class="math inline">\(p*m\)</span></td>
<td align="center">Matrix <span class="math inline">\(p*n\)</span></td>
</tr>
</tbody>
</table>
<p>We may thus have to be careful while getting the output from <code>apply</code> function as it may lead to introduction of bug in our code.</p>
</div>
<div id="apply-on-data-frames" class="section level4 unnumbered">
<h4><code>apply()</code> on data frames</h4>
<p>Now we know that data frames despite being special type of lists also behave like matrices, we may use <code>apply</code> on data frames too. See this example.</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="functional-programming.html#cb629-1" tabindex="-1"></a>(my_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mat))</span></code></pre></div>
<pre><code>##   V1 V2
## 1  1  6
## 2  2  7
## 3  3  8
## 4  4  9
## 5  5 10</code></pre>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="functional-programming.html#cb631-1" tabindex="-1"></a><span class="fu">apply</span>(my_df, <span class="dv">2</span>, sum)</span></code></pre></div>
<pre><code>## V1 V2 
## 15 40</code></pre>
</div>
</div>
<div id="function-lapply" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Function <code>lapply()</code></h3>
<p>Another cousin of apply is <code>lapply</code> which can thought of <code>apply</code> to <code>l</code>ists. So as the name suggests it is applied on lists instead of matrices. Now since <code>data frame</code> is also a list <code>lapply</code> can be applied on these. The basic syntax of <code>lapply()</code> is -</p>
<pre><code>lapply(l, FUN, f_args)</code></pre>
<p>where</p>
<ul>
<li><code>l</code> is the list</li>
<li><code>FUN</code> is the desired function which we want to apply</li>
<li><code>f_args</code> are the optional set of arguments, if needed to be supplied to <code>fun</code>.</li>
</ul>
<p>It may be noted that <code>MRAGIN</code> argument is not available here. See these examples.</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="functional-programming.html#cb634-1" tabindex="-1"></a><span class="fu">lapply</span>(my_df, sum)</span></code></pre></div>
<pre><code>## $V1
## [1] 15
## 
## $V2
## [1] 40</code></pre>
<p>Now you may have noticed two things here -</p>
<ol style="list-style-type: decimal">
<li>The output is of <code>list</code> type.</li>
<li>Unlike <code>apply</code> as <code>MARGIN</code> is not passed/available here, it applies <code>FUN</code> to every element of list. When we consider any <code>data.frame</code> as a list its each column is a separate element of that list. So <code>FUN</code> cannot be applied to <code>rows</code> in a <code>data.frame</code>.</li>
</ol>
<p>Thus <code>lapply()</code> -</p>
<ul>
<li>loops over a list, iterating over each element in that list</li>
<li>then <em>applies</em> the function <code>FUN</code> to each element</li>
<li>and then returns a list.</li>
</ul>
<p>Example-2: Let’s try to find type of each column in a given data frame.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="functional-programming.html#cb636-1" tabindex="-1"></a><span class="fu">lapply</span>(iris, typeof)</span></code></pre></div>
<pre><code>## $Sepal.Length
## [1] &quot;double&quot;
## 
## $Sepal.Width
## [1] &quot;double&quot;
## 
## $Petal.Length
## [1] &quot;double&quot;
## 
## $Petal.Width
## [1] &quot;double&quot;
## 
## $Species
## [1] &quot;integer&quot;</code></pre>
<p>Similar to <code>apply</code> we can define <code>FUN</code> inline here (anonymously) also. Example-3:</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="functional-programming.html#cb638-1" tabindex="-1"></a><span class="fu">lapply</span>(my_df, \(a) a<span class="sc">^</span><span class="dv">2</span>) </span></code></pre></div>
<pre><code>## $V1
## [1]  1  4  9 16 25
## 
## $V2
## [1]  36  49  64  81 100</code></pre>
<p>Example-4:</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="functional-programming.html#cb640-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb640-2"><a href="functional-programming.html#cb640-2" tabindex="-1"></a><span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, runif, <span class="at">min=</span><span class="dv">0</span>, <span class="at">max=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2.655087
## 
## [[2]]
## [1] 3.721239 5.728534
## 
## [[3]]
## [1] 9.082078 2.016819 8.983897
## 
## [[4]]
## [1] 9.4467527 6.6079779 6.2911404 0.6178627</code></pre>
<p><strong>Note</strong> that even if <code>lapply</code> is applied over a vector, it returns a list only.</p>
</div>
<div id="function-sapply" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Function <code>sapply()</code></h3>
<p>There is not much of the difference between <code>lapply()</code> and <code>sapply()</code>, as <code>sapply</code> is actually <code>s</code>implified l<code>apply</code>. It simplifies the argument as much as possible.</p>
<p>Example:</p>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="functional-programming.html#cb642-1" tabindex="-1"></a><span class="fu">sapply</span>(my_df, sum)</span></code></pre></div>
<pre><code>## V1 V2 
## 15 40</code></pre>
</div>
</div>
<div id="other-loop-functions" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Other loop functions</h2>
<div id="function-replicate" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Function <code>replicate()</code></h3>
<p>Function <code>replicate()</code>(replicate) is used for repeated evaluation of an expression. Syntax is</p>
<pre><code>replicate(n, expr, simplify = &quot;array&quot;)</code></pre>
<p>where -</p>
<ul>
<li><code>n</code> is integer denoting the number of replications</li>
<li><code>expr</code> is the expression to evaluate repeatedly</li>
<li><code>simplify</code> takes either ‘character’ or ‘logical’ to value to indicate whether the results should be simplified.</li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="functional-programming.html#cb645-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb645-2"><a href="functional-programming.html#cb645-2" tabindex="-1"></a><span class="co"># Default value of simplify will simplify the results as much possible</span></span>
<span id="cb645-3"><a href="functional-programming.html#cb645-3" tabindex="-1"></a><span class="fu">replicate</span>(<span class="dv">5</span>, <span class="fu">runif</span>(<span class="dv">3</span>))</span></code></pre></div>
<pre><code>##           [,1]      [,2]      [,3]      [,4]      [,5]
## [1,] 0.2875775 0.8830174 0.5281055 0.4566147 0.6775706
## [2,] 0.7883051 0.9404673 0.8924190 0.9568333 0.5726334
## [3,] 0.4089769 0.0455565 0.5514350 0.4533342 0.1029247</code></pre>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="functional-programming.html#cb647-1" tabindex="-1"></a><span class="co"># Notice the difference with simplify=FALSE</span></span>
<span id="cb647-2"><a href="functional-programming.html#cb647-2" tabindex="-1"></a><span class="fu">replicate</span>(<span class="dv">3</span>, <span class="fu">runif</span>(<span class="dv">5</span>), <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0.89982497 0.24608773 0.04205953 0.32792072 0.95450365
## 
## [[2]]
## [1] 0.8895393 0.6928034 0.6405068 0.9942698 0.6557058
## 
## [[3]]
## [1] 0.7085305 0.5440660 0.5941420 0.2891597 0.1471136</code></pre>
</div>
<div id="function-split" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Function <code>split()</code></h3>
<p>The <code>split()</code>(split() function) function takes object (vector or other) and splits it into groups determined by a given factor. The basic syntax is-</p>
<pre><code>split(x, f, drop=FALSE, ...)</code></pre>
<p>where</p>
<ul>
<li><code>x</code> is input object - <code>vector</code> or <code>list</code> or <code>data.frame</code></li>
<li><code>f</code> is a factor or a list of factors. If a factor is not provided, it will be coerced to factor.</li>
<li><code>drop</code> argument indicates whether empty factors should be dropped.</li>
</ul>
<p>Example: (To divide the given list by alternate elements)-</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="functional-programming.html#cb650-1" tabindex="-1"></a><span class="fu">split</span>(LETTERS, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">13</span>))</span></code></pre></div>
<pre><code>## $`1`
##  [1] &quot;A&quot; &quot;C&quot; &quot;E&quot; &quot;G&quot; &quot;I&quot; &quot;K&quot; &quot;M&quot; &quot;O&quot; &quot;Q&quot; &quot;S&quot; &quot;U&quot; &quot;W&quot; &quot;Y&quot;
## 
## $`2`
##  [1] &quot;B&quot; &quot;D&quot; &quot;F&quot; &quot;H&quot; &quot;J&quot; &quot;L&quot; &quot;N&quot; &quot;P&quot; &quot;R&quot; &quot;T&quot; &quot;V&quot; &quot;X&quot; &quot;Z&quot;</code></pre>
<p>Example-2: Find out sum of every odd and even number from 1:100-</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="functional-programming.html#cb652-1" tabindex="-1"></a><span class="fu">split</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, (<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">%%</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">lapply</span>(sum)</span></code></pre></div>
<pre><code>## $`0`
## [1] 2550
## 
## $`1`
## [1] 2500</code></pre>
<p>Example-3: Find out mean of <code>mpg</code> column splitting the <code>mtcars</code> data by <code>cyl</code></p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb654-1"><a href="functional-programming.html#cb654-1" tabindex="-1"></a><span class="fu">split</span>(mtcars<span class="sc">$</span>mpg, mtcars<span class="sc">$</span>cyl) <span class="sc">|&gt;</span> <span class="fu">sapply</span>(mean)</span></code></pre></div>
<pre><code>##        4        6        8 
## 26.66364 19.74286 15.10000</code></pre>
</div>
<div id="tapply" class="section level3" number="7.3.3">
<h3><span class="header-section-number">7.3.3</span> <code>tapply()</code></h3>
<p>The <code>tapply()</code> function(tapply() function) can be thought of combination of <code>split</code> and <code>sapply</code> for vectors, exactly as used in above example. It actually applies the function over subsets of a given vector. The basic syntax is-</p>
<pre><code>tapply(X, INDEX, FUN = NULL, ..., default = NA, simplify = TRUE)</code></pre>
<p>Where -</p>
<ul>
<li><code>X</code> is a vector</li>
<li><code>INDEX</code> is factor or list of factors</li>
<li><code>FUN</code> is function to be applied</li>
<li><code>...</code> are other arguments, if any, of <code>FUN</code> to be passed</li>
<li><code>simplify</code> if TRUE simplifies the result.</li>
</ul>
<p>See this example</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="functional-programming.html#cb657-1" tabindex="-1"></a><span class="fu">tapply</span>(mtcars<span class="sc">$</span>mpg, mtcars<span class="sc">$</span>cyl, mean)</span></code></pre></div>
<pre><code>##        4        6        8 
## 26.66364 19.74286 15.10000</code></pre>
<p>Needless to say if <code>simplify</code> is <code>FALSE</code> the results will not be simplified. See this example-</p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="functional-programming.html#cb659-1" tabindex="-1"></a><span class="co"># month-wise mean of temperatures from `airquality` data</span></span>
<span id="cb659-2"><a href="functional-programming.html#cb659-2" tabindex="-1"></a><span class="fu">tapply</span>(airquality<span class="sc">$</span>Temp, airquality<span class="sc">$</span>Month, mean, <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## $`5`
## [1] 65.54839
## 
## $`6`
## [1] 79.1
## 
## $`7`
## [1] 83.90323
## 
## $`8`
## [1] 83.96774
## 
## $`9`
## [1] 76.9</code></pre>
</div>
<div id="by-function" class="section level3" number="7.3.4">
<h3><span class="header-section-number">7.3.4</span> <code>by()</code> function</h3>
<p>This(by() function) works something like <code>tapply</code> but with the difference that input object here is <code>data.frame</code>. See this example</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="functional-programming.html#cb661-1" tabindex="-1"></a><span class="co"># Split the data by `cyl` column and subset first six rows only</span></span>
<span id="cb661-2"><a href="functional-programming.html#cb661-2" tabindex="-1"></a><span class="fu">by</span>(mtcars, mtcars<span class="sc">$</span>cyl, head)</span></code></pre></div>
<pre><code>## mtcars$cyl: 4
##                 mpg cyl  disp hp drat    wt  qsec vs am gear carb
## Datsun 710     22.8   4 108.0 93 3.85 2.320 18.61  1  1    4    1
## Merc 240D      24.4   4 146.7 62 3.69 3.190 20.00  1  0    4    2
## Merc 230       22.8   4 140.8 95 3.92 3.150 22.90  1  0    4    2
## Fiat 128       32.4   4  78.7 66 4.08 2.200 19.47  1  1    4    1
## Honda Civic    30.4   4  75.7 52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla 33.9   4  71.1 65 4.22 1.835 19.90  1  1    4    1
## ------------------------------------------------------------ 
## mtcars$cyl: 6
##                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Valiant        18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Merc 280       19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C      17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## ------------------------------------------------------------ 
## mtcars$cyl: 8
##                     mpg cyl  disp  hp drat   wt  qsec vs am gear carb
## Hornet Sportabout  18.7   8 360.0 175 3.15 3.44 17.02  0  0    3    2
## Duster 360         14.3   8 360.0 245 3.21 3.57 15.84  0  0    3    4
## Merc 450SE         16.4   8 275.8 180 3.07 4.07 17.40  0  0    3    3
## Merc 450SL         17.3   8 275.8 180 3.07 3.73 17.60  0  0    3    3
## Merc 450SLC        15.2   8 275.8 180 3.07 3.78 18.00  0  0    3    3
## Cadillac Fleetwood 10.4   8 472.0 205 2.93 5.25 17.98  0  0    3    4</code></pre>
</div>
<div id="specifying-the-output-type-with-vapply" class="section level3" number="7.3.5">
<h3><span class="header-section-number">7.3.5</span> Specifying the output type with <code>vapply()</code></h3>
<p>Function <code>vapply()</code>(vapply() function) works exactly like <code>sapply()</code> described above, with only difference that type of return value (output) has to be specifically provided through <code>FUN.VALUE</code> argument. Its syntax is -</p>
<pre><code>vapply(X, FUN, FUN.VALUE, ..., USE.NAMES = TRUE)</code></pre>
<ul>
<li>In the argument <code>FUN.VALUE</code> we have to provide the format type of output. See this example.</li>
</ul>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="functional-programming.html#cb664-1" tabindex="-1"></a><span class="fu">vapply</span>(mtcars, max, <span class="at">FUN.VALUE =</span> <span class="fu">double</span>(<span class="dv">1</span>))</span></code></pre></div>
<pre><code>##     mpg     cyl    disp      hp    drat      wt    qsec      vs      am    gear 
##  33.900   8.000 472.000 335.000   4.930   5.424  22.900   1.000   1.000   5.000 
##    carb 
##   8.000</code></pre>
<p>Through <code>FUN.VALUE = double(1)</code> we have specifically provided that our output should be of <code>double</code> type with length <code>1</code>. So in case we have to find out <code>range</code> of each column-</p>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="functional-programming.html#cb666-1" tabindex="-1"></a><span class="fu">vapply</span>(mtcars, range, <span class="at">FUN.VALUE =</span> <span class="fu">double</span>(<span class="dv">2</span>))</span></code></pre></div>
<pre><code>##       mpg cyl  disp  hp drat    wt qsec vs am gear carb
## [1,] 10.4   4  71.1  52 2.76 1.513 14.5  0  0    3    1
## [2,] 33.9   8 472.0 335 4.93 5.424 22.9  1  1    5    8</code></pre>
<p>If we will try this function on a dataset having mixed type columns like <code>iris</code> dataset, <code>vapply</code> will throw an error.</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="functional-programming.html#cb668-1" tabindex="-1"></a><span class="fu">vapply</span>(iris, range, <span class="at">FUN.VALUE =</span> <span class="fu">double</span>())</span></code></pre></div>
<pre><code>## Error in vapply(iris, range, FUN.VALUE = double()): values must be length 0,
##  but FUN(X[[1]]) result is length 2</code></pre>
</div>
</div>
<div id="purrr" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Functional Programming in <code>purrr</code></h2>
<p>Package <code>purrr</code><a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>, which is part of core <code>tidyverse</code>, enhances R’s functional programming (FP) toolkit by providing a complete and consistent set of tools for working with functions and vectors.</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="functional-programming.html#cb670-1" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code></pre></div>
<div id="iterate-over-single-listvector-with-map_-family-of-functions" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Iterate over single list/vector with <code>map_*()</code> family of functions</h3>
<p>This package has many families of functions; and most primary family is <code>map</code> family of functions. <code>map_*()</code> works nearly similar to <code>vapply</code> where we can control the type of output. The syntax style of each of these functions is nearly same, where these accept one object (list or vector) as <code>.x</code> argument, one function (or alternatively a formula) as <code>.f</code> argument; and outputs an object of specified type.</p>
<p>Example</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="functional-programming.html#cb671-1" tabindex="-1"></a><span class="fu">map</span>(mtcars, <span class="at">.f =</span> sum)</span></code></pre></div>
<pre><code>## $mpg
## [1] 642.9
## 
## $cyl
## [1] 198
## 
## $disp
## [1] 7383.1
## 
## $hp
## [1] 4694
## 
## $drat
## [1] 115.09
## 
## $wt
## [1] 102.952
## 
## $qsec
## [1] 571.16
## 
## $vs
## [1] 14
## 
## $am
## [1] 13
## 
## $gear
## [1] 118
## 
## $carb
## [1] 90</code></pre>
<p>Note that output type is list. If the output can be simplified to an atomic vector we can use either of these functions depending upon the output type of that vector.</p>
<ul>
<li><code>map_lgl</code> for <code>logical</code> format</li>
<li><code>map_int</code> for <code>integer</code> format</li>
<li><code>map_dbl</code> for <code>double</code> format</li>
<li><code>map_chr</code> for <code>character</code> format</li>
</ul>
<p><code>map</code> always return a list.
See these further examples.</p>
<p>Example-1:</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="functional-programming.html#cb673-1" tabindex="-1"></a><span class="fu">map_dbl</span>(mtcars, max)</span></code></pre></div>
<pre><code>##     mpg     cyl    disp      hp    drat      wt    qsec      vs      am    gear 
##  33.900   8.000 472.000 335.000   4.930   5.424  22.900   1.000   1.000   5.000 
##    carb 
##   8.000</code></pre>
</div>
<div id="iterate-over-two-or-more-listsvectors-using-map2_-pmap_-family" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Iterate over two or more lists/vectors using <code>map2_*()</code>/ <code>pmap_*()</code> family</h3>
<p>So far we have seen that <code>map_*()</code> family of functions are used to iterate over elements of a list. Even if extra lists/vectors are provided as extra arguments, these are used as it is, in each iteration, as can be seen in first illustration in figure<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> <a href="functional-programming.html#fig:map2">7.2</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:map2"></span>
<img src="images/map1.png" alt="Working of map vs map2 family of functions \hspace{\textwidth} Source Advanced R by Hadley Wickham" width="49%" /><img src="images/map2.png" alt="Working of map vs map2 family of functions \hspace{\textwidth} Source Advanced R by Hadley Wickham" width="49%" />
<p class="caption">
Figure 7.2: Working of map vs map2 family of functions Source Advanced R by Hadley Wickham
</p>
</div>
<p>In order to iterate over two vectors/lists, we will however, need <code>map2_*()</code> family of functions (Refer second illustration in figure <a href="functional-programming.html#fig:map2">7.2</a>).</p>
<p>See the following example</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="functional-programming.html#cb675-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb675-2"><a href="functional-programming.html#cb675-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>)</span>
<span id="cb675-3"><a href="functional-programming.html#cb675-3" tabindex="-1"></a><span class="fu">map2</span>(x, y, <span class="st">`</span><span class="at">*</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 11
## 
## [[2]]
## [1] 24
## 
## [[3]]
## [1] 39</code></pre>
<p>Similarly, to iterate over multiple lists we will use <code>pmap_*()</code>, with the only difference being that here all the vectors/list should be collectively passed on to <code>pmap</code> in a list. This can be better understood with the illustration used by Hadley Wickham in his <a href="https://adv-r.hadley.nz/functionals.html">book</a>. For reference see figure <a href="functional-programming.html#fig:pmap">7.3</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:pmap"></span>
<img src="images/pmap.png" alt="Working of pmap family of functions \hspace{\textwidth} Source Advanced R by Hadley Wickham" width="49%" /><img src="images/pmap-arg.png" alt="Working of pmap family of functions \hspace{\textwidth} Source Advanced R by Hadley Wickham" width="49%" />
<p class="caption">
Figure 7.3: Working of pmap family of functions Source Advanced R by Hadley Wickham
</p>
</div>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="6">
<li id="fn6"><p>Alan Turing, who created Turing machine which in turn laid the foundation of imperative programming style, was a student of <strong>Alonzo Church</strong>.<a href="functional-programming.html#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p><a href="https://purrr.tidyverse.org/">https://purrr.tidyverse.org/</a><a href="functional-programming.html#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Source: <a href="https://adv-r.hadley.nz/functionals.html">Advanced R</a> by Hadley Wickham<a href="functional-programming.html#fnref8" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Audit Analytics</strong>" was written by Anil Goyal. It was last built on 2024-11-29.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
